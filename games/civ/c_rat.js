/*


 Rat Game Engine

 Copyright 2013-2023 Wahoo Studios, Inc. and Steven H. Taylor.

 See the Rat home page for publicly released versions
 and license information for those public releases:
 http://www.wahoo.com/rat/

*/
'use strict';(function(Na,pd){"object"===typeof exports&&"undefined"!==typeof module?pd(exports):"function"===typeof define&&define.amd?define(["exports"],pd):(Na="undefined"!==typeof globalThis?globalThis:Na||self,pd(Na.rat={}))})(this,function(Na){function pd(L,P){L.autoFill&&(L={percent:!0,val:1});void 0!==L.val&&(L.percent&&(L.val*=P),L.fromParent&&(L.val+=P),L=L.val);return L}function Ze(L,P,Z){void 0===L.val&&(L={val:L});L.percent&&(L.val*=P);if(L.fromCenter)L.val+=P/2;else if(L.fromParentEdge||
L.fromParentFarEdge)L.val=P-L.val;if(L.centered||L.drawCentered||L.center)L.val-=Z/2;else if(L.fromMyEdge||L.fromMyFarEdge)L.val-=Z;return L=L.val}function oe(){ha.autoComplete=[];ha.accessingAutoComplete=-1}function uc(L,P,Z){ha.currentCommand=L;ha.cursorPos=Math.min(Math.max(0,ha.cursorPos),ha.currentCommand.length);P&&(ha.commandHistoryIndex=-1);Z&&oe()}function Ag(L){ha.autoComplete=[];for(var P=L.toUpperCase(),Z=ha.commandList.length,g=0;g!==Z;++g){var c=ha.commandList[g];if(c.name.slice(0,P.length)===
P)ha.autoComplete.push(c.name);else for(var a=c.alias.length,d=0;d!==a;++d)c.alias[d].slice(0,P.length)===P&&ha.autoComplete.push(c.alias[d])}if(0>=ha.autoComplete.length&&(Z=L.lastIndexOf("."),1<Z&&(P=L.substring(0,Z),L=L.substring(Z+1),Z=qd(qc,P),void 0!==Z)))for(var l in Z)!l||L&&l.substring(0,L.length)!==L||ha.autoComplete.push(P+"."+l);ha.autoComplete.sort();ha.accessingAutoComplete=0}function Bd(){var L={x:Ha,y:Ra};if(Cd.x!==L.x||Cd.y!==L.y)Ga.fire("rat_screen_resize",L,Cd),Cd.x=L.x,Cd.y=L.y}
function pe(L,P,Z){this.image=L;this.tpjs=P;this.opts=Z;this.scaledBy=P.meta&&P.meta?Number(P.meta.scale)||1:1;this.undoScaler=1/this.scaledBy;++Ba.numInMemory}function Rd(L){}function bd(L,P){this._stats={name:L,parent:P,time:0,lastTick:void 0,calls:0,hasChildren:!1};this._children={}}function Bg(L){da.curNode._stats.abortProfilerForFrame||(da.curNode=da.curNode.getChild(L),da.curNode.storeTick(),++da.curNode._stats.calls)}function Cg(L){da.curNode._stats.abortProfilerForFrame||(da.curNode._stats.name!==
L||void 0===da.curNode._stats.parent?(z.logError("ERROR!  profiler.push does not match profiler.pop"),da.curNode=da.profileTrees[0],da.curNode._stats.abortProfilerForFrame=!0):(da.curNode.updateElapsed(),da.curNode=da.curNode._stats.parent))}function qb(L,P,Z){Z=Z||0;P=P||0;for(var g=ca;Z--;)L=da.displayInfo.tab+L;P>=da.displayInfo.cols.length&&(P=da.displayInfo.cols.length-1);g.fillText(L,da.displayInfo.atX+da.displayInfo.cols[P],da.displayInfo.curY)}function Sd(){da.displayInfo.curY+=da.displayInfo.lineHeight}
function rd(L,P){return(L/P*100).toFixed(2)+"%"}function Td(L){for(var P=1;P<da.selectedNode.length;++P)L=L.getChild(da.selectedNode[P]);return L}function Dg(){if(da.enableStatsDisplay){var L=ca;if(L){L.save();L.font=da.displayInfo.font;L.fillStyle=da.displayInfo.color;da.displayInfo.curY=da.displayInfo.atY;var P=da.profileTrees[1];if(P._stats.abortProfilerForFrame)qb("***ERROR WITH PROFILER USAGE***",0);else if(P._stats.built){var Z=Td(P),g=Z._stats.parent,c=0;qb("NAME",0,2);qb("% Parent",1,2);qb("% Total",
2,2);qb("MS Total",3,2);qb("MS/call",4,2);qb("calls",5,2);Sd();g?(qb("-"+Z._stats.name,0),qb(rd(Z._stats.time,g._stats.time),1)):qb(" "+Z._stats.name,0);qb(rd(Z._stats.time,P._stats.time),2);qb(Z._stats.time.toFixed(4),3);Z._stats.calls&&(qb((Z._stats.time/Z._stats.calls).toFixed(4),4),qb(Z._stats.calls,5));Sd();for(var a in Z._children){da.highlightedNode||(da.highlightedNode=a);g=Z._children[a];a===da.highlightedNode&&(L.fillStyle=da.displayInfo.highlightColor);var d=" ";g._stats.hasChildren&&(d=
"+");qb(d+g._stats.name,0,1);qb(rd(g._stats.time,Z._stats.time),1);qb(rd(g._stats.time,P._stats.time),2);qb(g._stats.time.toFixed(4),3);Z._stats.calls&&(qb((g._stats.time/g._stats.calls).toFixed(4),4),qb(g._stats.calls,5));Sd();a===da.highlightedNode&&(L.fillStyle=da.displayInfo.color);c+=g._stats.time}Sd();qb(" MISSING TIME",0,1);c=Z._stats.time-c;qb(rd(c,Z._stats.time),1);qb(rd(c,P._stats.time),2);qb(c.toFixed(4),3)}else qb("***STATS PENDING***",0);L.restore()}}}function Eg(L){var P;if("keydown"===
L.eventType){if(da.enableStatsDisplay){if(L.which===la.j)return 1<da.selectedNode.length&&(da.highlightedNode=da.selectedNode.splice(da.selectedNode.length-1,1)[0]),!0;if(L.which===la.l)return L=Td(da.profileTrees[1]),L._children[da.highlightedNode]&&L._children[da.highlightedNode]._stats.hasChildren&&(da.selectedNode.push(da.highlightedNode),da.highlightedNode=void 0),!0;if(L.which===la.i){L=Td(da.profileTrees[1]);var Z="";for(P in L._children){if(P===da.highlightedNode){da.highlightedNode=Z;break}Z=
P}return!0}if(L.which===la.k){Z=!1;L=Td(da.profileTrees[1]);for(P in L._children)if(P===da.highlightedNode)Z=!0;else if(Z){da.highlightedNode=P;break}return!0}}if(L.which===la.p)return da.enableStatsDisplay=!da.enableStatsDisplay,!0}return!1}function $e(){return sa.Wraith?0:window.performance?window.performance.now()/1E3:(new Date).getTime()/1E3}function af(){}function bf(L,P){switch(L.type){case "circle":case "Circle":var Z=new ub.Circle(L);Z.type="circle";var g=Z.center,c=Z.radius;if(void 0===P.left||
P.left>g.x-c)P.left=g.x-c;if(void 0===P.right||P.right<g.x+c)P.right=g.x+c;if(void 0===P.top||P.top>g.y-c)P.top=g.y-c;if(void 0===P.bottom||P.bottom<g.y+c)P.bottom=g.y+c;break;case "rect":case "Rect":case "box":case "Box":Z=new ub.Rect(L);Z.type="rect";if(void 0===P.left||P.left>Z.x)P.left=Z.x;if(void 0===P.right||P.right<Z.x+Z.w)P.right=Z.x+Z.w;if(void 0===P.top||P.top>Z.y)P.top=Z.y;if(void 0===P.bottom||P.bottom<Z.y+Z.h)P.bottom=Z.y+Z.h;break;default:z.logError("ERROR: Un-supported shape found in bounding shape data: "+
L.type);return}Z.type=L.type;L.name&&(Z.name=L.name);Z.children=[];if(L.children)for(g=0,c=L.children.length;g!==c;++g)Z.children.push(bf(L.children[g],P));return Z}function cf(L,P,Z){L=(L%1+1)%1;1<P&&(P=1);1<Z&&(Z=1);var g=6*L|0,c=6*L-g;L=Z*(1-P);var a=Z*(1-P*c);P=Z*(1-P*(1-c));switch(g){case 0:return[Z,P,L];case 1:return[a,Z,L];case 2:return[L,Z,P];case 3:return[L,a,Z];case 4:return[P,L,Z];case 5:return[Z,L,a]}}function df(L,P){var Z=Array.isArray(L)?L:void 0;if(!Z)if(Z=null==L?null:"undefined"!==
typeof Symbol&&L[Symbol.iterator]||L["@@iterator"],null==Z)Z=void 0;else{var g=[],c=!0,a=!1,d;try{for(Z=Z.call(L);!(c=(d=Z.next()).done)&&(g.push(d.value),!P||g.length!==P);c=!0);}catch(m){a=!0;var l=m}finally{try{if(!c&&null!=Z["return"])Z["return"]()}finally{if(a)throw l;}}Z=g}if(!(L=Z||ef(L,P)))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return L}function ef(L,P){if(L){if("string"===
typeof L)return qe(L,P);var Z=Object.prototype.toString.call(L).slice(8,-1);"Object"===Z&&L.constructor&&(Z=L.constructor.name);if("Map"===Z||"Set"===Z)return Array.from(L);if("Arguments"===Z||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Z))return qe(L,P)}}function qe(L,P){if(null==P||P>L.length)P=L.length;for(var Z=0,g=Array(P);Z<P;Z++)g[Z]=L[Z];return g}function Fg(L){z.log("JS ERROR! "+JSON.stringify(L));Ga&&Ga.fire&&Ga.fire("error",{sysEvent:L});L=new window.Windows.UI.Popups.MessageDialog(L.detail.errorUrl+
"\n\tLine:\t"+L.detail.errorLine+"\tCharacter:\t"+L.detail.errorCharacter+"\nMessage: "+(L.detail.message||L.detail.errorMessage),"error"===L.type?"Unhanded Error!":L.type);L.cancelCommandIndex=0;L.defaultCommandIndex=0;L.showAsync();return!0}function Gg(L){L={sysEvent:L};Ga&&Ga.fire&&Ga.fire("resume",L)}function Hg(L){function P(){++c;1===c&&sa.winJS&&g.setPromise(new window.WinJS.Promise(function(l,m,k){a=l}))}function Z(){0>=c||(--c,0===c&&a&&a("Done"))}var g=L,c=0,a,d={};P();L={store:function(l){d=
l},setBusy:P,setDone:Z,sysEvent:g};Ga&&Ga.fire&&Ga.fire("suspend",L);sa.winJS&&(window.WinJS.Application.sessionState.savedState=d);Z()}function Dd(L,P){var Z=L.x-P.x;L=L.y-P.y;return Z*Z+L*L}function ff(L,P,Z){var g=Dd(P,Z);if(0===g)return Dd(L,P);g=((L.x-P.x)*(Z.x-P.x)+(L.y-P.y)*(Z.y-P.y))/g;return 0>g?Dd(L,P):1<g?Dd(L,Z):Dd(L,{x:P.x+g*(Z.x-P.x),y:P.y+g*(Z.y-P.y)})}function gf(L,P){L.lastButtons|=P.lastButtons;L.newButtons|=P.newButtons;L.rawButtons|=P.rawButtons;L.leftStick.x+=P.leftStick.x;L.leftStick.y+=
P.leftStick.y;L.rightStick.x+=P.rightStick.x;L.rightStick.y+=P.rightStick.y;P.leftTrigger>L.leftTrigger&&(L.leftTrigger=P.leftTrigger);P.rightTrigger>L.rightTrigger&&(L.rightTrigger=P.rightTrigger)}function hf(L){L.x=Y.clamp(L.x,-1,1);L.y=Y.clamp(L.y,-1,1);var P=Y.sqrt(L.x*L.x+L.y*L.y);1<P&&(L.x/=P,L.y/=P)}function Ud(L){var P="mousedown";"touchmove"===L.type?P="mousemove":"touchstart"===L.type?P="mousedown":"touchend"===L.type?P="mouseup":"touchcancel"===L.type&&(P="mousecancel");for(var Z=!1,g=
0;g!==L.changedTouches.length;++g){var c=X.setTouchPositionOnEvent(L.changedTouches[g],L);X.mouseToRatEvent(c,P,!0).allowBrowserDefault&&(Z=!0)}Z||L.preventDefault()}function Ig(L){if(X.customUIEventTranslations)for(var P=0;P<X.customUIEventTranslations.length;P++){var Z=X.customUIEventTranslations[P];if(L===Z.which)return Z.result}if(L===la.leftArrow)return"left";if(L===la.upArrow)return"up";if(L===la.rightArrow)return"right";if(L===la.downArrow)return"down";if(L===la.enter)return"enter";if(L===
la.esc||L===la.backspace)return"back";if(L===la.leftSys||L===la.rightSys)return"menu";if(L===la.selectKey)return"view";if(sa.xbox&&X.translateGamePadKeys){P=window.WinJS.Utilities.Key;if(L===P.gamepadDPadLeft||L===P.gamepadLeftThumbstickLeft)return"left";if(L===P.gamepadDPadUp||L===P.gamepadLeftThumbstickUp)return"up";if(L===P.gamepadDPadRight||L===P.gamepadLeftThumbstickRight)return"right";if(L===P.gamepadDPadDown||L===P.gamepadLeftThumbstickDown)return"down";if(L===P.gamepadA)return"enter";if(L===
P.gamepadB)return"back"}return null}function jf(L){L.setSize(L.buttonImage.size.x,L.buttonImage.size.y)}function kf(L){this.isTargetable()&&this.isEnabled()&&this.isVisibleInTree()&&(L={globalPos:this.getGlobalPos(),rect:this.getBounds(this.tempRect),el:this},L.pos={x:L.globalPos.x+L.rect.w/2,y:L.globalPos.y+L.rect.h/2},jc.push(L))}function lf(L){return this.isEnabled()?!1:!0}function mf(L,P,Z,g,c,a){var d=0,l=-1;g=1/g;for(var m=0;m!==jc.length;++m)if(!Z||m!==L){var k=jc[m].pos,f=k.x-P.x;k=k.y-P.y;
var e=(0>k?-k:k)*g,b=(0>f?-f:f)*g;if("right"===c&&0<f&&f>e||"left"===c&&0>f&&-f>e||"down"===c&&0<k&&k>b||"up"===c&&0>k&&-k>b)if("right"===c||"left"===c?f/=a:k/=a,f=f*f+k*k,0>l||f<d)l=m,d=f}return l}function Vd(L,P,Z,g,c){for(var a=g.searchRatioMax||8*g.searchAngleRatio,d,l=g.searchAngleRatio;l<a;l+=1){d=mf(L,P,!0,l,Z,g.directionPreference);if(0<=d)break;if(g.wrapHoriz||g.wrapVert)break}0>d&&(g.wrapHoriz||g.wrapVert)&&(P={x:P.x,y:P.y},"right"===Z&&g.wrapHoriz&&(P.x-=c.size.x),"left"===Z&&g.wrapHoriz&&
(P.x+=c.size.x),"down"===Z&&g.wrapVert&&(P.y-=c.size.y),"up"===Z&&g.wrapVert&&(P.y+=c.size.y),d=mf(L,P,!1,g.searchAngleRatio,Z,g.directionPreference));return 0<=d?jc[d].el:null}window.PACKAGE="bundled";var Cb=function(L,P,Z,g){void 0===g&&(g=!1);if(L&&L.addEventListener)return L.addEventListener(P,Z,g);if(L&&L.attachEvent)return L.attachEvent(P,Z);if("undefined"!==typeof window&&window.addEventListener)return window.addEventListener(P,Z,g)},Fb={list:[],byName:{},add:function(L,P){Fb.list.push(L);
Fb.byName[P]=L},getByName:function(L){return Fb.byName[L]},processUntilResult:function(L){for(var P=Fb.list,Z=arguments.length,g=Array(1<Z?Z-1:0),c=1;c<Z;c++)g[c-1]=arguments[c];for(Z=P.length-1;0<=Z;Z--)if(c=P[Z],c[L]&&(c=c[L].apply(c,g),void 0!==c&&null!==c))return c},processAll:function(L){for(var P=Fb.list,Z=arguments.length,g=Array(1<Z?Z-1:0),c=1;c<Z;c++)g[c-1]=arguments[c];for(Z=P.length-1;0<=Z;Z--)c=P[Z],c[L]&&c[L].apply(c,g)}};window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||
window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(L,P){return window.setTimeout(L,1E3/60)};window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout;"undefined"!==typeof WinJS&&(window.WinJS.Binding.optimizeBindingReferences=!0);var Ga={registered:{},firing:{},queued:{}},re=function(L,P,Z,g){if(P){Ga.registered[L]=
Ga.registered[L]||[];var c=Ga.registered[L];void 0===g&&(g=c.length);c.splice(g,0,{func:P,ctx:Z});Ga.queued[L]&&(Ga.fire.apply(Ga,Ga.queued[L]),Ga.queued[L]=void 0)}};Ga.queueEvent=function(L){var P=Array.prototype.slice.call(arguments),Z=Ga.registered[L];Z&&Z.length?Ga.fire.apply(Ga,P):Ga.queued[L]=P};Ga.fire=function(L){var P=Ga.registered[L];if(!P||0===P.length)return!1;var Z=Array.prototype.slice.call(arguments,1),g=Ga.firing[L];Ga.firing[L]={index:0,stopAt:P.length};for(var c=Ga.firing[L],a,
d;c.index!==c.stopAt;++c.index)a=P[c.index],d=a.func,a=a.ctx,d.apply(a,Z);Ga.firing[L]=g};if(void 0!==window.WinJS){if(window.Windows&&window.Windows.ApplicationModel)var lb=window.Windows.ApplicationModel.Activation;lb||(lb={});lb.ActivationKind||(lb.ActivationKind={});lb.ApplicationExecutionState||(lb.ApplicationExecutionState={});window.WinJS.Application.onactivated=function(L){var P={};switch(L.detail.kind){case lb.ActivationKind.launch:P.kind="launched";break;case lb.ActivationKind.search:P.kind=
"searchWith";break;case lb.ActivationKind.shareTarget:P.kind="shareTarget";break;case lb.ActivationKind.file:P.kind="file";break;case lb.ActivationKind.protocol:P.kind="protocol";break;case lb.ActivationKind.fileOpenPicker:P.kind="fileOpenPicker";break;case lb.ActivationKind.fileSavePicker:P.kind="fileSavePicker";break;case lb.ActivationKind.cachedFileUpdater:P.kind="cachedFileUpdater";break;case lb.ActivationKind.ContactPicker:P.kind="contactPicker";break;case lb.ActivationKind.device:P.kind="autoplay";
break;case lb.ActivationKind.printTaskSettings:P.kind="print";break;case lb.ActivationKind.cameraSettings:P.kind="camera";break;case lb.ActivationKind.restrictedLaunch:P.kind="launched-restricted";break;case lb.ActivationKind.appointmentsProvider:P.kind="appointmentsProvider";break;case lb.ActivationKind.Contact:P.kind="contact";break;case lb.ActivationKind.lockScreenCall:P.kind="launch-locked";break;default:P.kind="unknown"}switch(L.detail.previousExecutionState){case lb.ApplicationExecutionState.notRunning:P.prevState=
"notRunning";break;case lb.ApplicationExecutionState.running:P.prevState="running";break;case lb.ApplicationExecutionState.suspended:P.prevState="suspended";break;case lb.ApplicationExecutionState.terminated:P.prevState="terminated";break;case lb.ApplicationExecutionState.closedByUser:P.prevState="closed";break;default:P.prevState="unknown"}P.sessionState=(window.WinJS.Application.sessionState||{}).savedState;L.setPromise(window.WinJS.UI.processAll().then(function(){Ga.queueEvent("activated",P);"terminated"===
P.prevState&&Ga.queueEvent("resumeFromTerminated",P)}))};window.WinJS.Application.start()}else Ga.queueEvent("activated",{kind:"launched",prevState:"notRunning",sessionState:void 0});var Xb={};try{var se=window.localStorage}catch(L){se=null}se?(Xb.hasLocalStorage=!0,Xb.localStorageObject=se):(Xb.hasLocalStorage=!1,Xb.localStorageObject=null);Xb.getLocalStorage=function(){return Xb.localStorageObject};var Yb=function(L,P){return Object.prototype.hasOwnProperty.call(L,P)},tb=function c(P,Z,g){if("object"!==
typeof P||null===P)return P;Z=Z||!1;g=g||!1;var a=Array.isArray(P)?[]:{};var d;for(d in P){var l=P[d];void 0!==l&&(g||Yb(P,d))&&(a[d]=Z&&"object"===typeof l?c(l,!0,g):l)}return a},vc=function d(Z,g,c,a){c=c||!1;!1===Array.isArray(g)&&(g=[g]);for(var l,m,k=0,f=g.length;k!==f;++k)if(m=g[k],void 0!==m&&m!==Z)if(void 0===Z||null===Z)Z=tb(m,c);else for(var e in m)l=m[e],void 0!==l&&(void 0===Z[e]||null===Z[e]&&a?Z[e]="object"===typeof l&&c?tb(l,!0):l:"object"===typeof Z[e]&&"object"===typeof l?d(Z[e],
[l],c,a):a&&(Z[e]=l));return Z},nf=function(Z,g,c,a,d){d=vc(d||{},{enumerable:!0,configurable:!1});c&&(d.set=c);a&&(d.get=a);Object.defineProperty(Z||{},g,d);return Z},of=function k(g,c,a,d,l,m){function f(){for(var h=0;h<d;h++)a+=m}function e(h,n){if("undefined"!==typeof h)if(f(),""!==n&&(a+=""+n+" : "),Array.isArray(h)){a+="[\n";d++;for(n=0;n<h.length;n++)e(h[n],"");d--;f();a+="],\n"}else null===h?a+="null,\n":"function"===typeof h?a+="/*function*/,\n":"object"===typeof h?d>=l?a+="{...},\n":(a+=
"{\n",a=k(h,"",a,d,l-1,m),f(),a+="},\n"):a="string"===typeof h?a+("'"+h.toString()+"',\n"):"undefined"===typeof h?a+"x_x_undefined,\n":a+(h.toString()+",\n")}a=a||"";d||(d=0);l=void 0!==l?l:10;m=void 0!==m?m:"  ";""!==c&&(f(),a+=c+"{\n");d++;for(var b in g)Yb(g,b)&&e(g[b],b);d--;""!==c&&(f(),a+="};\n");return a},qd=function(g,c){c=c.split(".");for(var a=0,d=c.length;a<d;a++){var l=c[a];if("]"===l.substring(l.length-1)){var m=l.indexOf("["),k=l.substring(m+1,l.length-1);k=parseInt(k,10);isNaN(k)&&
(k=0);l=l.substring(0,m);g=g[l];l=k}if(!g)break;g=g[l];if("undefined"===typeof g)break}return g},Ed=function(g,c,a){c=c.split(".");for(var d,l=0,m=c.length;l<m;l++){d=c[l];var k=d.indexOf("[");if(0<=k){var f=d.indexOf("]"),e=d.substring(0,k);d=d.substring(k+1,f);d=parseInt(d);if("undefined"===typeof g[e]||null===g[e])g[e]=[];g=g[e]}if(l===m-1)break;e=g[d];if("undefined"===typeof e||null===e)e=g[d]={};g=e}g[d]=a},la={leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,enter:13,esc:27,backspace:8,insert:45,
del:46,space:32,home:36,end:35," ":32,tab:9,pageUp:33,pageDown:34,period:190,semicolon:186,singleQuote:222,comma:188,shift:16,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,numPad0:96,numPad1:97,numPad2:98,numPad3:99,numPad4:100,numPad5:101,numPad6:102,numPad7:103,numPad8:104,numPad9:105,asterisk:106,numPadForwardSlash:111,numPadPlus:107,numPadMinus:109,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,"~":192,tilde:192,
"`":192,backTick:192,"-":189,"=":187,leftSys:91,rightSys:92,ctrlKey:17,selectKey:93,"/":191,forwardSlash:191,"\\":220,backslash:220,leftBracket:219,rightBracket:221,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},te={calcBounds:function(g,c){g=tb(g.bounds||{},!0);g.x=g.x||0;g.y=g.y||0;g.w=g.w||0;g.h=g.h||0;if(g.noChange)return g;if(g.autoFill)return{x:0,y:0,w:c.w,h:c.h};g.w=pd(g.w,c.w);g.h=pd(g.h,c.h);g.x=Ze(g.x,c.w,g.w);g.y=Ze(g.y,c.h,g.h);return g}},Y={};
Y.PI=Math.PI;Y.PI2=2*Math.PI;Y.TAU=2*Math.PI;Y.HALFPI=Math.PI/2;Y.E=Math.E;Y.MAX_NUMBER=Number.MAX_VALUE;Y.MIN_NUMBER=Number.MIN_VALUE;Y.DegreesToRadians=Y.PI/180;Y.RadiansToDegrees=180/Y.PI;Y.abs=Math.abs;Y.min=Math.min;Y.max=Math.max;Y.ceil=Math.ceil;Y.floor=Math.floor;Y.round=Math.round;Y.cos=Math.cos;Y.sin=Math.sin;Y.tan=Math.tan;Y.acos=Math.acos;Y.asin=Math.asin;Y.atan=Math.atan;Y.atan2=Math.atan2;Y.random=Math.random;Y.sqrt=Math.sqrt;Y.log=Math.log;Y.exp=Math.exp;Y.pow=Math.pow;Y.randomRange=
function(g,c){return Y.random()*(c-g)+g};Y.clamp=function(g,c,a){return g<c?c:g>a?a:g};Y.limit=Y.clamp;Y.interpolate=function(g,c,a){return c*a+(1-a)*g};Y.interp=Y.interpolate;Y.interpolateClamped=function(g,c,a){0>a&&(a=0);1<a&&(a=1);return c*a+(1-a)*g};Y.interpolatePos=function(g,c,a,d){d=d||{};d.x=c.x*a+(1-a)*g.x;d.y=c.y*a+(1-a)*g.y;return d};Y.signOf=function(g){return 0<g?1:1>g?-1:0};Y.randomVariance=function(g){return g?2*g*Y.random()-g:0};var ec=Xb.getLocalStorage(),qc="undefined"===typeof window?
global:window,Fd=qc.console,z={output:[],saveOutputToLocalStorage:!1,copyToSystem:!1,copyErrorsToSystem:!0,logRemotely:!1,remoteURL:!1,maxLogLines:200,onceRecord:{},logPrefix:"|",lastText:"",repeat:0,config:{bounds:{x:48,y:0,w:{fromParent:!0,val:-96},h:{percent:!0,val:.6}},textColor:"#90B090",textSize:40,logLineHeight:42,bgColor:"rgba(0,0,0,0.5)"},configChanged:{}};z.state={consoleAllowed:!1,consoleActive:!1,cursorPos:0,pulseTimer:0,currentCommand:"",nextCommandID:0,commandList:[],commandHistory:[],
commandHistoryIndex:-1,commandHistoryMax:100,timeStart:Date.now(),prevTime:Date.now(),runningTime:0,autoComplete:[],accessingAutoComplete:-1,logOffset:0,consoleKey:"/",consoleKey2:"`",consoleAltKey:!1,consoleCtrlKey:!1,consoleShiftKey:!1,ctx:null,graphics:null,draw:null};var ha=z.state;z.loadConfig=function(){if(ec){var g=ec.getItem("rat_commandHistory");g&&(z.state.commandHistory=JSON.parse(g));if(g=ec.getItem("rat_consoleConfig")){g=JSON.parse(g);for(var c in g)z.config[c]&&(z.config[c]=g[c],z.configChanged[c]=
!0)}}};z.loadConfig();z.log=function(g,c){var a=z.output;g===z.lastText?(z.repeat+=1,a[a.length-1]=z.logPrefix+"(X"+z.repeat+") "+z.lastText):(z.lastText=g,z.repeat=1,a.push(z.logPrefix+" "+g),a.length>z.maxLogLines&&a.splice(0,1));z.saveOutputToLocalStorage&&ec&&ec.setItem("RAT_LOG",JSON.stringify(a));(z.copyToSystem&&"error"!==c||z.copyErrorsToSystem&&"error"===c)&&!z.redirectedSystem&&("error"===c?Fd.error(z.logPrefix+g):"warning"===c?Fd.warn(z.logPrefix+g):Fd.log(z.logPrefix+"%c"+g,"background:#505050; color:lightcyan;"),
qc.Debug&&qc.Debug.writeln&&qc.Debug.writeln(z.logPrefix+g));z.logRemotely&&z.remoteURL&&(c=new XMLHttpRequest,c.open("GET",z.remoteURL+g,!0),c.send());z.logCustom&&z.logCustom(g,z.repeat)};z.error=function(g){z.log(g,"error")};z.logError=function(){z.error.apply(z,arguments)};z.warn=function(g){z.log(g,"warning")};z.logWarning=function(){z.warn.apply(z,arguments)};z.info=function(g){z.log(g)};z.logInfo=function(){z.info.apply(z,arguments)};z.assert=function(g,c){if(!g){z.log(c||"(rat assert with no message)",
"error");debugger}};z.logNewlines=function(g){if(g){g=g.toString();g=g.split("\n");for(var c=g.length;""===g[c-1];)c--;for(var a=0;a<c;++a)z.log(g[a])}};z.redirectSystemConsole=function(g){void 0===g&&(g=!0);g&&!z.redirectedSystem?(g=function(c){z.redirectedSystem=!0;z.systemConsole=c;return{log:function(){z.log.apply(z,arguments)},info:function(){z.info.apply(z,arguments)},warn:function(){z.warn.apply(z,arguments)},error:function(){z.error.apply(z,arguments)},assert:function(){z.assert.apply(z,arguments)},
clear:function(){}}}(Fd),qc.console=g):!g&&z.redirectedSystem&&(Fd=z.systemConsole,z.redirectedSystem=!1)};z.writeConfig=function(g){Array.isArray(g)||(g=[g]);for(var c=0;c<g.length;c++)z.configChanged[g[c]]=!0;if(ec){g={};for(var a in z.configChanged)g[a]=z.config[a];ec.setItem("rat_consoleConfig",JSON.stringify(g))}};z.clearConfig=function(){ec&&ec.removeItem("rat_consoleConfig");z.configChanged={}};z.setBounds=function(g,c,a,d){g.x?(z.config.bounds.x=g.x,z.config.bounds.y=g.y,z.config.bounds.w=
g.w,z.config.bounds.h=g.h):(z.config.bounds.x=g,z.config.bounds.y=c,z.config.bounds.w=a,z.config.bounds.h=d)};z.getBounds=function(){var g=z.config.bounds;ha.graphics&&(g=te.calcBounds({bounds:g},{x:0,y:0,w:ha.graphics.SCREEN_WIDTH,h:ha.graphics.SCREEN_HEIGHT}));return g};z.setTextSize=function(g,c){z.config.textSize=g;c||(c=Math.floor(1.1*g));z.config.logLineHeight=c};z.allow=function(g){void 0===g&&(g=!0);z.state.consoleAllowed=!!g};z.activate=function(g){void 0===g&&(g=!0);z.state.consoleActive=
!!g};z.logOnce=function(g,c,a,d){c||(c=g);a||(a=1);z.onceRecord[c]||(z.onceRecord[c]=0);z.onceRecord[c]++;z.onceRecord[c]<=a&&z.log(g,d)};z.logWarningOnce=function(g,c,a){z.logOnce(g,c,a,"warning")};z.logErrorOnce=function(g,c,a){z.logOnce(g,c,a,"error")};z.attachGraphics=function(g,c,a){z.state.ctx=g;z.state.graphics=c;z.state.draw=a};z.drawConsole=function(){if(z.state.consoleAllowed&&z.state.consoleActive&&z.state.ctx&&z.state.graphics&&z.state.draw){var g=z.getBounds();ha.draw.drawRect(g,{fill:!0,
color:z.config.bgColor});ha.draw.drawRect(g,{color:z.config.bgColor,lineWidth:2});var c=tb(g);c.h-=z.config.logLineHeight+7;z.drawLog(c);c.y=c.h;c.h=g.h-c.h;ha.draw.drawRect(c,{color:z.config.bgColor,lineWidth:2});c.x+=4;c.y+=4;var a=Date.now();ha.runningTime=(a-ha.timeStart)/1E3;g=(a-ha.prevTime)/1E3;ha.prevTime=a;a=ha.runningTime||0;var d=a/60/60|0;a-=3600*d;var l=a/60|0;a=""+d+":"+l+":"+(a-60*l|0);d=ha.graphics.ctx.measureText(a);void 0!==d.width&&(d=d.width);ha.draw.drawText(a,c.x+c.w-d-8,c.y);
z.config.identifier&&(ha.graphics.ctx.textAlign="right",ha.draw.drawText(""+z.config.identifier,c.x+c.w-8,c.y-z.config.logLineHeight));ha.graphics.ctx.textAlign="left";ha.draw.drawText("> "+ha.currentCommand,c.x,c.y);g=ha.pulseTimer=(ha.pulseTimer+g)%.6;.6<g&&(g=0);.3>g&&(g=ha.currentCommand.slice(0,ha.cursorPos),d=ha.graphics.ctx.measureText("> "+g),d=d.width||d,c.x+=d,ha.graphics.ctx.fillStyle="white",ha.graphics.ctx.font=" bold"+ha.graphics.ctx.font,ha.draw.drawText("|",c.x,c.y))}};z.drawLog=function(g){g=
g||z.config.bounds;var c=z.output,a=ha.graphics.ctx;if(ha.ctx&&ha.graphics&&ha.draw){var d=z.config.logLineHeight,l=g.x,m=g.y,k=g.w,f=g.h;0>k&&(k=ha.graphics.SCREEN_WIDTH-l-10);0>f&&(f=ha.graphics.SCREEN_HEIGHT-m-10);a.font=""+z.config.textSize+"px Arial";a.textAlign="left";a.fillStyle=z.config.textColor;g=f-0-d*c.length;f+=m;g+=(z.state.logOffset-1)*d;a.textBaseline="top";for(var e=0;e<c.length&&!(g+d>m&&a.fillText(c[e],l,g,k),g+=d,g+d>=f&&0<z.state.logOffset&&(a.fillText("...",l,g,k),g+=d),g>=f);e++);
}};z.insertCommandText=function(g){var c=z.state;c.currentCommand=c.currentCommand.slice(0,c.cursorPos)+g+c.currentCommand.slice(c.cursorPos);c.cursorPos+=g.length;oe()};z.handleEvent=function(g){function c(d){ha.consoleActive&&"\n"!==d&&"\t"!==d&&d!==ha.consoleKey&&d!==ha.consoleKey2&&(ha.currentCommand=ha.cursorPos===ha.currentCommand.length?ha.currentCommand+d:0===ha.cursorPos?d+ha.currentCommand:ha.currentCommand.slice(0,ha.cursorPos)+d+ha.currentCommand.slice(ha.cursorPos),ha.cursorPos++,oe())}
if("keydown"!==g.eventType&&"keypress"!==g.eventType)return!1;var a=g.sysEvent.shiftKey;if("keydown"===g.eventType){if(g.which===la.f12)return!1;if((g.which===la[ha.consoleKey]||g.which===la[ha.consoleKey2])&&g.sysEvent.altKey===ha.consoleAltKey&&g.sysEvent.ctrlKey===ha.consoleCtrlKey&&g.sysEvent.shiftKey===ha.consoleShiftKey||g.which===la.esc&&z.state.consoleActive)return z.state.consoleActive=!z.state.consoleActive,!0;if(z.state.consoleActive)g.allowBrowserDefault=!0;else return!1;if(g.which===
la.enter)g.sysEvent.preventDefault(),ha.currentCommand=ha.currentCommand.trim(),ha.currentCommand&&ha.commandHistory[ha.commandHistory.length]!==ha.currentCommand&&(ha.commandHistory.unshift(ha.currentCommand),ha.commandHistory.length>ha.commandHistoryMax&&ha.commandHistory.pop(),ec&&ec.setItem("rat_commandHistory",JSON.stringify(ha.commandHistory))),ha.currentCommand&&z.parseCommand(ha.currentCommand.trim()),uc("",!0,!0);else if(g.which===la.space)g.sysEvent.preventDefault(),c(" ");else if(g.which===
la.backspace)g.sysEvent.preventDefault(),0<ha.cursorPos&&(--ha.cursorPos,uc(ha.currentCommand.slice(0,ha.cursorPos)+ha.currentCommand.slice(ha.cursorPos+1),!1,!0));else if(g.which===la.del)g.sysEvent.preventDefault(),ha.cursorPos<ha.currentCommand.length&&uc(ha.currentCommand.slice(0,ha.cursorPos)+ha.currentCommand.slice(ha.cursorPos+1),!1,!0);else if(g.sysEvent.shiftKey&&(g.which===la.upArrow||g.which===la.downArrow))a=z.config.textSize,g.which===la.upArrow?a+=2:g.which===la.downArrow&&(a-=2,4>a&&
(a=4)),z.setTextSize(a),z.writeConfig(["textSize","logLineHeight"]);else if(g.which===la.upArrow||g.which===la.downArrow)g.sysEvent.preventDefault(),uc(ha.currentCommand.trim(),!1,!1),g.which===la.upArrow?++ha.commandHistoryIndex:--ha.commandHistoryIndex,-1>ha.commandHistoryIndex?ha.commandHistoryIndex=-1:0===ha.commandHistoryIndex&&0===ha.commandHistory.length?uc("",!0,!0):ha.commandHistoryIndex>=ha.commandHistory.length?(ha.commandHistoryIndex=ha.commandHistory.length-1,uc(ha.commandHistory[ha.commandHistoryIndex],
!1,!1)):-1===ha.commandHistoryIndex?uc("",!1,!1):(uc(ha.commandHistory[ha.commandHistoryIndex],!1,!0),ha.cursorPos=ha.currentCommand.length);else if(g.which===la.leftArrow||g.which===la.rightArrow)g.sysEvent.preventDefault(),g.which===la.leftArrow?--ha.cursorPos:++ha.cursorPos,ha.cursorPos=Math.max(0,ha.cursorPos),ha.cursorPos=Math.min(ha.cursorPos,ha.currentCommand.length);else if(g.which===la.home)g.sysEvent.preventDefault(),ha.cursorPos=0;else if(g.which===la.end)g.sysEvent.preventDefault(),ha.cursorPos=
ha.currentCommand.length;else if(g.which===la.tab)g.sysEvent.preventDefault(),-1===ha.accessingAutoComplete&&(uc(ha.currentCommand.trim(),!1,!1),Ag(ha.currentCommand)),0<ha.autoComplete.length&&(uc(ha.autoComplete[ha.accessingAutoComplete],!0,!1),ha.cursorPos=ha.currentCommand.length,a?(ha.accessingAutoComplete--,0>ha.accessingAutoComplete&&(ha.accessingAutoComplete=ha.autoComplete.length-1)):(ha.accessingAutoComplete++,ha.accessingAutoComplete>=ha.autoComplete.length&&(ha.accessingAutoComplete=0)));
else if(g.which===la.pageUp||g.which===la.pageDown)g.sysEvent.preventDefault(),a=z.getBounds().h/z.config.logLineHeight/4|0,a=Math.max(1,a),z.state.logOffset=g.which===la.pageUp?z.state.logOffset+a:z.state.logOffset-a,z.state.logOffset=Y.clamp(z.state.logOffset,0,z.output.length-1)}else if("keypress"===g.eventType){if(!z.state.consoleActive)return!1;g=g.key;if(32>g.charCodeAt(0))return!1;c(g)}return!0};z.registerCommand=function(g,c,a){var d={};d.name=g.toUpperCase();d.func=c;d.id=ha.nextCommandID++;
a&&!Array.isArray(a)&&(a=[a]);d.alias=a||[];g=d.alias.length;for(c=0;c<g;c++)d.alias[c]=d.alias[c].toUpperCase();ha.commandList.push(d);return d.id};z.unregisterCommand=function(g){for(var c=ha.commandList.length,a=0;a<c;a++)if(ha.commandList[a].id===g)return ha.commandList.splice(a,1),!0;return!1};z.getCommand=function(g){g=g.toUpperCase();for(var c=ha.commandList.length,a=0;a!==c;++a){var d=ha.commandList[a];if(d.name===g)return d;for(var l=0;l!==d.alias.length;++l)if(d.alias[l]===g)return d}};
z.parseCommand=function(g){var c=g,a=g.split(/\s+/);g=a[0];a.splice(0,1);var d=z.getCommand(g);if(d)d.func(g,a,c);else{try{var l=qd(qc,c)}catch(m){return z.log(c),z.logError("ERROR evaluating expression: "+m.toString()),!0}void 0!==l?z.dumpValue(l,c+" == "):z.logError(""+c+" : undefined")}return!0};z.dumpValue=function(g,c){c=c||"";switch(typeof g){case "object":null===g?c+="NULL":(z.log("------------"),g=of(g,c,null,0,0,".."),z.logNewlines(g),c=null);break;case "boolean":c+=g.toString();break;case "number":c+=
g.toString();break;case "string":c+="'"+g.toString()+"'";break;case "function":c+="function";break;case "undefined":c+="undefined"}c&&z.log(c)};z.listCommands=function(){for(var g=ha.commandList.length,c=0;c!==g;++c){var a=ha.commandList[c],d="    "+a.name;if(a.alias.length){d+="  (";for(var l=0;l!==a.alias.length;++l)d+=a.alias[l]+" ";d+=")"}z.log(d)}};z.registerCommand("help",function(){z.log("-------------------------------------");z.log("rat console help:");z.log("* up/down arrows navigate command history");
z.log("* shift up/down arrows change font size");z.log("* commands:");z.listCommands()},["?"]);z.registerCommand("refreshpage",function(g,c){c=c.join(" ");"?"===c||"HELP"===c||"Help"===c||"help"===c||"man"===c?(z.log("-------------------------------------"),z.log("REFRESH <?>"),z.log("* reload the page.")):qc.document&&qc.document.location&&qc.document.location.reload&&qc.document.location.reload(!0)},["restartapp","resetapp","reloadpage"]);z.registerCommand("consolelog",function(g,c){z.log(c.join(" "))});
z.registerCommand("saveLog",function(){z.saveOutputToLocalStorage=!z.saveOutputToLocalStorage;z.log("Log will "+(z.saveOutputToLocalStorage?"":" not ")+" save.")});z.registerCommand("restoreLog",function(){if(ec){var g=JSON.parse(ec.getItem("RAT_LOG"));g&&Array.isArray(g)?(z.output=g,z.log("Log restored")):z.log("Failed to restore log")}else z.logError("ERROR! localStorage not supported")});z.registerCommand("clear",function(g,c){z.output=[]},["cls","clearLog"]);z.registerCommand("alias",function(g,
c){if(g=c[0]){c.splice(0,1);z.registerCommand(g,function(d,l){d=z.getCommand(d);z.parseCommand(d.aliasedTo+" "+l.join(" "))});var a=z.getCommand(g);a.aliasedTo=c.join(" ");z.log("Added alias "+g+"="+a.aliasedTo)}});"undefined"!==typeof window&&window.addEventListener("paste",function(g){if(z.state.consoleActive&&g.clipboardData){g.preventDefault();var c=g.clipboardData.items;if(c)for(var a=0;a<c.length;a++){var d=g.clipboardData.items[a];if("string"===d.kind){d.getAsString(function(l){z.insertCommandText(l)});
break}}}},!1);var sa={};(function(){sa.pointer=!0;"undefined"===typeof window?(sa.nodejs=!0,global.window={},global.navigator={userAgent:"ratInNode"},global.document={}):sa.nodejs=!1;navigator.gamepadInputEmulation&&(navigator.gamepadInputEmulation="keyboard");if("undefined"!==typeof Windows&&"undefined"!==typeof MSApp){sa.windows=!0;sa.windows10=!0;var g=Windows.System.Profile.AnalyticsInfo.VersionInfo||Windows.System.Profile.AnalyticsInfo.versionInfo;g&&(g=g.DeviceFamily||g.deviceFamily)&&-1<g.indexOf("Xbox")&&
(sa.uwpXbox=!0,sa.pointer=!1,Windows.UI.ViewManagement.ApplicationViewScaling.trySetDisableLayoutScaling(!0),Windows.UI.ViewManagement.ApplicationView.getForCurrentView().setDesiredBoundsMode(Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow))}else"undefined"!==typeof Windows&&"undefined"!==typeof WinJS&&(sa.windows=!0,sa.windows8=!0,void 0===window.Windows.Xbox&&(sa.realWindows8=!0));/MSAppHost/.test(navigator.userAgent)&&(sa.msAppHost=!0);window.Windows&&void 0!==window.Windows.Xbox&&
(sa.xbox=!0,sa.pointer=!1);"undefined"!==typeof WinJS&&(sa.winJS=!0);"undefined"!==typeof Wraith&&Wraith&&Wraith.w_isNative&&(sa.Wraith=!0);g=navigator;sa.gamepadAPI=!!g.getGamepads||!!g.gamepads||!!g.mozGetGamepads||!!g.mozGamepads||!!g.webkitGetGamepads||!!g.webkitGamepads;sa.iOSBrowser=!1;!window.MSStream&&g&&document&&("iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(g.platform)||g.userAgent.includes("Mac")&&"ontouchend"in document)&&(sa.iOSBrowser=!0);g&&
0<=g.userAgent.search("PlayStation 4")?sa.PS4Browser=!0:sa.PS4Browser=!1;if(g&&0<=g.userAgent.search("Chrome")){sa.chromeBrowser=!0;var c=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);sa.chromeVersion=c?parseInt(c[2],10):0}else sa.chromeBrowser=!1;g&&-1!==g.userAgent.indexOf("Firefox/")?sa.firefoxBrowser=!0:sa.firefoxBrowser=!1;g&&-1!==g.userAgent.indexOf("Gecko/")?sa.geckoBrowser=!0:sa.geckoBrowser=!1;g&&(0<=g.userAgent.search("MSIE")||0<=g.userAgent.search("Edge"))?(sa.IEBrowser=!0,g&&0<=
g.userAgent.search("Edge/")?(c=navigator.userAgent.match(/Edge\/(\d+)/),sa.IEVersion=c?parseInt(c[1],10):0):g&&0<=g.userAgent.search("like Gecko")?sa.IEVersion=11:g&&0<=g.userAgent.search("MSIE 10")?sa.IEVersion=10:g&&0<=g.userAgent.search("MSIE 9")?sa.IEVersion=9:sa.IEVersion=0,sa.chromeBrowser=!1,sa.chromeVersion=void 0,sa.firefoxBrowser=!1,sa.geckoBrowser=!1):sa.IEBrowser=!1;"undefined"!==typeof chrome&&chrome.app&&chrome.app.runtime&&(sa.chromeApp=!0);/Mobi/.test(navigator.userAgent)&&(sa.mobile=
!0);sa.cpuClass=g&&g.cpuClass?g.cpuClass:"unknown";"undefined"!==typeof QUnit&&(sa.QUnit=!0,sa.unitTest=!0);sa.electronProcess=!!(window.process&&window.process.versions&&window.process.versions.electron);sa.electronProcessVersion=sa.electron?window.process.versions.electron:0;sa.electron=/electron/i.test(navigator.userAgent);sa.localStorage=Xb.hasLocalStorage;try{var a=document.cookie}catch(d){a=null}sa.cookies=a?!0:!1})();var Ha=0,Ra=0,yb={x:1,y:1},wc=1,Jb=null,xc=1,Wd=!1,sd="#000000",La=null,ca=
null,Ic="fullscreen",cd=0,dd={totalElementsDrawn:0},pf=function(){cd++},Xd="default",Vc={},qf=[],Gd=function(g,c){Ha=g;Ra=c},rf=function(g){wc=g},sf=function(g){La=g},tf=function(g){ca=g},uf=function(g){xc=g},gb=function(g){if(g&&Vc[g]){var c=Vc[g];qf.push({activeContextID:Xd,canvas:La,ctx:ca,SCREEN_WIDTH:Ha,SCREEN_HEIGHT:Ra});Xd=g;c.canvas&&(La=c.canvas);c.ctx&&(ca=c.ctx);c.SCREEN_WIDTH&&(Ha=c.SCREEN_WIDTH);c.SCREEN_HEIGHT&&(Ra=c.SCREEN_HEIGHT)}return ca},vf=function(g){return Vc[g]},Yd=function(g){g&&
Vc[g]&&(Xd!==g&&z.logOnce("Warning - this graphics context was not on the top of the stack: "+g),(g=qf.pop())?(Xd=g.activeContextID,La=g.canvas,ca=g.ctx,Ha=g.SCREEN_WIDTH,Ra=g.SCREEN_HEIGHT):z.logError("unexpected empty context stack"))},wf=function(g,c){Vc[g]=c},xf=function(g,c){Wd=g;"undefined"!==typeof c&&(sd=c)},yf=function(g,c){Jb={x:g,y:c}},zf=function(){Jb={x:0,y:0}},td=function(){return yb.x&&yb.y&&(1!==yb.x||1!==yb.y)},ue=function(g,c){yb.x=g||1;yb.y=c||1;Gd((La.width+.5)/yb.x|0,(La.height+
.5)/yb.y|0);Bd()},Af=function(){yb.x=1;yb.y=1;Ha=La.width;Ra=La.height;Bd()},Cd={x:0,y:0},Zd=function(){if(window.Windows&&window.Windows.UI&&window.Windows.UI.ViewManagement.ApplicationViewState){var g=window.Windows.UI.ViewManagement.ApplicationViewState;switch(window.Windows.UI.ViewManagement.ApplicationView.value){case g.fullScreenLandscape:Ic="fullscreen";break;case g.filled:Ic="filled";break;case g.snapped:Ic="snapped";break;case g.fullscreenPortrait:Ic="fullscreenPortrait";break;default:Ic=
"unknown"}}else Ic="fullscreen";return Ic},Hd=function(g){g||(g=ca);var c=window.devicePixelRatio||1;g=g.webkitBackingStorePixelRatio||g.mozBackingStorePixelRatio||g.msBackingStorePixelRatio||g.oBackingStorePixelRatio||g.backingStorePixelRatio||1;if(sa.windows&&Windows&&Windows.Graphics&&Windows.Graphics.Display){var a=Windows.Graphics.Display.DisplayInformation?Windows.Graphics.Display.DisplayInformation.getForCurrentView():Windows.Graphics.Display.DisplayProperties;a&&(g=100,c=a.resolutionScale)}return{ratio:c/
g,devicePixelRatio:c,backingStoreRatio:g}},Bf=Object.freeze({__proto__:null,get SCREEN_WIDTH(){return Ha},get SCREEN_HEIGHT(){return Ra},globalScale:yb,get outerScale(){return wc},get globalTranslate(){return Jb},get canvasPixelRatio(){return xc},get autoClearCanvas(){return Wd},get autoClearColor(){return sd},get canvas(){return La},get ctx(){return ca},minAutoScale:1E-7,get viewState(){return Ic},get frameIndex(){return cd},frameStats:dd,incFrameIndex:pf,setScreenSize:Gd,setOuterScale:rf,setCanvas:sf,
setContext:tf,setCanvasPixelRatio:uf,getContext:gb,getContextProperties:vf,doneWithContext:Yd,registerContext:wf,setAutoClear:xf,setGlobalTranslate:yf,clearGlobalTranslate:zf,hasGlobalScale:td,setGlobalScale:ue,clearGlobalScale:Af,screenSizeChanged:Bd,updateViewState:Zd,getDevicePixelRatio:Hd}),rc={reportRawLoads:!1,loading:[],load:function(g,c,a){for(var d=0;d<rc.loading.length;d++){var l=rc.loading[d];if(l.source===g)return c&&l.onLoads.push(c),a&&l.onErrors.push(a),l}var m={source:g,image:null,
onLoads:[],onErrors:[]};rc.loading.push(m);c&&m.onLoads.push(c);a&&m.onErrors.push(a);c=new Image;m.image=c;c.valid=!1;c.error=!1;c.onload=function(k){0===this.width&&z.logError("NEED UWP SIZE HACK");this.onload=null;this.valid=!0;for(k=0;k<m.onLoads.length;k++)m.onLoads[k](this,m);rc.removeLoad(g)};c.onerror=function(k){this.onerror=null;z.logError("ERROR loading image "+this.src);this.error=!0;for(k=0;k<m.onLoads.length;k++)m.onErrors[k](this,m);rc.removeLoad(g)};rc.reportRawLoads&&z.log("Loading image "+
g+"...");c.src=g;return m},removeLoad:function(g){for(var c=0;c<rc.loading.length;c++)if(rc.loading[c].source===g)return rc.loading.splice(c,1),!0;return!1}},Id=function(g){var c=g.lastIndexOf("/"),a=g.lastIndexOf("\\");a>c&&(c=a);return 0>c?g:g.substring(c+1)},Cf=function(g){var c=g.lastIndexOf(".");return 0<=c?g.substring(0,c):g},Df=function(g){return Cf(Id(g))},$d=function(g,c){void 0===c&&(c=!0);var a=g.lastIndexOf("/"),d=g.lastIndexOf("\\");d>a&&(a=d);if(0>a)return"";c&&a++;return g.substring(0,
a)},ud=function(g){for(;0<=g.indexOf("\\");)g=g.replace("\\","/");for(;0<=g.indexOf("//");)g=g.replace("//","/");for(var c=!0,a=0;c;){c=!1;var d=g.indexOf("/../",a),l=g.indexOf("/./",a);if(0<=d&&(0>l||d<=l)){c=!0;a=d+3;var m=g.substring(0,d).lastIndexOf("/");0<=m&&(g=g.substring(0,m)+g.substring(d+3))}!c&&0<=l&&(c=!0,a=l+2,g.splice(l,2))}return g},Jc={rootFolder:null,rootSubFolder:!1,ratAltFolder:null,applyCacheBuster:!1,applyVersion:null},ac=function(g){if(0===g.length)return g;var c=-1<g.search(/^http/);
c||(Jc.rootFolder&&(g=Jc.rootFolder+g,g=ud(g)),Jc.ratAltFolder&&"rat/"===g.substring(0,4)&&(g=Jc.ratAltFolder+g.substring(4)),Jc.rootSubFolder&&(g="../"+g),Jc.applyCacheBuster&&(g=g+"?_="+Math.random()),Jc.applyVersion&&(g=g+"?v="+Jc.applyVersion));return g},Oa={list:[],byName:{},leftToLoadCount:0,loadedCount:0,preLoadImages:function(g){Array.isArray(g)||(g=[g]);for(var c=0,a=0;a<g.length;a++){var d=g[a];if(Oa.findInCache(d))c++;else{Oa.leftToLoadCount+=1;var l={assetName:d,loaded:!1};Jg(l);Oa.byName[d]=
l;Oa.list.push(l)}}}},Jg=function(g){var c=g.assetName,a=ac(c);rc.load(a,function(d,l){g.asset=d;g.loaded=!0;--Oa.leftToLoadCount;++Oa.loadedCount},function(d,l){Oa.removeFromCache(c);--Oa.leftToLoadCount})};Oa.addToCache=function(g,c){Oa.byName[c]={asset:g,assetName:c,loaded:!0}};Oa.removeFromCache=function(g){delete Oa.byName[g]};Oa.isCacheLoaded=function(){for(var g in Oa.byName)if(!Oa.byName[g].loaded)return!1;return!0};Oa.getCacheState=function(){return{total:Oa.loadedCount,current:Oa.leftToLoadCount}};
Oa.reportCache=function(){z.log("-----------------------------------");z.log(""+Oa.loadedCount+" images in cache.");z.log("("+Oa.leftToLoadCount+" left to load.)");for(var g in Oa.byName){var c=Oa.byName[g],a="";c.loaded||(a+=" (not loaded)");z.log("\t> "+c.assetName+a)}z.log("-----------------------------------")};z.registerCommand("imageCache",Oa.reportCache,["reportImageCache","showImageCache"]);Oa.findInCache=function(g,c){g=ud(g);return(g=Oa.byName[g])?g.asset:null};var Ba={sheets:[],numInMemory:0};
pe.prototype.inMemory=!0;pe.prototype.setActive=function(g){void 0===g&&(g=!0);g!=this.inMemory&&(g?(Oa.preLoadImages([this.image]),this.inMemory=!0,++Ba.numInMemory):(this.inMemory=!1,Oa.removeFromCache(this.image),--Ba.numInMemory),z.log((g?"":"UN-")+"loading spritesheet "+this.image))};Ba.registerSpriteSheet=function(g,c,a){var d=Ba.getSpriteSheetIndex(c);if(0<=d)return Ba.sheets[d];a||(a={});void 0===a.preloadImage&&(a.preloadImage=!0);a.preloadImage&&g&&Oa.preLoadImages(g);g||z.logError("ERROR: imagePath required when registering spritesheet!");
d=new pe(g,c,a);var l=c.meta.image;l?(a.forceLowerCase&&(c.meta.image=l.toLowerCase()),d.pathPrefix=$d(c.meta.image,!0)):d.pathPrefix="";d.frameCount=0;l=c.frames;if(Array.isArray(l)){var m=l;l=c.frames={};for(var k=0;k<m.length;k++){var f=m[k];l[f.filename]=f}}c.bylongname={};for(var e in l)a.forceLowerCase&&(e=e.toLowerCase()),l[e].filename=e,c.bylongname[d.pathPrefix+e]=l[e],d.frameCount++;a.verbose&&z.log("loaded spritesheet "+g+" with "+d.frameCount+" frames");Ba.sheets.push(d);return d};Ba.unregisterSpriteSheet=
function(g){for(var c=Ba.sheets,a=0;a<c.length;a++){var d=Ba.sheets[a];if(d.image===g){Oa.removeFromCache(d.image);Ba.numInMemory=0;c.splice(a,1);return}}z.log("unregisterSpriteSheet couldn't find "+g)};Ba.getSpriteSheetCount=function(g){return g&&g.inMemory?Ba.numInMemory:Ba.sheets.length};Ba.getNthSpriteSheet=function(g,c){var a=Ba.sheets;if(c&&c.inMemory)for(c=0;c<a.length;++c){var d=Ba.sheets[c];if(d.inMemory&&(--g,0>g))return d}else return a[g]};Ba.forEachSpriteSheet=function(g,c){if(g)for(var a=
0,d;d=Ba.getNthSpriteSheet(a,c);)++a,g(d,c)};Ba.getSpriteSheetIndex=function(g){for(var c=0;c<Ba.sheets.length;c++)if(Ba.sheets[c].tpjs===g)return c;return-1};Ba.getSpriteSheetByIndex=function(g){return Ba.sheets[g]};Ba.getSpriteSheetIndexByImage=function(g){for(var c=0;c<Ba.sheets.length;c++)if(Ba.sheets[c].image===g)return c;return-1};Ba.getSpriteSheetJSByImage=function(g){for(var c=0;c<Ba.sheets.length;c++)if(Ba.sheets[c].image===g)return Ba.sheets[c].tpjs;return null};Ba.findInSpriteSheet=function(g){function c(l,
m){for(var k=0;k!==Ba.sheets.length;++k){var f=Ba.sheets[k],e=f.tpjs,b=e.frames;m&&(b=e.bylongname);e=[];if(f.opts.requirePath&&!m)break;for(var h=0;h!==l.length;++h){var n=l[h];f.opts.forceLowerCase&&(n=n.toLowerCase());b[n]&&e.push(b[n])}if(e.length===l.length)return{sheetIndex:k,frameList:e,sheetEntry:f};if(0<e.length)for(z.logError("ERROR: incorrect partial match in sheet search! only found:"),f=0;f<e.length;f++)z.log(e[f].filename)}return null}if(!Ba.sheets||1>Ba.sheets.length)return null;Array.isArray(g)||
(g=[g]);for(var a=[],d=0;d!==g.length;++d)a[d]=ud(g[d]);if(a=c(a,!0))return a;a=[];for(d=0;d!==g.length;++d)a[d]=Id(g[d]);return c(a,!1)};Ba.processFramesFromSpriteSheet=function(g,c){for(var a=[],d=0;d<c.length;d++){var l={},m=c[d],k=m.filename;l.name=k.substring(0,k.length-4);l.scaledBy=g.scaledBy;l.undoScaler=g.undoScaler;l.drawBox={x:m.frame.x,y:m.frame.y,w:m.frame.w,h:m.frame.h};l.box={};l.box.x=l.drawBox.x*g.undoScaler;l.box.y=l.drawBox.y*g.undoScaler;l.box.w=l.drawBox.w*g.undoScaler;l.box.h=
l.drawBox.h*g.undoScaler;k=m.spriteSourceSize;l.trimRect={x:k.x*g.undoScaler,y:k.y*g.undoScaler,w:k.w*g.undoScaler,h:k.h*g.undoScaler};k=m.spriteSourceSize;l.sourceSize={w:k.w,h:k.h};m=m.sourceSize;l.origSize={w:m.w?m.w*g.undoScaler:l.box.w,h:m.h?m.h*g.undoScaler:l.box.h};a.push(l)}return a};Ba.getFullFrameList=function(g){var c=Ba.getSpriteSheetIndex(g);if(0>c)return null;g=[];c=Ba.sheets[c].tpjs.bylongname;for(var a in c)g.push(c[a]);return g};Ba.loadSpriteSheetSet=function(g,c,a,d){if(g){a&&z.log("loading "+
g.length+" spritesheets.");d||(d={});for(var l=0;l<g.length;++l){var m=g[l];var k=c?c+Id(m.meta.image):m.meta.image;Oa.preLoadImages(k);var f={forceLowerCase:!0,requirePath:""!==$d(m.meta.image),verbose:a,preloadImage:!1},e;for(e in d)f[e]=d[e];Ba.registerSpriteSheet(k,m,f)}}};Ba.constructAllFromSpriteSheet=function(g){return{}};Ba.generateAltSheetJS=function(g,c,a){c=c||"";a=a||"";var d=Ba.getSpriteSheetIndexByImage(g);if(0>d)z.logError("Tried to mess with a nonexistent spritesheet : "+g);else{if((d=
Ba.sheets[d].tpjs)&&d.frames){g={};g.meta=tb(d.meta,!0);g.frames={};for(var l in d.frames){var m=c+d.frames[l].filename+a;g.frames[m]=tb(d.frames[l],!0);g.frames[m].filename=m}return g}z.logError("Tried (2) to mess with a nonexistent spritesheet : "+g)}};Ba.dumpList=function(){var g=Ba.sheets;z.log("-----------");z.log("spritesheets: ("+g.length+")");for(var c=0;c<g.length;++c){var a=Ba.sheets[c];z.log(""+a.image+"  pathPrefix: "+a.pathPrefix+" scale: "+a.scaledBy+" inMem: "+a.inMemory)}z.log("-----------")};
z.registerCommand("spritesheets",Ba.dumpList,["showspritesheets"]);var xa=function(){this.imageFrames=[];this.frames=null;this.frameEvents=void 0;this.loadedTargetCount=this.loadedCount=0};xa.prototype.isImage=!0;xa.centeredX=1;xa.centeredY=2;xa.flipX=4;xa.flipY=8;xa.perFrameDrawCount=0;xa.perFrameBubblePartCount=0;xa.rawLoadCount=0;xa.reportRawLoads=!1;xa.beginFrame=function(){xa.perFrameDrawCount=0;xa.perFrameBubblePartCount=0};xa.prototype.getImageFrame=function(g,c){return this.imageFrames?0>
g||g>=this.imageFrames.length?(c&&c.noWarn||(0>=this.imageFrames.length?z.log("Bad image frame! Failed to specify/load any images?"):z.log("Bad image frame! "+g+" / "+this.imageFrames.length)),null):this.imageFrames[g].valid?this.imageFrames[g].image:null:null};xa.prototype.isLoaded=function(){for(var g=0;g<this.imageFrames.length;g++)if(!this.imageFrames[g].valid&&!this.imageFrames[g].image.error)return!1;return!0};xa.prototype.loadOneNativeImage=function(g){var c=this,a={image:null,origSrc:ud(g)};
g=ac(g);g=rc.load(g,function(d){a.valid=!0;c.loadedCount++;if(c.loadedCount>=c.loadedTargetCount&&c.onLoad)c.onLoad(d)}.bind(this),function(d){a.valid=!1;this.loadedCount++}.bind(this));a.image=g.image;xa.rawLoadCount++;return a};xa.prototype.loadOneImageFrame=function(g){var c=typeof g;if("string"===c)return(c=Oa.findInCache(g))?(g={image:c,valid:!0,origSrc:ud(g)},this.loadedCount++,g):this.loadOneNativeImage(g);if("object"===c&&g&&g.width)return g={image:g,valid:!0},this.loadedCount++,g;console.logError("ERROR:  We don't understand this image source and type:"+
g+" :"+c);return null};xa.prototype.appendFrames=function(g){if(g){var c=g;Array.isArray(g)||(c=[g]);g=typeof c[0];"string"===g&&(this.debugName=c[0]);if("string"!==g||!this.findAndBuildFromSpriteSheets(c))for(this.loadedTargetCount=c.length,g=0;g<c.length;g++){var a=this.loadOneImageFrame(c[g]);this.imageFrames.push(a)}}};xa.prototype.findAndBuildFromSpriteSheets=function(g){g=Ba.findInSpriteSheet(g);if(!g)return!1;this.buildFramesFromSpriteSheet(g.sheetEntry,g.frameList);return!0};xa.prototype.buildFramesFromSpriteSheet=
function(g,c){this.appendFrames(g.image);this.frames=Ba.processFramesFromSpriteSheet(g,c)};xa.prototype.buildFromEntireSpriteSheet=function(g){var c=Ba.getSpriteSheetIndex(g);0>c||(c=Ba.getSpriteSheetByIndex(c),(g=Ba.getFullFrameList(g))&&this.buildFramesFromSpriteSheet(c,g))};xa.prototype.frameCount=function(){return this.frames?this.frames.length:this.imageFrames.length};xa.prototype.getNamedFrame=function(g){if(this.frames)for(var c=0;c<this.frames.length;c++)if(this.frames[c].name===g)return c;
return-1};xa.prototype.getFrameSize=function(g){if(this.frames)return this.frames[g].origSize;if((g=this.getImageFrame(g))&&g.width)return{w:g.width,h:g.height};z.logWarningOnce("r_image: warning:  asking for size of image that hasn't been loaded : "+(this.debugName||""),"imageSizeError");return{w:32,h:32}};xa.prototype.getFrameVisibleSize=function(g){return this.frames?(g=this.frames[g].box,{w:g.w,h:g.h,isKnown:!0}):this.getFrameSize(g)};xa.prototype.setOnLoad=function(g){(this.onLoad=g)&&this.loadedCount>=
this.loadedTargetCount&&(this.imageFrames[0].valid||z.logWarningOnce("  WARNING: onLoad for cached image not fully loaded. "+this.imageFrames[0].image.src,"cachenotfullyloaded"),this.onLoad(this.imageFrames[0].image),this.onLoad=void 0)};xa.prototype.draw=function(g,c,a,d,l,m,k,f,e,b,h){g=g||ca;var n=1,t=1,v=!1;a=a||0;d=d||0;if(this.frames){var q=this.getImageFrame(0);if(!q)return;var r=this.frames[c];void 0===l&&(l=r.origSize.w);void 0===m&&(m=r.origSize.h);f=f||0;e=e||0;b=b||r.origSize.w;h=h||r.origSize.h;
var B=l/b,H=m/h,G=r.trimRect.x,K=r.trimRect.y,u=r.box.x,A=r.box.y,E=r.box.w,S=r.box.h;f+b<r.trimRect.x+r.trimRect.w&&(E-=r.trimRect.x+r.trimRect.w-(f+b));f>G?(u+=f-G,E-=f-G,G=0):G-=f;e+h<K+r.trimRect.h&&(S-=K+r.trimRect.h-(e+h));e>K?(A+=e-K,S-=e-K,K=0):K-=e;f=E*B;e=S*H;c=G*B;var aa=K*H;k&xa.flipX&&(v=!0,g.save(),n=-1,g.translate(f,0),c=(r.origSize.w-(G+r.box.w))*B,g.scale(-1,1));k&xa.flipY&&(v||(v=!0,g.save()),t=-1,g.translate(0,e),c=(r.origSize.h-(K+r.box.h))*H,g.scale(1,-1));k&xa.centeredX&&(c-=
l/2);k&xa.centeredY&&(aa-=m/2);g.drawImage(q,u*r.scaledBy,A*r.scaledBy,E*r.scaledBy,S*r.scaledBy,(a+c)*n,(d+aa)*t,f,e)}else{q=this.getImageFrame(c);if(!q)return;void 0===l&&(l=q.width);void 0===m&&(m=q.height);void 0===f&&(f=0);void 0===e&&(e=0);void 0===b&&(b=q.width);void 0===h&&(h=q.height);aa=c=0;k&xa.centeredX&&(c=-l/2);k&xa.centeredY&&(aa=-m/2);k&xa.flipX&&(v=!0,g.save(),n=-1,g.translate(l,0),g.scale(-1,1));k&xa.flipY&&(v||(v=!0,g.save()),t=-1,g.translate(0,m),g.scale(1,-1));g.drawImage(q,f,
e,b,h,(a+c)*n,(d+aa)*t,l,m)}v&&g.restore();xa.perFrameDrawCount++};var Kc=[],Ef=function(g,c){g&&Kc.push({func:g,thisObj:c})},Ff=Object.freeze({__proto__:null,eventHandlers:Kc,registerEventHandler:Ef,insertEventHandler:function(g,c){g&&Kc.unshift({func:g,thisObj:c})},unRegisterEventHandler:function(g,c){if(g)for(var a=0;a!==Kc.length;++a)if(Kc[a].func===g&&Kc[a].thisObj===c){Kc.splice(a,1);break}}}),da={enableProfiler:!1,usingRatProfiler:!1,profileTrees:[void 0,void 0],curNode:void 0,enableStatsDisplay:!1,
selectedNode:["ROOT"],displayInfo:{atX:64,atY:64,lineHeight:22,tab:"  ",font:"12px arial",color:void 0,highlightColor:void 0,shadowColor:"black",curY:0,cols:[0,150,225,300,375,450]},highlightedNode:void 0,perfmarkers:[]},ed=da.perfmarkers,Jd={last:void 0,name:void 0};bd.prototype.getChild=function(g){this._children[g]||(this._children[g]=new bd(g,this),this._stats.hasChildren=!0);return this._children[g]};bd.prototype.clear=function(){this._stats.time=0;this._stats.calls=0;for(var g in this._children)this._children[g].clear()};
bd.prototype.getTick=function(){return da.usingRatProfiler?window.performance.now():0};bd.prototype.storeTick=function(){this._stats.lastTick=this.getTick()};bd.prototype.updateElapsed=function(){this._stats.time+=(this.getTick()-this._stats.lastTick)/1E3;this._stats.lastTick=void 0};da.addPerfMarker=function(g,c){ed.unshift({name:g,color:c.toString(),frame:cd})};da.init=function(){var g=da;if(da.enableProfiler)if(sa.Wraith)z.log("Using Wraith Profiler"),g.pushPerfMark=Wraith.PushPerfMark,g.popPerfMark=
Wraith.PopPerfMark;else if(window.performance&&window.performance.now){z.log("Using RAT Profiler");g.pushPerfMark=Bg;g.popPerfMark=Cg;var c=g.beginFrame,a=g.endFrame;g.beginFrame=function(){c()};g.endFrame=function(){a();da.curNode.parent&&(z.logError("ERROR!  profiler.push does not match profiler.pop"),da.curNode=da.profileTrees[0],da.curNode._stats.abortProfilerForFrame=!0);da.curNode._stats.abortProfilerForFrame||void 0!==da.curNode._stats.lastTick&&da.curNode.updateElapsed();var d=da.profileTrees[0];
da.profileTrees[0]=da.profileTrees[1];da.profileTrees[1]=d;da.curNode=da.profileTrees[0];da.curNode.clear();da.curNode.storeTick();++da.curNode._stats.calls;da.curNode._stats.abortProfilerForFrame=!1;d._stats.built=!0};g.displayStats=Dg;for(g=0;g<da.profileTrees.length;++g)da.profileTrees[g]=new bd("ROOT",void 0);da.curNode=da.profileTrees[0];da.displayInfo.color=da.displayInfo.color||"#FFFFFF";da.displayInfo.highlightColor=da.displayInfo.highlightColor||"#FFFF00";Ef(Eg);da.usingRatProfiler=!0}else z.log("No Profiler"),
g.pushPerfMark=Rd,g.popPerfMark=Rd;else g.pushPerfMark=Rd,g.popPerfMark=Rd};da.beginFrame=function(){if(ed.length){for(var g=cd-100,c=ed.length,a=ed.length-1;0<=a;--a)if(ed[a].frame<g)c=a;else break;c<ed.length&&ed.splice(c)}};da.endFrame=function(){};da.push=function(g){Jd={name:g,last:Jd};da.pushPerfMark(g)};da.pop=function(){var g=Jd.name;Jd=Jd.last;da.popPerfMark(g)};da.perf=function(g,c,a){da.pushPerfMark(g);c=a?c.call(a):c();da.popPerfMark(g);return c};var kc=1/60,ve=kc,fb={deltaTime:kc,runningFps:1/
kc,highDeltaTime:1,highFor:0,deltaTimeRawRecord:[],deltaTimeRawSmoothedRecord:[],FPSRecordIndex:0},Gf=$e(),ae=[],we=0;fb.updateDeltaTime=function(){if(sa.Wraith)kc=Wraith.getDeltaTime();else{var g=$e();kc=g-Gf;Gf=g}.1<kc&&(kc=.1);g=0;ae[we]=kc;we=(we+1)%25;for(var c=25>ae.length?ae.length:25,a=0;a!==c;++a)g+=ae[a];ve=g/c;fb.deltaTime=1*ve;fb.runningFps=1/fb.deltaTime;fb.deltaTimeRawRecord[fb.FPSRecordIndex]=kc;fb.deltaTimeRawSmoothedRecord[fb.FPSRecordIndex]=ve;fb.FPSRecordIndex=(fb.FPSRecordIndex+
1)%100;if(void 0===fb.highDeltaTime||2<(fb.highFor+=kc)||fb.highDeltaTime<kc)fb.highDeltaTime=kc,fb.highFor=0};fb.lockDeltaTime=function(g){};var zb={drawTiming:!1,drawStats:!1,drawFramerateGraph:!1,drawMemoryGraph:!1,framerateGraphSettings:{bounds:{}},debugMemoryGraphSettings:null,debugFramerateGraphSettings:null,setDebugFont:function(){var g=gb();g.font="bold "+z.config.textSize+"px monospace";g.textAlign="left";g.textBaseline="middle"},drawDebugTiming:function(){var g=fb.runningFps|0,c=(1E3*fb.deltaTime|
0)/1E3,a=gb();a.fillStyle="#F08030";a.fillText("fps: "+g+"  DT: "+c,60,Ra-z.config.logLineHeight-230)},drawDebugStats:function(){var g=gb();g.fillStyle="#F08030";var c=z.config.logLineHeight,a=Ra-3*c-230,d=Fb.getByName("particle");if(d){var l=d.getSystemCount(),m=d.getAllEmitterCount(),k=d.getAllParticleCount(),f=d.State.cacheSize,e=d.State.count;d.stateCaching.enabled&&(g.fillText("   states(cached): "+e+"("+f+")",30,a),a-=c);g.fillText("P: sys: "+l+"  em: "+m+"  p: "+k,30,a);a-=c}d=Fb.getByName("ui");
Bf&&dd&&d&&(g.fillText("UI: elem: "+dd.totalElementsDrawn+", mcalls "+d.Element.mouseMoveCallCount+", ucalls "+d.Element.updateCallCount,30,a),a-=c);Bf&&xa&&xa.perFrameDrawCount&&g.fillText("Images: "+xa.perFrameDrawCount,30,a)},drawDebugMemoryGraph:function(){zb.debugMemoryGraphSettings||(zb.debugMemoryGraphSettings={bounds:{},history:[]});var g=zb.debugMemoryGraphSettings,c=gb(),a=Ha,d=Ra;g.bounds&&g.bounds.x||(g.bounds={},g.bounds.w=a/4,g.bounds.h=d/8,g.bounds.x=.9*a-g.bounds.w,g.bounds.y=.95*
d-2*g.bounds.h-16);a=g.bounds;c.save();c.fillStyle="white";c.translate(a.x,a.y);for(d=0;3>d;++d){c.lineWidth=1;c.strokeStyle=["red","yellow","blue"][d];c.beginPath();var l=d/2*a.h;c.moveTo(0,l);c.lineTo(a.w,l);c.stroke()}if(window.performance&&window.performance.memory){d=window.performance.memory.totalJSHeapSize||1;l=window.performance.memory.usedJSHeapSize||0;var m=l/d*100;g.history.push(l);100<g.history.length&&g.history.shift();c.textAlign="start";c.textBaseline="hanging";c.fillText("Memory: "+
m.toFixed(2)+"% of "+(d/1024/1024).toFixed(2)+"MB",0,a.h+1);c.strokeStyle="green";c.save();c.beginPath();for(l=0;l<g.history.length&&100>l;++l){m=l;100>g.history.length&&(m+=100-g.history.length);m=m/99*a.w;var k=a.h*(1-g.history[l]/d);0==l?c.moveTo(m,k):c.lineTo(m,k)}c.stroke();c.restore()}else c.textAlign="start",c.textBaseline="hanging",c.fillText("Memory unavailable.",0,a.h+1);c.restore()},drawDebugFramerateGraph:function(){function g(e,b){c.beginPath();for(var h=0,n,t=e.length,v=l.bounds.w/99,
q=0;q!==t;++q)n=e[(q+b)%t],n=1/n/120,n=l.bounds.h-n*l.bounds.h,0===q?c.moveTo(h,n):c.lineTo(h,n),h+=v;c.stroke()}if(!(1>=fb.deltaTimeRawRecord.length)){var c=gb(),a=Ha,d=Ra-30,l=zb.debugFramerateGraphSettings;l&&l.bounds&&l.bounds.x||(l={bounds:{}},l.bounds.w=a/4,l.bounds.h=d/8,l.bounds.x=.9*a-l.bounds.w,l.bounds.y=.95*d-l.bounds.h);c.translate(l.bounds.x,l.bounds.y);c.lineWidth=1;c.strokeStyle="#F02040";c.beginPath();c.moveTo(0,0);c.lineTo(l.bounds.w,0);c.stroke();c.beginPath();c.moveTo(0,l.bounds.h/
2);c.lineTo(l.bounds.w,l.bounds.h/2);c.stroke();c.beginPath();c.moveTo(0,l.bounds.h);c.lineTo(l.bounds.w,l.bounds.h);c.stroke();c.lineWidth=2;if(0<da.perfmarkers.length){c.save();a=da.perfmarkers;d=cd;for(var m,k=0;k!==a.length;++k){m=a[k];var f=1-(d-m.frame)/100;c.strokeStyle=m.color;c.beginPath();f*=l.bounds.w;c.moveTo(f,0);c.lineTo(f,l.bounds.h);c.stroke()}c.restore()}c.strokeStyle="#808000";g(fb.deltaTimeRawRecord,fb.FPSRecordIndex);c.strokeStyle="#8080FF";g(fb.deltaTimeRawSmoothedRecord,fb.FPSRecordIndex);
a=(100*fb.runningFps|0)/100;d=(1E3*fb.deltaTime|0)/1E3;k=1/fb.highDeltaTime;c.fillStyle="#F0F0F0";a=""+a.toFixed(2);d=""+d.toFixed(3);k=""+k.toFixed(2);a="     ".substr(0,5-a.length)+a;d="     ".substr(0,5-d.length)+d;c.fillText("fps: "+a+" (low "+k+")  DT: "+d,0,l.bounds.h);c.translate(-l.bounds.x,-l.bounds.y)}},draw:function(){zb.setDebugFont();zb.debugDrawTiming&&zb.drawDebugTiming();zb.debugDrawStats&&zb.drawDebugStats();zb.debugDrawFramerateGraph&&zb.drawDebugFramerateGraph();zb.debugDrawMemoryGraph&&
zb.drawDebugMemoryGraph()}};z.registerCommand("showFPSGraph",function(g,c){g=zb.debugDrawFramerateGraph;zb.debugDrawFramerateGraph=!g;zb.debugDrawTiming=!g},["fpsgraph"]);z.registerCommand("showFPS",function(g,c){zb.debugDrawTiming=!zb.debugDrawTiming},["fps"]);z.registerCommand("showStats",function(g,c){zb.debugDrawStats=!zb.debugDrawStats},["stats"]);var Ka={entries:[],state:{show:!1},frame:0},Hf=Xb.getLocalStorage();if(Hf){var Wc=Hf.getItem("rat_debugTrackValue");if(Wc&&((Wc=JSON.parse(Wc))&&Wc.state&&
(Ka.state=Wc.state),Wc&&Wc.entries)){Ka.entries=Wc.entries;for(var xe=Ka.entries.length-1;0<=xe;xe--){var If=Ka.entries[xe];If.decimalPlaces||(If.decimalPlaces=0)}}}Ka.writeActiveState=function(){var g=Xb.getLocalStorage();g&&g.setItem("rat_debugTrackValue",JSON.stringify({state:Ka.state,entries:Ka.entries}))};Ka.findEntry=function(g){for(var c=Ka.entries.length-1;0<=c;c--)if(Ka.entries[c].expression===g)return c;return-1};Ka.show=function(g){Ka.state.show=void 0===g?!Ka.state.show:!!g;Ka.writeActiveState()};
Ka.draw=function(){if(Ka.state.show){Ka.update(.01);var g=ca,c=z.config.logLineHeight,a=Ka.entries.length*c+10,d=(Ha-400)/2,l=Ra-40-a;g.fillStyle=z.config.bgColor.toString();g.fillRect(d,l,400,a);a=l+5;l=d+10;d=d+175+25;g.textAlign="right";g.textBaseline="top";for(var m=Ka.entries.length-1;0<=m;m--){var k=Ka.entries[m];g.font=""+z.config.textSize+"px Arial";g.fillStyle=z.config.textColor;g.fillText(k.displayName,l+175,a,175);g.fillText(k.displayValue,d+175,a,175);a+=c}}};Ka.update=function(g){g=Ka.frame%
9;for(var c=Ka.entries.length-1;0<=c;c--)if(c%9===g){var a=Ka.entries[c];try{var d=qd(window,a.expression)}catch(m){d="error "+m.description}if("number"===typeof d){d=Math.floor(1E3*d)/1E3;var l=d|0;d=""+d;l=d.length-(""+l).length-1;l>a.decimalPlaces&&(a.decimalPlaces=l);if(0<a.decimalPlaces&&l<a.decimalPlaces)for(0>l&&(d+=".",l++);l<a.decimalPlaces;)d+="0",l++}a.displayValue=""+d}Ka.frame++};Ka.track=function(g){if(g&&"string"===typeof g)if(-1<Ka.findEntry(g))Ka.unTrack(g);else{var c={expression:g,
decimalPlaces:0,displayName:"",displayValue:"-"},a=g.slice(-15);a.length<g.length&&(a="\u2026"+a);c.displayName=a;Ka.entries.push(c);Ka.show(!0);return!0}};Ka.unTrack=function(g){g=Ka.findEntry(g);0>g||(Ka.entries.splice(g,1),0>=Ka.entries.length&&Ka.show(!1),Ka.writeActiveState())};Ka.clear=function(g){Ka.entries=[];Ka.show(!1)};z.registerCommand("track",function(g,c){"clear"!==c[0]&&"none"!==c[0]&&c[0]?Ka.track(c[0]):Ka.clear()},["trackvalue"]);z.registerCommand("untrack",function(g,c){Ka.unTrack(c[0])});
z.registerCommand("cleartrack",function(g,c){Ka.clear()},["notrack","trackclear"]);z.registerCommand("showtrack",function(g,c){Ka.show(c[0])},["trackshow"]);z.registerCommand("hidetrack",function(g,c){Ka.show(!1)},["trackhide"]);var mb={setTarget:{set:{},show:{},log:{}}};mb.settings=mb.setTarget;mb.configure=function(g,c,a){function d(l,m){if(1>m.length||"none"===m[0])z.log("showSet: clearing "+l),g[l]={},c&&c();else{var k=m[0].toLowerCase();if("bounds"===k||"collis"===k)k="collision";a&&a[k]&&(k=
a[k]);g[l][k]=void 0!==m[1]?m[1]:!g[l][k];c&&c();z.log("showSet: toggle "+l+" "+k+" (now: "+g[l][k]+")")}}g?(mb.setTarget=g,mb.settings=mb.setTarget,g.show||(g.show={}),g.set||(g.set={}),g.log||(g.log={}),mb.settingWriteFunction=c,mb.setter=d,z.registerCommand("set",function(l,m){d(l,m)}),z.registerCommand("show",function(l,m){d(l,m)}),z.registerCommand("log",function(l,m){d(l,m)})):z.log("Error configuring rat.debug.showSet: no setTarget object.")};mb.set=function(g,c){mb.setter("set",[g,c])};mb.show=
function(g){mb.setter("show",[g])};mb.log=function(g){mb.setter("log",[g])};var Jf=function(g,c,a,d,l,m,k){var f=a-g,e=d-c,b=Math.sqrt(f*f+e*e);l=Math.sqrt(l*l-b*b*.25);var h=e,n=-f;0>h*m-n*k&&(h=-e,n=f);return{x:.5*(a+g)+l*h/b,y:.5*(d+c)+l*n/b}},ye=function(g,c,a,d){return Y.atan2(c-d,g-a)},ze=function(g,c,a,d,l,m,k){var f=0<(l-g)*(d-c)-(m-c)*(d-g);g=ye(g,c,l,m);a=ye(a,d,l,m);return{type:"arc",center:{x:l,y:m},radius:k,startAngle:g,endAngle:a,anticlockwise:f}},Ae=function(g,c,a,d){var l=d-c,m=.5*
(a+g);if(0===l)return{a:1,b:0,c:m};g=-(a-g)/l;return{a:-g,b:1,c:-g*m+.5*(d+c)}},Kf=function(g,c,a,d,l,m){a=Ae(g,c,a,d);m=Ae(g,c,l,m);0===a.b?l=a:0===m.b?l=m:(l=-a.b/m.b,l={a:a.a+m.a*l,c:a.c+m.c*l});if(0===l.a)return!1;l=l.c/l.a;a=0!==a.b?(a.c-a.a*l)/a.b:(m.c-m.a*l)/m.b;g-=l;c-=a;c=Y.sqrt(g*g+c*c);return{center:{x:l,y:a},radius:c}},Lf=Object.freeze({__proto__:null,findCircleCenterFromTwoPoints:Jf,findAngleOnCircle:ye,findArcOnCircle:ze,findArcFromTwoPoints:function(g,c,a,d,l,m,k){m=Jf(g,c,a,d,l,m,
k);return ze(g,c,a,d,m.x,m.y,l)},findPerpendicularBisector:Ae,findCircleFromThreePoints:Kf,findArcFromThreePoints:function(g,c,a,d,l,m){return(a=Kf(g,c,a,d,l,m))?ze(g,c,l,m,a.center.x,a.center.y,a.radius):{type:"seg",point1:{x:g,y:c},point2:{x:l,y:m}}}}),za=function(g,c){void 0!==g&&void 0!==g.x&&(c=g.y,g=g.x);this.x=g||0;this.y=c||0};za.prototype.isClear=function(){return!this.x&&!this.y};za.prototype.copy=function(){var g=new za;g.x=this.x;g.y=this.y;return g};za.prototype.set=function(g,c){void 0!==
g.x&&(c=g.y,g=g.x);void 0===c&&(c=g);this.x=g;this.y=c};za.prototype.copyFrom=function(g){this.x=g.x;this.y=g.y};za.prototype.length=function(){return Y.sqrt(this.x*this.x+this.y*this.y)};za.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y};za.prototype.distanceSqFrom=function(g){var c=g.x-this.x;g=g.y-this.y;return c*c+g*g};za.prototype.distanceFrom=function(g){return Y.sqrt(this.distanceSqFrom(g))};za.prototype.deltaTo=function(g,c){c=c||new za;c.set(g.x-this.x,g.y-this.y);return c};
za.prototype.normalize=function(){var g=this.length();this.x/=g;this.y/=g};za.prototype.scale=function(g){this.x*=g;this.y*=g};za.prototype.setLength=function(g){this.normalize();this.scale(g)};za.prototype.add=function(g){this.x+=g.x;this.y+=g.y};za.prototype.addScaled=function(g,c){this.x+=g.x*c;this.y+=g.y*c};za.prototype.subtract=function(g){this.x-=g.x;this.y-=g.y};za.prototype.setFromDelta=function(g,c){this.x=c.x-g.x;this.y=c.y-g.y};za.prototype.setFromAngle=function(g){var c=Y.cos(g);g=Y.sin(g);
this.x=c;this.y=g};za.prototype.getAngle=function(){return Y.atan2(this.y,this.x)};za.dot=function(g,c){return g.x*c.x+g.y*c.y};za.normalizedDot=function(g,c){var a=Y.sqrt(g.x*g.x+g.y*g.y),d=g.x/a;g=g.y/a;a=Y.sqrt(c.x*c.x+c.y*c.y);return c.x/a*d+c.y/a*g};za.cross=function(g,c){return g.x*c.y-g.y*c.x};za.prototype.toString=function(){return"("+this.x+", "+this.y+")"};za.prototype.limitToRect=function(g){this.x<g.x&&(this.x=g.x);this.y<g.y&&(this.y=g.y);this.x>g.x+g.w&&(this.x=g.x+g.w);this.y>g.y+g.h&&
(this.y=g.y+g.h)};var bc=function(g){this.angle=g||0};bc.prototype.copy=function(){var g=new bc;g.angle=this.angle;return g};bc.prototype.setFromVector=function(g){this.angle=Y.atan2(g.y,g.x);return this};bc.prototype.setFromSourceTarget=function(g,c){this.angle=Y.atan2(c.y-g.y,c.x-g.x);return this};bc.prototype.rotateVectorInPlace=function(g){var c=Y.cos(this.angle),a=Y.sin(this.angle),d=g.x*a+g.y*c;g.x=g.x*c-g.y*a;g.y=d;return g};bc.prototype.rotateVector=function(g,c){c?(c.x=g.x,c.y=g.y):c=new za(g);
return this.rotateVectorInPlace(c)};bc.closestDelta=function(g,c){for(var a=2*Math.PI;0>g;)g+=a;for(;0>c;)c+=a;g=c%a-g%a;g>Math.PI&&(g-=a);g<-Math.PI&&(g+=a);return g};bc.dot=function(g,c){g={x:Y.cos(g),y:Y.sin(g)};c={x:Y.cos(c),y:Y.sin(c)};return za.dot(g,c)};var Mf=function(g,c,a){this.pos=new za(g,c);this.rot=new bc(a)};za.normalize=function(g){var c=Math.sqrt(g.x*g.x+g.y*g.y);g.x/=c;g.y/=c;return g};var ub={Circle:function(g,c,a){var d=0;void 0!==g.x&&(c=g.y,d=void 0!==g.squaredRadius?g.squaredRadius:
g.r*g.r||0,a=void 0!==g.r?g.r:Y.sqrt(d),g=g.x);this.center={x:g||0,y:c||0};this.radius=a||0;this.squaredRadius=d},Rect:function(g,c,a,d){g&&g.x&&(d=g.h,a=g.w,c=g.y,g=g.x);this.set(g,c,a,d)}};ub.Rect.prototype.set=function(g,c,a,d){void 0===g?this.h=this.w=this.y=this.x=0:void 0!==g.x?(this.x=g.x,this.y=g.y,this.w=g.w,this.h=g.h):(this.x=g,this.y=c,this.w=a,this.h=d);this.forgetEdges()};ub.Rect.prototype.copy=function(){var g=new ub.Rect;g.x=this.x;g.y=this.y;g.w=this.w;g.h=this.h;return g};ub.Rect.prototype.inset=
function(g,c){void 0===c&&(c=g);this.x+=g;this.y+=c;this.w-=2*g;this.h-=2*c};ub.Rect.prototype.expandToInclude=function(g){var c=g.w||0,a=g.h||0;g.x<this.x&&(this.x=g.x);g.y<this.y&&(this.y=g.y);g.x+c>this.x+this.w&&(this.w=g.x+c-this.x);g.y+a>this.y+this.h&&(this.h=g.y+a-this.y);this.forgetEdges()};ub.Rect.prototype.getCenter=function(g){g=g||new za;g.x=this.x+this.w/2;g.y=this.y+this.h/2;return g};ub.Rect.prototype.calcEdges=function(){this.l=this.x;this.t=this.y;this.r=this.x+this.w;this.b=this.y+
this.h;return this};ub.Rect.prototype.calcEdgesIfNeeded=function(){void 0!==this.l&&void 0!==this.r&&void 0!==this.t&&void 0!==this.b||this.calcEdges()};ub.Rect.prototype.forgetEdges=function(){this.l=this.r=this.t=this.b=void 0};ub.Rect.prototype.isPointInRect=function(g,c){void 0!=g.x&&(c=g.y,g=g.x);this.calcEdgesIfNeeded();return g>=this.l&&g<=this.r&&c>=this.t&&c<=this.b};ub.Rect.prototype.isRectInRect=function(g,c,a,d){if(void 0!==g.x){g.calcEdgesIfNeeded&&g.calcEdgesIfNeeded();var l=g.l;var m=
g.r;var k=g.t;var f=g.b;d=g.h;a=g.w;c=g.y;g=g.x}if(void 0===l||void 0===m||void 0===k||void 0===f)l=g,m=g+a,k=c,f=c+d;this.calcEdgesIfNeeded();return!(this.l>m||this.r<l||this.t>f||this.b<k)};ub.Rect.prototype.getManhattanDistToPoint=function(g,c){void 0!==g.x&&(c=g.y,g=g.x);if(this.isPointInRect(g,c))return 0;this.calcEdgesIfNeeded();var a=Y.max(g-this.r,0);g=Y.max(this.l-g,0);var d=Y.max(this.t-c,0);c=Y.max(c-this.b,0);return a+g+d+c};var Ab=[[],[],[]],Qb=function(g){this.m=[[],[],[]];g&&g.m?this.set(g.m):
g?this.set(g):this.loadIdent()};Qb.prototype.loadIdent=function(){this.m[0][0]=1;this.m[0][1]=0;this.m[0][2]=0;this.m[1][0]=0;this.m[1][1]=1;this.m[1][2]=0;this.m[2][0]=0;this.m[2][1]=0;this.m[2][2]=1};Qb.prototype.translateSelf=function(g,c){var a=this.m;a[0][2]=a[0][0]*g+a[0][1]*c+a[0][2];a[1][2]=a[1][0]*g+a[1][1]*c+a[1][2];a[2][2]=a[2][0]*g+a[2][1]*c+a[2][2]};Qb.prototype.rotateSelf=function(g){var c=Y.cos(g);g=Y.sin(g);var a=-g,d=this.m,l=d[0][0]*a+d[0][1]*c,m=d[1][0]*c+d[1][1]*g,k=d[1][0]*a+
d[1][1]*c,f=d[2][0]*c+d[2][1]*g;a=d[2][0]*a+d[2][1]*c;d[0][0]=d[0][0]*c+d[0][1]*g;d[0][1]=l;d[1][0]=m;d[1][1]=k;d[2][0]=f;d[2][1]=a};Qb.prototype.scaleSelf=function(g,c){var a=this.m;a[0][0]*=g;a[0][1]*=c;a[1][0]*=g;a[1][1]*=c;a[2][0]*=g;a[2][1]*=c};Qb.prototype.multSelf=function(g){g.m&&(g=g.m);var c=this.m;Ab[0][0]=c[0][0]*g[0][0]+c[0][1]*g[1][0]+c[0][2]*g[2][0];Ab[0][1]=c[0][0]*g[0][1]+c[0][1]*g[1][1]+c[0][2]*g[2][1];Ab[0][2]=c[0][0]*g[0][2]+c[0][1]*g[1][2]+c[0][2]*g[2][2];Ab[1][0]=c[1][0]*g[0][0]+
c[1][1]*g[1][0]+c[1][2]*g[2][0];Ab[1][1]=c[1][0]*g[0][1]+c[1][1]*g[1][1]+c[1][2]*g[2][1];Ab[1][2]=c[1][0]*g[0][2]+c[1][1]*g[1][2]+c[1][2]*g[2][2];Ab[2][0]=c[2][0]*g[0][0]+c[2][1]*g[1][0]+c[2][2]*g[2][0];Ab[2][1]=c[2][0]*g[0][1]+c[2][1]*g[1][1]+c[2][2]*g[2][1];Ab[2][2]=c[2][0]*g[0][2]+c[2][1]*g[1][2]+c[2][2]*g[2][2];g=this.m;this.m=Ab;Ab=g};Qb.prototype.inverseSelf=function(){var g=this.m,c=g[0][0]*g[1][1]*g[2][2]-g[0][0]*g[1][2]*g[2][1]-g[0][1]*g[1][0]*g[2][2]+g[0][1]*g[1][2]*g[2][0]+g[0][2]*g[1][0]*
g[2][1]-g[0][2]*g[1][1]*g[2][0];if(0===c)return!1;c=1/c;Ab[0][0]=c*(g[1][1]*g[2][2]-g[1][2]*g[2][1]);Ab[0][1]=c*(g[0][2]*g[2][1]-g[0][1]*g[2][2]);Ab[0][2]=c*(g[0][1]*g[1][2]-g[0][2]*g[1][1]);Ab[1][0]=c*(g[1][2]*g[2][0]-g[1][0]*g[2][2]);Ab[1][1]=c*(g[0][0]*g[2][2]-g[0][2]*g[2][0]);Ab[1][2]=c*(g[0][2]*g[1][0]-g[0][0]*g[1][2]);Ab[2][0]=c*(g[1][0]*g[2][1]-g[1][1]*g[2][0]);Ab[2][1]=c*(g[0][1]*g[2][0]-g[0][0]*g[2][1]);Ab[2][2]=c*(g[0][0]*g[1][1]-g[0][1]*g[1][0]);g=this.m;this.m=Ab;Ab=g;return!0};Qb.prototype.set=
function(g){g.m&&(g=g.m);var c=this.m;c[0][0]=g[0][0];c[0][1]=g[0][1];c[0][2]=g[0][2];c[1][0]=g[1][0];c[1][1]=g[1][1];c[1][2]=g[1][2];c[2][0]=g[2][0];c[2][1]=g[2][1];c[2][2]=g[2][2]};Qb.prototype.transformPointSelf=function(g){var c=this.m,a=g.x,d=g.y;g.x=c[0][0]*a+(c[0][1]*d+c[0][2]);g.y=c[1][0]*a+(c[1][1]*d+c[1][2]);return g};Qb.prototype.transformPoint=function(g,c){c?(c.x=g.x,c.y=g.y):c=new za(g);return this.transformPointSelf(c)};Qb.matMult=function(g,c,a){a?a.set(g):a=new Qb(g);a.multSelf(c);
return a};Qb.prototype.inverse=function(g){g?g.set(this):g=new Qb(this);g.inverseSelf();return g};var Kd=function(){this.list=[]};Kd.prototype.setBit=function(g,c){void 0===c&&(c=!0);this.list[g]=c};Kd.prototype.getBit=function(g){return this.list[g]};Kd.prototype.serialize=function(){for(var g="A"+this.list.length+":",c=[],a=this.list[0],d=1,l=1;l<this.list.length;l++)this.list[l]!==a?(a=a?1:0,c.push(d,a),d=1,a=this.list[l]):d++;c.push(d,a?1:0);return g+=JSON.stringify(c)};Kd.prototype.deserialize=
function(g){this.list=[];if(g&&!(2>g.length)){g[0];var c=g.indexOf(":");if(!(0>c))for(parseInt(g.substring(1,c)),g=g.substring(c+1),g=JSON.parse(g),c=0;c<g.length;c+=2)for(var a=g[c],d=g[c+1],l=0;l<a;l++)this.list.push(d)}};var cb=function(g,c){if(void 0===c){z.logError("Error inheriting from undefined...");var a=g.toString();a=a.substring(0,1E3);z.log(a)}af.prototype=c.prototype;g.prototype=new af;g.prototype.constructor=g;g.prototype.parentClass=c;g.prototype.parentConstructor=c;g.prototype.parent=
c.prototype;g.prototype.parentPrototype=c.prototype;return g},Nf=function(g,c){vc(g.prototype,[c.prototype],!0)},Rb={},Sb=function(g){this.seed=void 0!==g?g:Y.random()*this.MAX_VAL|0};Rb.Base=Sb;Sb.prototype.seed=void 0;Sb.prototype.MAX_VAL=2147483647;Sb.prototype.random=void 0;Sb.prototype.setSeed=function(g){this.seed=g};Sb.prototype.setSeedNormalized=function(g){this.setSeed(g*this.MAX_VAL)};Sb.prototype.getSeed=function(){return this.seed};Sb.prototype.getSeedRange=function(){return this.MAX_VAL};
Sb.prototype.getState=function(){return this.seed};Sb.prototype.setState=function(g){this.setSeed(g)};Sb.prototype.randomRange=function(g,c){return this.random()*(c-g)+g};Sb.prototype.randomIntInRange=function(g,c){c-=g;return this.random()*c+g+.5|0};Sb.prototype.randomVariance=function(g){return g?2*g*this.random()-g:0};Rb.OldSimple=function(g){Rb.Simple.prototype.parentConstructor.call(this,g)};cb(Rb.OldSimple,Sb);Rb.OldSimple.prototype.random=function(){var g=this.MAX_VAL;this.seed=(7621*this.seed+
1)%g;return this.seed/g};Rb.Simple=function(g){Rb.Simple.prototype.parentConstructor.call(this,g)};cb(Rb.Simple,Sb);Rb.Simple.prototype.MAX_VAL=4294967296;Rb.Simple.prototype.random=function(){var g=this.seed+=1831565813;g=Math.imul(g^g>>>15,g|1);g^=g+Math.imul(g^g>>>7,g|61);return((g^g>>>14)>>>0)/this.MAX_VAL};Rb.Default=function(g){Rb.Default.prototype.parentConstructor.call(this,g)};cb(Rb.Default,Sb);Rb.Default.prototype.random=Y.random;var db={pointInRect:function(g,c){return!(g.x<c.x||g.y<c.y||
g.x>c.x+c.w||g.y>c.y+c.h)},pointInsideRect:function(g,c){return!(g.x<c.x||g.y<c.y||g.x>=c.x+c.w||g.y>=c.y+c.h)},limitPointToSpace:function(g,c,a,d,l){g.x<c&&(g.x=c);g.y<a&&(g.y=a);g.x>c+d&&(g.x=c+d);g.y>a+l&&(g.y=a+l)},limitPointToRectEdge:function(g,c,a,d,l){function m(h,n,t){h<n&&(h=n);h>t&&(h=t);return h}var k=Y.abs;db.limitPointToSpace(g,c,a,d,l);var f=k(c-g.x),e=k(c+d-g.x),b=k(a-g.y);k=k(a+l-g.y);f<e&&f<b&&f<k?(f=0,g.x=c,g.y=m(g.y,a,a+l)):e<f&&e<b&&e<k?(f=2,g.x=c+d,g.y=m(g.y,a,a+l)):(b<f&&b<
e&&b<k?(f=1,g.y=a):(f=3,g.y=a+l),g.x=m(g.x,c,c+d));return f},rectOverlapsRect:function(g,c){return!(g.y+g.h<c.y||g.y>c.y+c.h||g.x+g.w<c.x||g.x>c.x+c.w)},circlesCollide_Offset:function(g,c,a,d){if(g&&a){var l=g.radius+a.radius,m=a.center.x+d.x-(g.center.x+c.x);g=a.center.y+d.y-(g.center.y+c.y);m=Y.sqrt(m*m+g*g);if(!(m>l))return{dist:m,radii:l}}},circlesCollide:function(g,c){if(g&&c){var a=g.radius+c.radius,d=c.center.x-g.center.x;g=c.center.y-g.center.y;d=Y.sqrt(d*d+g*g);if(!(d>a))return{dist:d,radii:a}}},
rectsCollide_Offset:function(g,c,a,d){var l=g.x+c.x;c=g.y+c.y;var m=a.x+d.x;d=a.y+d.y;return!(c+g.h<d||c>d+a.h||l+g.w<m||l>m+a.w)}};db.rectsCollide=db.rectOverlapsRect;db.circlesAndRectCollide_Offset=function(g,c,a,d){var l=0;var m=g.squaredRadius?g.squaredRadius:g.radius*g.radius;var k=g.center.y+c.x;g=g.center.y+c.y;c=a.x+d.x;d=a.y+d.y;var f=c+a.w;a=d+a.h;k<c?(k-=c,l+=k*k):k>f&&(k-=f,l+=k*k);g<d?(k=g-d,l+=k*k):g>a&&(k=g-a,l+=k*k);if(l<=m)return{}};db.circlesAndRectCollide=function(g,c){var a=0;
var d=g.squaredRadius?g.squaredRadius:g.radius*g.radius;g=g.center;var l=c.x+c.w;var m=c.y+c.h;g.x<c.x?(l=g.x-c.x,a+=l*l):g.x>l&&(l=g.x-l,a+=l*l);g.y<c.y?(l=g.y-c.y,a+=l*l):g.y>m&&(l=g.y-m,a+=l*l);if(a<=d)return{}};db.shapesCollide=function(g,c,a,d){switch(g.type){case "circle":switch(a.type){case "circle":return db.circlesCollide_Offset(g,c,a,d);case "rect":return db.circlesAndRectCollide_Offset(g,c,a,d);default:return}case "rect":switch(a.type){case "circle":return db.circlesAndRectCollide_Offset(a,
d,g,c);case "rect":return db.rectsCollide_Offset(g,c,a,d)}}};db.shapeAndShapeListCollide=function(g,c,a,d){for(var l,m,k=g.children&&g.children.length,f,e=0,b=a.length;e!==b;++e)if(m=a[e],l=db.shapesCollide(g,c,m,d)){f=m.children&&m.children.length;if(!k&&!f)return l;if(k&&!f){if(l=db.shapeAndShapeListCollide(m,d,g.children,c))return l}else if(l=db.shapeAndShapeListCollide(g,c,m.children,d))if(!k||(l=db.shapeListsCollide(g.children,c,m.children,d)))return l}};db.shapeListsCollide=function(g,c,a,d){for(var l,
m=0,k=g.length;m!==k;++m)if(l=db.shapeAndShapeListCollide(g[m],c,a,d))return l};db.BoundingShapesCollide=function(g,c,a,d){var l=db.circlesCollide_Offset(g.mBounding,c,a.mBounding,d);return l?db.shapeListsCollide(g.mShapes,c,a.mShapes,d):l};db.BoundingShape=function(g){!1===Array.isArray(g)&&(g=[g]);this.mLimits={left:void 0,right:void 0,top:void 0,bottom:void 0};this.mShapes=[];for(var c=0,a=g.length;c!==a;++c)this.mShapes.push(bf(g[c],this.mLimits));this.mLimits.left=this.mLimits.left||0;this.mLimits.right=
this.mLimits.right||0;this.mLimits.top=this.mLimits.top||0;this.mLimits.bottom=this.mLimits.bottom||0;this.mSize={x:this.mLimits.right-this.mLimits.left,y:this.mLimits.bottom-this.mLimits.top};g=this.mSize.x/2;c=this.mSize.y/2;this.mBounding=new ub.Circle({x:this.mLimits.left+g,y:this.mLimits.top+c,squaredRadius:g*g+c*c})};db.pointToLine=function(g,c,a){var d={onLine:!1},l=c.x-a.x,m=c.y-a.y;l=((g.x-c.x)*(a.x-c.x)+(g.y-c.y)*(a.y-c.y))/(l*l+m*m);m={};m.x=c.x+l*(a.x-c.x);m.y=c.y+l*(a.y-c.y);d.closePoint=
m;c=g.x-m.x;g=g.y-m.y;d.distanceSquared=c*c+g*g;d.onLine=0<=l&&1>=l;return d};db.lineIntersectsCircle=function(g,c,a,d){var l=c.x-g.x,m=c.y-g.y;c=g.x-a.x;a=g.y-a.y;g=l*l+m*m;l=2*(c*l+a*m);c=l*l-4*g*(c*c+a*a-d*d);if(0>c)return!1;c=Math.sqrt(c);d=(-l-c)/(2*g);l=(-l+c)/(2*g);return 0<=d&&1>=d||0<=l&&1>=l?!0:!1};var be=function(g){this.phaseTimer=this.phaseIndex=this.currentAverage=0;this.phaseTimerMax=g;this.phaseInterp=0;this.onFirstPhase=!0;this.phases=[{average:0,count:0},{average:0,count:0}]};be.prototype.addValue=
function(g){var c=this.phases[this.phaseIndex];c.count++;c.average+=(g-c.average)/c.count};be.prototype.update=function(g){this.phaseTimer+=g;this.phaseInterp=this.phaseTimer/this.phaseTimerMax;this.phaseTimer>=this.phaseTimerMax&&(this.phaseIndex,this.phaseIndex=(this.phaseIndex+1)%2,this.phaseInterp=this.phaseTimer=0,this.phases[this.phaseIndex].average=0,this.phases[this.phaseIndex].count=0,this.onFirstPhase=!1);g=this.phases[this.phaseIndex];var c=this.phases[(this.phaseIndex+1)%2];this.onFirstPhase&&
(c=g);var a=this.phaseInterp;this.currentAverage=Y.interp(g.average,c.average,a*a*(3-2*a))};be.prototype.getCurrentAverage=function(){return this.currentAverage};Y.Matrix=Qb;Y.BitList=Kd;Y.rng=Rb;Y.shapes=ub;Y.Vector=za;Y.Angle=bc;Y.Position=Mf;Y.collision2D=db;Y.PhasedRollingAverage=be;for(var Of in Lf)Y[Of]=Lf[Of];var O=function m(c,a,d,l){"undefined"===typeof c?(this.b=this.g=this.r=255,this.a=1):"string"===typeof c?this.copyFrom(m.makeFromStyleString(c)):(void 0!==c.r?(this.r=c.r,this.g=c.g,this.b=
c.b,this.a=void 0===c.a?1:c.a):(this.r=c,this.g=a,this.b=d,this.a=void 0===l?1:l),this.applyLimits())};O.prototype.setAlpha=function(c){0>c?c=0:1<c&&(c=1);this.a=c;return this};O.prototype.mult=function(c,a,d,l,m){void 0!==c.r&&(m=a,l=c.a,d=c.b,a=c.g,c=c.r);c=c/255*this.r;a=a/255*this.g;d=d/255*this.b;l*=this.a;m?m.set(c,a,d,l):m=new O(c,a,d,l);m.applyLimits();return m};O.prototype.scale=function(c){this.r*=c;this.g*=c;this.b*=c;this.applyLimits();return this};O.prototype.shift=function(c){this.r+=
c;this.g+=c;this.b+=c;this.applyLimits();return this};O.prototype.applyLimits=function(){this.r=0>this.r?0:255<this.r?255:this.r|0;this.g=0>this.g?0:255<this.g?255:this.g|0;this.b=0>this.b?0:255<this.b?255:this.b|0;0>this.a?this.a=0:1<this.a&&(this.a=1)};O.prototype.toString=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"};O.prototype.toHexString=function(){var c=this.r.toString(16);c.length%2&&(c="0"+c);var a=this.g.toString(16);a.length%2&&(a="0"+a);var d=this.b.toString(16);
d.length%2&&(d="0"+d);return"#"+c+a+d};O.prototype.setWhite=function(){this.b=this.g=this.r=255;this.a=1};O.prototype.setRandom=function(c){c||(c=Y);this.r=(200*c.random()|0)+54;this.g=(200*c.random()|0)+54;this.b=(200*c.random()|0)+54;this.a=1};O.randomColor=function(c){var a=new O;a.setRandom(c);return a};O.prototype.copy=function(){return new O(this.r,this.g,this.b,this.a)};O.prototype.set=function(c,a,d,l){void 0===l&&(l=1);this.r=c;this.g=a;this.b=d;this.a=l};O.prototype.copyFrom=function(c){this.set(c.r,
c.g,c.b,c.a)};O.prototype.equal=function(c){return this.r===c.r&&this.g===c.g&&this.b===c.b&&this.a===c.a?!0:!1};O.prototype.distanceSq=function(c){var a=this.r-c.r,d=this.g-c.g;c=this.b-c.b;return a*a+d*d+c*c};O.prototype.luminance=function(){return.2126*this.r/255+.7152*this.g/255+.0722*this.b/255};O.luminanceRGB=function(c,a,d){return.2126*c/255+.7152*a/255+.0722*d/255};O.prototype.luminancePerceived=function(){return.299*this.r/255+.587*this.g/255+.114*this.b/255};O.luminancePerceivedRGB=function(c,
a,d){return.299*c/255+.587*a/255+.114*d/255};O.prototype.luminancePerceived2=function(){return Math.sqrt(.299*this.r*this.r/65025+.587*this.g*this.g/65025+.114*this.b*this.b/65025)};O.prototype.matchLuminanceTo=function(c){c=c.luminancePerceived();for(var a=0;20>a;a++){var d=this.luminancePerceived();0>c-d?(this.r-=10,this.g-=10,this.b-=10):(this.r+=10,this.g+=10,this.b+=10);this.applyLimits()}};O.interp=function(c,a,d,l){var m=1-d,k=a.r*d+m*c.r,f=a.g*d+m*c.g,e=a.b*d+m*c.b;c=a.a*d+m*c.a;k=0>k?0:255<
k?255:k|0;f=0>f?0:255<f?255:f|0;e=0>e?0:255<e?255:e|0;c=0>c?0:1<c?1:c;l?(l.r=k,l.g=f,l.b=e,l.a=c):l=new O(k,f,e,c);return l};O.prototype.randomVariance=function(c,a){var d=this.r,l=this.g,m=this.b,k=this.a;c.r&&(d+=2*c.r*Y.random()-c.r,d=0>d?0:255<d?255:d|0);c.g&&(l+=2*c.g*Y.random()-c.g,l=0>l?0:255<l?255:l|0);c.b&&(m+=2*c.b*Y.random()-c.b,m=0>m?0:255<m?255:m|0);c.a&&(k+=2*c.a*Y.random()-c.a,k=0>k?0:1<k?1:k);a?(a.r=d,a.g=l,a.b=m,a.a=k):a=new O(d,l,m,k);return a};var Pf=function(c,a,d){c/=255;a/=255;
d/=255;var l=Math.max(c,a,d),m=Math.min(c,a,d),k=l-m;var f=0==l?0:k/l;if(l==m)var e=0;else{switch(l){case c:e=(a-d)/k+(a<d?6:0);break;case a:e=(d-c)/k+2;break;case d:e=(c-a)/k+4}e/=6}c=[e,f,l];c.h=e;c.s=f;c.v=l;return c};O.RGBToSV=function(c,a,d){c/=255;a/=255;d/=255;var l=Math.max(c,a,d);c=Math.min(c,a,d);return{s:0==l?0:(l-c)/l,v:l}};O.RGBToHSV=function(c,a,d){return Pf(c,a,d)};O.HSVToRGB=function(c,a,d){c=cf(c,a,d);return{r:255*c[0],g:255*c[1],b:255*c[2]}};O.makeColorFromHSV=function(c,a,d){c=
cf(c,a,d);c=new O(255*c[0],255*c[1],255*c[2]);c.applyLimits();return c};O.getHSVFromColor=function(c){return Pf(c.r,c.g,c.b)};O.transparent=new O(0,0,0,0);O.black=new O(0,0,0);O.white=new O(255,255,255);O.gray=new O(128,128,128);O.lightGray=new O(190,190,190);O.darkGray=new O(64,64,64);O.red=new O(255,0,0);O.green=new O(0,255,0);O.blue=new O(0,0,255);O.yellow=new O(255,255,0);O.cyan=new O(0,255,255);O.violet=new O(255,0,255);O.magenta=O.violet;O.lightRed=new O(255,128,128);O.darkRed=new O(128,0,0);
O.lightGreen=new O(128,255,128);O.darkGreen=new O(0,128,0);O.lightBlue=new O(128,128,256);O.darkBlue=new O(0,0,128);O.darkYellow=new O(128,128,0);O.darkCyan=new O(0,128,128);O.darkViolet=new O(128,0,128);O.darkMagenta=O.darkViolet;O.lightYellow=new O(255,255,128);O.lightCyan=new O(128,255,255);O.lightViolet=new O(255,128,255);O.lightMagenta=O.lightViolet;O.orange=new O(255,128,0);O.brown=new O(128,96,0);O.darkBrown=new O(96,64,0);O.makeFromStyleString=function(c){var a,d;var l=a=d=255;var m=1;if("rgb"===
c.substring(0,3)){var k=c.indexOf("(");k&&(c=c.substring(k+1),d=c.indexOf(","),l=parseInt(c.substring(0,d),10),c=c.substring(d+1),d=c.indexOf(","),a=parseInt(c.substring(0,d),10),c=c.substring(d+1),d=c.indexOf(","),0>d?d=c.indexOf(")"):m=parseFloat(c.substring(d+1)),d=parseInt(c.substring(0,d),10))}else{if(O.isStandard(c))return O.standard(c);"#"===c.charAt(0)&&(c=c.substring(1,7));l=parseInt(c.substring(0,2),16);a=parseInt(c.substring(2,4),16);d=parseInt(c.substring(4,6),16)}return new O(l,a,d,m)};
O.makeFromHexString=O.makeFromStyleString;O.standardColorTable={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",
darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",
gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",
lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",
oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",
skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};O.isStandard=function(c){c=c.toLowerCase();var a=O.standardColorTable;return a[c]?a[c]:null};O.standard=function(c){var a=O.standardColorTable;c=c.toLowerCase();return a[c]?O.makeFromHexString(a[c]):
O.gray};O.fixColorStyle=function(c){return"string"===typeof c&&"0"<=c.charAt(0)&&"9">=c.charAt(0)?"#"+c:c};var cc={},ce={};cc.register=function(c,a){a&&(c=c.toUpperCase(),ce[c]?ce[c].push(a):ce[c]=[a])};cc.registerHandler=cc.register;cc.add=cc.register;cc.fireEvent=function(c,a){c=c.toUpperCase();var d=ce[c];if(d){var l=Array.prototype.slice.call(arguments);l.splice(0,2);for(var m=d.length,k=0;k<m;++k)d[k].apply(a,l)}};cc.fire=cc.fireEvent;var Fa=function(c){"object"===typeof c&&c.isImageRef?this.copyFrom(c):
("object"===typeof c&&c.isImage?this.image=c:(this.image=new xa,c&&this.image.appendFrames(c)),this.animSpeed=this.frame=0,this.animDir=1,this.hasRunOnce=this.animOneShot=this.animAutoReverse=this.animPaused=!1,this.flags=this.time=0)};Fa.prototype.isImageRef=!0;Fa.prototype.tileStretchFudge={x:1.5,y:1.5};Fa.prototype.copyFrom=function(c){this.image=c.image;this.frame=c.frame;this.animSpeed=c.animSpeed;this.animDir=c.animDir;this.animPaused=c.animPaused;this.animAutoReverse=c.animAutoReverse;this.animOneShot=
c.animOneShot;this.animRandom=c.animRandom;this.time=c.time;this.flags=c.flags;this.frameEvents=c.frameEvents;this.hasRunOnce=c.hasRunOnce};Fa.prototype.copy=function(c){return new Fa(this)};Fa.prototype.setFrameEvents=function(c){this.frameEvents=c};Fa.prototype.fireEventsForFrame=function(c){this.frameEvents&&this.frameEvents[c]&&cc&&cc.fire(this.frameEvents[c],this)};Fa.buildFromEntireSpriteSheet=function(c,a){Ba.registerSpriteSheet(c,a);c=new Fa;c.image.buildFromEntireSpriteSheet(a);return c};
Fa.prototype.setOnLoad=function(c){this.image.setOnLoad(c)};Fa.prototype.isLoaded=function(){return this.image.isLoaded()};Fa.prototype.getImage=function(){return this.image.getImageFrame(this.frame)};Fa.prototype.getImageFrame=function(c){return this.image.getImageFrame(c)};Fa.prototype.getNamedFrame=function(c){return this.image.getNamedFrame(c)};Fa.prototype.getFrameCount=function(){return this.image.frameCount()};Fa.prototype.setFrame=function(c){var a=this.image.frameCount();0>c&&(c=0);c%=a;
a=this.frame;this.time=this.frame=c;this.hasRunOnce=!1;a!==this.frame&&this.frameEvents&&this.fireEventsForFrame(this.frame)};Fa.prototype.setFrameByName=function(c){this.setFrame(this.getNamedFrame(c))};Fa.prototype.setRandomFrame=function(){var c=this.image.frameCount();this.setFrame(Math.random()*c|0)};Fa.prototype.getFrame=function(){return this.frame};Fa.prototype.getFrameSize=function(c){return this.image.getFrameSize(c)};Fa.prototype.getFrameVisibleSize=function(c){return this.image.getFrameVisibleSize(c)};
Fa.prototype.getSize=function(){return this.getFrameSize(this.frame)};Fa.prototype.setAnimSpeed=function(c){this.animSpeed=c};Fa.prototype.getAnimSpeed=function(){return this.animSpeed};Fa.prototype.setAnimDir=function(c){this.animDir=c};Fa.prototype.getAnimLength=function(){return this.getFrameCount()/this.animSpeed};Fa.prototype.setAnimAutoReverse=function(c){this.hasRunOnce=!1;this.animAutoReverse=c};Fa.prototype.setAnimOneShot=function(c){void 0===c&&(c=!0);this.hasRunOnce=!1;this.animOneShot=
c};Fa.prototype.setAnimRandom=function(c){this.hasRunOnce=!1;this.animRandom=c};Fa.prototype.setAnimPaused=function(c){this.animPaused=void 0===c?!0:c};Fa.prototype.setAnimFinished=function(){this.hasRunOnce=!0;this.setTime(this.image.frameCount())};Fa.prototype.setAnimEnd=function(){this.setTime(this.image.frameCount())};Fa.prototype.isAnimFinished=function(){return this.time>=this.image.frameCount()};Fa.prototype.isAnimOneShot=function(){return this.animOneShot};Fa.prototype.restartAnim=function(){this.setTime(0)};
Fa.prototype.getAnimCompletion=function(){return this.time/this.image.frameCount()};Fa.prototype.setRandomTime=function(){this.setTime(Math.random()*this.image.frameCount())};Fa.prototype.setTime=function(c){this.hasRunOnce=!1;this.time=c;this.update(0)};Fa.prototype.getTime=function(c){return this.time};Fa.prototype.update=function(c){if(0<this.animSpeed){var a=this.frame,d=this.image.frameCount();if(!this.animPaused)if(this.time+=this.animSpeed*this.animDir*c,this.animAutoReverse)this.time>d&&(this.time=
d-(this.time-d),this.animDir=-1),0>this.time&&(this.animOneShot?this.time=0:(this.time=-this.time,this.animDir=1),this.hasRunOnce=!0);else if(this.animOneShot)0<this.animDir&&this.time>d&&(this.time=d,this.hasRunOnce=!0),0>this.animDir&&0>=this.time&&(this.time=0,this.hasRunOnce=!0);else{if(this.animRandom){1<=this.time&&(--this.time,this.frame=(this.frame+((Math.random()*(d-1)|0)+1))%d,this.frameEvents&&a!==this.frame&&this.fireEventsForFrame(this.frame));return}for(;this.time>d;)this.time-=d,this.hasRunOnce=
!0}this.frame=this.time|0;0>this.frame&&(this.frame=0);this.frame>=d&&(this.frame=d-1);this.frameEvents&&a!==this.frame&&this.fireEventsForFrame(this.frame)}};Fa.prototype.draw=function(c,a,d,l,m,k,f,e,b){this.image.draw(c,this.frame,a,d,l,m,this.flags,k,f,e,b)};Fa.prototype.setCentered=function(c,a){"undefined"===typeof a&&(a=c);this.flags=c?this.flags|xa.centeredX:this.flags&~xa.centeredX;this.flags=a?this.flags|xa.centeredY:this.flags&~xa.centeredY;return this};Fa.prototype.isCenteredX=function(){return this.flags&
xa.centeredX?!0:!1};Fa.prototype.setFlipped=function(c,a){this.flags=c?this.flags|xa.flipX:this.flags&~xa.flipX;this.flags=a?this.flags|xa.flipY:this.flags&~xa.flipY};Fa.prototype.drawAsBubble=function(c,a,d,l,m,k,f,e,b){function h(A,E,S,aa){r=aa;if(0===A)return 0;if(A>=E-1)return 1<E&&2>E&&(r=(E-S)*aa),2*aa+(aa-r);A>=S-1&&(r=(E-S)*aa);return aa}var n=m/f;1===e&&(n=1);e=n|0;var t=l/k,v=t|0,q=xa.perFrameDrawCount,r=0,B=0,H=0,G=0;if(b){this.getImage();B=l+a;var K=m+d;G=h(0,n,e,f);var u=r;H=h(0,t,v,
k);b=r;this.draw(c,a,d,b,u,H,G,b,u);G=h(0,n,e,f);u=r;H=h(v,t,v,k);b=r;this.draw(c,B-b,d,b,u,H,G,b,u);G=h(e,n,e,f);u=r;H=h(0,t,v,k);b=r;this.draw(c,a,K-u,b,u,H,G,b,u);G=h(e,n,e,f);u=r;H=h(v,t,v,k);b=r;this.draw(c,B-b,K-u,b,u,H,G,b,u);2<t&&(G=h(0,n,e,f),u=r,H=h(1,t,v,k),b=r,this.draw(c,b+a,d,l-2*b,u,H,G,b,u),G=h(e,n,e,f),u=r,H=h(1,t,v,k),b=r,this.draw(c,b+a,K-u,l-2*b,u,H,G,b,u));2<n&&(G=h(1,n,e,f),u=r,H=h(0,t,v,k),b=r,this.draw(c,a,u+d,b,m-2*u,H,G,b,u),G=h(1,n,e,f),u=r,H=h(v,t,v,k),b=r,this.draw(c,
B-b,u+d,b,m-2*u,H,G,b,u));2<n&&2<t&&(G=h(1,n,e,f),u=r,H=h(1,t,v,k),b=r,2<n&&2<t&&this.draw(c,b+a,u+d,l-2*b,m-2*u,H,G,b,u))}else for(l=0;l<n;l++){G=h(l,n,e,f);u=r;for(K=m=0;K<t;K++)H=h(K,t,v,k),b=r,this.draw(c,m+a,B+d,b+this.tileStretchFudge.x,u+this.tileStretchFudge.y,H,G,b,u),m+=b;B+=u}xa.perFrameBubblePartCount+=xa.perFrameDrawCount-q};var de=function(c,a){var d=!1;a||(a=ca);void 0!==a.imageSmoothingEnabled?(d=a.imageSmoothingEnabled,a.imageSmoothingEnabled=c):(void 0!==a.mozImageSmoothingEnabled?
d=a.mozImageSmoothingEnabled:void 0!==a.webkitImageSmoothingEnabled?d=a.webkitImageSmoothingEnabled:void 0!==a.msImageSmoothingEnabled&&(d=a.msImageSmoothingEnabled),a.mozImageSmoothingEnabled=c,a.webkitImageSmoothingEnabled=c,a.msImageSmoothingEnabled=c);return d},Be=function(){var c=window,a=document,d=a.documentElement;!d&&a.getDocumentElement&&(d=a.getDocumentElement());d||(d=a.getElementsByTagName("body")[0]);a=d.clientWidth||c.innerWidth;c=d.clientHeight||c.innerHeight;return{x:a,y:c,w:a,h:c}},
Ce=null,De=function(c,a,d){return a&&Ce?Ce(c,a,d):new Fa(c)},jb={drawLine:function(c,a,d,l,m){var k={x:0,y:0},f={x:0,y:0};void 0!==c.x?(k=c,void 0!==a.x?(f=a,m=d):(f.x=a,f.y=d,m=l)):(k.x=c,k.y=a,void 0!==d.x?(f=d,m=l):(f.x=d,f.y=l));m&&(m.color&&(ca.strokeStyle=m.color.toString()),void 0!==m.lineWidth&&(ca.lineWidth=m.lineWidth));ca.beginPath();ca.moveTo(k.x,k.y);ca.lineTo(f.x,f.y);ca.stroke()},drawText:function(c,a,d,l){a=a||0;d=d||0;l?ca.fillText(c,a,d,l):ca.fillText(c,a,d)},drawTextArc:function(c,
a,d,l,m,k){k=k||{};if(!m){var f=ca.measureText(c);void 0!==f.width&&(f=f.width);m=Y.min(f/l);k.angleScale&&(m*=k.angleScale)}k.stroke&&k.lineWidth&&(ca.lineWidth=k.lineWidth);f=c.length;ca.save();ca.translate(a,d);ca.rotate(-1*m/2);ca.rotate(m/f*-1/2);for(d=0;d<f;d++)ca.rotate(m/f),ca.save(),ca.translate(0,-1*l),a=c[d],k.stroke?ca.strokeText(a,0,0):ca.fillText(a,0,0),ca.restore();ca.restore()},drawCircle:function(c,a,d,l){ca.beginPath();void 0!==c.center?(l=a,d=c.radius,a=c.center.y,c=c.center.x):
void 0!==c.x&&(void 0!==c.r?(l=a,d=c.r):(l=d,d=a),a=c.y,c=c.x);void 0!==l&&(l.color&&(l.fill?ca.fillStyle=l.color.toString():ca.strokeStyle=l.color.toString()),l.fill||void 0===l.lineWidth||(ca.lineWidth=l.lineWidth));ca.arc(c,a,d,0,Y.PI2,!0);ca.closePath();l&&l.fill?ca.fill():ca.stroke()},drawCircleFilled:function(c,a,d){ca.beginPath();ca.arc(c,a,d,0,Y.PI2,!0);ca.closePath();ca.fill()},drawRect:function(c,a){a=a||{};a.fill?(a.color&&(ca.fillStyle=a.color.toString()),ca.fillRect(c.x,c.y,c.w,c.h)):
(a.lineWidth&&(ca.lineWidth=a.lineWidth),a.color&&(ca.strokeStyle=a.color.toString()),ca.strokeRect(c.x,c.y,c.w,c.h))},drawShapeList:function(c){if(c&&!(0>=c.length))for(var a,d=0;d!==c.length;++d){a=c[d];switch(a.type){case "circle":jb.drawCircle(a);break;case "rect":jb.drawRect(a);break;default:z.log("Unable able to identify shape for drawing\n")}jb.drawShapeList(a.children)}},drawFillbar:function(c,a,d,l,m,k,f,e,b,h){m=m*d/k;ca.fillStyle=f.toString();ca.fillRect(c,a,d,l);ca.fillStyle=e.toString();
ca.fillRect(c,a,m,l);ca.lineWidth=h||1;ca.strokeStyle=b.toString();ca.strokeRect(c,a,d,l)}};jb.draw_fillbar=jb.drawFillbar;jb.makePolygonShape=function(c,a,d,l,m){"undefined"===typeof m&&(m=3);"undefined"===typeof l&&(l=0);var k=2*Math.PI/m;ca.beginPath();for(var f=0;f<m;f++){var e=Math.cos(l+f*k)*d,b=Math.sin(l+f*k)*d;0===f?ca.moveTo(c+e,a+b):ca.lineTo(c+e,a+b)}ca.closePath()};jb.fillPolygon=function(c,a,d,l,m){jb.makePolygonShape(c,a,d,l,m);ca.fill()};jb.strokePolygon=function(c,a,d,l,m){jb.makePolygonShape(c,
a,d,l,m);ca.stroke()};jb.radialClip=function(c,a,d,l,m,k,f){c.beginPath();c.moveTo(a,d);c.arc(a,d,l,m,k,f);c.closePath();c.clip()};jb.roundRect=function(c,a){var d=Math.PI;ca.beginPath();var l=c.x+a,m=c.y+a;ca.arc(l,m,a,d,1.501*d);l=c.x+c.w-a;ca.lineTo(l,c.y);ca.arc(l,m,a,1.499*d,2*d);m=c.y+c.h-a;ca.lineTo(c.x+c.w,m);ca.arc(l,m,a,0,.501*d);l=c.x+a;ca.lineTo(l,c.y+c.h);ca.arc(l,m,a,.499*d,d);ca.closePath()};jb.drawMiniArrow=function(c,a,d){ca.strokeStyle=d;ca.lineWidth=3;ca.beginPath();ca.moveTo(c-
2,a);ca.lineTo(c+7,a);ca.closePath();ca.stroke();ca.beginPath();ca.lineWidth=2;ca.moveTo(c+4,a-3);ca.lineTo(c+8,a);ca.lineTo(c+4,a+3);ca.closePath();ca.stroke()};jb.drawArrow=function(c,a,d,l,m,k,f){d-=c;var e=l-a;l=Math.atan2(e,d);d=Math.sqrt(d*d+e*e)/4;ca.save();ca.translate(c,a);ca.rotate(l);ca.beginPath();ca.moveTo(-d,-d);ca.lineTo(-d,d);ca.lineTo(d,d);ca.lineTo(d,2*d);ca.lineTo(3*d,0);ca.lineTo(d,-2*d);ca.lineTo(d,-d);ca.closePath();ca.fillStyle=m;ca.fill();ca.lineWidth=f;ca.strokeStyle=k;ca.stroke();
ca.restore()};jb.drawPlus=function(){ca.fillStyle="#70B070";ca.fillRect(-7,-3,14,6);ca.fillRect(-3,-7,6,14)};jb.drawMinus=function(){ca.fillStyle="#C07070";ca.fillRect(-7,-3,14,6)};jb.drawParallelogram=function(c,a,d,l,m,k,f){"undefined"===typeof f&&(f=1);if(0!==f){m=Math.tan(m)*l;var e=c+m*(1-f);f=a+(1-f)*l;ca.beginPath();ca.moveTo(e,f);ca.lineTo(e+d,f);ca.lineTo(c+d+m,a+l);ca.lineTo(c+m,a+l);ca.closePath();ca.fillStyle=k;ca.fill()}};jb.drawSegmentOrArc=function(c,a,d){a.toString()&&(a=a.toString());
d=d||1;ca.beginPath();"arc"===c.type?ca.arc(c.center.x,c.center.y,c.radius,c.startAngle,c.endAngle,c.anticlockwise):(ca.moveTo(c.point1.x,c.point1.y),ca.lineTo(c.point2.x,c.point2.y),ca.closePath());ca.lineWidth=d;ca.strokeStyle=a;ca.stroke()};jb.drawArc=function(c,a,d,l,m,k){k=k||{};k.fill?ca.fillStyle=k.color.toString():ca.strokeStyle=k.color.toString();k.fill||void 0===k.lineWidth||(ca.lineWidth=k.lineWidth);ca.beginPath();ca.moveTo(c,a);ca.arc(c,a,d,l,m,!0);ca.closePath();k.fill?ca.fill():ca.stroke()};
var Lc=function(c,a){this.pixelScale=1;this.data=[];this.width=c/this.pixelScale|0;this.height=a/this.pixelScale|0;this.len=this.width*this.height;this.clear()};Lc.prototype.clear=function(){for(var c=0;c<this.len;c++)this.data[c]=0};Lc.prototype.getImageData=function(c,a,d,l){return this};Lc.prototype.setLineWidth=function(c){c/=this.pixelScale;for(var a=0;a<Qf.length;a++){var d=Qf[a];if(c<=d.useForSize||-1===d.useForSize){this.mask=d;break}}};Lc.prototype.setPixels=function(c,a){c=c/this.pixelScale|
0;a=a/this.pixelScale|0;for(var d,l=this.mask.xPts,m=this.mask.yPts,k=this.mask.aVals,f=0;f<l.length;f++)d=(a+m[f])*this.width+c+l[f],this.data[d]+=k[f]};Lc.prototype.getValue=function(c,a){return this.data[(a/this.pixelScale|0)*this.width+(c/this.pixelScale|0)]};Lc.prototype.pack=function(){for(var c="",a=this.width*this.height,d=0;d<a;d+=2)c+=String.fromCharCode(this.data[d]<<8|this.data[d+1]);return c};Lc.prototype.unpack=function(c){for(var a=this.width*this.height,d=0,l=0;l<a;l++){var m=c.charCodeAt(l);
this.data[d]=m>>8&255;this.data[d+1]=m&255;d+=2}};var Qf=[{useForSize:2,xPts:[-1,0,1,0,0],yPts:[0,0,0,-1,1],aVals:[127,255,127,127,127]},{useForSize:3,xPts:[-1,0,1,-1,0,1,-1,0,1],yPts:[0,0,0,-1,-1,-1,1,1,1],aVals:[255,255,255,127,255,127,127,255,127]},{useForSize:6,xPts:[-2,-2,-2,-1,-1,-1,0,0,0,1,1,1,2,2,2,-1,0,1,-1,0,1],yPts:[-1,0,1,-1,0,1,-1,0,1,-1,0,1,-1,0,1,-2,-2,-2,2,2,2],aVals:[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{useForSize:10,xPts:[-1,0,1,
-2,-1,0,1,2,-3,-2,-1,0,1,2,3,-4,-3,-2,-1,0,1,2,3,4,-4,-3,-2,-1,0,1,2,3,4,-4,-3,-2,-1,0,1,2,3,4,-3,-2,-1,0,1,2,3,-2,-1,0,1,2,-1,0,1],yPts:[-4,-4,-4,-3,-3,-3,-3,-3,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,3,3,3,4,4,4],aVals:[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
255,255]},{useForSize:-1,xPts:[-1,0,1,-3,-2,-1,0,1,2,3,-4,-3,-2,-1,0,1,2,3,4,-5,-4,-3,-2,-1,0,1,2,3,4,5,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,-5,-4,-3,-2,-1,0,1,2,3,4,5,-4,-3,-2,-1,0,1,2,3,4,-3,-2,-1,0,1,2,3,-1,0,1],yPts:[-7,-7,-7,-6,-6,-6,-6,-6,-6,-6,-5,-5,-5,-5,-5,-5,-5,-5,-5,-4,-4,-4,-4,-4,-4,-4,
-4,-4,-4,-4,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,7,7,7],aVals:[255,255,255,255,255,255,255,255,255,127,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,127,255,255,255,255,
255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,127,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,127,255,255,255]}],Ob={filters:{},queue:[]};Ob.filters.invert=function(c,a,d){a=
c.data;for(d=0;d<c.data.length;d+=4)a[d]=255-a[d],a[d+1]=255-a[d+1],a[d+2]=255-a[d+2];return c};Ob.filters.colorize=function(c,a,d){d=c.data;var l=a.color.r,m=a.color.g;a=a.color.b;for(var k=0;k<c.data.length;k+=4)d[k]=d[k]*l/255|0,d[k+1]=d[k+1]*m/255|0,d[k+2]=d[k+2]*a/255|0;return c};Ob.filters.brightness=function(c,a,d){d=c.data;a=a.brightness||1.5;for(var l=0;l<c.data.length;l+=4)d[l]=d[l]*a|0,d[l+1]=d[l+1]*a|0,d[l+2]=d[l+2]*a|0;return c};Ob.filters.pixelscale=function(c,a,d){var l=c.data;a=a.scale;
var m=c.width,k=a*c.width,f=a*c.height;d=d.getContext("2d").createImageData(k,f);c=d.data;for(--f;0<=f;f--)for(var e=k-1;0<=e;e--){var b=4*(k*f+e),h=4*(m*(f/a|0)+(e/a|0));c[b]=l[h];c[b+1]=l[h+1];c[b+2]=l[h+2];c[b+3]=l[h+3]}return d};Ob.apply=function(c,a,d,l){"string"===typeof c&&(c=Oa.findInCache(c));if("string"===typeof a){var m=a;a=Ob.filters[m];if(!a)return z.logError("ERROR: No such filter : "+m),null}c.isImage&&(c=c.getImageFrame(0));m=document.createElement("canvas");m.width=c.width;m.height=
c.height;var k=m.getContext("2d");k.drawImage(c,0,0);c=k.getImageData(0,0,m.width,m.height);d&&d.scale&&(m.width=m.width*d.scale|0,m.height=m.height*d.scale|0);(a=a(c,d,m))&&k.putImageData(a,0,0);l&&Oa.addToCache(m,l);return m};Ob.queueFilter=function(c,a,d,l,m){if(Array.isArray(c))for(var k=0;k<c.length;k++){var f=l;l&&Array.isArray(l)&&(f=l[k]);Ob.queueFilter(c[k],a,d,f,m)}else{l===c&&void 0===m&&(m=!0);if(m)for(m=0;m<Ob.queue.length;m++)if(k=Ob.queue[m],k.srcImage===c&&k.registerName===l&&a===
k.filter)return;Ob.queue.push({srcImage:c,filter:a,filterOptions:d,registerName:l})}};Ob.processQueue=function(){if(0<Ob.queue.length){var c=Ob.queue.shift();Ob.apply(c.srcImage,c.filter,c.filterOptions,c.registerName)}return 0>=Ob.queue.length?!0:!1};var Db=function(c){this.anims=[];if(0==Array.isArray(c.anims)){var a=c.anims;c.anims=[];for(var d in a){var l=a[d];l.name=d;c.anims.push(l)}}for(a=0;a<c.anims.length;a++){d=c.anims[a];if(!d.frames&&d.buildFrom){l=d.buildFrom.startFrame||0;var m=d.buildFrom.skipFrames||
1;d.frames=[];for(var k=0;k<d.buildFrom.count;k+=m){for(var f=""+(k+l);f.length<d.buildFrom.digits;)f="0"+f;f=d.buildFrom.base+f;d.buildFrom.suffix&&(f+=d.buildFrom.suffix);d.frames.push(f)}}l=new Fa(d.frames);void 0===d.center&&(d.center=!0);l.setCentered(!!d.center,!!d.center);l.setFlipped(!!d.flipX,!!d.flipY);d.animSpeed||(d.animSpeed=c.defaultAnimSpeed);l.setAnimSpeed(d.animSpeed);d.animSequence||(d.animSequence=c.defaultAnimSequence);"oneshot"===d.animSequence?l.setAnimOneShot(!0):"bounce"===
d.animSequence?l.setAnimAutoReverse(!0):"random"===d.animSequence&&l.setAnimRandom(!0);"number"===typeof d.scale&&(d.scale={x:d.scale,y:d.scale});d.drawOffset||(d.drawOffset=c.defaultDrawOffset);l.animDef=d;this.anims.push(l)}this.states={};this.defaultState=null;if(c.states)for(var e in c.states)if(a={},d=c.states[e],this.states[e]=a,a.defState=d,a.name=e,this.defaultState||(this.defaultState=a),d.anim&&(a.animRef=this.animFromName(d.anim)),d.directions&&0<d.directions.length)for(a.directions=[],
l=0;l<d.directions.length;l++)m=d.directions[l],k=m.maxRad-m.minRad,m={minRad:m.minRad,maxRad:m.maxRad,radWidth:1.00001*k,centerRad:m.minRad+k/2,animRef:this.animFromName(m.anim)},a.directions.push(m);for(e=this.curDirIndex=0;e<this.anims.length;++e)a=this.anims[e],d=a.animDef.name,this.states[d]||(l={},this.states[d]=l,l.name=d,l.animRef=a,this.defaultState||(this.defaultState=l));this.deltaAngle=0;this.curAnimRef=this.curState=null;this.setAnimState(this.defaultState.name);this.animSetDef=c};Db.prototype._syncWith=
void 0;Db.prototype.syncWith=function(c){this._syncWith=c;this.syncAnims(this._syncWith)};Db.prototype.isDone=function(){return this.getCurAnimation()?this.getCurAnimation().hasRunOnce:!0};Db.prototype.syncAnims=function(c){if(c)for(var a=c.anims[0],d=0;d<this.anims.length;d++)c.anims[d]?this.anims[d].setTime(c.anims[d].time):this.anims[d].setTime(a)};Db.prototype.setTime=function(c,a){for(var d=0;d<this.anims.length;d++)a&&"oneshot"===this.anims[d].animDef.animSequence||this.anims[d].setTime(c)};
Db.prototype.getTime=function(){return this.curAnimRef?this.curAnimRef.getTime():0};Db.prototype.setRandomTime=function(){for(var c=0;c<this.anims.length;c++)"oneshot"!==this.anims[c].animDef.animSequence&&this.anims[c].setRandomTime()};Db.prototype.getAnimCount=function(){return this.anims.length};Db.prototype.animFromIndex=function(c){return this.anims[c]};Db.prototype.animFromName=function(c){for(var a=0;a<this.anims.length;a++)if(this.anims[a].animDef.name===c)return this.anims[a];return null};
Db.prototype.update=function(c){if(this._syncWith)this.syncAnims(this._syncWith);else for(var a=0;a<this.anims.length;a++)this.anims[a].update(c)};Db.prototype.assignAnimState=function(c,a){var d={};a=this.animFromName(a.animName);this.states[c]=d;d.name=c;d.animRef=a};Db.prototype.setAnimState=function(c){if(this.states[c]){this.curState=this.states[c];if(this.curState.animRef)return this.setAnimDirectly(this.curState.animRef),this.curAnimRef;if(this.curState.directions)return c=this.curDirIndex,
c>=this.curState.directions.length&&(c=0),this.setAnimDirectly(this.curState.directions[c].animRef),this.curAnimRef}else z.logWarningOnce("WARNING: AnimSet: Attempt to set anim state to "+c+" but no matching state was found"),z.logWarningOnce("   leaving in current state: "+(this.curState?this.curState.name:"???"));return null};Db.prototype.getAnimState=function(){return this.curState?this.curState.name:""};Db.prototype.hasAnimDir=function(c){var a=this.curState;this.states[c]&&(a=this.states[c]);
return a&&a.directions?!0:!1};Db.prototype.setAnimDirFromVector=function(c,a){void 0!==c.x&&(a=c.y,c=c.x);this.setAnimDirFromAngle(Math.atan2(a,c))};Db.prototype.setAnimDirFromAngle=function(c){if(this.curState&&this.curState.directions){this.animSetDef.counterclockwise&&(c=-c);var a=Math.PI,d=2*a;0>c&&(c=d+c);for(var l=0;l<this.curState.directions.length;l++){var m=this.curState.directions[l],k=c-m.centerRad;k>a&&(k-=d);if(k>-m.radWidth/2&&k<m.radWidth/2){this.curAnimRef=m.animRef;this.curDirIndex=
l;this.deltaAngle=k;break}}}};Db.prototype.setAnimDirectly=function(c){"oneshot"===c.animDef.animSequence&&c.restartAnim();if(this.curAnimRef=c)this.curAnimRef.hasRunOnce=!1};Db.prototype.getCurAnimation=function(){return this.curAnimRef};Db.prototype.draw=function(c,a,d){a=a||0;d=d||0;var l=this.getCurAnimation();if(l)if(l.animDef.scale){var m=l.getSize(),k=m.w*l.animDef.scale.x;m=m.h*l.animDef.scale.y;l.animDef.drawOffset&&(a-=l.animDef.drawOffset.x/l.animDef.scale.x,d-=l.animDef.drawOffset.y/l.animDef.scale.y);
l.draw(c,a,d,k,m)}else l.animDef.drawOffset&&(a-=l.animDef.drawOffset.x,d-=l.animDef.drawOffset.y),l.draw(c,a,d)};var fd={makeEmitter:function(c){c=c||{};c.events={};c.on=function(a,d){c.events[a]||(c.events[a]=[]);c.events[a].push(d);return c};c.addListener=c.on;c.off=function(a,d){c.events[a]&&(d=c.events[a].indexOf(d),-1<d&&c.events[a].splice(d,1));return c};c.removeListener=c.off;c.once=function(a,d){c.on(a,function m(){c.removeListener(a,m);for(var k=arguments.length,f=Array(k),e=0;e<k;e++)f[e]=
arguments[e];d.apply(c,f)})};c.emit=function(a){var d=c.events[a];if(d){var l=Array.isArray(d)?qe(d):void 0;l||(l="undefined"!==typeof Symbol&&null!=d[Symbol.iterator]||null!=d["@@iterator"]?Array.from(d):void 0);if(!(d=l||ef(d)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");var m=arguments.length;l=Array(1<m?m-1:0);for(var k=1;k<m;k++)l[k-1]=arguments[k];for(m=0;m<d.length;m++)d[m].apply(c,
l)}return c};return c}};fd.eventify=fd.makeEmitter;var Kg={name:"simple skeleton",bones:[{id:"root",parent:null}]},Rf=function(c,a,d){return c.val},Lg=function(c,a,d){d=(d-c.time)/(a.time-c.time);return c.val*(1-d)+a.val*d},Mg=function(c,a,d){a=(d-c.time)/(a.time-c.time);d=1-a;c=c.c;return d*d*d*c[0]+3*a*d*d*c[1]+3*a*a*d*c[2]+a*a*a*c[3]},nb=function(c,a){a=a||{};this.curTime=0;this.timeDir=this.timeScale=1;this.autoUpdateTime=!0;this.trackChangeCallbacks={};c&&this.loadFromRatData(c,a);a.timeScale&&
this.setTimeScale(a.timeScale);fd.makeEmitter(this)};nb.makeEmptyAnim=function(){return new nb({frame_rate:1,name:"empty",bones:[{id:"root",tracks:[]}],length:1,start_frame:0,end_frame:1},{})};nb.makeConstantAnim=function(c){var a={frame_rate:1,name:"empty",bones:[{id:"root",tracks:[]}],length:1,start_frame:0,end_frame:1},d;for(d in c)a.bones[0].tracks.push({property:d,keys:[{frame:0,val:c[d]}]});return new nb(a,{})};nb.makeAnimFromSimpleData=function(c,a){var d={name:"",bones:[{id:"root",tracks:[]}],
length:1,start_frame:0,end_frame:1,frame_rate:1E3};d.name=c.name||"";d.length=Math.ceil(c.length*d.frame_rate);d.end_frame=d.length-1;c=c.data;for(var l in c){for(var m={property:l,keys:[]},k=c[l],f=0;f<k.length;f++)m.keys[f]={frame:k[f].time*d.frame_rate|0,val:k[f].val};d.bones[0].tracks.push(m)}return new nb(d,a)};nb.prototype.update=function(c){this.autoUpdateTime&&(this.curTime+=c*this.timeScale*this.timeDir,this.curTime>this.data.timeEnd&&0<this.timeDir?this.loop?this.curTime-=this.data.timeEnd:
this.data.reverse?(this.timeDir=-1,this.curTime=this.data.timeEnd-(this.curTime-this.data.timeEnd)):(this.curTime=this.data.timeEnd,this.emit("end")):0>this.curTime&&0>this.timeDir&&(this.timeDir=1,this.curTime=-this.curTime));for(c=0;c<this.bones.length;c++){var a=this.bones[c],d;for(d in a.trackKeys){var l=a.trackKeys[d],m;for(m=0;m<l.length-1&&!(this.curTime<l[m+1].time);m++);var k=l[m].getValue(l[m],l[m+1],this.curTime);if("instant"===l[m].curve_type&&this.trackChangeCallbacks[d]&&k!==a.curVal[d])this.trackChangeCallbacks[d](k);
a.curVal[d]=k}}};nb.prototype.getName=function(){return this.data.name?this.data.name:"[anim]"};nb.prototype.getTime=function(){return this.curTime};nb.prototype.setTime=function(c){this.curTime=c};nb.prototype.getTimeEnd=function(){return this.data?this.data.timeEnd:0};nb.prototype.isLooping=function(){return this.loop};nb.prototype.isAtEnd=function(){return this.curTime>=this.data.timeEnd};nb.prototype.setTimeScale=function(c){this.timeScale=c};nb.prototype.setInterpTime=function(c){this.curTime=
this.data.timeEnd*c};nb.prototype.setFlipX=function(c){this.flipX=c};nb.prototype.setFlipRotation=function(c){this.flipRotation=c};nb.prototype.setScaleTranslation=function(c){this.scaleTranslation=c};nb.prototype.setAnimSpecialXRotation=function(c){this.specialXRotation={xPart:Math.cos(c),yPart:Math.sin(c)}};nb.prototype.setOnTrackChange=function(c,a,d){var l=this.bonesByID[c];l?l.trackKeys[a]?this.trackChangeCallbacks[a]=d:z.logError("setOnTrackChange no such track "+a):z.logError("setOnTrackChange no such bone "+
c)};nb.prototype.clearOnTrackChange=function(c){delete this.trackChangeCallbacks[c]};nb.prototype.getTransform=function(c){c=this.bonesByID[c].curVal;c={translation:{x:c.x||0,y:c.y||0},rotation:c.rz||0,scale:{x:void 0===c.sx?1:c.sx,y:void 0===c.sy?1:c.sy}};this.scaleTranslation&&(c.translation.x*=this.scaleTranslation.x,c.translation.y*=this.scaleTranslation.y);this.flipX&&(c.translation.x*=-1);this.flipRotation&&(c.rotation*=-1);this.applySpecialXRotation&&void 0!==this.specialXRotation&&(c.translation.y+=
c.translation.x*this.specialXRotation.yPart,c.translation.x*=this.specialXRotation.xPart);return c};nb.prototype.loadFromRatData=function(c,a){a=a||{};void 0!==a.autoUpdateTime&&(this.autoUpdateTime=a.autoUpdateTime);this.data=c;this.skeleton=c.skeleton||Kg;this.loop=!0;void 0!==c.loop&&(this.loop=c.loop);void 0!==a.loop&&(this.loop=a.loop);void 0!==a.applySpecialXRotation&&(this.applySpecialXRotation=a.applySpecialXRotation);c.frame_rate=c.frame_rate||24;c.length=c.length||c.end_frame-c.start_frame;
c.timeEnd=c.length/c.frame_rate;this.bones=[];this.bonesByID={};for(c=0;c<this.skeleton.bones.length;c++){for(var d=this.skeleton.bones[c],l=this.getTracksForBone(d.id),m={},k=0;k<l.length;k++){var f=l[k],e=1,b;if(b=void 0!==a.scaleTranslation)b=f.property,b="x"===b||"y"===b||"z"===b;b&&(e=a.scaleTranslation);void 0!==a.flipYData&&"y"===f.property&&(e*=-1);b=[];for(var h=0;h<f.keys.length;h++){var n=f.keys[h];n.time||(n.time=n.frame/this.data.frame_rate);var t={val:n.val*e,time:n.time};t.curve_type=
n.curve_type||"linear";"CONSTANT"==n.interpolation?t.curve_type="instant":"CUBIC"===n.interpolation&&"EASE_IN"===n.easing?(t.curve_type="cubic",t.c=[0,0,0,1]):"CUBIC"===n.interpolation&&"EASE_OUT"===n.easing?(t.curve_type="cubic",t.c=[0,1,1,1]):"CUBIC"===n.interpolation&&"EASE_IN_OUT"===n.easing||"AUTO"===n.easing?(t.curve_type="cubic",t.c=[0,0,1,1]):"cubic"===t.curve_type&&(t.c=[0,n.c[0],n.c[1],1]);b.push(t)}0!==b[0].time&&(e=tb(b[0]),e.time=0,e.curve_type="instant",b.unshift(e));for(e=0;e<b.length-
1;e++)h=b[e],t=b[e+1],h.curve_type||(h.curve_type="linear"),"linear"===h.curve_type?h.getValue=Lg:"cubic"===h.curve_type?(h.getValue=Mg,n=h.val,t=t.val-h.val,h.c=[h.c[0]*t+n,h.c[1]*t+n,h.c[2]*t+n,h.c[3]*t+n]):(h.curve_type="instant",h.getValue=Rf);b[b.length-1].getValue=Rf;m[f.property]=b}d={id:d.id,trackKeys:m,curVal:{}};this.bonesByID[d.id]=d;this.bones.push(this.bonesByID[d.id])}};nb.prototype.getTracksForBone=function(c){for(var a=0;a<this.data.bones.length;a++)if(this.data.bones[a].id===c)return this.data.bones[a].tracks;
return[]};var Kb=function(c){this.anims=[];this.animsByName={};if(0==Array.isArray(c.anims)){var a=c.anims;c.anims=[];for(var d in a){var l=a[d];l.name=d;c.anims.push(l)}}a=c.source.data.objects[0].animations;for(d=0;d<c.anims.length;d++){l=c.anims[d];if(l.anim)var m=l.anim;else{m=l.useDataName||l.name;a:{for(var k=0;k<a.length;k++)if(a[k].name===m){m=a[k];break a}z.logError("KeyAnimSet constructor: can't find source data named "+m);m=null}m=new nb(m,l.constructionOpts)}m.name=l.name;this.anims.push(m);
this.animsByName[m.name]=m}this.keyAnimSetDef=c;this.setAnimByIndex(0)};Kb.prototype.setAnimEntry=function(c,a){a||(a=c.name);for(var d=-1,l=0;l<this.anims.length;l++)if(this.anims[l].name===a){d=l;break}-1<d&&(this.anims[d]=c);this.animsByName[a]=c};Kb.prototype.getAnimCount=function(){return this.anims.length};Kb.prototype.isDone=function(){return this.getCurAnimation()?this.getCurAnimation().isAtEnd():!0};Kb.prototype.setTime=function(c){this.curAnim&&this.curAnim.setTime(c)};Kb.prototype.getTime=
function(){return this.curAnim?this.curAnim.getTime():0};Kb.prototype.setRandomTime=function(){for(var c=0;c<this.anims.length;c++)"oneshot"!==this.anims[c].animDef.animSequence&&this.anims[c].setRandomTime()};Kb.prototype.animFromName=function(c){for(var a=0;a<this.anims.length;a++)if(this.anims[a].animDef.name===c)return this.anims[a];return null};Kb.prototype.update=function(c){this.curAnim&&this.curAnim.update(c)};Kb.prototype.setAnimByName=function(c){if(this.curAnim&&this.curAnim.name===c)return this.curAnim;
if(this.animsByName[c])this.curAnim=this.animsByName[c];else return z.logWarningOnce("WARNING: KeyAnimSet: Attempt to set anim to "+c+" but no matching anim was found"),z.logWarningOnce("   leaving in current state: "+(this.curAnim?this.curAnim.name:"???")),null;return this.curAnim};Kb.prototype.setAnimState=Kb.prototype.setAnimByName;Kb.prototype.setCurAnim=Kb.prototype.setAnimByName;Kb.prototype.setAnimByIndex=function(c){return this.setAnimByName(this.anims[c].name)};Kb.prototype.getAnimName=function(){return this.curAnim?
this.curAnim.name:""};Kb.prototype.getCurAnimation=function(){return this.curAnim};Kb.prototype.getCurAnim=Kb.prototype.getCurAnimation;var yc=function(){this.list=[]};yc.prototype.clear=function(){this.list=[]};yc.prototype.snap=function(c){var a={};a.x=c.x-1|0;a.y=c.y-1|0;a.w=c.w+1+(c.x-a.x)+.999999999|0;a.h=c.h+1+(c.y-a.y)+.999999999|0;return a};yc.prototype.add=function(c){c=this.snapEven?this.snap(c):{x:c.x,y:c.y,w:c.w,h:c.h};for(var a=this.list.length-1;0<=a;a--){var d=this.list[a],l=c.x+c.w,
m=c.y+c.h,k=d.x+d.w,f=d.y+d.h;if(c.x>=d.x&&c.y>=d.y&&l<=k&&m<=f)return;if(c.x<=d.x&&c.y<=d.y&&l>=k&&m>=f)this.list.splice(a,1);else if(!(l<d.x||k<c.x||m<d.y||f<c.y)){if(c.x<d.x){var e=c.x;if(l>k){var b=d.w;k=l}else b=l-d.x}else e=d.x,k>l?b=c.w:(b=k-c.x,k=l);if(c.y<d.y){var h=c.y;m>f?l=d.h:(l=m-d.y,m=f)}else h=d.y,f>m?(l=c.h,m=f):l=f-c.y;b*l>c.w*c.h*.7&&(d.x+d.w>k&&console.log("LOSS"),c.x=e,c.y=h,c.w=k-e,c.h=m-h,this.list.splice(a,1))}}this.list.push(c)};yc.prototype.hits=function(c){this.snapEven&&
(c=this.snap(c));for(var a=0;a<this.list.length;a++){var d=this.list[a];if(c.x+c.w>=d.x&&c.x<=d.x+d.w&&c.y+c.h>=d.y&&c.y<=d.y+d.h)return!0}return!1};yc.prototype.eraseList=function(c){for(var a=0;a<this.list.length;a++){var d=this.list[a];c.clearRect(d.x,d.y,d.w,d.h)}};yc.prototype.clipToList=function(c,a){c.save();this.listToPath(c,a);c.clip()};yc.prototype.unclip=function(c){c.restore()};yc.prototype.listToPath=function(c,a){a||(a=this.list);c.beginPath();for(var d=0;d<a.length;d++){var l=a[d];
c.moveTo(l.x,l.y);c.lineTo(l.x+l.w,l.y);c.lineTo(l.x+l.w,l.y+l.h);c.lineTo(l.x,l.y+l.h);c.lineTo(l.x,l.y)}};var $a=function l(a,d){this.canvas=document.createElement("canvas");this.canvas.width=this.width=a;this.canvas.height=this.height=d;this.ctx=this.canvas.getContext("2d");l.allowOffscreens||z.logWarning("WARNING!  You're trying to use an Offscreen() object, but offscreens are not allowed by this host!")};$a.allowOffscreens=!sa.Wraith;$a.prototype.enableDirtyRects=function(){this.dirtyRects||
(this.dirtyRects=new yc,this.dirtyRects.snapEven=!0)};$a.prototype.setSize=function(a,d,l){if(l||this.width!==a||this.height!==d)this.canvas.width=this.width=a,this.canvas.height=this.height=d};$a.prototype.getContext=function(){return this.ctx};$a.prototype.getCanvas=function(){return this.canvas};$a.prototype.render=function(a,d,l,m,k){a||(a=gb());d||(d=0);l||(l=0);m||(m=this.canvas.width);k||(k=this.canvas.height);m&&k&&a.drawImage(this.canvas,d,l,m,k)};$a.prototype.eraseDirty=function(){this.dirtyRects&&
this.dirtyRects.eraseList(this.ctx)};$a.prototype.clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.dirtyRects&&this.dirtyRects.clear()};$a.prototype.erase=function(){10!==sa.IEVersion||$a.warnedAboutIE10||(z.logWarning("Warning:  This clearRect() call will fail in IE10 if you're using fancy clipping."),$a.warnedAboutIE10=!0);this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)};$a.prototype.clipAndEraseDirty=function(){10===sa.IEVersion?(this.eraseDirty(),
this.clipToDirty()):(this.clipToDirty(),this.erase())};$a.prototype.clipToDirty=function(){this.dirtyRects.clipToList(this.ctx)};$a.prototype.unclip=function(){this.dirtyRects.unclip(this.ctx)};$a.prototype.dirtyToPath=function(a,d){a||(a=this.ctx);d||(d=this.dirtyRects.list);this.dirtyRects.listToPath(a,d)};$a.debugColors=[O.orange,O.darkGreen,O.cyan,O.blue,O.violet];$a.prototype.applyDebugOverlay=function(){if(!$a.checkerImages){$a.checkerImages=[];for(var a=$a.debugColors,d=0;d<a.length;d++){var l=
a[d];$a.checkerImages[d]=document.createElement("canvas");$a.checkerImages[d].width=32;$a.checkerImages[d].height=32;var m=$a.checkerImages[d].getContext("2d");m.fillStyle=l.toString();m.fillRect(0,0,10,10);m.fillRect(16,16,10,10)}}a=$a.debugColors.length;this.debugOffscreenCycle||(this.debugOffscreenCycle=Math.random()*a|0);m=this.ctx;this.pat=m.createPattern($a.checkerImages[this.debugOffscreenCycle],"repeat");d=m.globalAlpha;m.globalAlpha=.3;m.fillStyle=this.pat;m.fillRect(0,0,this.width,this.height);
this.debugOffscreenCycle=(this.debugOffscreenCycle+1)%a;m.globalAlpha=d};var Ng=0,fc={Mov:{type:"mp4",ext:"mov"},MP4:{type:"mp4",ext:"mp4"},WebM:{type:"webm",ext:"webm"},Ogg:{type:"ogg",ext:"ogg"}},Ua=function(a){this.flags=0;a=a||{};var d=a.file,l=a.foreground;this._isPlaying=this._pauseOnDoneBuffering=this._pauseOnLoad=this._playOnLoad=!1;this._isLoading=!0;this._isMuted=this._isBuffering=!1;this.events={};this._loadingDoneWaitingForBufferedData=!1;this._isVisibleWhenNotPlaying=null!=a.isVisibleWhenNotPlaying?
a.isVisibleWhenNotPlaying:!0;this._isAlphaChannelVideo=null!=a.isAlphaChannelVideo?a.isAlphaChannelVideo:!1;this._isPlayInCanvas=!1;null!=a.isPlayInCanvas&&(this._isPlayInCanvas=a.isPlayInCanvas,this._xPositionInCanvas=a.xPositionInCanvas?a.xPositionInCanvas:0,this._yPositionInCanvas=a.yPositionInCanvas?a.yPositionInCanvas:0);this._lastBufferingCheckTime=this._accredBufferingCheck=0;this.runningEvents=[];this.addEventListener("load",a.onLoad||a.onload);this.addEventListener("destroy",a.onDestroy||
a.ondestroy);this.addEventListener("startbuffering",a.onStartBuffering||a.onstartbuffering);this.addEventListener("endbuffering",a.onEndBuffering||a.onendbuffering);this.addEventListener("end",a.onEnd||a.onend);this._isForeground=l||!1;this.htmlTagID=++Ng;this.mSrc="";this.mVolume=1;this.createHTMLTag();this.setFile(d||"");this.buffered=[];void 0!==a.volume&&this.setVolume(a.volume)};Ua.prototype.disabled=!1;Ua.numberOfActiveBGVideos=0;Ua.prototype.updateCanvasDrawPosition=function(a,d){null!=a&&
(this._xPositionInCanvas=a);null!=d&&(this._yPositionInCanvas=d)};Ua.prototype.addEventListener=function(a,d,l){a&&d&&(this.events[a]||(this.events[a]=[]),this.events[a].push({cb:d,context:l}))};Ua.prototype.removeEventListener=function(a,d,l){if(a&&d&&this.events[a]){for(var m=this.events[a],k,f=0;f<m.length;++f)if(k=m[f],k.cb===d&&k.context===l){for(l=0;l<this.runningEvents.length;++l)d=this.runningEvents[l],d.type==a&&(d.onIndex>=l&&--d.onIndex,--d.endIndex);m.splice(f,1);break}0>=m.length&&(this.events[a]=
void 0)}};Ua.prototype.fireEvent=function(a,d){if(a&&this.events[a]){var l=Array.prototype.slice.call(arguments);l.unshift(this);var m=this.events[a],k={type:a,onIndex:0,endIndex:m.length-1};this.runningEvents.push(k);for(var f;k.onIndex<=k.endIndex;++k.onIndex)f=m[k.onIndex],f.cb.apply(f.context,l);this.runningEvents.pop()}};Ua.prototype.isPlaying=function(){return this.isLoading()?this._playOnLoad:this._isPlaying};Ua.prototype.isPaused=function(){return this.isPlaying()?this.isLoading()?this._pauseOnLoad:
this.isBuffering()?this._pauseOnDoneBuffering:this.htmlTag.paused:!1};Ua.prototype.isLoading=function(){return this._isLoading};Ua.prototype.isBuffering=function(){return this._isBuffering};Ua.prototype.destroy=function(){this.fireEvent("destroy");this.stop();this.htmlTag.pause();this.htmlTag.src="";this.htmlTag.parentNode.removeChild(this.htmlTag);this.htmlTag=void 0};Ua.prototype.getFile=function(){return this.mSrc};Ua.prototype.setFile=function(a){if(a!==this.mSrc){this.mSrc=a;if(a){var d=this.htmlTag;
if(!fc.queried){for(var l in fc)fc[l].supported=!!d.canPlayType("video/"+fc[l].type);fc.queried=!0}for(var m in fc)if(fc[m].supported){z.log(fc[m].ext+" is supported video format");var k=fc[m].ext;break}k||(z.log("Unable to find supported video file format.  Defaulting to .mp4"),k=fc.MP4.ext);l=a.lastIndexOf(".");0>l&&(l=a.length);b:{m=a.slice(l);"."===m[0]&&(m=m.slice(1));if(m)for(f in fc)if(fc[f].ext===m){var f=fc[f];break b}f={supported:!1}}f.supported||(a=a.slice(0,l)+"."+k);k=ac(a)}else k=a;
this.mFullFile=k;this.htmlTag.src=this.mFullFile;this._isLoading=!0;this.htmlTag.load()}this.stop()};Ua.prototype.createHTMLTag=function(){if(!this.disabled){this.htmlTag=document.createElement("video");this.htmlTag.id=this.htmlTagID;this.htmlTag.style.position="absolute";this._isVisibleWhenNotPlaying||(this.htmlTag.style.display="none");var a=La;a.parentNode.appendChild(this.htmlTag);a.style.zIndex||0===a.style.zIndex||(a.style.zIndex=0);this.htmlTag.style.zIndex=this._isForeground?a.style.zIndex+
(100-this.htmlTagID):a.style.zIndex-(100-this.htmlTagID);this.htmlTag.style.backgroundColor=sd;this.htmlTag.style.objectFit="contain";this._isPlayInCanvas||(this.onResize(),re("resize",this.onResize.bind(this)));this._isAlphaChannelVideo&&(this.bufferCanvas=document.createElement("canvas"),this.bufferCanvas.style.display="none",a.parentNode.appendChild(this.bufferCanvas));this.htmlTag.preload="auto";this.htmlTag.oncanplaythrough=this.onLoaded.bind(this);this.htmlTag.onended=this.onEnded.bind(this)}};
Ua.prototype.setCentered=function(a,d){"undefined"===typeof d&&(d=a);this.flags=a?this.flags|xa.centeredX:this.flags&~xa.centeredX;this.flags=d?this.flags|xa.centeredY:this.flags&~xa.centeredY;return this};Ua.prototype.draw=function(a,d,l){this.updateCanvasDrawPosition(d,l);if(this._isPlayInCanvas&&!this.htmlTag.paused&&!this.htmlTag.ended){var m=this.flags;l=d=0;m&xa.centeredX&&(d=-this.htmlTag.videoWidth/2);if(this._isAlphaChannelVideo){var k=this.htmlTag.videoWidth,f=this.htmlTag.videoHeight/2;
m&xa.centeredY&&(l=-this.htmlTag.videoHeight/4);this.buffer.drawImage(this.htmlTag,0,0);m=this.buffer.getImageData(0,0,k,f);var e=m.data;k=this.buffer.getImageData(0,f,k,f).data;f=3;for(var b=e.length;f<b;f+=4)e[f]=k[f-1];a.putImageData(m,this._xPositionInCanvas+d,this._yPositionInCanvas+l)}else m&xa.centeredY&&(l=-this.htmlTag.videoHeight/2),a.drawImage(this.htmlTag,this._xPositionInCanvas+d,this._yPositionInCanvas+l)}};Ua.prototype.onLoaded=function(){this.isLoading()&&(this._loadingDoneWaitingForBufferedData=
!0,this._isAlphaChannelVideo&&(this.bufferCanvas.width=this.htmlTag.videoWidth,this.bufferCanvas.height=this.htmlTag.videoHeight,this.buffer=this.bufferCanvas.getContext("2d")))};Ua.prototype.onEnded=function(){this.stop();this.fireEvent("end")};Ua.prototype.play=function(a){if(a)this.setFile(a);else if(this.isPlaying())return;this.mSrc?this.isLoading()?this._playOnLoad=!0:(this.activateVideo(),this.htmlTag.play(),this._isPlaying=!0):z.log("Attempting to play a video with no source")};Ua.prototype.stop=
function(){this.isPlaying()&&(this.isLoading()?this._playOnLoad=!1:(this.deactivateVideo(),this.htmlTag.pause(),this._isPlaying=!1,this.isBuffering()&&this.fireEvent("endbuffering"),this._isBuffering=!1,this.htmlTag.currentTime=0))};Ua.prototype.pause=function(){this.isPlaying()&&!this.isPaused()&&(this.isLoading()?this._pauseOnLoad=!0:this.isBuffering()?this._pauseOnDoneBuffering=!0:(this._pauseOnLoad=this._pauseOnDoneBuffering=!1,this.htmlTag.pause()))};Ua.prototype.resume=function(){this.isPlaying()&&
this.isPaused()&&(this.isLoading()?this._pauseOnLoad=!1:this.htmlTag.play())};Ua.prototype.activateVideo=function(){this._isVisibleWhenNotPlaying||this._isPlayInCanvas||(this.htmlTag.style.display="block");this._isForeground||++Ua.numberOfActiveBGVideos};Ua.prototype.deactivateVideo=function(){this._isVisibleWhenNotPlaying||(this.htmlTag.style.display="none");this._isForeground||--Ua.numberOfActiveBGVideos};Ua.prototype.onResize=function(){var a=La;this.htmlTag.width=a.width;this.htmlTag.height=a.height;
this.htmlTag.style.left=a.style.left;this.htmlTag.style.top=a.style.top};Ua.prototype.update=function(a){if(this.mSrc&&(this.buffered=[],this.htmlTag.buffered.length))for(var d=0;d<this.htmlTag.buffered.length;++d){var l={start:this.htmlTag.buffered.start(d),end:this.htmlTag.buffered.end(d)};this.buffered.push(l)}this._loadingDoneWaitingForBufferedData?0<this.htmlTag.buffered.length&&.1<this.htmlTag.buffered.end(0)&&(this._loadingDoneWaitingForBufferedData=!1,this.htmlTag.buffered.start(0),this.htmlTag.buffered.end(0),
this._isLoading=!1,this.fireEvent("load"),this._playOnLoad&&this.play(),this._pauseOnLoad&&this.pause(),this._pauseOnLoad=this._playOnLoad=!1):this.isLoading()||this._updateBuffering(a)};var Sf=void 0;Ua.prototype._updateBuffering=function(a){this._accredBufferingCheck+=a;a=this.getCurrentTime({useRaw:!0});Sf!==Y.floor(a)&&(Sf=Y.floor(a));if(this.htmlTag.paused)this._accredBufferingCheck=0,this._lastBufferingCheckTime=this.getCurrentTime({useRaw:!0}),a=!1;else if(.2<this._accredBufferingCheck){a=
this._lastBufferingCheckTime;var d=this.getCurrentTime({useRaw:!0});this._lastBufferingCheckTime=d;a=d-a<this._accredBufferingCheck-.1;this._accredBufferingCheck=0}else a=this.isBuffering();this.isLoading()||this.isPaused()&&!this._pauseOnDoneBuffering||!this.isPlaying()?!this._pauseOnDoneBuffering&&this.isBuffering()&&(this.fireEvent("endbuffering"),this._isBuffering=!1):this.isBuffering()!==a&&(this._isBuffering=a,this.isBuffering()?this.fireEvent("startbuffering"):(this._pauseOnDoneBuffering&&
(this._pauseOnDoneBuffering=!1,this.pause()),this.fireEvent("endbuffering")))};Ua.prototype.getDurration=function(){return this.isLoading()?-1:this.htmlTag.duration};Ua.prototype.getCurrentTime=function(a){return!this.isLoading()||a&&a.useRaw?this.htmlTag.currentTime:0};Ua.prototype.setCurrentTime=function(a){0>a||a>this.htmlTag.duration?z.log("Unable to seek to invalid time "+a):this.isLoading()?z.log("Unable to seek to time "+a+" while loading..."):(this.isBuffering()||(this._isBuffering=!0,this.isBuffering()&&
this.fireEvent("startbuffering"),this._lastBufferingCheckTime=a,this._accredBufferingCheck=0),this.htmlTag.currentTime=a)};Ua.prototype.setVolume=function(a){0>a?a=0:1<a&&(a=1);this.getVolume()!==a&&(this.mVolume=a,this.isMuted()||(this.htmlTag.volume=a))};Ua.prototype.getVolume=function(){return this.mVolume};Ua.prototype.isMuted=function(){return this._isMuted};Ua.prototype.mute=function(a){void 0===a&&(a=!0);a!==this.isMuted()&&(this._isMuted=a,this.isMuted()?this.htmlTag.volume=0:this.htmlTag.volume=
this.mVolume)};sa.Wraith&&(z.log("r_video not yet ported for wraith support!"),Ua.prototype.disabled=!0);var gd={},Ee={standard:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",changeEvent:"fullscreenchange"},webkit:{enabled:"webkitFullscreenEnabled",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",changeEvent:"webkitfullscreenchange"},moz:{enabled:"mozFullScreenEnabled",element:"mozFullScreenElement",
request:"mozRequestFullScreen",exit:"mozCancelFullScreen",changeEvent:"mozfullscreenchange"},ms:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",changeEvent:"MSFullscreenChange"}},hd=null,Fe;for(Fe in Ee)if(Ee[Fe].enabled in document){hd=Ee[Fe];break}gd.listen=function(a){hd&&document.addEventListener(hd.changeEvent,function(d){a(!!document.fullscreenElement,d)})};gd.isFullScreen=function(){return hd?!!document[hd.element]:!1};gd.requestFullScreen=
function(a,d){a=a||La;var l=a[hd.request];l&&a?d=l.call(a,d):(z.logError("Error attempting to requestFullScreen"),d=null);return d};gd.exitFullScreen=function(){var a;(a=document[hd.exit])?a=a.call(document):(z.logError("Error attempting to exitFullscreen"),a=null);return a};gd.lockOrientation=function(a){screen.orientation&&screen.orientation.lock&&screen.orientation.lock(a)};gd.unlockOrientation=function(){screen.orientation&&screen.orientation.lock&&screen.orientation.lock()};var Tf={make:function(a){a=
a||La;if(!a)return null;var d=document.createElement("div");d.id="edit_div";d.style.cssText="position:fixed;display:block;";d.style.border="4px solid white";d.style["border-color"]="rgba(255,255,255, 0.1)";Tf.updateScale(d,a);a.parentNode.insertBefore(d,a.nextSibling);return d},updateScale:function(a,d){if(d=d||La){var l=yb.x*wc;d=d.getBoundingClientRect();var m=Ha,k=Ra,f=Hd(),e=0,b=0;Jb&&(e=Jb.x,b=Jb.y);f=f.ratio;l/=f;m|=0;k|=0;a.style.width=""+m+"px";a.style.height=""+k+"px";a.style.left=""+(e/
f+d.x|0)+"px";a.style.top=""+(b/f+d.y|0)+"px";a.setAttribute("width",""+m);a.setAttribute("height",""+k);a.style.transformOrigin="0 0 0";a.style.webkitTransformOrigin="0 0 0";l="scale("+l+","+l+")";a.style.transform=l;a.style.webkitTransform=l}}},Ld=function(a,d){d||(d=Math);for(var l=0;l<a.length;l++){var m=Math.floor(d.random()*a.length),k=a[l];a[l]=a[m];a[m]=k}return a},ee=function(a,d,l){return a[Uf(a,d,l)]},Uf=function(a,d,l){l||(l=Math);if(void 0===d||null===d)return Math.floor(l.random()*a.length);
!1===Array.isArray(d)&&(d=[d]);d.sort(function(m,k){return k-m});a=a.length-d.length;l=Math.floor(l.random()*a);for(a=0;a!==d.length;++a)d[a]<=l&&++l;return l},Vf=function(a,d,l){l||(l=Math);z.assert(void 0===d||null===d,"skip not supported yet in randomIndexInWeightedList");for(var m=d=0;m<a.length;m++)d+=a[m].weight;l=l.random()*d;for(m=d=0;m<a.length;m++)if(d+=a[m].weight,d>=l)return m;return a.length-1},ya=function(a){this.setDefaultConfig();a&&this.setConfig(a);this.validateConfig();this.pigs=
[];this.nextPos=[];this.doneRatio=0;this.myImageData=null;this.state="init";this.spawns=this.updates=this.perfTimeMS=this.drawTime=0};ya.standardSizes=[{lineWidth:3,name:"3",testAhead:1,moveIncrement:1.5,giveUpCounter:160},{lineWidth:6,name:"5",testAhead:2,moveIncrement:3,giveUpCounter:150},{lineWidth:9,name:"9",testAhead:3,moveIncrement:4.5,giveUpCounter:110},{lineWidth:15,name:"15",testAhead:5,moveIncrement:7.5,giveUpCounter:90}];ya.MOVE_STRAIGHT=1;ya.MOVE_RANDOM=2;ya.MOVE_CURVE=3;ya.MOVE_TRIANGLES=
4;ya.prototype.setDefaultConfig=function(){this.config||(this.config={});var a=this.config;a.USE_MY_PIXELS=!0;a.USE_REF_IMAGE=!0;a.USE_REF_IMAGE_LUM=!1;a.USE_BACK_START_COLOR=!1;a.RANDOM_LUMINANCE_START=!1;a.BACK_PLANE_DOTS=!0;a.BACK_PLANE_BLOTCHINESS=.8;a.MATCH_REF_ALPHA=!0;a.WAIT_FOR_NEXT_POS_TO_SPAWN=!1;a.MOVE_TYPE=ya.MOVE_CURVE;a.FOLLOW_WALLS=!0;a.DRAW_DONE_WITH_BACKPLANE=!0;a.drawFrequency=1;a.renderScale=1;a.LINE_SCALE=1;a.sizeIndex=1;a.LINE_ALPHA=.7;a.DEST_ALPHA_CLEAR_LEVEL=130;a.OPACITY_THRESHOLD=
.1;a.COLOR_SQ_THRESH=4900;a.COLOR_LUM_THRESH=.1;a.COLOR_CHANGE_LIMIT=20;a.COLOR_CHANGE_VARIANCE=6;a.COLOR_CHANGE_HALF_VARIANCE=.49*a.COLOR_CHANGE_VARIANCE;a.NUM_PIGS=6;a.MAX_PIGS=10;a.MIN_PIGS=1;a.SPAWN_GIVE_UP_COUNTER=100;a.NORMAL_TURN_INCREMENT=.02;a.RANDOM_TURN_RANGE=.5;a.STUCK_TURN_INCREMENT=.1;a.STUCK_GIVE_UP_COUNT=70;a.UPDATE_SPEED=3;a.UPDATE_RATIO=0;a.UPDATE_TOTAL_TIME=0;a.UPDATE_EASING_FUNC=null;a.SPEED_INCREASE=0;a.USE_START_SPOTS=!0;a.RANDOM_START_SPOTS=!0;this.startSeed=a.verbose=0;a.rng=
new Rb.Default(this.startSeed);this.validateConfig()};ya.prototype.setConfig=function(a){for(var d in a)this.config[d]=a[d];this.validateConfig(a);a.rng&&(this.startSeed=a.rng.getSeed())};ya.prototype.validateConfig=function(a){var d=this.config;a&&void 0!==a.COLOR_CHANGE_VARIANCE&&!a.COLOR_CHANGE_HALF_VARIANCE&&(d.COLOR_CHANGE_HALF_VARIANCE=.49*a.COLOR_CHANGE_VARIANCE);d.ORIG_UPDATE_SPEED=d.UPDATE_SPEED;d.ORIG_UPDATE_RATIO=d.UPDATE_RATIO};ya.prototype.log=function(a){this.config.verbose&&z.log(a)};
ya.prototype.setImage=function(a){this.width=this.config.width=a.width;this.height=this.config.height=a.height;this.createRefCanvas();this.setupRefCanvas(a);this.prepForDrawing()};ya.prototype.loadAndSetImage=function(a){var d=this,l=new Image;l.onload=function(){d.setImage(l)};l.src=a};ya.prototype.loadFromImageRef=function(a){var d=a.flags;a.setCentered(!1,!1);var l=a.getSize(),m=document.createElement("canvas");m.width=l.w;m.height=l.h;l=m.getContext("2d");a.draw(l,0,0);this.setReferenceCanvas(m);
a.flags=d};ya.prototype.setReferenceCanvas=function(a){this.width=this.config.width=a.width;this.height=this.config.height=a.height;this.refCanvas=a;this.refContext=this.refCanvas.getContext("2d");this.setupRefPixels();this.prepForDrawing()};ya.prototype.prepForDrawing=function(){this.createRenderCanvas();this.myImageData=new Lc(this.width,this.height);this.applySize();this.config.USE_START_SPOTS&&this.setupStartSpots();this.createBackplane();this.setupBackplane();this.state="draw";this.log("state draw");
this.setPigCount(this.config.NUM_PIGS)};ya.prototype.restart=function(){this.startSeed=this.config.rng.getSeed();this.nextPos=[];this.config.UPDATE_SPEED=this.config.ORIG_UPDATE_SPEED;this.config.UPDATE_RATIO=this.config.ORIG_UPDATE_RATIO;this.doneRatio=0;this.setPaused(!1);this.everGonePartOver=this.everGoneOver=!1;this.renderContext.clearRect(0,0,this.renderCanvas.width,this.renderCanvas.height);this.config.USE_START_SPOTS&&this.setupStartSpots();this.config.USE_MY_PIXELS&&this.myImageData.clear();
this.setupBackplane();this.pigs=[];this.setPigCount(this.config.NUM_PIGS);this.state="draw";this.spawns=this.updates=this.perfTimeMS=this.drawTime=0};ya.prototype.setupStartSpots=function(){this.log("setup start spots");this.curStartSpot=0;var a=this.config.LINE_WIDTH;this.startSpotRes=a;var d=(this.width+a-1)/a|0;this.startSpotWidth=d;this.startSpotHeight=a=(this.height+a-1)/a|0;this.totalStartSpots=d*a;if(this.config.RANDOM_START_SPOTS){this.startSpots=[];for(var l=0;l<a;l++)for(var m=0;m<d;m++){var k=
d*l+m;this.startSpots[k]=k}Ld(this.startSpots,this.config.rng);this.log("startspot length = "+this.startSpots.length)}else this.log("startspot non-array (non-random) length = "+this.totalStartSpots);this.doneSpawning=!1};ya.prototype.createRenderCanvas=function(){this.renderCanvas=document.createElement("canvas");this.renderCanvas.width=this.width*this.config.renderScale|0;this.renderCanvas.height=this.height*this.config.renderScale|0;this.renderContext=this.renderCanvas.getContext("2d");this.renderContext.clearRect(0,
0,this.renderCanvas.width,this.renderCanvas.height);this.updateContextModes()};ya.prototype.getRenderSize=function(){return{width:this.width*this.config.renderScale,height:this.height*this.config.renderScale}};ya.prototype.getRenderCanvas=function(){return this.renderCanvas};ya.prototype.updateContextModes=function(){if(this.renderContext){var a=this.renderContext;a.lineCap=this.config.MOVE_TYPE===ya.MOVE_STRAIGHT?"square":"round";this.renderLineWidth=this.config.LINE_WIDTH*this.config.LINE_SCALE*
this.config.renderScale;a.lineWidth=this.renderLineWidth}};ya.prototype.applySize=function(a){void 0===a&&(a=this.config.sizeIndex);a=ya.standardSizes[a];this.config.LINE_WIDTH=a.lineWidth;this.config.TEST_AHEAD=a.testAhead;this.config.MOVE_INCREMENT=a.moveIncrement;this.config.SPAWN_GIVE_UP_COUNTER=a.giveUpCounter;this.log("size: "+this.config.LINE_WIDTH);this.updateContextModes();this.myImageData&&this.myImageData.setLineWidth(this.config.LINE_WIDTH)};ya.prototype.createBackplane=function(){this.backplane=
document.createElement("canvas");this.backplane.width=this.width*this.config.renderScale|0;this.backplane.height=this.height*this.config.renderScale|0;this.backContext=this.backplane.getContext("2d")};ya.prototype.setupBackplane=function(){this.log("setupBackplane "+this.width+","+this.height);this.backContext.clearRect(0,0,this.backplane.width,this.backplane.height);if(this.config.BACK_PLANE_DOTS){var a=this.backContext,d=this.config.LINE_WIDTH*this.config.BACK_PLANE_BLOTCHINESS;2>d&&(d=2);for(var l=
[],m=d/2;m<this.height;m+=d)for(var k=d/2;k<this.width;k+=d)l[l.length]={x:k,y:m};Ld(l,this.config.rng);for(m=0;m<l.length;m++){k=l[m].x|0;var f=l[m].y|0,e=this.refColorAt(k,f);if(!(e.a<this.config.OPACITY_THRESHOLD)){if(this.config.RANDOM_LUMINANCE_START){var b=e;var h=this.config.rng,n=new O;n.setRandom(h);b=Wf(n,b,h);b.a=e.a;a.fillStyle=b.toString()}else a.fillStyle="rgba("+e.r+","+e.g+","+e.b+","+e.a+")";e=d+this.config.rng.random()*d/2;this.config.MOVE_TYPE==ya.MOVE_STRAIGHT?(e*=this.config.renderScale,
this.backContext.fillRect(k*this.config.renderScale-e/2,f*this.config.renderScale-e/2,e,e)):(a.beginPath(),a.arc(k*this.config.renderScale,f*this.config.renderScale,e*this.config.renderScale,0,2*Math.PI,!0),a.closePath(),a.fill())}}this.config.MATCH_REF_ALPHA&&(this.backContext.globalCompositeOperation="destination-in",this.backContext.drawImage(this.refCanvas,0,0,this.backplane.width,this.backplane.height),this.backContext.globalCompositeOperation="source-over")}else this.backContext.drawImage(this.refCanvas,
0,0,this.backplane.width,this.backplane.height);this.log("setupBackplane drawn");this.config.USE_BACK_START_COLOR&&(1!==this.config.renderScale&&this.logError("ERROR:  USE_BACK_START_COLOR and scale issue!"),this.backPixelData=this.backContext.getImageData(0,0,this.backplane.width,this.backplane.height).data)};ya.prototype.drawBackplane=function(a){this.backplane&&a.drawImage(this.backplane,0,0)};ya.prototype.createRefCanvas=function(){this.refCanvas=document.createElement("canvas");this.refCanvas.width=
this.width;this.refCanvas.height=this.height;this.refContext=this.refCanvas.getContext("2d")};ya.prototype.setupRefCanvas=function(a){this.refContext.drawImage(a,0,0);this.setupRefPixels()};ya.prototype.setupRefPixels=function(){this.refPixelData=this.refContext.getImageData(0,0,this.refCanvas.width,this.refCanvas.height).data};ya.prototype.drawRefCanvas=function(a){this.refCanvas&&(this.refCanvas.width,this.refCanvas.height,a.drawImage(this.refCanvas,0,0))};ya.prototype.drawStartSpots=function(a){if(this.totalStartSpots)if(this.startSpots){a.fillStyle=
"#80FF80";for(var d=this.curStartSpot;d<this.startSpots.length;d++){var l=this.startSpots[d],m=l%this.startSpotWidth;a.fillRect(m*this.startSpotRes-3,(l-m)/this.startSpotWidth*this.startSpotRes-3,6,6)}}else for(a.fillStyle="#80FF80",d=this.startSpotRes/2,l=this.curStartSpot;l<this.totalStartSpots;l++){m=l%this.startSpotWidth;m=this.startSpotWidth/2+((m+1)/2|0)*(m%2*2-1);var k=l/this.startSpotWidth|0;k=this.startSpotHeight/2+((k+1)/2|0)*(k%2*2-1);a.fillRect(m*this.startSpotRes-d/2,k*this.startSpotRes-
d/2,d,d)}};var Md={r:0,g:0,b:0,a:0};ya.prototype.refColorAt=function(a,d){a=4*(this.refCanvas.width*d+a);Md.r=this.refPixelData[a];Md.g=this.refPixelData[a+1];Md.b=this.refPixelData[a+2];Md.a=this.refPixelData[a+3]/255;return Md};ya.prototype.refAlphaAt=function(a,d){return this.refPixelData[4*(this.refCanvas.width*d+a)+3]/255};ya.prototype.refLumAt=function(a,d){a=4*(this.refCanvas.width*d+a);return.299*this.refPixelData[a]/255+.587*this.refPixelData[a+1]/255+.114*this.refPixelData[a+2]/255};ya.prototype.backColorAt=
function(a,d){a=4*(this.backplane.width*d+a);return new O(this.backPixelData[a],this.backPixelData[a+1],this.backPixelData[a+2])};var Wf=function(a,d,l){d=d.luminancePerceived();a=a.copy();var m=[{name:"r",ratio:.299},{name:"g",ratio:.587},{name:"b",ratio:.114}];Ld(m,l);for(l=0;20>l;l++)for(var k=0;3>k;k++){for(var f=m[k],e=a[f.name],b=d,h=0;3>h;h++)h!==k&&(b-=m[h].ratio*a[m[h].name]/255);a[f.name]=b/f.ratio*255/8+7*e/8;a.applyLimits()}return a};ya.prototype.draw=function(a){"done"===this.state&&
this.config.DRAW_DONE_WITH_BACKPLANE&&this.drawBackplane(a);this.renderCanvas&&a.drawImage(this.renderCanvas,0,0)};ya.prototype.getFinalRender=function(a,d){a||(a=this.width);d||(d=this.height);var l=document.createElement("canvas");l.width=a;l.height=d;var m=l.getContext("2d");m.save();m.scale(a/(this.width*this.config.renderScale),d/(this.height*this.config.renderScale));this.draw(m);m.restore();return l};ya.prototype.mergeFinalRender=function(){this.backContext.drawImage(this.renderCanvas,0,0);
this.config.DRAW_DONE_WITH_BACKPLANE=!1;this.renderCanvas=this.backplane;this.renderContext=this.backContext;this.backContext=this.backplane=null;return this.renderCanvas};ya.prototype.cleanUpFinal=function(){this.config.DRAW_DONE_WITH_BACKPLANE||(this.backContext=this.backplane=null);this.myImageData=this.refPixelData=this.refContext=this.refCanvas=null;this.pigs=[];this.startSpots=[]};ya.prototype.drawToRenderCanvas=function(){var a=this.renderContext,d=this.config.renderScale;this.renderLineWidth;
for(var l=this.pigs.length,m=0;m<l;m++){var k=this.pigs[m];if(!k.stuck&&0===k.timer%this.config.drawFrequency){var f=k.place.pos.x,e=k.place.pos.y;a.strokeStyle=k.colorString;a.beginPath();a.moveTo(k.oldPos.x*d,k.oldPos.y*d);a.lineTo(f*d,e*d);a.stroke();k.oldPos.x=f;k.oldPos.y=e}}};ya.prototype.getPigs=function(a){return this.pigs};ya.prototype.updatePigs=function(a){a=this.myImageData.getImageData();for(var d=0,l=0;l<this.pigs.length;l++){var m=this.pigs[l];m.spawning?(this.doneSpawning||m.updateSpawn(a),
m.spawning&&(d++,this.totalStartSpots||(m.spawnTimer>this.config.SPAWN_GIVE_UP_COUNTER&&(this.everGoneOver=!0),m.spawnTimer>this.config.SPAWN_GIVE_UP_COUNTER/2&&(this.everGonePartOver=!0)))):(m.updateMove(a),m.updateStuck(a))}this.doneRatio=this.totalStartSpots?this.curStartSpot/this.totalStartSpots:.5;1<=this.doneRatio?this.setDone():d==this.pigs.length&&(this.everGoneOver||this.doneSpawning)&&this.setDone()};ya.prototype.setDone=function(){this.state="done";this.doneRatio=1;this.log("draw time "+
this.drawTime+" over "+this.updates+" updates");this.log("perf time "+this.perfTimeMS/1E3+" at "+this.config.ORIG_UPDATE_SPEED+" + "+this.config.SPEED_INCREASE);this.log("spawns "+this.spawns)};ya.prototype.isDone=function(){return"done"===this.state};ya.prototype.cancelDrawing=function(){this.state="init";this.renderContext&&this.renderContext.clearRect(0,0,this.renderCanvas.width,this.renderCanvas.height);this.doneRatio=0};ya.prototype.update=function(a){var d=window.performance.now();if("draw"==
this.state&&!this.paused)if(this.drawTime+=a,this.config.UPDATE_RATIO||this.config.UPDATE_TOTAL_TIME){var l=this.config.UPDATE_RATIO?this.doneRatio+this.config.UPDATE_RATIO:this.drawTime/this.config.UPDATE_TOTAL_TIME;1<l&&(l=1);this.config.UPDATE_EASING_FUNC&&(l=this.config.UPDATE_EASING_FUNC(l));do this.updatePigs(a),this.drawToRenderCanvas();while(this.doneRatio<l&&"draw"==this.state);this.log("doneRatio "+this.doneRatio);this.config.SPEED_INCREASE&&this.config.UPDATE_RATIO&&(this.config.UPDATE_RATIO+=
this.config.SPEED_INCREASE)}else{for(l=0;l<this.config.UPDATE_SPEED&&"draw"==this.state;l++)this.updatePigs(a),this.drawToRenderCanvas();this.config.SPEED_INCREASE&&(this.config.UPDATE_SPEED+=1/60*this.config.SPEED_INCREASE)}a=window.performance.now();this.perfTimeMS+=a-d;this.updates++};ya.prototype.setPigCount=function(a){for(this.config.NUM_PIGS=a;a>this.pigs.length;){var d=new id(this);this.pigs.push(d)}a<this.pigs.length&&this.pigs.splice(a)};ya.prototype.setPigSize=function(a){var d=ya.standardSizes;
this.config.sizeIndex=a;0>this.config.sizeIndex&&(this.config.sizeIndex=0);this.config.sizeIndex>=d.length&&(this.config.sizeIndex=d.length-1);this.applySize(this.config.sizeIndex)};ya.prototype.setPigStyle=function(a){this.config.MOVE_TYPE=a;if(a===ya.MOVE_STRAIGHT)for(var d=0;d<this.pigs.length;d++)this.pigs[d].pickRandomSquareAngle();this.updateContextModes();a===ya.MOVE_STRAIGHT?(this.config.STUCK_GIVE_UP_COUNT=4,this.config.FOLLOW_WALLS=!1):a===ya.MOVE_RANDOM?(this.config.STUCK_GIVE_UP_COUNT=
11,this.config.FOLLOW_WALLS=!1):(this.config.STUCK_GIVE_UP_COUNT=70,this.config.FOLLOW_WALLS=!0)};ya.prototype.setSpeed=function(a){this.config.ORIG_UPDATE_SPEED=a;this.config.UPDATE_SPEED=a};ya.prototype.getSpeed=function(){return this.config.UPDATE_SPEED};ya.prototype.setSpeedIncrease=function(a){this.config.SPEED_INCREASE=a};ya.prototype.setPaused=function(a){this.paused=a};var id=function(a){this.render=a;this.config=a.config;a.config;this.place=new Y.Position(0,0,0);this.oldPos=new Y.Vector(this.place.pos.x,
this.place.pos.y);this.drawLength=0;this.spawning=!0;this.spawnTimer=this.timer=0;this.stuck=!0;this.stuckTimer=0;this.color=new O;this.colorString="#000000";this.startColor=this.color.copy();this.startLum=this.color.luminancePerceived();this.color.setRandom(this.config.rng);a.config.MOVE_TYPE==ya.MOVE_STRAIGHT&&this.pickRandomSquareAngle();a.spawns++};id.prototype.pickRandomSquareAngle=function(){var a=this.config.rng.random();this.place.rot.angle=Math.floor(4*a)*Math.PI/2};id.prototype.pixelIsBlocking=
function(a,d,l){var m=this.config;if((m.USE_MY_PIXELS?this.render.myImageData.getValue(d,l):a[4*(this.render.renderCanvas.width*l+d)+3])>m.DEST_ALPHA_CLEAR_LEVEL)return!0;if(m.USE_REF_IMAGE_LUM){if(a=this.refLumAt(d,l),a-this.startLum<-m.COLOR_LUM_THRESH||a-this.startLum>m.COLOR_LUM_THRESH||this.refAlphaAt(d,l)<this.config.OPACITY_THRESHOLD)return!0}else if(m.USE_REF_IMAGE&&(d=this.render.refColorAt(d,l),d.a<this.config.OPACITY_THRESHOLD||this.startColor.distanceSq(d)>m.COLOR_SQ_THRESH))return!0;
return!1};id.prototype.updateMove=function(a){var d=this.render,l=this.config,m=this.place.pos;this.timer++;l.MOVE_TYPE==ya.MOVE_RANDOM?this.place.rot.angle+=l.rng.random()*l.RANDOM_TURN_RANGE-l.RANDOM_TURN_RANGE/2:l.MOVE_TYPE==ya.MOVE_CURVE&&(this.place.rot.angle+=l.NORMAL_TURN_INCREMENT);if(l.FOLLOW_WALLS){var k=2*l.TEST_AHEAD,f=this.place.rot.angle+.4*Math.PI;this.pixelIsBlocking(a,m.x+Math.sin(f)*k|0,m.y+Math.cos(f)*k|0)&&(this.place.rot.angle+=1*l.NORMAL_TURN_INCREMENT)}if(!this.stuck&&l.COLOR_CHANGE_LIMIT&&
l.COLOR_CHANGE_VARIANCE){var e=l.COLOR_CHANGE_VARIANCE,b=l.COLOR_CHANGE_HALF_VARIANCE;k=this.color;f=k.r;var h=k.g,n=k.b;f+=l.rng.random()*e-b;h+=l.rng.random()*e-b;n+=l.rng.random()*e-b;0>f&&(f=0);0>h&&(h=0);0>n&&(n=0);255<f&&(f=255);255<h&&(h=255);255<n&&(n=255);f|=0;h|=0;n|=0;e=f-this.startColor.r;b=h-this.startColor.g;var t=n-this.startColor.b;e*e+b*b+t*t<l.COLOR_CHANGE_LIMIT*l.COLOR_CHANGE_LIMIT&&(k.r=f,k.g=h,k.b=n,this.colorString=k.toString())}f=this.place.rot.angle;k=Math.sin(f);f=Math.cos(f);
h=l.MOVE_INCREMENT;this.stuck&&this.stuckTimer>l.STUCK_GIVE_UP_COUNT/2&&(h=l.rng.random()*l.MOVE_INCREMENT*2);n=m.x+k*h;e=m.y+f*h;this.stuck=!1;0>n||0>e||n>d.width||e>d.height?this.stuck=!0:(l=l.TEST_AHEAD,this.pixelIsBlocking(a,Math.floor(n+k*l),Math.floor(e+f*l))&&(this.stuck=!0));this.stuck||(m.x=n,m.y=e,this.drawLength+=h,d.myImageData.setPixels(n,e))};id.prototype.updateStuck=function(a){a=this.config;this.stuck?(this.place.rot.angle=a.MOVE_TYPE==ya.MOVE_RANDOM?this.config.rng.random()*Math.PI*
2:a.MOVE_TYPE==ya.MOVE_STRAIGHT?this.place.rot.angle+Math.PI/2:this.place.rot.angle-a.STUCK_TURN_INCREMENT,this.stuckTimer+=1,this.stuckTimer>a.STUCK_GIVE_UP_COUNT&&this.respawn()):a.MAX_DRAW_LENGTH&&a.MAX_DRAW_LENGTH<this.drawLength?this.respawn():this.stuckTimer=0};id.prototype.respawn=function(){this.stuck=this.spawning=!0;this.stuckTimer=0;this.color.setRandom(this.config.rng);this.drawLength=0;this.render.spawns++};id.prototype.updateSpawn=function(a){var d=this.config,l=this.render;if(l.nextPos.length)this.place.pos.copyFrom(l.nextPos[0].pos),
l.nextPos.shift();else if(l.totalStartSpots){if(l.startSpots){var m=l.startSpots[l.curStartSpot++];var k=m%l.startSpotWidth;m=(m-k)/l.startSpotWidth}else m=l.curStartSpot++,k=m%l.startSpotWidth,k=l.startSpotWidth/2+((k+1)/2|0)*(k%2*2-1),m=m/l.startSpotWidth|0,m=l.startSpotHeight/2+((m+1)/2|0)*(m%2*2-1);this.place.pos.x=k*l.startSpotRes;this.place.pos.y=m*l.startSpotRes;l.curStartSpot>=l.totalStartSpots&&(l.doneSpawning=!0)}else{if(d.WAIT_FOR_NEXT_POS_TO_SPAWN){this.spawnTimer=0;return}this.place.pos.x=
Math.floor(this.config.rng.random()*this.render.width);this.place.pos.y=Math.floor(this.config.rng.random()*this.render.height)}k=this.place.pos.x|0;m=this.place.pos.y|0;a=d.USE_MY_PIXELS?l.myImageData.getValue(k,m):a[4*(this.renderCanvas.width*m+k)+3];var f;d.USE_REF_IMAGE&&(f=l.refColorAt(k,m));a<=d.DEST_ALPHA_CLEAR_LEVEL&&(!d.USE_REF_IMAGE||f.a>d.OPACITY_THRESHOLD)?(this.spawning=!1,this.spawnTimer=0,d.USE_REF_IMAGE?this.color=new O(f.r,f.g,f.b,f.a):this.color.setRandom(this.config.rng),d.USE_BACK_START_COLOR&&
(l=l.backColorAt(k,m),this.color=Wf(l,{r:f.r,g:f.g,b:f.b,a:f.a},this.config.rng)),this.color.a*=d.LINE_ALPHA,this.colorString=this.color.toString(),this.startColor=this.color.copy(),this.startColorValue=this.startColor.r+this.startColor.g+this.startColor.b,this.startLum=this.startColor.luminancePerceived(),this.stuckTimer=0,this.stuck=!0,this.oldPos.x=this.place.pos.x,this.oldPos.y=this.place.pos.y):this.spawnTimer+=1};var Yf=function(a,d){d=d||{};lc=!!d.ignoreRatTransform;a=a||"canvas";Zb=new Qb;
La=document.getElementById(a);ca=La.getContext("2d");Gd(La.width,La.height);Zd();Cb(window,"resize",Xf);Bd()},ab={autoTargetSize:{x:0,y:0},autoResizeCanvas:!0,autoResizeToElement:null,autoFillOnResize:!1,autoCenterCanvas:!1,autoScaleWithDevicePixelRatio:!1,callAutoScale:!1},Xf=function(a){Zd();Ga.fire("before_resize",a);ab.callAutoScale&&Ge();Ga.fire("resize",a)},Zf=function(){var a=gb();""===sd?(a.clearRect(0,0,a.canvas.width,a.canvas.height),mb&&mb.setTarget&&mb.setTarget.show.canvasframe&&(a.lineWidth=
4,a.strokeStyle="#00FFFF",a.strokeRect(0,0,a.canvas.width,a.canvas.height))):(a.fillStyle=sd,a.fillRect(0,0,a.canvas.width,a.canvas.height))},$f=function(){cd++;dd.totalElementsDrawn=0;xa&&xa.beginFrame&&xa.beginFrame()},Ge=function(){if(La){if(ab.autoResizeToElement){var a=document.getElementById(ab.autoResizeToElement);if(!a)return;var d=a.getBoundingClientRect();a={w:d.width,h:d.height};var l=La;l.style.left=""+d.left+"px";l.style.top=""+d.top+"px"}else a=Be();d=1;if(ab.autoResizeCanvas){d=a.w/
ab.autoTargetSize.w;var m=a.h/ab.autoTargetSize.h;m<d&&(d=m);d<ab.minAutoScale&&(d=ab.minAutoScale);!ab.allowAutoUpscale&&1<d&&(d=1);m=Y.floor(ab.autoTargetSize.w*d);var k=Y.floor(ab.autoTargetSize.h*d);ab.autoFillOnResize&&(m=a.w,k=a.h);ab.autoScaleWithDevicePixelRatio&&!ab.allowAutoUpscale&&z.logWarning("WARNING: autoScaleWithDevicePixelRatio = true yet allowAutoUpscale = false.");if(ab.autoScaleWithDevicePixelRatio){l=La.getContext("2d");l=Hd(l);var f=l.ratio;La.style.width=""+m+"px";La.style.height=
""+k+"px";var e=ab.resizeCanvasPixelLimit;if(e&&(m*f|0)*(k*f|0)>e){var b=m/k;f=Math.sqrt(e*b);b=f/b;f=(f|0)/m;b=(b|0)/k;b<f&&(f=b);z.log("limiting res to pixel limit "+e+" with ratio: "+f)}m=m*f|0;k=k*f|0;d*=f;xc=f;1!==l.ratio&&(z.log("device pixel ratio "+l.ratio+" : "+devicePixelRatio+" / "+l.backingStoreRatio),f!==l.ratio&&z.log("   using ratio : "+f))}La.width=m;La.height=k}ab.autoCenterCanvas&&(k=a.h-k,m=Y.floor((a.w-m)/2),k=Y.floor(k/2),La.style["margin-left"]=""+m+"px",La.style["margin-top"]=
""+k+"px");ab.autoScaleCanvasStyleToWindow?(m=a.w/La.width,a=a.h/La.height,a<m&&(m=a),wc=m,a=La.height*m|0,La.style.width=""+(La.width*m|0)+"px",La.style.height=""+a+"px"):wc=1;ue(d,d);ab.autoResizeCanvas&&!ab.autoFillOnResize&&ab.autoTargetSize&&Gd(ab.autoTargetSize.w,ab.autoTargetSize.h)}},Zb=void 0,fe=[],lc=!1,He=function(a,d){d=d||ca;lc||Zb.rotateSelf(a);d.rotate(a)},jd=function(a,d,l){void 0===d&&(d=a);l=l||ca;lc||Zb.scaleSelf(a,d);l.scale(a,d)},sc=function(a,d,l){l=l||ca;lc||Zb.translateSelf(a,
d);l.translate(a,d)},ag=function(a,d,l,m,k,f,e){Array.isArray(a.m)&&(a=a.m);Array.isArray(a)&&(e=m,d=a[1][0],l=a[0][1],m=a[1][1],k=a[0][2],f=a[1][2],a=a[0][0]);e=e||ca;lc||Zb.multSelf([[a,d,k],[l,m,f],[0,0,1]]);e.transform(a,d,l,m,k,f)},bg=function(a){a=a||ca;lc||Zb.loadIdent();a.setTransform(1,0,0,1,0,0)},tc=function(a){var d=ca;a=a||{};a.ignoreRatMat=void 0===a.ignoreRatMat?lc:lc||a.ignoreRatMat||!1;d.save();d={ignoreRatMat:lc,transform:void 0};(lc=a.ignoreRatMat)?fe.push(d):(d.transform=Zb.m,fe.push(d),
a=Zb.m,a=[[a[0][0],a[0][1],a[0][2]],[a[1][0],a[1][1],a[1][2]],[a[2][0],a[2][1],a[2][2]]],Zb.m=a)},zc=function(){ca.restore();var a=fe.pop();lc=a.ignoreRatMat;a.transform&&(Zb.m=a.transform)},Ie=function(a,d){return Zb.transformPoint(a,d)},Je=function(){Jb&&sc(Jb.x,Jb.y);td()&&jd(yb.x,yb.y)},cg=Object.freeze({__proto__:null,ImageData:xa,init:Yf,resizing:ab,resizeCallback:Xf,clearCanvas:Zf,beginFrame:$f,endFrame:function(){},counterGlobalScale:function(a){td()&&jd(1/yb.x,1/yb.y,a)},counterGlobalTranslate:function(a){Jb&&
sc(-Jb.x,-Jb.y,a)},getDOMWindowCoordinates:function(a){a={x:a.x,y:a.y};td()&&(a.x*=yb.x/xc,a.y*=yb.y/xc);Jb&&(a.x+=Jb.x,a.y+=Jb.y);a.x*=wc;a.y*=wc;a.x+=La.offsetLeft;a.y+=La.offsetTop;return a},autoScaleCallback:Ge,setAutoScaleFromIdeal:function(a,d,l,m){"undefined"===typeof l?l={autoResizeCanvas:!0,allowAutoUpscale:!0,autoFillOnResize:!1}:"object"!==typeof l&&(l={autoResizeCanvas:!!l,allowAutoUpscale:!!m});ab.autoTargetSize.w=a;ab.autoTargetSize.h=d;void 0!==l.autoResizeCanvas&&(ab.autoResizeCanvas=
l.autoResizeCanvas);void 0!==l.autoResizeToElement&&(ab.autoResizeToElement=l.autoResizeToElement);void 0!==l.allowAutoUpscale&&(ab.allowAutoUpscale=l.allowAutoUpscale);void 0!==l.autoFillOnResize&&(ab.autoFillOnResize=l.autoFillOnResize);void 0!==l.autoScaleCanvasStyleToWindow&&(ab.autoScaleCanvasStyleToWindow=l.autoScaleCanvasStyleToWindow);void 0!==l.autoScaleWithDevicePixelRatio&&(ab.autoScaleWithDevicePixelRatio=l.autoScaleWithDevicePixelRatio);void 0!==l.resizeCanvasPixelLimit&&(ab.resizeCanvasPixelLimit=
l.resizeCanvasPixelLimit);ab.callAutoScale=!0;Ge()},autoCenterCanvasStyle:function(a){var d=Be(),l=xc;a&&(l=Hd().ratio);a=d.h*l-La.height;d=Y.floor((d.w*l-La.width)/2/l);l=Y.floor(a/2/l);La.style["margin-left"]=""+d+"px";La.style["margin-top"]=""+l+"px"},get mTransform(){return Zb},mStateStack:fe,get mIgnoreRatTransform(){return lc},rotate:He,scale:jd,translate:sc,transform:ag,setTransform:function(a,d,l,m,k,f,e){bg();ag(a,d,l,m,k,f,e)},resetTransform:bg,save:tc,restore:zc,getTransform:function(){return Zb},
transformPoint:Ie,pushPerfMark:function(a,d){d||(d=ca);d.pushPerfMark&&d.pushPerfMark(a)},popPerfMark:function(a){a||(a=ca);a.popPerfMark&&a.popPerfMark()},setupMatrixForRendering:Je,Color:O,ImageRef:Fa,imageGenerators:{fromText:function(a){var d=a.text,l=a.fontInfo,m=a.bgColor,k=a.padding,f=a.width,e=a.height;void 0===k&&(k=.05*f|0);var b=a.offset||{x:0,y:0},h=document.createElement("canvas");h.width=f;h.height=e;f=h.getContext("2d");m&&(f.fillStyle=m,f.fillRect(0,0,h.width,h.height));m="";l.style&&
(m=l.style+" ");f.font=""+m+l.size+"px "+l.font;f.fillStyle=l.color;f.textAlign="center";f.textBaseline="middle";m=h.width/2+b.x;b=h.height/2+b.y;l.stroke&&(f.lineWidth=l.stroke.width,f.strokeStyle=l.stroke.color.toString(),f.strokeText(d,m,b,h.width-k));f.fillText(d,m,b,h.width-k);a.registerName&&Oa.addToCache(h,a.registerName);return h}},spritesheet:Ba,imageCache:Oa,draw:jb,SimpleImageData:Lc,imageFilter:Ob,AnimSet:Db,KeyAnim:nb,KeyAnimSet:Kb,RectList:yc,Offscreen:$a,Video:Ua,fullScreen:gd,layerDiv:Tf,
PigRender:ya,get SCREEN_WIDTH(){return Ha},get SCREEN_HEIGHT(){return Ra},globalScale:yb,get outerScale(){return wc},get globalTranslate(){return Jb},get canvasPixelRatio(){return xc},get autoClearCanvas(){return Wd},get autoClearColor(){return sd},get canvas(){return La},get ctx(){return ca},minAutoScale:1E-7,get viewState(){return Ic},get frameIndex(){return cd},frameStats:dd,incFrameIndex:pf,setScreenSize:Gd,setOuterScale:rf,setCanvas:sf,setContext:tf,setCanvasPixelRatio:uf,getContext:gb,getContextProperties:vf,
doneWithContext:Yd,registerContext:wf,setAutoClear:xf,setGlobalTranslate:yf,clearGlobalTranslate:zf,hasGlobalScale:td,setGlobalScale:ue,clearGlobalScale:Af,screenSizeChanged:Bd,updateViewState:Zd,getDevicePixelRatio:Hd,createCanvasInDiv:function(a,d){a=document.getElementById(a);if(!a)return null;d=d||"canvas";var l=a.getBoundingClientRect(),m=document.createElement("canvas");m.setAttribute("id",d);m.width=l.width;m.height=l.height;m.style.position="absolute";m.style.left=""+l.left+"px";m.style.top=
""+l.top+"px";m.style.width=""+l.width+"px";m.style.height=""+l.height+"px";a.appendChild(m);return m},setImageSmoothing:de,getWindowSize:Be,makeImage:De,setExternalSpriteMaker:function(a){Ce=a}}),Lb=function(a,d,l,m){this.func=a;this.param2=l;this.currentTime=0;this.delay=d;this.flags=0;void 0===m&&(m=!0);m&&this.autoUpdate(!0)};Lb.prototype.updateSpeed=1;Lb.prototype.setRepeat=function(a){this.flags=a?this.flags|1:this.flags&-2};Lb.prototype.setPause=function(a){this.flags=a?this.flags|2:this.flags&
-3};Lb.prototype.setUpdateSpeed=function(a){this.updateSpeed=a};Lb.prototype.update=function(a){this.flags&16386||(this.currentTime+=a*this.updateSpeed,this.currentTime>=this.delay&&this.callNow())};Lb.prototype.autoUpdate=function(a){void 0===a&&(a=!0);a?(this.flags&32768&&z.logWarning("rat Timer : Timer already flagged autoUpdate.  Might be in list twice now!"),this.flags&=-16385,this.flags|=32768,ge.timers.push(this)):this.flags&=-32769};Lb.prototype.endAutoUpdate=function(){this.flags&=-32769};
Lb.prototype.callNow=function(){this.func(this,this.param2);this.flags&1?this.currentTime=0:(this.flags&=32768,this.flags|=16384)};Lb.setTimeout=function(a,d,l){a=new Lb(a,d,l);a.autoUpdate();return a};Lb.setInterval=function(a,d,l){a=new Lb(a,d,l);a.setRepeat(!0);a.autoUpdate();return a};var ge={timers:[],updateAll:function(a){if(!this.isPaused)for(var d=this.timers.length-1;0<=d;--d){var l=this.timers[d];l.flags&32768&&l.update(a);l.flags&32768||(this.timers[d]=this.timers[this.timers.length-1],
this.timers.pop())}},pause:function(a){void 0===a&&(a=!0);this.isPaused=a},test:function(){Lb.setTimeout(function(){z.log("2 seconds once")},2);Lb.setInterval(function(a,d){z.log(d)},3,"Every 3 seconds.")}},vd={baseURL:"",URLVars:{}};if(window.location){var he=window.location.href,dg=he.indexOf("?");vd.baseURL=0<dg?he.slice(0,dg):he;vd.URLVars={};he.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(a,d,l){vd.URLVars[d]=l})}vd.reloadLocation=function(a){void 0===a&&(a=!0);window.location&&window.location.reload&&
window.location.reload(a)};vd.assignLocation=function(a){window.location.assign(a)};var mc={updaters:[]},Xc=mc.updaters,Ke=!1;mc.addUpdater=function(a){a&&Xc.push(a)};mc.removeUpdater=function(a){a&&(a=Xc.indexOf(a),-1!==a&&(Ke?Xc[a]=void 0:Xc.splice(a,1)))};mc.updateAll=function(a){Ke=!0;for(var d=Xc.length-1;0<=d;--d)if(Xc[d])Xc[d](a);else Xc.splice(d,1);Ke=!1};var ra={appDraw:null,appPostUIDraw:null,appAfterDraw:null,appUpdate:null,has:sa,deltaTime:fb,startupTimeStamp:0,runningTimeMS:0,runningTime:0,
fixPath:ac,url:vd,suspendAnimationOnBlur:!1,animationCycleInitialized:!1};ra.fixPath=ac;ra.pathConfig=Jc;ra.load=null;ra.init=function(a){ra.startupTimeStamp=Date.now();if(a.useProtectedCycle){var d=ra.cycle,l=!1;ra.cycle=function(m){try{d(m)}catch(k){if(!l||a.protectedCycleAllowMultipleErrors)l=!0,z.saveOutputToLocalStorage=!0,ra.reportSeriousError(k),z.logNewlines(k.stack),a.protectedCycleErrorHandler&&a.protectedCycleErrorHandler(k)}}}ra.registerDebuggerCommands()};ra.registerDebuggerCommands=
function(){z.registerCommand("showMemory",function(a,d){ra.debugDrawMemoryGraph=!ra.debugDrawMemoryGraph},["showMemory","memory"])};ra.startAnimationCycle=function(){ra.requestAnimationFrameID=window.requestAnimationFrame(ra.cycle)};ra.initAnimationCycle=function(){ra.startAnimationCycle();ra.animationCycleInitialized=!0};ra.updateAnimationActive=function(a,d){if(ra.animationCycleInitialized){var l=!1,m=!0,k=ra.suspendAnimationNextFrame;ra.suspendAnimationNextFrame=!1;ra.suspendAnimationOnBlur&&"focus"!==
a&&(m=!1);ra.suspendAnimationOnBlur&&z.log("updateAnimationActive: eType "+a+", alreadysussing "+k+", shouldbeactive "+m);m&&void 0===ra.requestAnimationFrameID?(z.log("restart animation cycle"),ra.startAnimationCycle(),l=!0):m||void 0===ra.requestAnimationFrameID||(z.log("suspend animation cycle, wasalready= "+k),ra.suspendAnimationNextFrame=!0,k||Ga.fire("animationCycleSuspended",{sysEvent:d}));(k&&!ra.suspendAnimationNextFrame||l)&&Ga.fire("animationCycleResumed",{sysEvent:d})}};ra.isAnimationActive=
function(){return(!ra.animationCycleInitialized||void 0!=ra.requestAnimationFrameID)&&!ra.suspendAnimationNextFrame};ra.setDraw=function(a){ra.appDraw=a};ra.setPostUIDraw=function(a){ra.appPostUIDraw=a};ra.setAfterDraw=function(a){ra.appAfterDraw=a};ra.setUpdate=function(a){ra.appUpdate=a};ra.frameIntervalLimit=0;ra.setFrameIntervalLimit=function(a){ra.frameIntervalLimit=a};ra.setFrameRateLimit=function(a){ra.setFrameIntervalLimit(1/a)};ra.clearFrameRateLimit=ra.clearFrameIntervalLimit=function(){ra.frameIntervalLimit=
0};ra.lastCycleTime=0;ra.cycle=function(a){ra.dateNow=Date.now();ra.runningTimeMS=ra.dateNow-ra.startupTimeStamp;ra.runningTime=ra.runningTimeMS/1E3;var d=!1;ra.frameIntervalLimit&&(a-ra.lastCycleTime<1E3*ra.frameIntervalLimit?d=!0:ra.lastCycleTime=a);ra.suspendAnimationNextFrame&&!d?(ra.requestAnimationFrameID=void 0,ra.suspendAnimationNextFrame=!1,z.log("  suspending animation after this frame")):ra.requestAnimationFrameID=window.requestAnimationFrame(ra.cycle);d||($f(),da.pushPerfMark("system.Cycle"),
fb.deltaTimeLock||(da.pushPerfMark("updateDeltaTime"),fb.updateDeltaTime(),da.popPerfMark("updateDeltaTime")),a=fb.deltaTime,ra.appUpdate&&(da.pushPerfMark("GameUpdate"),ra.appUpdate(a),da.popPerfMark("GameUpdate")),Fb.processAll("update",a),mc&&(da.pushPerfMark("cycleupdate"),mc.updateAll(a),da.popPerfMark("cycleupdate")),ge&&(da.pushPerfMark("timerUpdate"),ge.updateAll(a),da.popPerfMark("timerUpdate")),a=gb(),da.pushPerfMark("Rendering"),tc(),Wd&&(da.pushPerfMark("Clearing Canvas"),Zf(),da.popPerfMark("Clearing Canvas")),
Je(),ra.appBeforeDraw&&(da.pushPerfMark("BEFORE draw"),ra.appBeforeDraw(a),da.popPerfMark("BEFORE draw")),ra.appDraw&&(da.pushPerfMark("draw"),ra.appDraw(a),da.popPerfMark("draw")),Fb.processAll("draw",a),ra.appPostUIDraw&&(da.pushPerfMark("post UI draw"),ra.appPostUIDraw(a),da.popPerfMark("post UI draw")),da.pushPerfMark("Debug Rendering"),z.drawConsole(),Fb.processAll("drawDebug",a),Ka.draw(),zb.draw(),da&&da.displayStats&&(da.pushPerfMark("Profiler draw"),da.displayStats(),da.popPerfMark("Profiler draw")),
da.popPerfMark("Debug Rendering"),zc(),da.popPerfMark("Rendering"),ra.appAfterDraw&&(da.pushPerfMark("After Draw"),ra.appAfterDraw(a),da.popPerfMark("After Draw")),da.popPerfMark("system.Cycle"))};ra.reportSeriousError=function(a){var d="EXCEPTION: "+a.toString();z.logOnce(d);z.state.consoleActive||z.activate(!0);ra.errorOutputElement&&(ra.errorOutputElement.innerHTML+=d+"<br>"+(a.stack||"[no stack]"),ra.errorOutputElement.style.visibility="visible",window.cancelAnimationFrame(ra.requestAnimationFrameID))};
ra.exit=function(){sa.Wraith?window.close&&window.close():z.log(">>>>APP REQUESTED CLOSE, but we are just a poor browser and don't know how.<<<<")};window.WinJS&&window.WinJS&&(window.WinJS.Application.onerror=Fg,window.WinJS.Application.oncheckpoint=Hg,window.Windows&&window.Windows.UI.WebUI.WebUIApplication.addEventListener("resuming",Gg,!1));(function(){function a(l){var m={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};l=l||window.event;
l=l.type in m?m[l.type]:this[d]?"hidden":"visible";(ra.visibility=l)&&Ga&&Ga.fire&&Ga.fire("visibility",l)}var d="hidden";d in document?document.addEventListener("visibilitychange",a):(d="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(d="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",a):(d="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?document.onfocusin=document.onfocusout=a:window.onpageshow=
window.onpagehide=window.onfocus=window.onblur=a})();(function(){window.addEventListener("focus",function(a){ra.updateAnimationActive("focus",a)},!1);window.addEventListener("blur",function(a){ra.updateAnimationActive("blur",a)},!1)})();var Qa={storageObjects:{byUser:{},byType:{}},permanentLocal:1,permanentRoaming:2,permanentServer:3,suspendLocal:4,clear:function(){var a=Xb.getLocalStorage();a&&(a.clear?a.clear():sa.Wraith&&z.log('To clear user settings under wraith, use the wraith cheat "resetPrefs"'));
sa.cookies&&document.cookie&&(document.cookie="FakeStorage=; expires=Thu, 01 Jan 1970 00:00:00 UTC")}};z.registerCommand("clearStorage",function(a,d){Qa.clear()},["clearstore"]);Qa.getStorage=function(a,d){d=void 0!==d&&void 0!==d.id?d.id:d||"";var l=Qa.storageObjects.byType;d&&(Qa.storageObjects.byUser[d]=Qa.storageObjects.byUser[d]||{},l=Qa.storageObjects.byUser[d]);if(l&&l[a])return l[a];l[a]=new (sa.localStorage?Qa.LocalStorage:Qa.FakeStorage)("");return l[a]};Qa.BasicStorage=function(a){this.prefix=
a||"";this.sizes={};this.pack=JSON.stringify;this.unpack=JSON.parse};Qa.BasicStorage.prototype.setPrefix=function(a){this.prefix=a||""};Qa.BasicStorage.prototype.getPrefix=function(a){return this.prefix};Qa.BasicStorage.prototype.setObjectAsync=function(a,d){this.pack&&(d=this.pack(d));return this.setItemAsync(a,d)};Qa.BasicStorage.prototype.getObjectAsync=function(a){var d=this,l=this.prefix+a;return this._internalGetItemAsync(l).then(function(m){if(d.unpack)void 0===m||null===m||"string"!==typeof m?
d.sizes[l]=0:(d.sizes[l]=m.length,m=d.unpack(m));else if(m){var k=JSON.stringify(m);d.sizes[l]=k.length}return m})};Qa.BasicStorage.prototype.setItemAsync=function(a,d){a=this.prefix+a;d&&d.length&&(this.sizes[a]=d.length);if("save"===a)z.logError("ERROR! You cannot save items to local storage with the key 'save'.  That keyword is reserved!");else return this._internalSetItemAsync(a,d)};Qa.BasicStorage.prototype.getItemAsync=function(a){var d=this,l=this.prefix+a;return this._internalGetItemAsync(l).then(function(m){d.sizes[l]=
m&&m.length?m.length:0;return m})};Qa.BasicStorage.prototype.removeAsync=function(a){};Qa.BasicStorage.prototype.getSize=function(){var a=0,d;for(d in this.sizes)a+=this.sizes[d];return 2*a};Qa.BasicStorage.prototype._internalSetItemAsync=void 0;Qa.BasicStorage.prototype._internalGetItemAsync=void 0;Qa.FakeStorage=function(a){Qa.FakeStorage.prototype.parentConstructor.call(this,a);this.data={}};cb(Qa.FakeStorage,Qa.BasicStorage);Qa.FakeStorage.prototype._internalSetItemAsync=function(a,d){this.data[a]=
d;return Promise.resolve(d)};Qa.FakeStorage.prototype._internalGetItemAsync=function(a){return Promise.resolve(this.data[a])};Qa.FakeStorage.prototype.removeAsync=function(a){delete this.data[this.prefix+a];return Promise.resolve(null)};Qa.LocalStorage=function(a){Qa.LocalStorage.prototype.parentConstructor.call(this,a)};cb(Qa.LocalStorage,Qa.BasicStorage);Qa.LocalStorage.prototype._internalSetItemAsync=function(a,d){return sa.localStorage?("string"!==typeof d&&z.logWarning("setting non-string atomic values in local storage is probably not what you want!"),
Xb.getLocalStorage().setItem(a,d),Promise.resolve(d)):Promise.reject(Error("no localStorage support"))};Qa.LocalStorage.prototype._internalGetItemAsync=function(a){return sa.localStorage?(a=Xb.getLocalStorage().getItem(a),Promise.resolve(a)):Promise.reject(Error("no localStorage support"))};Qa.LocalStorage.prototype.removeAsync=function(a){a=this.prefix+a;sa.localStorage&&Xb.getLocalStorage().removeItem(a);return Promise.resolve(null)};var eg=function(a){return"true"==a||"TRUE"===a||"1"===a||"yes"===
a?!0:!1},fg=function(a,d){var l="",m=a/3600|0;a-=3600*m;var k=a/60|0;a=a-60*k|0;0<m&&(l+=m+":");if(0<k||0<m||d)l+=(10>k?"0"+k:""+k)+":";return l+(10>a?"0"+a:""+a)},gg=function(a,d,l){var m=l?Math.pow(10,l):1;a=(a*m|0)/m;m=""+(a|0);a=""+a;var k=a.indexOf(".");for(a=k?a.substring(k+1):"";m.length<d;)m="0"+m;for(;a.length<l;)a+="0";return 0>=l?m:m+"."+a},Mc=[],hg=0,Ac={length:0},jg=function(a,d,l){function m(v,q){if(v){if(v.loaded)return;v.loaded=!0;v.callback&&v.callback(q)}--e;k&&k({left:e,loaded:f-
e,of:f});0>=e&&d&&d()}Array.isArray(a)||(a=[a]);l=l||{};void 0===l.async&&(l.async=!0);var k=l.update,f=a.length,e=a.length,b;var h=0;for(b=a.length;h!==b;++h)"string"===typeof a[h]&&(a[h]={source:a[h]}),a[h].loaded=!1;k&&k({left:f,loaded:0,of:f});if(0>=e)d&&d();else{h=0;for(b=a.length;h!==b;++h){var n=a[h];if(void 0===n.type){var t=n.source.lastIndexOf(".");n.type=-1===t?"UNKNOWN":n.source.substr(t+1).toUpperCase()}"JS"!==n.type||Ac[n.source]||(Ac[n.source]="pending",++Ac.length)}h=0;for(b=a.length;h!==
b;++h)switch(n=a[h],n.type){case "JS":ig(n.source,!!l.async,m.bind(void 0,n));break;case "JSON":l.async?Le(n.source,m.bind(void 0,n)):z.logError("ERROR!  Unable to load JSON files synchronously");break;default:z.logWarning("WARNING! Attempting to load unrecognized resource "+n.source),m(n,void 0)}}},ig=function(a,d,l,m){function k(b){!b||"load"!==b.type&&"complete"!==b.readyState||(Ac[a]="loaded",l&&l(a))}void 0!==Ac[a]&&"pending"!==Ac[a]&&(z.log("WARNING:  File "+a+" is getting loaded twice!"),a+=
Math.random());Ac[a]||++Ac.length;Ac[a]="downloading";var f=ac(a);if(sa.Wraith)Wraith.LoadScript({src:f,async:d,complete:k});else{var e=document.createElement("script");e.async=d||!1;e.type="text/javascript";e.onreadystateChange=k;e.onload=k;e.onerror=function(){Ac[a]="error";z.log("Failed to load file "+f);m&&m(a)};e.src=f;document.getElementsByTagName("head")[0].appendChild(e)}},Le=function(a,d,l){void 0===l&&(l=!0);Me(a,function(m){l&&m&&(m=m.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1"));
m=m?JSON.parse(m):{};d(m)},"json")},kg=function(a,d){Me(a,d,"xml")},Me=function(a,d,l){Mc[Mc.length]={filename:a,state:"none",type:l};var m=new XMLHttpRequest;m.onreadystatechange=function(){4===m.readyState&&(Ne(a),d(m.responseText))};m.open("GET",ac(a),!0);try{m.send()}catch(k){}},Oe=function(a){for(var d=0;d<Mc.length;d++)if(Mc[d].filename===a)return d;return-1},Ne=function(a){var d=Oe(a);0<=d&&(d=Mc[d],"done"!==d.state&&(d.state="done",hg++,d.clientCallback&&d.clientCallback(a)))},Bc={read:function(a,
d,l){var m=new XMLHttpRequest;m.onload=function(k){4===m.readyState&&(200===m.status||0===m.status&&""===m.statusText)?(k=Bc.parse(m.responseText,l),d(!0,k,l)):(z.log("error loading "+a+" : "+m.statusText),d(!1,null,l))};m.open("GET",ac(a),!0);m.send()},readAsync:function(a,d){return new Promise(function(l,m){var k=new XMLHttpRequest;k.onload=function(f){4===k.readyState&&(200===k.status||0===k.status&&""===k.statusText)?(f=Bc.parse(k.responseText,d),l({data:f,opts:d})):(z.log("error loading "+a+
" : "+k.statusText),m(k.statusText))};k.open("GET",ac(a),!0);k.send()})},parseCSVLine:function(a,d){for(var l=[],m="",k=a.length,f=!1,e=!1,b=0;b<k;b++)f?'"'===a[b]?'"'===a[b+1]?(m+='"',b++):f=!1:m+=a[b]:","===a[b]?(m&&""!==m&&(e=!0),l.push(m),m=""):'"'===a[b]?f=!0:m+=a[b];m&&""!==m&&(e=!0);l.push(m);return d.skipEmptyLines&&!e?null:l}},Og=function(a,d){a=a.replace(/(?:[\r\n])+/g,"\n");d=[];for(var l="",m=a.length,k=!1,f=0;f<m;f++){var e=a[f];k?'"'===e?'"'===a[f+1]?(l+='"',f++):(k=!1,l+=e):l+=e:'"'===
e?(k=!0,l+=e):"\n"===e?(d.push(l),l=""):l+=e}return d};Bc.findMetaCommandInBoxes=function(a){for(var d=0;d<a.length;d++)if(a[d]&&"_"===a[d][0])return a[d];return null};Bc.parse=function(a,d){function l(I,p,x){for(;p<I.length;p++)I[p]&&(x[p]=I[p])}function m(I,p,x,C){z.logWarning((I||"don't know what to do with data ")+p+" @ row "+x+", col "+C)}d||(d={});void 0===d.slashComments&&(d.slashComments=!0);void 0===d.propertyLine&&(d.propertyLine=!0);void 0===d.allowMetaCommands&&(d.allowMetaCommands=!0);
void 0===d.defaultLine&&(d.defaultLine=!0);void 0===d.replaceCharCodes&&(d.replaceCharCodes=!0);void 0===d.leadingKey&&(d.leadingKey=!0);void 0===d.skipEmptyLines&&(d.skipEmptyLines=!0);var k=d.addTo;k||(k=d.leadingKey?{}:[]);var f=[],e=[],b=[],h=k,n=null,t=null,v=null,q=0,r=0;a=Og(a);d.verbose&&console.log("CSV Parse: "+a.length+" lines");for(var B=0;B<a.length;B++){var H=a[B];d.slashComments&&(H=H.replace(/"?\/\/[\D\d]*/g,""));var G=d.propertyLine?{}:[];var K=!1,u=!1,A=r,E=!1,S=Bc.parseCSVLine(H,
d);if(!d.skipEmptyLines||!(!S||0>=S.length||1===S.length&&""===S[0])){for(var aa=Bc.findMetaCommandInBoxes(S),R=H=0;R<S.length;R++){var Q=S[R];if(void 0===Q||""===Q)if(void 0===b[R]||""===b[R]||aa&&"_next"===aa)continue;else Q=b[R];Q.trim()!==Q&&m("trailing whitespace in value ",Q,B+1,R+1);if("_property"===Q&&d.propertyLine){l(S,R+1,f);K=!0;break}if("_type"===Q&&d.allowMetaCommands){l(S,R+1,e);K=!0;break}if("_default"===Q&&d.defaultLine&&(l(S,R+1,b),!d.includeDefaults)){K=!0;break}if("_location"===
Q&&d.allowMetaCommands){(E=S[R+1])||m("don't know the location name after _location ",E,B+1,R+1);h=qd(k,E);h||(h=d.leadingKey?{}:[],Ed(k,E,h));break}if("_next"===Q&&d.allowMetaCommands)(v=S[R+1])||m("don't know the property name after _next ",v,B+1,R+1),q++,G=n,A=t,E=!0,R++,u=!0,aa=null;else if(H++,d.leadingKey&&!E)A=Q,E=!0,v=null,q=0;else{E||1!==H||u||(v=null,q=0);var ea=Q;e[R]&&"string"!==e[R]&&("number"===e[R]?ea=parseFloat(Q):"boolean"===e[R]&&(ea=eg(Q)));var F=R;if(d.propertyLine)if(f[R])F=f[R];
else{m("don't know the property name for ",Q,B+1,R+1);continue}if("string"===typeof F){if(v&&(Q=F.indexOf(v+"["),0<=Q)){var y=F.indexOf("]",Q);F=F.substring(0,Q)+v+"["+q+"]"+F.substring(y+1)}Ed(G,F,ea)}else G[F]=ea}}K||d.skipEmptyLines&&0>=H||(n=h[A]=G,t=A,u||r++)}}return k};Bc.readCSVListAsync=function(a,d,l){l=l||{};l.readCount=0;l.readCountTarget=a.length;l.readDone=!1;for(var m=[],k=0;k<a.length;k++){var f=a[k],e=f.opts||{};d&&(e.addTo=d);f=Bc.readAsync(f.file,e);f.then(function(b){l.readCount++});
m.push(f)}return Promise.all(m)};var Pg=Bc.parseCSVLine,Pe={readAsync:function(a,d){return new Promise(function(l,m){var k=new XMLHttpRequest;k.onload=function(f){4===k.readyState&&(200===k.status||0===k.status&&""===k.statusText)?(f=Pe.parse(k.responseText,d),l(f)):(z.log("error loading "+a+" : "+k.statusText),m(k.statusText))};k.open("GET",ac(a),!0);k.send()})},parse:function(a,d){var l=[];d||(d={});void 0===d.slashComments&&(d.slashComments=!0);void 0===d.replaceCharCodes&&(d.replaceCharCodes=
!0);void 0===d.skipEmptyLines&&(d.skipEmptyLines=!0);d.slashComments&&(a=a.replace(/"?\/\/.*/g,""));a=a.split(/\r\n/);for(var m=0,k=0;k<a.length;k++){var f=Pg(a[k]);if(!d.skipEmptyLines||!(0>=f.length||1===f.length&&""===f[0])){for(var e=0,b=0;b<f.length;b++){var h=f[b];void 0!==h&&""!==h&&e++}d.skipEmptyLines&&0>=e||(l[m]=f,m++)}}return l}},fa={currentStatus:"uninit",currentLanguage:"en",currentLocale:"en-US",stringData:{},tokenReplacements:{},supportedLanguages:[],callback:void 0,defaultLanguage:"key",
hasLanguage:{}};fa.expectedFormat=window.DOMParser?"xml":"csv";var Qe=0;fa.fireDoneCallback=function(){fa.callback&&(fa.callback(),fa.callback=void 0)};fa.initAsync=function(a,d,l){l=l||{};if("uninit"!==fa.currentStatus)z.log("stringManager.init called twice, which is not supported.");else if(fa.initDebug(),fa.callback=d,!1===Array.isArray(a)&&(a=a?[a]:[]),Qe=a.length,0<a.length)for(fa.currentStatus="requested",d=0;d!==a.length;++d){var m=a[d],k=m.lastIndexOf("."),f=m.substring(k);l.format?fa.expectedFormat=
l.format:l.formatFromPlatform?(-1!==k&&(m=m.slice(0,k)),m+="."+fa.expectedFormat):fa.expectedFormat=f;var e=function(b){fa.loadData(b,fa.expectedFormat)};"xml"===fa.expectedFormat?kg(m,e):"json"===fa.expectedFormat?Le(m,e):Pe.readAsync(m).then(function(b){e(b)})}else fa.currentStatus="complete",fa.fireDoneCallback()};fa.init=function(a,d){return new Promise(function(l,m){fa.initAsync(a,function(k){l(k)},d)})};fa.initDebug=function(){z.registerCommand("language",function(a,d){1>d.length||!d[0]?(z.log("current locale '"+
fa.getLocale()+"', language '"+fa.getLanguage()+"'"),z.log("usage: locale <2-part locale code or 1-part language code>")):(fa.isLocaleCode(d[0])?fa.setLocale(d[0]):fa.setLanguage(d[0]),z.log("current locale '"+fa.getLocale()+"', language '"+fa.getLanguage()+"'"))},["lang"])};fa.isReady=function(){return"complete"===fa.currentStatus||"error"===fa.currentStatus?!0:!1};fa.getUserLocale=function(){var a="en-US";if(sa.windows&&sa.winJS){var d=window.Windows.System.UserProfile.GlobalizationPreferences.languages;
1<=d.length&&(a=d)}else null!=window.navigator.userLanguage?a=window.navigator.userLanguage:null!=window.navigator.languages?(d=window.navigator.languages,1<=d.length&&(a=d)):null!=window.navigator.language?a=window.navigator.language:null!=window.navigator.browserLanguage?a=window.navigator.browserLanguage:null!=window.navigator.systemLanguage&&(a=window.navigator.systemLanguage);if(Array.isArray(a)){for(d=0;d<a.length;d++)if(!0===fa.isKnownLocale(a[d]))return a[d];return"en-US"}return!0===fa.isKnownLocale(a)?
a:"en-US"};fa.setDefaultLanguage=function(a){a=fa.interpretLanguageCode(a);!1===fa.isKnownLanguage(a)&&(z.logWarning("Tried to set an unknown language: "+a+" as the default. Using english instead."),a="es");fa.defaultLanguage=a};fa.isLocaleCode=function(a){return a.match("^(([a-zA-Z]{2})|([a-zA-Z]{2}-[a-zA-Z]{2,3}))$")};fa.interpretLanguageCode=function(a){a=a.toLowerCase();fa.isLocaleCode(a)&&(a=fa.convertLocaleToLanguage(a));return a};fa.selectLanguage=function(){var a=fa.getUserLocale();fa.setLocale(a);
z.log("Using locale: "+fa.currentLocale+", with language: "+fa.currentLanguage)};fa.isKnownLanguage=function(a){return!0};fa.setLocale=function(a){!0===fa.isKnownLocale(a)?fa.currentLocale=a:(z.logWarning("locale "+a+" unknown, setting to en-US"),fa.currentLocale="en-US");fa.currentLanguage=fa.convertLocaleToLanguage(fa.currentLocale);fa.stringData[fa.currentLanguage]||z.logWarning("setLocale : No data for language "+fa.currentLanguage)};fa.setLanguage=function(a){a=fa.interpretLanguageCode(a);fa.currentLanguage=
a;fa.stringData[a]||z.log("No data for language : "+a)};fa.isKnownLocale=function(a){return"??"===fa.getLanguageFromLanguageCode(a)?!1:!0};fa.getLocale=function(){return fa.currentLocale};fa.getLanguage=function(){return fa.currentLanguage};fa.getString=function(a){var d=fa.getStringNoReplaceTokens(a,1<arguments.length&&void 0!==arguments[1]?arguments[1]:null),l=fa.getTokensFromString(d);if(null!=l&&0<l.length){for(var m=[],k=0;k<l.length;k++){var f=l[k],e=fa.tokenReplacements[f];null!=e&&m.push({key:f,
value:e})}d=fa.replaceTokens(d,m)}return d};fa.getStringNoReplaceTokens=function(a){var d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,l=fa.currentLanguage,m=fa.defaultLanguage;null!=d&&(d=d.toLowerCase(),fa.isKnownLanguage(d)&&(l=d));fa.stringData[l]||(l=m);if((d=fa.stringData[l])&&d[a])return d[a].split("\\n").join("\n");if(!fa.stringData.key[a])return"!k_"+a;if("key"!==m){if((m=fa.stringData[m])&&m[a])return m[a]}else if(null!=fa.stringData.key[a]&&fa.stringData.key[a]!==a)return fa.stringData.key[a];
return"["+l+"]_"+a};fa.getStringReplaceTokens=function(a,d){var l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;d=d||[];!1===Array.isArray(d)&&(d=[d]);l=fa.getStringNoReplaceTokens(a,l);return l=fa.replaceTokens(l,d)};fa.getTokensFromString=function(a){for(var d=[],l=0;l<a.length;){var m=a.indexOf("{",l);l=a.indexOf("}",l+1);if(-1===m||-1===l)break;m=a.substring(m,l+1);-1===d.indexOf(m)&&d.push(m);l+=1}return d};fa.replaceTokens=function(a,d){d=d||[];!1===Array.isArray(d)&&(d=[d]);for(var l,
m=0;m<d.length;++m){var k=d[m];l=void 0!==k.value?k.value:k;k.localize&&(l=fa.getString(l));a=void 0!==k.key?a.split(k.key).join(l):a.split("{"+m+"}").join(l)}return a};fa.loadData=function(a,d){if("requested"===fa.currentStatus){if("xml"===d)a=fa.parseXMLString(a),fa.loadParsedData(a);else if("json"===d){a=(a=(a=(a=a?a.Workbook:void 0)?a.Worksheet:a)?a.Table||a[0].Table:a)?a.Row:a;if(!a){z.log("FAILED to process string JSON file.  Bad format");return}for(d=0;d<a.length;++d){var l=a[d].Cell;if(0===
d)for(var m=0;m<l.length;++m){var k=(l[m].Data||l[m]["ss:Data"])["#text"].toLowerCase();fa.hasLanguage[k]||(fa.supportedLanguages.push(k),fa.stringData[k]=fa.stringData[k]||{},fa.hasLanguage=!0)}else if(l.length&&1!==l.length&&(l[0].Data||l[0]["ss:Data"])&&(l[1].Data||l[1]["ss:Data"]))for(m=l[0].Data||l[0]["ss:Data"],k=0;k<l.length;++k){var f=l[k].Data||l[k]["ss:Data"],e=fa.stringData[fa.supportedLanguages[k]];f&&(e[m["#text"]]=f["#text"])}}}else a=fa.parseCSV(a),fa.loadParsedData(a);fa.finishedFile()}};
fa.finishedFile=function(){--Qe;0>=Qe&&(fa.currentStatus="complete",fa.fireDoneCallback())};fa.loadParsedData=function(a){for(var d=0;d<a.languages.length;d++){var l=a.languages[d];fa.hasLanguage[l]||(fa.supportedLanguages.push(l),fa.stringData[l]=fa.stringData[l]||{},fa.hasLanguage[l]=!0)}fa.setStrings(a.stringSets)};fa.parseXMLString=function(a){var d={languages:[],stringSets:[]},l=(new DOMParser).parseFromString(a,"text/xml");a=l.getElementsByTagName("Row");var m=l.getElementsByTagName("table:table-row");
l=l.getElementsByTagName("table-row");a=0<a.length?a:0<m.length?m:l;for(m=0;m<a.length;++m){l=a[m].getElementsByTagName("Cell");var k=a[m].getElementsByTagName("table:table-cell"),f=a[m].getElementsByTagName("table-cell");l=0<l.length?l:0<k.length?k:f;if(0===m)for(k=0;k<l.length;++k)f=l[k].textContent.toLowerCase(),d.languages.push(f);else if(""!==l[0].textContent){k={};for(var e=f=0;e<l.length;++e){var b=l[e],h=d.languages[f++],n=b.textContent.trim();k[h]=n;b=b.getAttribute("table:number-columns-repeated");
if(null!=b&&(b=parseInt(b,10),1<b))for(h=1;h<b;h++){var t=d.languages[f++];k[t]=n}}d.stringSets.push(k)}}return d};fa.parseCSV=function(a){for(var d={languages:[],stringSets:[]},l=0;l<a.length;++l){var m=a[l];if(0===l)for(var k=0;k<m.length;++k){var f=m[k].toLowerCase();d.languages.push(f)}else if(""!==m[0]){k={};for(var e=f=0;e<m.length;++e){var b=m[e],h=d.languages[f++];b=b.trim();k[h]=b}d.stringSets.push(k)}}return d};fa.setString=function(a){if(null==a.key)z.logError("Missing KEY in newStringData");
else{for(var d=a.key,l=0,m=Object.keys(fa.stringData);l<m.length;l++){var k=m[l];fa.stringData[k]=fa.stringData[k]||{};fa.stringData[k][d]=void 0}fa.stringData.key[d]=d;l=0;for(a=Object.entries(a);l<a.length;l++)k=df(a[l],2),m=k[0],k=k[1],"key"!==m&&(fa.isKnownLanguage(m)?(fa.hasLanguage[m]||(fa.supportedLanguages.push(m),fa.hasLanguage[m]=!0,fa.stringData[m]=fa.stringData[m]||{}),fa.stringData[m][d]=k):z.logError("Attempted to add a language not recognized by Rat: "+m))}};fa.setStrings=function(a){for(var d=
0;d<a.length;d++)fa.setString(a[d])};fa.addStringWithKey=function(a,d){var l={};switch(typeof d){case "object":if(Array.isArray(d)){console.logError("Arrays not accepted in method: stringManager.addStringWithKey");return}l.key=a;a=0;for(d=Object.entries(d);a<d.length;a++){var m=df(d[a],2),k=m[0];m=m[1];"key"!==k&&0!=fa.isKnownLanguage(k)&&(l[k]=m)}break;case "string":l={key:a,en:d};break;case "number":l={key:a,en:""+d};break;default:z.logWarning("Cannot add unkown stringData type for: "+d);return}fa.setString(l)};
fa.setKeyString=function(a,d){null!=fa.stringData.key&&null!=fa.stringData.key[a]&&(fa.stringData.key[a]=d)};fa.setAutoTokenReplacement=function(a,d){fa.tokenReplacements[a]=d};fa.getLanguageFromLanguageCode=function(a){return!a||!a.length||2>a.length?"??":a.substring(0,2)};fa.convertLocaleToLanguage=function(a){var d=fa.getLanguageFromLanguageCode(a);return"??"===d?(z.logWarning("Unknown language from locale: "+a+". Using english instead."),"en"):d};var $b=function(a){this.a=a};$b.prototype.isPlaying=
function(){return!!(this.a&&0<this.a.currentTime&&!this.a.paused&&!this.a.ended&&2<this.a.readyState)};$b.prototype.isPaused=function(){return this.a.paused};$b.prototype.getCurrentTime=function(){return this.a.currentTime};$b.prototype.setCurrentTime=function(a){this.a.currentTime=a};$b.prototype.getDuration=function(){return this.a.duration};$b.prototype.play=function(){var a=this.a.play();void 0!==a&&a.then(function(){}).catch(function(d){"NotAllowedError"!==d.name&&z.logWarning("play promise rejected : "+
d);return-1})};$b.prototype.stop=function(){this.a.stop()};$b.prototype.pause=function(){this.a.pause()};$b.prototype.unload=function(){this.a.removeAttribute("src")};$b.prototype.isLooping=function(){return this.a.loop};$b.prototype.setLooping=function(a){this.a.loop=a};$b.prototype.getVolume=function(){return this.a.volume};$b.prototype.setVolume=function(a){this.a.volume=a};var V={implementation:"default",RatSound:$b,initialized:!1,soundOn:!0,suppressSound:!1,globalVolume:1,defaultGroup:"sfx",
groups:{sfx:{volume:1,enabled:!0}},defaultExt:"",toLoadCount:0,loadedCount:0,sounds:{},dukTapeSound:null,trackLog:!0,logHistory:"",logHistoryCount:0,logHistoryMax:0,initialDebug:!1,showVerboseLevel:0,verboseLevelNormal:0,verboseLevelError:0,verboseLevelInit:1,verboseLevelHigh:2,log:function(a,d,l){l||(l=a);d||(d=1);V.showVerboseLevel>=d&&z.logOnce("| r_audio: "+a,l);V.logHistoryCount<V.logHistoryMax&&(V.logHistoryCount++,V.logHistory+=a+"\n")},audioConstructor:function(){return new window.Audio},
init:function(a){a="undefined"===typeof a?V:a;V.initialDebug&&!V.showVerboseLevel&&(V.showVerboseLevel=1);V.log("Init");a.iOSBrowser=sa.iOSBrowser;a.PS4Browser=sa.PS4Browser;var d=a.audioConstructor();if(d.canPlayType){a.canPlay={};a.canPlay.mp3=!!d.canPlayType("audio/mpeg");a.canPlay.m4a=!!d.canPlayType('audio/mp4; codecs="mp4a.40.5"');a.canPlay.ogg=!!d.canPlayType('audio/ogg; codecs="vorbis"');a.canPlay.xma=!!d.canPlayType("audio/xma2;");a.canPlay.wav=!0;a.PS4Browser&&(a.canPlay.m4a=!0);a.initialDebug&&
V.log("can play: mp3("+a.canPlay.mp3+") m4a("+a.canPlay.m4a+") ogg("+a.canPlay.ogg+") xma("+a.canPlay.xma+") wav("+a.canPlay.wav+") \n");if(a.canPlay.m4a)var l="m4a";else a.canPlay.mp3?l="mp3":a.canPlay.ogg?l="ogg":a.canPlay.xma?l="xma":a.canPlay.wav?l="wav":(a.log("Unable to find supported audio file format.  Defaulting to .m4a"),l="m4a");a.initialDebug&&a.log("load using ."+l);a.defaultExt=l}else a.canPlay={m4a:!0},a.defaultExt="m4a";a.dukTapeSound=d;a.initialized=!0},loadSounds:function(a){V.sounds=
V._loadSoundList(a,V.makeSound,V.sounds)},loadSound:function(a){V.loadSounds([a])},makeSound:function(a,d){var l=V.audioConstructor(),m=new $b(l);V.doSingleLoad(m,a,d);V._setSoundGroup(m,d.group);var k=V._setSoundInitialVolume(m,d.volume)*V.globalVolume;V.log("set volume for "+a+" to "+k);l.volume=k;d.loop&&(l.loop=!0);return m},_setSoundGroup:function(a,d){a.group=d||V.defaultGroup;V.groups[a.group]||(V.groups[a.group]={volume:1,enabled:!0})},_setSoundInitialVolume:function(a,d){var l=1;void 0!==
d&&(l=d);void 0!==V.groups[a.group].volume&&(l*=V.groups[a.group].volume);a.soundVolume=d;a.origVolume=d;return l},_loadSoundList:function(a,d,l){V.initialized||z.logError("rat.audio NOT INITIALIZED before loadSounds");l=l||{};for(var m={},k=0;k<a.length;k++){var f=a[k];Array.isArray(f)||(f=[a[k]]);var e=f[0].count-1;if(0<e)for(var b=f[0].count=0;b<e;b++)f.push(f[0]);e=[];for(b=0;b<f.length;b++){var h=f[b];"string"===typeof h&&(h={resource:n,volume:1});var n=h.resource;h.id||(h.id=Df(n));h.group||
(h.group=r);if("data:"!==n.substring(0,5)){var t=n.lastIndexOf(".");if(0<t){var v=n.substring(t+1,n.length);V.canPlay[v]||(n=n.substring(0,t)+"."+V.defaultExt)}else n=n+"."+V.defaultExt;n=ra.fixPath(n)}V.toLoadCount++;t=d(n,h);e[b]=t;if(0===b){var q=h.id;var r=h.group}}m[q]&&V.log("ERROR: "+q+" redefined!",V.verboseLevelError,q);l[q]&&(V.log("replacing sound "+q,V.verboseLevelError,q),V.releaseSound(q));l[q]=e}return l},releaseSound:function(a){var d=V.sounds[a];if(d){for(var l=0;l<d.length;l++)d[l].unload();
delete V.sounds[a]}},loadSoundsWithData:function(a,d){function l(m,k){for(var f=0;f<m.length;f++){var e=m[f];if(Array.isArray(e))l(e,k);else for(var b=0;b!=k.length;++b){var h=k[b];if(h.id===e.resource){e.resource=h.resource;break}}}}l(a,d);V.loadSounds(a)},doSingleLoad:function(a,d,l){function m(e){V.log("on_load, src "+this.src+", dur "+this.duration+", error : "+(this.error?this.error.code:"none")+", ready : "+this.readyState,2);this.removeEventListener("canplaythrough",m,!1);this.removeEventListener("error",
k,!1);e=this.ratSound;e.ratLoaded||(e.ratLoaded=!0,V.loadedCount++,V.log(V.loadedCount+"/"+V.toLoadCount+" loaded: "+this.src))}function k(e){V.log("on_error, src "+this.src+", dur "+this.duration+", error : "+(this.error?this.error.code:"none")+", ready : "+this.readyState,0);m.call(this,e)}var f=a.a;f.ratSound=a;V.log("triggering load "+l.id+" : "+d,2);f.preload="auto";f.addEventListener("canplaythrough",m,!1);f.addEventListener("error",k,!1);f.src=d;f.load()},selectVariant:function(a){if(!V.sounds[a])return V.log("tried to play nonexistent sound "+
a,0,a),null;var d=V.sounds[a];if(0>=d.length)return V.log("tried to play from empty list "+a,0,a),null;a=Math.random()*d.length|0;for(var l,m=-1,k=0;k<d.length;k++){var f=d[(a+k)%d.length],e=f.isPaused(),b=f.getCurrentTime();e=!e&&0<b?.5:1;e>m&&(m=e,l=f)}return l},getSoundGroup:function(a){return V.sounds[a][0].group},playSound:function(a,d){if(!V.soundOn||V.suppressSound)return null;V.log("play "+a);var l=V.selectVariant(a);if(l){if(a=V.groups[l.group],!a||a.enabled)d&&d.volume&&(l.soundVolume=d.volume,
l.setVolume(d.volume*V.groups[l.group].volume*V.globalVolume)),0>=l.getVolume()||(l.isPaused()?l.play():(d=l.getCurrentTime(),l.isPlaying()&&.1>d||(sa.Wraith&&l.stop(),l.play())))}else z.logError("sound "+a+" not found in loaded audio.")},pauseSound:function(a){if(V.sounds[a]){a=V.sounds[a];for(var d=0;d<a.length;d++){var l=a[d];l.a&&l.isPlaying()&&l.pause()}}else V.log("tried to pause nonexistent sound "+a,0,a)},resetSound:function(a){if(V.sounds[a]){a=V.sounds[a];for(var d=0;d<a.length;d++){var l=
a[d];l.a&&0!==l.getCurrentTime()&&l.setCurrentTime(0)}}else V.log("tried to reset nonexistent sound "+a,0,a)},stopSound:function(a){V.pauseSound(a);V.resetSound(a)},seekSound:function(a,d,l){if(V.sounds[a]){"undefined"===typeof l&&(l=!1);a=V.sounds[a];for(var m=0;m<a.length;m++){var k=a[m];if(k&&k.a){var f=k.getDuration(),e=d;l&&(e*=f);k.setCurrentTime(e)}}}else V.log("tried to reset nonexistent sound "+a,0,a)},setSoundLooping:function(a,d){d=!!d;if(V.sounds[a]){a=V.sounds[a];for(var l=0;l<a.length;l++){var m=
a[l];m&&m.a&&m.isLooping()!==d&&m.setLooping(d)}}else V.log("tried to call setSoundLooping nonexistent sound "+a,0,a)},getSoundLooping:function(a){return V.sounds[a][0].isLooping()},getSoundVolume:function(a){if(V.sounds[a])return V.sounds[a][0].soundVolume;V.log("tried to get volume for nonexistent sound "+a,0,a)},setSoundVolume:function(a,d){if(V.sounds[a]){a=V.sounds[a];for(var l=0;l<a.length;l++){var m=a[l];m&&m.a&&(m.soundVolume=d,m.setVolume(d*V.groups[m.group].volume*V.globalVolume))}}else V.log("tried to set volume for nonexistent sound "+
a,0,a)},setGroupVolume:function(a,d){V.groups[a]||(V.groups[a]={volume:1,enabled:!0});if(d!==V.groups[a].volume){V.groups[a].volume=d;for(var l in V.sounds)for(var m=V.sounds[l],k=0;k<m.length;++k){var f=m[k];f&&f.a&&f.group===a&&f.setVolume(f.soundVolume*d*V.globalVolume)}}},setGlobalVolume:function(a){if(a!==V.globalVolume){V.globalVolume=a;for(var d in V.sounds){a=V.sounds[d];for(var l=0;l<a.length;++l){var m=a[l];m.setVolume(m.soundVolume*V.groups[m.group].volume*V.globalVolume)}}}},enableGroup:function(a,
d){d=!!d;V.groups[a]||(V.groups[a]={volume:1,enabled:!0});V.groups[a].enabled=d;if(!d)for(var l in V.sounds)V.sounds[l][0].group===a&&V.stopSound(l)},muteGroup:function(a,d){void 0===d&&(d=!0);V.enableGroup(a,!d)},isGroupEnabled:function(a){V.groups[a]||(V.groups[a]={volume:1,enabled:!0});return V.groups[a].enabled},fadeSound:function(a,d,l,m){m||(m=1);a=V.sounds[a];for(var k=0;k<a.length;++k){var f=a[k],e=d;if(void 0===d||0>d)e=f.soundVolume;var b=l;if(void 0===l||0>l)b=f.origVolume;f.fade={startVolume:e,
endVolume:b,time:m,startTime:m};f.soundVolume=e;f.setVolume(e*V.groups[f.group].volume*V.globalVolume)}},fadeSoundTo:function(a,d,l){V.fadeSound(a,-1,d,l)},unFadeSound:function(a,d){V.fadeSound(a,-1,-1,d)},fadeGroup:function(a,d,l,m){m||(m=1);a=V.groups[a];if(void 0===d||0>d)d=a.volume;a.fade={startVolume:d,endVolume:l,time:m,startTime:m}},fadeGroupTo:function(a,d,l){V.fadeGroup(a,-1,d,l)},getSoundCurrentTime:function(a){return(a=V.sounds[a])&&a[0]?a[0].getCurrentTime():0},isSoundLoaded:function(a){var d=
V.sounds[a];if(!d||!d[0])return V.log("Tried to check if nonexistent audio ("+a+") is loaded",0),null;a=d[0];if(a.a.error)return"error";d=a.a.buffered;return 1===d.length&&0===d.start(0)&&d.end(0)===a.a.duration},isSoundPlaying:function(a){a=V.sounds[a];if(!a)return!1;for(var d=0;d<a.length;d++){var l=a[d];if(l&&l.isPlaying())return!0}return!1},update:function(a){function d(h){var n=h.fade;n.time-=a;var t=1-n.time/n.startTime;1<t&&(t=1,h.fade=null);return Y.interp(n.startVolume,n.endVolume,t)}for(var l in V.groups)if(Yb(V.groups,
l)){var m=V.groups[l];if(m.fade){var k=d(m);m.volume=k}}for(var f in V.sounds)if(Yb(V.sounds,f))for(l=V.sounds[f],m=0;m<l.length;++m){k=l[m];var e=V.groups[k.group];if(k.fade){var b=d(k);k.soundVolume=b;k.setVolume(b*e.volume*V.globalVolume)}e.fade&&k.setVolume(k.soundVolume*V.groups[k.group].volume*V.globalVolume)}},isCacheLoaded:function(){return!0},getSoundCount:function(){var a=0,d;for(d in V.sounds)Yb(V.sounds,d)&&a++;return a},getSoundIDByIndex:function(a){var d=0,l;for(l in V.sounds)if(Yb(V.sounds,
l)){if(d===a)return l;d++}return"error"},getSoundInfo:function(a){var d=V.sounds[a];if(d&&d[0])return d=d[0],a={id:a,duration:d.a.duration,source:d.a.src,volume:d.a.volume,currentPos:d.a.currentTime,readyState:d.a.readyState,errorCode:"none"},d.a.error&&(a.errorCode=d.a.error.code),a;V.log("Requested info for nonexistent sound"+a,0,a);return null},whatIsMissing:function(){var a=0,d=0,l;for(l in V.sounds)if(Yb(V.sounds,l))for(var m=0;m<V.sounds[l].length;m++)V.sounds[l][m].ratLoaded||(z.log("Missing: "+
l+" (variant "+m+")"),d++),a++;z.log("missing "+d+" of "+a)}},rb={audio:"audio",atlases:"atlases",images:"images",strings:"strings"},gc=function(a){a=a||{};this.loadRunning=!1;this.loading={};this.loaded={};var d;for(d in rb){var l=rb[d];this.loading[l]=!1;this.loaded[l]=!1}this.atlasJSONLoading=this.atlasImagesLoading=!1;this.onDone=[];this.data={};for(d in rb)l=rb[d],this.data[l]=a[l]||[];this.fireCBIndex=-1;this.cycleUpdateFunc=this.cycleUpdate.bind(this)};gc.prototype.log=function(){};gc.prototype.registerOnDone=
function(a,d,l){l=l||{};l.autoRemove=!!l.autoRemove;a&&this.onDone.push({cb:a,ctx:d,options:l})};gc.prototype.unregisterOnDone=function(a,d){if("number"===typeof a){var l=a;if(0<=l&&l<this.onDone.length)return l<this.fireCBIndex&&--this.fireCBIndex,this.onDone.splice(l,1),!0}else if(a)for(l=0;l!==this.onDone.length;++l){var m=this.onDone[l];if(m.cb===a&&m.ctx===d)return l<this.fireCBIndex&&--this.fireCBIndex,this.onDone.splice(l,1),!0}return!1};gc.prototype.fireOnDone=function(){for(this.fireCBIndex=
0;this.fireCBIndex!==this.onDone.length;++this.fireCBIndex){var a=this.onDone[this.fireCBIndex];a.cb.call(a.ctx)}this.fireCBIndex=-1;for(var d=this.onDone.length-1;0<=d;--d)a=this.onDone[d],a.options.autoRemove&&this.unregisterOnDone(d)};gc.prototype.isLoaded=function(){for(var a in this.loaded)if(!this.loaded[a])return!1;return!0};gc.prototype.isLoading=function(){return this.loadRunning};gc.prototype._loadedSingleAtlasJSON=function(a,d){a.jsonData=d;a.jsonData.meta||z.error("JSON failed to load correctly.");
if(a.autoLoadImage&&a.jsonData.meta.image){d=$d(a.json);var l=Id(a.jsonData.meta.image);Oa.preLoadImages(d+l);a.atlas=d+l;this.atlasImagesLoading=!0}};gc.prototype._loadedAtlasJSON=function(){this.atlasJSONLoading=!1};gc.prototype._loadedSingleAtlas=function(a){Ba.registerSpriteSheet(a.atlas,a.jsonData)};gc.prototype._preloadSetFinished=function(a){this.log("...Finished loading ALL "+a+".");this.loading[a]=!1;this.loaded[a]=!0};gc.prototype.startLoad=function(a,d){a&&this.registerOnDone(a,d,{autoRemove:!0});
for(var l in rb)d=rb[l],this.loaded[d]=!this.loading[d]&&0>=this.data[d].length,this.loading[d]=this.loading[d]||!this.loaded[d]&&0<this.data[d].length;if(this.isLoaded())this.fireOnDone();else if(!this.isLoading()){this.loadRunning=!0;this.log("Starting the preload process.  Loading :");for(l in rb)d=rb[l],this.log("   "+d+":  "+this.data[d].length);a=this.data[rb.atlases];if(this.loading[rb.atlases])for(d=0;d!==a.length;++d)a[d].atlas&&this.data[rb.images].push(a[d].atlas);for(l in rb)if(d=rb[l],
this.loading[d]&&!this.loaded[d])switch(d){case rb.audio:V.loadSounds(this.data[d]);break;case rb.atlases:this.atlasImagesLoading=this.atlasJSONLoading=!0;var m=[];for(d=0;d!==a.length;++d){var k=a[d];m.push({source:k.json,callback:this._loadedSingleAtlasJSON.bind(this,k)})}jg(m,this._loadedAtlasJSON.bind(this));this.loading[rb.images]||Oa.preLoadImages(this.data[rb.images]);break;case rb.images:Oa.preLoadImages(this.data[d]);break;case rb.strings:fa.initAsync(this.data[d]);break;default:this.logError("ERROR!  Unrecognized load type!")}mc.addUpdater(this.cycleUpdateFunc)}};
gc.prototype.cycleUpdate=function(){var a;for(a in rb){var d=rb[a];if(this.loading[d]&&!this.loaded[d])switch(d){case rb.audio:V.isCacheLoaded()&&this._preloadSetFinished(d);break;case rb.atlases:this.atlasImagesLoading&&Oa.isCacheLoaded()&&(this.atlasImagesLoading=!1);if(!this.atlasImagesLoading&&!this.atlasJSONLoading){for(var l=this.data[d],m=0;m!==l.length;++m)this._loadedSingleAtlas(l[m]);this._preloadSetFinished(d)}break;case rb.images:Oa.isCacheLoaded()&&this._preloadSetFinished(d);break;case rb.strings:fa.isReady()&&
this._preloadSetFinished(d);break;default:this.logError("ERROR!  Unrecognized load type!")}}this.loadRunning&&this.isLoaded()&&(this.log("...Preload Finished."),mc.removeUpdater(this.cycleUpdateFunc),this.loadRunning=!1,this.fireOnDone())};var lg=function(a){for(var d="",l=0;l<a;l++)d+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(62*Math.random()));return d},mg=function(a){var d="";do{var l=a%62;a=Math.floor(a/62);d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(l)+
d}while(a);return d},Re=function(){return mg((new Date).getTime())+"_"+lg(5)},Qg=Object.freeze({__proto__:null,applyNamedFlags:function(a,d){var l=0;if(!a||!d)return 0;a=a.split(" ");for(var m=0;m<a.length;m++)d[a[m]]&&(l|=d[a[m]]);return l},getNamedFlags:function(a,d,l){l=l||{};for(var m in d)0!==(a&d[m])&&(l[m]=!0);return l},collectNamedFlags:function(a,d,l){if(!a)return{};l=l||{};a=a.split(" ");for(var m=0;m<a.length;m++)if(!d||d[a[m]])l[a[m]]=!0;return l},makeID:lg,encodeID:mg,makeUniqueID:Re,
makeUserID:Re,launchSystemHelpUI:function(a){if(window.Windows&&window.Windows.Xbox&&window.Windows.Xbox.ApplicationModel.Help){var d=window.Windows.Xbox.ApplicationModel.Help.show;z.log("Launching system help ui for the Xbox");d(a.rawData)}},checkSum:function(a){for(var d=305419896,l=a.length,m=0;m<l;m++)d+=a.charCodeAt(m)*(m+1);return d&4294967295},hashCode:function(a){var d=0,l=a.length;if(0===l)return 0;for(var m=0;m<l;m++){var k=a.charCodeAt(m);d=(d<<5)-d+k;d&=d}return d},hasOwnProperty:Yb,copyObject:tb,
deepCopy:function(a){return tb(a,!0)},extendObject:vc,mergeObject:function m(d,l){function k(b){return"object"===typeof b?tb(b,!0):b}if(void 0===l||l===d)return d;if(void 0===d||null===d)return tb(l,!0);for(var f in l)if(Yb(l,f)){var e=l[f];void 0!==e&&(null===e?delete d[f]:void 0===d[f]||null===d[f]?d[f]=k(e):typeof d[f]!==typeof e||Array.isArray(e)?d[f]=tb(e,!0):"object"===typeof d[f]&&"object"===typeof e?m(d[f],e):d[f]=k(e))}return d},deepSet:function f(l,m,k){if("object"===typeof l&&null!==l)for(var e in l)Yb(l,
e)&&("object"===typeof l[e]?f(l[e],m,k):e===m&&(l[e]=k))},searchArrayFor:function(l,m){for(var k=0;k<l.length;++k)if(m(l[k]))return k;return-1},addProp:nf,objectToString:of,get:qd,set:Ed,diff:function f(m,k){var e={},b;for(b in m)if(Yb(m,b)){var h=m[b],n=k[b],t=b;void 0===n?e[t]=null:typeof h!==typeof n||Array.isArray(h)&&!Array.isArray(n)||Array.isArray(n)&&!Array.isArray(h)?e[t]=tb(n):"object"===typeof h?(h=f(h,n),0<Object.keys(h).length&&(e[t]=h)):h!=n&&(e[t]=n)}for(var v in k)Yb(k,v)&&(m[v]||
m[v]===k[v]||(e[v]=tb(k[v])));if(Array.isArray(m)){m=[];for(var q in e)m[q]=e[q];e=m}return e},applyDiff:function(m,k){return vc(m,k,!0,!0)},compareDiff:function(m,k){function f(v,q){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1,B=3<arguments.length?arguments[3]:void 0,H=r;0<H&&--H;if(0===r||"object"!=typeof v&&!Array.isArray(v)||"object"!=typeof q&&!Array.isArray(q)||typeof v!=typeof q)return h=!1,v!=q?{old:v,new:q,count:1}:{count:0};r={count:0};var G={};for(A in v)if(!B[A]){G[A]=
!0;var K=f(v[A],q[A],H,B);0<K.count&&(r[A]=h?K:{old:K.old,new:K.new},r.count+=K.count)}for(var u in q)if(!B[u]&&!G[u]){G[u]=!0;var A=f(v[u],q[u],H,B);0<A.count&&(r[u]=h?A:{old:A.old,new:A.new},r.count+=A.count)}h=!0;return r}var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1,b=3<arguments.length?arguments[3]:void 0,h=!1;b=b||{};if(Array.isArray(b)){for(var n={},t=0;t<b.length;++t)n[b[t]]=!0;b=n}return f(m,k,e,b)},arrayToObject:function(m){if(!1!==Array.isArray(m)){for(var k={},f=0;f<
m.length;++f)k[m[f]]=(k[m[f]]||0)+1;return k}},safeJSONParse:function(m){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;try{var e=JSON.parse(m)||{};var b=!0}catch(n){var h=n;e={};b=!1}b&&k?k(e):!b&&f&&f(h);return e},inheritClassFrom:cb,inheritFrom:cb,extendClassWith:Nf,stripPath:Id,stripExtension:Cf,getBaseFilename:Df,getPath:$d,cleanPath:ud,addDefaultExtension:function(m,k){if(!k)return m;0>m.lastIndexOf(".")&&("."!==
k[0]&&(m+="."),m+=k);return m},parseBoolean:eg,secondsToText:fg,secondsToPrettyTime:function(m){function k(r,B){B.key=r;if(!(0>B.at)){for(B.len=0;e.charAt(B.at+B.len)===r;)++B.len;for(B.out=""+B.value;B.out.length<B.len;)B.out="0"+B.out;q.push(B)}}var f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"DD:HH:MM:SS.FF";f=f||"DD:HH:MM:SS.FFF";var e=f.toLowerCase(),b={},h={},n={},t={},v={};b.value=Y.floor(m/86400);m-=86400*b.value;h.value=Y.floor(m/3600);m-=3600*h.value;n.value=Y.floor(m/60);m-=
60*n.value;t.value=Y.floor(m);m-=t.value;v.value=Y.floor(1E3*m);b.at=e.indexOf("d");h.at=e.indexOf("h");n.at=e.indexOf("m");t.at=e.indexOf("s");v.at=e.indexOf("f");0>b.at&&(h.value+=24*b.value);0>h.at&&(n.value+=60*h.value);0>n.at&&(t.value+=60*n.value);0>t.at&&(v.value+=1E3*t.value);var q=[];k("d",b);k("h",h);k("m",n);k("s",t);k("f",v);if(!q.length)return"";0<=v.at&&v.len<v.out.length&&(v.out=v.out.substring(0,v.out.length));q=q.sort(function(r,B){return r.at-B.at});n=f;for(f=q.length-1;0<=f;--f)b=
q[f],h=n.substring(0,b.at),n=n.substring(b.at+b.len),n=h+b.out+n;return n},dateToTimeText:function(m,k,f){var e=m.getHours(),b=m.getMinutes();m=m.getSeconds();var h="";k||(12<=e?(e-=12,h=" pm"):h=" am");k=10>e?"0"+e:""+e;k=10>b?k+(":0"+b):k+(":"+b);f&&(k=10>m?k+(":0"+m):k+(":"+m));return k+h},formatNumberString:gg,expandTemplateText:function(m,k){do{var f=m.indexOf("{"),e=m.indexOf("}");if(0<=f&&0<=e){var b=m.substring(0,f);var h=m.substring(e+1);m=m.substring(f+1,e);m=(f=k[m])?ee(f):"[MISSING template value for "+
m+"]";m=b+m+h;b=!0}else b=!1}while(b);return m},randomizeList:Ld,randomInList:ee,pickRandomInList:ee,randomIndexInList:Uf,randomInRange:function(m,k){return Math.random()*(k-m)+m},randomIntInRange:function(m,k){return Math.round(Math.random()*(k-m))+m},randomIndexInWeightedList:Vf,randomInWeightedList:function(m,k,f){return m[Vf(m,k,f)]},pickRandomInWeightedList:ee,Timer:Lb,timerUpdater:ge,loadXMLAsync:function(m,k,f){var e=new XMLHttpRequest;e.onload=function(b){4===e.readyState&&(200===e.status||
0===e.status&&""===e.statusText)?k(!0,e.responseText,f):(z.log("error loading "+m+" : "+e.statusText),k(!1,null,f))};e.open("GET",ac(m),!0);f&&f["content-type"]&&e.setRequestHeader("Content-type",f["content-type"]);e.send()},loadXMLDoc:function(m){var k=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");k.open("GET",ac(m),!1);k.send();return k.responseXML},loadJSONObject:function(m){var k=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");
k.open("GET",ac(m),!1);k.send();return JSON.parse(k.responseText)},loadJSONObjectAsync:function(m,k){var f=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");f.onload=function(e){if(4===f.readyState&&(200===f.status||0===f.status&&""===f.statusText)){e=!0;try{var b=JSON.parse(f.responseText)}catch(n){e=!1;var h=n}k(e,b,h)}else z.log("error loading "+m+" : "+f.statusText),k(!1,null)};f.open("GET",ac(m),!0);f.send()},restGetJSONAsync:function(m,k){var f=window.XMLHttpRequest?
new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");f.onload=function(e){if(4===f.readyState&&(200===f.status||0===f.status&&""===f.statusText)){e=!0;try{var b=JSON.parse(f.responseText)}catch(n){e=!1;var h=n}k(e,b,h)}else z.log("error reading rest json "+m+" : "+f.statusText),k(!1,null)};f.open("GET",m,!0);f.setRequestHeader("Content-type","application/json");f.send()},loadCSS:function(m,k){if(!document.getElementById(k)){var f=document.createElement("link");f.setAttribute("id",k);f.setAttribute("rel",
"stylesheet");f.setAttribute("type","text/css");f.setAttribute("href",m);f.setAttribute("media","all");document.getElementsByTagName("head")[0].appendChild(f)}},unloadCSS:function(m){(m=document.getElementById(m))&&m.parentNode.removeChild(m)},isCSSLoaded:function(m){return!!document.getElementById(m)},loadResources:jg,loadScripts:function(m,k,f){k||(k=void 0);Array.isArray(m)||(m=[m]);var e=!0;f&&void 0!==f.async&&(e=f.async||!1);var b=f=Mc.length,h;for(h=0;h<m.length;h++)0<=Oe(m[h])?z.logWarning("warning:  already loaded script "+
m[h]):Mc[b++]={filename:m[h],state:"none",type:"script",clientCallback:k};for(h=f;h<b;h++)ig(Mc[h].filename,e,Ne)},loadJSON:Le,loadXML:kg,getResource:Me,scriptIndex:Oe,dynamicLoadCompleteCallback:Ne,allScriptsAreLoaded:function(){return hg===Mc.length?!0:!1},Preloader:gc,stringManager:fa}),Ya={adPlaying:!1,curAdInfo:null,curAdTimer:null,messages:{}};fd.eventify(Ya.messages);Ya.messageType={AdsAvailable:"adsAvailable",AdsUnavailable:"adsUnavailable",AdOpened:"adOpened",AdCompleted:"adCompleted",AdAbandoned:"adAbandoned"};
Ya.adsAvailable=function(){return!0};Ya.onAdCompleted=function(m){Ya.adPlaying=!1;Ya.curAdInfo=null;Ya.curAdTimer=null;Ya.messages.emit("adCompleted",m)};Ya.onAdAbandoned=function(m){Ya.adPlaying=!1;Ya.curAdTimer&&Ya.curAdTimer.endAutoUpdate();Ya.curAdInfo=null;Ya.curAdTimer=null;Ya.messages.emit("adAbandoned",m)};Ya.getAdPlaying=function(){return Ya.adPlaying?(Ya.curAdInfo.time=Ya.curAdTimer?Ya.curAdTimer.currentTime:0,Ya.curAdInfo):null};Ya.openAd=function(){Ya.adPlaying=!0;Ya.curAdInfo={id:0};
z.log("fake ad: start");var m=new Lb(function(){z.log("fake ad: complete.");Ya.onAdCompleted(Ya.curAdInfo)},2,null);m.autoUpdate();Ya.curAdTimer=m;return Ya.curAdInfo};Ya.abandonAd=function(){if(Ya.adPlaying&&Ya.curAdInfo)Ya.onAdAbandoned(Ya.curAdInfo)};Ya.renderFrame=function(m){};var ng=function(m,k){this.rawData=m;k&&(this.id=k.id,this.gamerTag=k.gamerTag,this.isSignedIn=k.isSignedIn||!1,this.userImageSource=k.userImageSource,this.friendsList=k.friendsList)},Nd=function(){this.list=[];this.byId=
{};this.length=0};Nd.prototype.addUser=function(m){this.list.push(m);this.length=this.list.length;return this.byId[m.id]=m};Nd.prototype.add=function(m,k){m=new ng(m,k);return this.addUser(m)};Nd.prototype.at=function(m){return this.list[m]};var bb={messages:{}};fd.eventify(bb.messages);var og={ActiveUserChanged:"activeUserChanged",SignIn:"signIn",SignOut:"signOut",InfoChange:"infoChange",SigninUIClosed:"signinUIClosed",ControllerBindingChanged:"controllerBindingChanged",FriendsInfoAvailable:"friendsInfoAvailable",
AchievementInfoAvailable:"achievementInfoAvailable"};bb.messageType=og;bb.SigninUIOps={NoGuests:"",AllowGuests:"allowGuests",AllowOnlyDistinctControllerTypes:"allowOnlyDistinctControllerTypes"};var kd=void 0,Se=void 0;bb._internal={UserList:Nd,User:ng,isSigninUIShowing:!1};bb.userIDFromControllerID=function(m){return"keyboard"===m||"mouse"===m?bb.getUsers().at(0).id:0};bb.controllerIDFromUserID=function(m){return 0};bb.getUsers=function(){return Se};bb.requestFriendsInfo=function(m){};bb.showSigninUI=
void 0;bb.isSigninUIShowing=function(){return bb._internal.isSigninUIShowing};bb.getUser=function(m){return bb.getUsers().byId[m]};bb.clearActiveUser=function(m){bb.setActiveUser(void 0,m)};bb.setActiveUser=function(m,k){k=k||{};void 0!==m&&void 0!==m.id&&(m=m.id);var f;if((f=void 0!==m?void 0===kd||kd.id!==m:void 0!==kd)||k.force)k=kd,kd=void 0!==m?bb.getUser(m):void 0,f&&bb.messages.emit(og.ActiveUserChanged,kd,k)};bb.getActiveUser=function(){return kd};bb.getActiveUserID=function(){return(bb.getActiveUser()||
{}).id||0};bb.getActiveUserName=function(){return(bb.getActiveUser()||{}).gamerTag||""};bb.getActiveUserImageSource=function(){return(bb.getActiveUser()||{}).userImageSource||void 0};bb.init=function(){Se=new Nd;(function(){var m={id:-1,gamerTag:"Fake Player 1",isGuest:!1,isSignedIn:!0,userImageSource:null,friendsList:null},k=Se.add(m,m);bb.setActiveUser(k);bb.messages.emit(bb.messageType.InfoChange,k);window.setTimeout(function(){k.userImageSource="https://upload.wikimedia.org/wikipedia/commons/3/38/%22Cabeza_de_mujer%22.JPG";
bb.messages.emit(bb.messageType.InfoChange,k)},1E3)})()};var vb={osIsLicensed:!1,forceLicenseTo:void 0},ie=[{identifier:"frogbuddy",name:"Frog Buddy",description:"A frog buddy that will be your best friend forever",uses:0},{identifier:"acorn1",name:"Acorn",description:"A consumable acorn",uses:1}],Yc=[],Rg=1;vb.isOwned=function(){return void 0!==vb.forceLicenseTo?vb.forceLicenseTo:vb.osIsLicensed};var Te=!1;vb.onLicenseChange=function(){var m=vb.isOwned();Te!==m&&(Ga.fire("licenseChanged",m,Te),Te=
m)};vb.forceLicenseState=function(m){vb.forceLicenseTo=m;vb.onLicenseChange()};vb.unforceLicenseState=function(){vb.forceLicenseState(void 0)};vb.launchPurchaseUI=function(m){m=m||bb.getActiveUserID();vb._OSPurchaseUI(m)};vb.purchaseItem=function(m,k,f){(new Lb(function(){for(var e=0;e<ie.length;e++)if(ie[e].identifier===m[0]){Yc.push({id:Rg++,identifier:ie[e].identifier,data:k,remaining_uses:ie[e].uses});z.log("rat.license: fake purchase succeeded");f({success:!0});return}z.log("rat.license: fake purchase failed");
f({success:!1})},.2,null)).autoUpdate()};vb.getUserItemList=function(m,k){(new Lb(function(f){z.log("rat.license: delayed fake item list callback");k({success:!0,data:Yc})},.2,null)).autoUpdate()};vb.consumeItem=function(m,k){(new Lb(function(f){for(f=0;f<Yc.length;f++)if(Yc[f].id===m){z.log("rat.license: delayed fake item consume "+m);0==Yc[f].remaining_uses?k({success:!1}):(Yc[f].remaining_uses--,0>=Yc[f].remaining_uses&&Yc.splice(f,1));k({success:!0,id:m});return}k({success:!1})},.2,null)).autoUpdate()};
vb.consumeItemType=function(m,k,f){1<k?z.log("rat.license: error: consumeItemType doesn't support count other than 1"):vb.getUserItemList(null,function(e){if(e.success)for(var b=0;b<e.data.length;b++)if(e.data[b].identifier===m){vb.consumeItem(e.data[b].id,f);return}f({success:!1})})};vb._OSPurchaseUI=function(m){function k(){vb.osIsLicensed=!0;vb.onLicenseChange()}if(window.confirm)1==window.confirm("Buy the game?")&&k();else if(sa.windows&&sa.winJS){m=new Windows.UI.Popups.MessageDialog("Buy the game?");
var f=new Windows.UI.Popups.UICommand("Yes",k);f.Id=0;m.commands.append(f);f=new Windows.UI.Popups.UICommand("No",function(){});f.Id=1;m.commands.append(f);m.defaultCommandIndex=0;m.cancelCommandIndex=1;m.showAsync()}};var je=Y.sqrt(3),Sg=je/2,oa=function f(k){k=tb(k);k.colCount=k.colCount||1;k.rowCount=k.rowCount||1;k.sideSize=k.sideSize||1;k.vScale=k.vScale||1;this.config=k;this.pointyStyle=!0;"undefined"!==typeof k.style&&(this.pointyStyle="pointy"===k.style);this.size=k.sideSize;this.vScale=k.vScale;
this.hexHeight=2*this.size*this.vScale;this.hexWidth=je/2*this.size*2;var e=0;this.data=[];for(var b=0;b<k.rowCount;b++){var h=[];this.data[b]=h;h.offset=-Y.floor(b/2);for(h=0;h<k.colCount;h++)this.data[b][h]={value:void 0,blocking:{main:f.noBlocking},debugStyle:void 0,id:e++}}};oa.direction={right:0,upRight:1,upLeft:2,left:3,downLeft:4,downRight:5};var wd=oa.oppositeDirection={};wd[oa.direction.right]=oa.direction.left;wd[oa.direction.upRight]=oa.direction.downLeft;wd[oa.direction.upLeft]=oa.direction.downRight;
wd[oa.direction.left]=oa.direction.right;wd[oa.direction.downLeft]=oa.direction.upRight;wd[oa.direction.downRight]=oa.direction.upLeft;var xd=oa.sideDirections={};xd[oa.direction.right]=[oa.direction.upRight,oa.direction.downRight];xd[oa.direction.upRight]=[oa.direction.upLeft,oa.direction.right];xd[oa.direction.upLeft]=[oa.direction.upRight,oa.direction.left];xd[oa.direction.left]=[oa.direction.upLeft,oa.direction.downLeft];xd[oa.direction.downLeft]=[oa.direction.left,oa.direction.downRight];xd[oa.direction.downRight]=
[oa.direction.downLeft,oa.direction.right];oa.deltaToDirection={"-1":{0:oa.direction.left,1:oa.direction.downLeft},0:{"-1":oa.direction.upLeft,1:oa.direction.downRight},1:{0:oa.direction.right,"-1":oa.direction.upRight}};oa.neighbors=[{delta:{q:1,r:0}},{delta:{q:1,r:-1}},{delta:{q:0,r:-1}},{delta:{q:-1,r:0}},{delta:{q:-1,r:1}},{delta:{q:0,r:1}}];oa.neighbors2=[{delta:{q:2,r:0}},{delta:{q:2,r:-1}},{delta:{q:2,r:-2}},{delta:{q:1,r:-2}},{delta:{q:0,r:-2}},{delta:{q:-1,r:-1}},{delta:{q:-2,r:0}},{delta:{q:-2,
r:1}},{delta:{q:-2,r:2}},{delta:{q:-1,r:2}},{delta:{q:0,r:2}},{delta:{q:1,r:1}}];oa.fullBlocking=-1;oa.noBlocking=0;oa.prototype.inBounds=function(k,f){if(0>f||f>=this.data.length)return!1;f=this.data[f];k-=f.offset;return 0>k||k>=f.length?!1:!0};oa.prototype.forEachHex=function(k,f){f={hexGrid:this,userData:f};for(var e=0;e<this.data.length;e++){f.r=e;for(var b=this.data[e],h=0;h<b.length;h++)f.q=h+b.offset,f.entry=b[h],f.value=f.entry.value,k(f)}};oa.distance=function(k,f,e,b){return(Y.abs(k-e)+
Y.abs(k+f-e-b)+Y.abs(f-b))/2};oa.prototype.distance=oa.distance;oa.isNeighbor=function(k,f,e,b,h){h||(h=1);return this.distance(k,f,e,b)<=h};oa.prototype.isNeighbor=oa.isNeighbor;oa.prototype.forEachNeighbor=function(k,f,e,b,h,n,t){b={hexGrid:this,userData:b};k=this.getNeighbors(k,f,h,n,t);for(f=0;f<k.length;f++)h=k[f].q,n=k[f].r,this.inBounds(h,n)&&(t=this.data[n],b.entry=t[h-t.offset],b.value=b.entry.value,b.q=h,b.r=n,e(b))};oa.prototype.getEntryAt=function(k,f){k|=0;f|=0;if(this.inBounds(k,f))return f=
this.data[f],f[k-f.offset]};oa.prototype.setValueAt=function(k,f,e){if(k=this.getEntryAt(k,f))return k.value=e,!0};oa.prototype.clearValueAt=function(k,f){return this.setValueAt(k,f,void 0)};oa.prototype.getValueAt=function(k,f){if(k=this.getEntryAt(k,f))return k.value};oa.prototype.setAllValues=function(k){this.forEachHex(function(f){f.entry.value=k})};oa.prototype.clearAllValues=function(){this.setAllValues(void 0)};oa.prototype.setBlockingAt=function(k,f,e,b){if(k=this.getEntryAt(k,f))return void 0===
e&&(e=oa.fullBlocking),void 0===b&&(b="main"),k.blocking[b]=e,!0};oa.prototype.getBlockingAt=function(k,f,e){if(k=this.getEntryAt(k,f))return void 0===e&&(e="main"),k.blocking[e]};oa.prototype.clearBlockingAt=function(k,f,e){return this.setBlockingAt(k,f,oa.noBlocking,e)};oa.prototype.setDebugStyleAt=function(k,f,e){if(k=this.getEntryAt(k,f))return k.debugStyle=e,!0};oa.prototype.clearDebugStyleAt=function(k,f){return this.setDebugStyleAt(k,f,void 0)};oa.prototype.setAllDebugStyles=function(k){this.forEachHex(function(f){f.entry.debugStyle=
k})};oa.prototype.clearAllDebugStyles=function(){this.setAllDebugStyles(void 0)};oa.prototype.getNeighbors=function(k,f,e,b,h){var n=!0===e?"main":e;void 0===b&&(b=!1);void 0===h&&(h=1);var t=oa.neighbors;2===h&&(t=oa.neighbors2);h=[];for(var v=0;v<t.length;v++){var q=k+t[v].delta.q,r=f+t[v].delta.r,B=this.getEntryAt(q,r);B&&(e&&B.blocking[n]===oa.fullBlocking||h.push({q,r,entry:B}))}b&&(e=this.getEntryAt(k,f),h.push({q:k,r:f,entry:e}));return h};oa.prototype.isValidNeighbor=function(k,f,e,b,h,n){if(k===
e&&f===b)return!!n;n=!0===h?"main":h;for(var t=0;t<oa.neighbors.length;t++){var v=k+oa.neighbors[t].delta.q,q=f+oa.neighbors[t].delta.r;if(v===e&&q===b){k=this.getEntryAt(v,q);if(!k)break;if(h&&k.blocking[n]===oa.fullBlocking)break;return!0}}return!1};oa.prototype.isEdgeHex=function(k,f,e){var b=oa.neighbors;2===(e||1)&&(b=oa.neighbors2);for(e=0;e<b.length;e++)if(!this.getEntryAt(k+b[e].delta.q,f+b[e].delta.r))return!0;return!1};oa.prototype.mergeHexList=function(k,f){for(var e=0;e<f.length;e++){for(var b=
!1,h=0;h<k.length;h++)if(k[h].q===f[e].q&&k[h].r===f[e].r){b=!0;break}b||k.push(f[e])}return k};oa.prototype.axialToPixelPos=function(k,f){return this.pointyStyle?{x:this.size*je*(k+f/2),y:this.size*this.vScale*3/2*f}:{x:3*this.size/2*k,y:this.size*this.vScale*je*(f+k/2)}};oa.prototype.posToPixelPos=oa.prototype.axialToPixelPos;oa.prototype.pixelPosToHex=function(k,f){k/=this.hexWidth;var e=(f+this.size*this.vScale)/(this.hexHeight/2);f=Y.floor(k+e);e=Y.floor((Y.floor(e-k)+f)/3);return{q:Y.floor((Y.floor(2*
k+1)+f)/3)-e,r:e}};oa.prototype.columnRowToAxial=function(k,f){return{q:k+this.data[f].offset,r:f}};oa.prototype.getXYDataBounds=function(){for(var k=0,f=0;f<this.data.length;f++){var e=this.data[f];e=e.length+e.offset+f/2|0;e>k&&(k=e)}return{x:0,y:0,w:k,h:this.data.length}};oa.prototype.sortListByXYDistance=function(k,f,e){f=this.axialToPixelPos(f,e);for(e=0;e<k.length;e++){var b=this.axialToPixelPos(k[e].q,k[e].r),h=b.x-f.x;b=b.y-f.y;k[e].dist2=h*h+b*b}return k.sort(function(n,t){return n.dist2-
t.dist2})};oa.prototype.getScaledAngles=function(){for(var k=[],f=0;6>f;f++){var e=2*Math.PI-f*Math.PI/3,b=Math.cos(e),h=Math.sin(e)*this.vScale,n=Math.atan2(h,b);e+=2*Math.PI/12;b=Math.cos(e);h=Math.sin(e)*this.vScale;for(e=Math.atan2(h,b);0>n;)n+=2*Math.PI;for(;e<n;)e+=2*Math.PI;k.push({angle:n,halfArc:e-n})}return k};oa.prototype.directionIndexFromVector=function(k){for(k=Math.atan2(k.y/this.vScale,k.x);0>k;)k+=2*Math.PI;for(var f=2*Math.PI/12,e=0;6>e;e++)if(k>=2*Math.PI-e*Math.PI/3-f)return e;
return 0};oa.prototype.findPath=function(k){function f(u){for(;u!==k.startID;){var A=k.visited[u];k.path.unshift({q:A.q,r:A.r});u=k.visited[u].fromID}k.frontier=void 0;k.visited=void 0;k.totalCost=H;k.valid=!0;return k.done=!0}k.cycles=k.cycles||-1;if(!k.frontier||k.done){k.path=[];k.settings||(k.settings={});k.done=!1;k.valid=!1;var e=this.getEntryAt(k.start.q,k.start.r);if(!e)return k.valid=!1,k.done=!0;k.startID=e.id;if(k.start.q===k.end.q&&k.start.r===k.end.r)return k.valid=!0,k.done=!0;k.frontier=
[];k.frontier.push({q:k.start.q,r:k.start.r,id:e.id,priority:0});k.visited={};k.visited[e.id]={q:k.start.q,r:k.start.r,fromID:-1,cost:0};k.closest=k.findClosest?{dist:99999999,id:e.id,pos:{q:k.start.q,r:k.start.r}}:null;void 0===k.blockingSet&&(k.blockingSet="main");k.done=!1}e=null;for(var b=-1,h=0;(-1===k.cycles||h<k.cycles)&&k.frontier.length;){var n=k.frontier[0];k.frontier.splice(0,1);var t=k.visited[n.id];if(e&&t.cost>=e.cost)return f(b);var v=this.getNeighbors(n.q,n.r,k.blockingSet);k.settings.prioritizeXYDistance&&
(v=this.sortListByXYDistance(v,k.end.q,k.end.r));for(var q=0;q<v.length;q++){var r=v[q],B=this.getEntryAt(r.q,r.r),H=t.cost+B.blocking[k.blockingSet],G=0;k.transitionCostFunction&&(G=k.transitionCostFunction(this,n,r),H+=G);if(G!==oa.fullBlocking&&(!k.visited[B.id]||H<k.visited[B.id].cost)){G={q:r.q,r:r.r,id:B.id,priority:H};for(var K=0;K<k.frontier.length&&!(H<k.frontier[K].priority);K++);k.frontier.splice(K,0,G);k.visited[B.id]={fromQ:n.q,fromR:n.r,fromID:n.id,q:r.q,r:r.r,cost:H};if(r.q===k.end.q&&
r.r===k.end.r){if(!k.transitionCostFunction)return f(B.id);if(!e||H<e.cost)e=k.visited[B.id],b=B.id}k.findClosest&&(G=oa.distance(r.q,r.r,k.end.q,k.end.r),G<k.closest.dist&&(k.closest.totalCost=H,k.closest.dist=G,k.closest.pos={q:r.q,r:r.r},k.closest.id=B.id))}}h++}if(k.frontier.length)return!1;if(e)return f(b);if(k.findClosest)for(e=k.closest.id;e!==k.startID;)b=k.visited[e],k.path.unshift({q:b.q,r:b.r}),e=k.visited[e].fromID;k.frontier=void 0;k.visited=void 0;k.valid=!1;return k.done=!0};oa.prototype.getFloodFillDetails=
function(k,f,e,b,h){e=e||{};var n={blockingSet:"main"};e&&void 0!==e.blockingSet&&(n.blockingSet=e.blockingSet);var t=this.getEntryAt(k,f),v=t.blocking[n.blockingSet];n.startID=t.id;n.frontier=[];n.frontier.push({q:k,r:f,id:t.id});n.visited={};n.visited[t.id]={q:k,r:f};n.visitedCount=1;for(k={hexGrid:this,userData:h};n.frontier.length;)for(f=n.frontier[0],n.frontier.splice(0,1),h=this.getEntryAt(f.q,f.r),k.entry=h,k.q=f.q,k.r=f.r,k.value=k.entry.value,b&&b(k),h=this.getNeighbors(f.q,f.r),t=0;t<h.length;t++){var q=
h[t],r=this.getEntryAt(q.q,q.r);if(!n.visited[r.id]){var B=r.blocking[n.blockingSet],H=0;e.transitionCostFunction&&(H=e.transitionCostFunction(this,f,q),B+=H);H!==oa.fullBlocking&&B===v&&(n.frontier.push({q:q.q,r:q.r,id:r.id}),n.visited[r.id]={q:q.q,r:q.r},n.visitedCount++)}}return n};oa.prototype.floodFill=function(k,f,e,b,h){return this.getFloodFillDetails(k,f,e,b,h).visitedCount};oa.prototype.loadLayersFromData=function(k,f,e){var b=k.layers;b&&this.forEachHex(function(h){for(var n=[],t=!1,v=h.r,
q=h.q+Y.floor(h.r/2),r=0;r<b.length;r++){var B=b[r],H=B.data,G=B.width,K=B.height,u=v*G+q;q<G&&v<K&&"tilelayer"===B.type&&H&&void 0!==H[u]&&(n[r]=H[u],t=!0)}t&&(f?(h.layerData=n,f(h)):(h.entry.value&&"object"===typeof h.entry.value||(h.entry.value={}),h.entry.value={layerData:n}))})};oa.prototype.trim=function(k){function f(K,u,A){n.q=K;n.r=u;n.entry=A;n.value=A.value;n.neighbors=b.getNeighbors(K,u,!1,!1,1);n.neighbors2=b.getNeighbors(K,u,!1,!1,2);return k.removable(n)}function e(K,u){for(var A=0;A<
u.length;A++)if(!f(A+u.offset,K,u[A]))return!1;return!0}for(var b=this,h={trimmed:{top:0,bottom:0,left:0,right:0}},n={},t=99999999,v=99999999,q=0;q<this.data.length;q++)if(e(q,this.data[q]))this.data.splice(q,1),q--,h.trimmed.top++;else break;q=(h.trimmed.top+1)/2|0;for(var r=this.data.length-1;0<=r;r--)this.data[r].offset+=q;for(q=this.data.length-1;0<=q;q--)if(e(q,this.data[q]))this.data.splice(q,1),h.trimmed.bottom++;else break;for(q=this.data.length-1;0<=q;q--){r=this.data[q];for(var B=!0,H=0,
G=0;G<r.length;G++)if(f(G+r.offset,q,r[G]))H++;else{B=!1;break}if(!B){B=0;for(G=r.length-1;0<=G;G--)if(f(G+r.offset,q,r[G]))B++;else break;B&&r.splice(r.length-B,B);v=Math.min(B,v);H&&(r.splice(0,H),r.offset+=H);t=Math.min(H,t)}}h.trimmed.left=t;for(q=this.data.length-1;0<=q;q--)this.data[q].offset-=t;h.trimmed.right=v;return h};oa.prototype.makeHexContextPath=function(k,f,e,b){b=b||0;e=this.axialToPixelPos(f,e);f=e.x;e=e.y;var h=this.hexHeight,n=this.hexWidth;b*=this.vScale;var t=b*Sg,v=.5*b;k.beginPath();
k.moveTo(f+t-n/2,e+v-h/4);k.lineTo(f,e+b-h/2);k.lineTo(f-t+n/2,e+v-h/4);k.lineTo(f-t+n/2,e-v+h/4);k.lineTo(f,e-b+h/2);k.lineTo(f+t-n/2,e-v+h/4);k.closePath()};oa.prototype.strokeOneHex=function(k,f,e,b){this.makeHexContextPath(k,f,e,b);k.stroke()};oa.prototype.fillOneHex=function(k,f,e,b){this.makeHexContextPath(k,f,e,b);k.fill()};oa.prototype.drawGrid=function(k){for(var f=0;f<this.data.length;f++)for(var e=this.data[f].offset,b=0;b<this.data[f].length;b++){var h=b+e,n=f;this.strokeOneHex(k,h,n);
var t=this.getEntryAt(h,n);t.debugStyle&&(k.fillStyle=t.debugStyle,this.fillOneHex(k,h,n))}};var sb=function(){this.nodes=[];this.mapCenter=new za(0,0);this.mapSize=new za(1,1);this.config=null;this.fillDefaultConfig()};sb.debug={nodeColors:"red yellow green cyan blue violet orange".split(" "),NODE_COLOR_COUNT:7};sb.prototype.fillDefaultConfig=function(){this.config||(this.config={});var k={rng:Math,targetNodeCount:50,linkFromCurrent:3,attemptsAtNearSpace:5,nearSpaceDist:3,nearSpaceBias:new za(0,
0),maxTargetNewLinks:2,maxNearNodesToTry:4,maxNearNodeDistance:4,minNearNodeDistance:0,maxLinkGenerationGap:-1,maxLinksFromNode:99,maxLinksFromFirst:1,maxLinksFromLast:1,stuckAction:"backtrack",tightenLeaves:!1,tightenLinks:!1,addRandomJitter:!0,adjustToTopLeft:!1},f;for(f in k)"undefined"===typeof this.config[f]&&(this.config[f]=k[f])};sb.prototype.setConfig=function(k){this.config=k;this.fillDefaultConfig()};sb.prototype.checkLineNearNodes=function(k,f,e,b,h,n){k={x:k,y:f};e={x:e,y:b};for(b=0;b<
this.nodes.length;b++)if(b!==h&&b!==n&&.2>ff(this.nodes[b].pos,k,e))return!0;return!1};sb.prototype.checkNodeNearLines=function(k,f,e){void 0===e&&(e=-1);k={x:k,y:f};for(f=0;f<this.nodes.length;f++)if(f!==e)for(var b=this.nodes[f],h=0;h<b.links.length;h++){var n=b.links[h];if(n!==e&&.2>ff(k,b.pos,this.nodes[n].pos))return!0}return!1};sb.prototype.checkUsedSpace=function(k,f){for(var e=0;e<this.nodes.length;e++)if(this.nodes[e].pos.x===k&&this.nodes[e].pos.y===f)return!0;return!1};sb.prototype.getTooNearNode=
function(k,f,e,b){void 0===b&&(b=-1);e*=e;for(var h=0;h<this.nodes.length;h++)if(h!==b){var n=this.nodes[h].pos.x-k,t=this.nodes[h].pos.y-f;if(n*n+t*t<e)return h}return-1};sb.prototype.checkIntersects=function(k,f,e,b,h){for(var n=0;n<this.nodes.length;n++)for(var t=this.nodes[n],v=0;v<t.links.length;v++){var q=t.links[v];if(q!==h&&q>n){var r=this.nodes[q];q=t.pos.x;var B=t.pos.y,H=r.pos.x,G=r.pos.y;r=(G-B)*(e-k)-(H-q)*(b-f);0===r?q=!1:(H=((H-q)*(f-B)-(G-B)*(k-q))/r,q=((e-k)*(f-B)-(b-f)*(k-q))/r,
q=0<H&&1>H&&0<q&&1>q?!0:!1);if(q)return!0}}return!1};sb.prototype.getNearNodeIndices=function(k,f){k=this.nodes[k];k.distSq=0;for(var e=[],b=0;b<this.nodes.length;b++){var h=this.nodes[b];h.index=b;h.distSq=h.pos.distanceSqFrom(k.pos);0<=f&&Math.abs(k.generation-h.generation)>f||(e[e.length]=h)}e.sort(function(n,t){return n.distSq-t.distSq});return e};sb.prototype.linkNodes=function(k,f){this.nodes[k].links[this.nodes[k].links.length]=f;this.nodes[f].links[this.nodes[f].links.length]=k};sb.prototype.nodesHaveLink=
function(k,f){for(var e=0;e<this.nodes[k].links.length;e++)if(this.nodes[k].links[e]===f)return!0;return!1};sb.prototype.getLinkIndex=function(k,f){for(var e=0;e<this.nodes[k].links.length;e++)if(this.nodes[k].links[e]===f)return e;return-1};sb.prototype.linkNearNodes=function(k,f){f=Math.floor(this.config.rng.random()*(f+1));if(0!==f)for(var e=this.nodes[k],b=this.getNearNodeIndices(k,this.config.maxLinkGenerationGap),h=this.config.maxNearNodesToTry,n=this.config.maxNearNodeDistance,t=this.config.minNearNodeDistance,
v=1;v<=h&&v<b.length&&0<f&&e.links.length<this.config.maxLinksFromNode;v++){var q=b[v];!(q.links.length<this.config.maxLinksFromNode&&q.distSq>=t&&q.distSq<n)||this.nodesHaveLink(k,q.index)||this.checkIntersects(q.pos.x,q.pos.y,e.pos.x,e.pos.y)||this.checkLineNearNodes(q.pos.x,q.pos.y,e.pos.x,e.pos.y,k,q.index)||0===q.index&&q.links.length>=this.config.maxLinksFromFirst||(this.linkNodes(k,q.index),f--)}};sb.prototype.addRandomMapJitter=function(){for(var k=this.config.rng,f=0;f<this.nodes.length;f++)this.nodes[f].pos.x+=
.2*k.random()-.1,this.nodes[f].pos.y+=.2*k.random()-.1};sb.prototype.tightenLeaf=function(k){for(var f=this.nodes[k],e=this.nodes[f.links[0]],b=f.pos.x-e.pos.x,h=f.pos.y-e.pos.y,n=Math.sqrt(b*b+h*h);2<=n;){var t=n-1;b*=t/n;h*=t/n;n=e.pos.x+b;var v=e.pos.y+h;if(this.checkNodeNearLines(n,v,k)||0<=this.getTooNearNode(n,v,1,k))break;f.pos.x=n;f.pos.y=v;n=t}};sb.prototype.findConnected=function(k,f,e){var b=[k];for(e.links.push(k);0<b.length;){for(var h=this.nodes[b[0]],n=0;n<h.links.length;n++){var t=
h.links[n];t!==k&&(t===f?e.hitSkipCount++:0>e.links.indexOf(t)&&(e.links.push(t),b.push(t)))}b.shift()}return e};sb.prototype.tightenOneLink=function(k,f){var e=this.nodes[k],b=this.nodes[f],h=this.mapCenter,n=e.pos.x-h.x,t=e.pos.y-h.y,v=b.pos.x-h.x;h=b.pos.y-h.y;n*n+t*t>v*v+h*h&&(n=k,k=f,f=n,e=this.nodes[k],b=this.nodes[f]);n=b.pos.x-e.pos.x;t=b.pos.y-e.pos.y;v=Math.sqrt(n*n+t*t);e=!1;b=[];1<v&&(h={links:b,hitSkipCount:0},this.findConnected(f,k,h),1<h.hitSkipCount&&(b=[b[0]]));n=n/v*.5;for(t=t/v*
.5;1<v;){k=[];for(f=0;f<b.length;f++)h=this.nodes[b[f]],k[f]={x:h.pos.x,y:h.pos.y},h.pos.x-=n,h.pos.y-=t;for(f=0;f<this.nodes.length;f++){var q=this.nodes[f];h=this.getTooNearNode(q.pos.x,q.pos.y,.99,f);if(q=this.checkNodeNearLines(q.pos.x,q.pos.y,f)||0<=h)break}if(q){for(q=0;q<b.length;q++)f=this.nodes[b[q]],f.pos.x=k[q].x,f.pos.y=k[q].y;break}v-=.5;e=!0}return e};sb.prototype.tightenLinks=function(){this.recalcBounds();var k=1;do{var f=!1;for(var e=0;e<this.nodes.length;e++)for(var b=this.nodes[e],
h=0;h<b.links.length;h++){var n=b.links[h];n>e&&(f=this.tightenOneLink(e,n)||f)}if(f&&(k++,4<k))break}while(f)};sb.prototype.build=function(){this.nodes=[];this.nodes[0]={pos:new za(0,0),links:[],colorIndex:0,generation:0,main:!0,leaf:!1};for(var k=0,f=1,e=0;this.nodes.length<this.config.targetNodeCount;e++){var b=this.nodes[k].pos.x,h=this.nodes[k].pos.y,n=k,t=0,v=this.config.linkFromCurrent,q=this.nodes[k].links.length;this.config.maxLinksFromFirst<v+q&&0===k&&(v=this.config.maxLinksFromFirst-q);
this.config.maxLinksFromNode<v+q&&(v=this.config.maxLinksFromNode-q);for(q=0;q<v;q++){for(var r=0;r<this.config.attemptsAtNearSpace;r++){var B=b+Math.floor(this.config.rng.random()*this.config.nearSpaceDist*2)-this.config.nearSpaceDist+this.config.nearSpaceBias.x,H=h+Math.floor(this.config.rng.random()*this.config.nearSpaceDist*2)-this.config.nearSpaceDist+this.config.nearSpaceBias.y;if(!(0===B&&0===H||this.checkUsedSpace(B,H)||this.checkIntersects(b,h,B,H,k)||this.checkLineNearNodes(b,h,B,H,k)||
this.checkNodeNearLines(B,H))){t={pos:new za(B,H),links:[],colorIndex:Math.floor(this.config.rng.random()*sb.debug.NODE_COLOR_COUNT),generation:f,main:!1,leaf:!1};this.nodes[this.nodes.length]=t;this.linkNodes(k,this.nodes.length-1);t=this.nodes.length-1;this.nodes[k].main=!0;r=this.config.maxTargetNewLinks;this.nodes.length>=this.config.targetNodeCount&&this.config.maxLinksFromLast-1<r&&(r=this.config.maxLinksFromLast-1);r&&this.linkNearNodes(this.nodes.length-1,r);break}}if(this.nodes.length>=this.config.targetNodeCount)break}t&&
(k=t);if(k===n){if("random"===this.config.stuckAction)k=Math.floor(this.config.rng.random()*this.nodes.length);else if("backtrack"===this.config.stuckAction){if(k--,1>=k)break}else break;f=this.nodes[k].generation}f++}this.nodes[this.nodes.length-1].main=!0;for(k=0;k<this.nodes.length;k++)e=this.nodes[k],1===e.links.length&&(e.leaf=!0),this.config.tightenLeaves&&e.leaf&&this.tightenLeaf(k);this.config.tightenLinks&&this.tightenLinks();this.config.addRandomJitter&&this.addRandomMapJitter();this.recalcBounds();
if(this.config.adjustToTopLeft){e=this.mapCenter.x-this.mapSize.x/2;b=this.mapCenter.y-this.mapSize.y/2;for(k=0;k<this.nodes.length;k++)this.nodes[k].pos.x-=e,this.nodes[k].pos.y-=b;this.mapCenter.x-=e;this.mapCenter.y-=b}this.maxGeneration=f-1};sb.prototype.recalcBounds=function(){for(var k=99999,f=-99999,e=99999,b=-99999,h=0;h<this.nodes.length;h++)this.nodes[h].pos.x<k&&(k=this.nodes[h].pos.x),this.nodes[h].pos.x>f&&(f=this.nodes[h].pos.x),this.nodes[h].pos.y<e&&(e=this.nodes[h].pos.y),this.nodes[h].pos.y>
b&&(b=this.nodes[h].pos.y);this.mapSize.x=f-k;this.mapSize.y=b-e;this.mapLargestSide=this.mapSize.x>this.mapSize.y?this.mapSize.x:this.mapSize.y;this.mapCenter.x=k+this.mapSize.x/2;this.mapCenter.y=e+this.mapSize.y/2};sb.prototype.getBounds=function(){return new ub.Rect(this.mapCenter.x-this.mapSize.x/2,this.mapCenter.y-this.mapSize.y/2,this.mapSize.x,this.mapSize.y)};sb.prototype.draw=function(k,f,e,b){var h,n=(f.w-40)/this.mapSize.x;var t=(f.h-40)/this.mapSize.y;t<n&&(n=t);b&&(n=b);e?(e=f.x+f.w/
2-this.mapCenter.x*n,b=f.y+f.h/2-this.mapCenter.y*n):(e=f.x,b=f.y);tc(k);sc(e,b,k);k.fillStyle="#6040FF";for(h=0;h<this.nodes.length;h++){var v=10;0===h&&(v=20);h===this.nodes.length-1&&(v=20);e=this.nodes[h];b=e.pos.x*n;t=e.pos.y*n;k.fillStyle=sb.debug.nodeColors[e.colorIndex];tc();sc(b,t,k);k.beginPath();k.arc(0,0,v/2,0,2*Math.PI,!0);k.closePath();k.fill();zc();k.font="10px Arial";k.fillStyle="#A0A0A0";k.fillText(h,b+5,t-2)}for(h=0;h<this.nodes.length;h++)for(e=this.nodes[h],b=e.pos.x*n,t=e.pos.y*
n,k.strokeStyle="yellow",v=0;v<e.links.length;v++)if(!(e.links[v]<h)){var q=this.nodes[e.links[v]],r=q.pos.x*n;q=q.pos.y*n;k.beginPath();k.moveTo(b,t);k.lineTo(r,q);k.closePath();k.stroke()}e=this.getBounds();k.strokeStyle="#55FF55";k.strokeRect(e.x*n,e.y*n,e.w*n,e.h*n);zc();k.strokeStyle="#5555FF";k.strokeRect(f.x,f.y,f.w,f.h)};var Gb={},ob={empty:" ",floor:".",hall:"=",entry:"*",exit:"E",temp:"T"};Gb.tileTypes=ob;Gb.settings={mapSize:{x:60,y:60},roomSize:{min:4,max:10},roomCount:{min:10,max:20},
allowCollide:.5,squashRooms:!1,cleanupWalls:!1,addEnterExit:!1,seed:void 0};Gb.generate=function(k){k=k||{};void 0===k.seed&&(k.seed=Y.randomRange(0,999999999)|0);vc(k,[Gb.settings]);var f=new Y.rng.Simple(k.seed),e=[];e.size={x:k.mapSize.x,y:k.mapSize.y};e.seed=k.seed;e.rGen=f;for(var b=0;b<k.mapSize.x;++b){e[b]=[];for(var h=0;h<k.mapSize.y;++h)e[b][h]=ob.empty}h=f.randomRange(k.roomCount.min,k.roomCount.max)|0;b=[];e.rooms=b;for(var n=!1,t=0;t<h;++t){var v=0,q=void 0;do{if(10<=v)break;++v;q={w:f.randomRange(k.roomSize.min,
k.roomSize.max)|0,h:f.randomRange(k.roomSize.min,k.roomSize.max)|0};q.x=f.randomRange(1,k.mapSize.x-q.w-1)|0;q.y=f.randomRange(1,k.mapSize.y-q.h-1)|0;n=!1;f.randomRange(0,1)>k.allowCollide&&(n=Gb.doesCollide(q,b))}while(n);n||(1<q.w&&q.w--,1<q.h&&q.h--,b.push(q))}k.squashRooms&&Gb.SquashRooms(b);h=[b[0]];for(n=1;n<b.length;++n){q=b[n];v=Gb.findClosestRoom(q,h);h[n]=q;t=f.randomRange(q.x,q.x+q.w)|0;q=f.randomRange(q.y,q.y+q.h)|0;var r=f.randomRange(v.x,v.x+v.w)|0;for(v=f.randomRange(v.y,v.y+v.h)|0;r!=
t||v!=q;)r!=t?r>t?r--:r++:v!=q&&(v>q?v--:v++),e[r][v]=ob.hall}for(h=0;h<b.length;++h)for(n=b[h],t=n.x;t<n.x+n.w;t++)for(v=n.y;v<n.y+n.h;v++)e[t][v]=ob.floor;k.cleanupWalls&&(Gb.forEachTile(e,function(K){if(K.current===ob.hall)return(K.l!==ob.empty&&K.l!==ob.temp||K.r!==ob.empty&&K.r!==ob.temp)&&(K.u!==ob.empty&&K.u!==ob.temp||K.d!==ob.empty&&K.d!==ob.temp)?{changeTo:ob.temp}:void 0}),Gb.forEachTile(e,function(K){if(K.current===ob.temp)return{changeTo:ob.floor}}));if(k.addEnterExit){k=!1;h=0;do{k=
!1;for(n=h=0;n<b.length;++n)for(t=b[n],v={x:t.x+t.w/2,y:t.y+t.h/2},q=n+1;q<b.length;++q){r=b[q];var B=Gb.distanceBetween(t,v,r);if(B>h){var H=t;var G=r;h=B}}if(!H||!G){z.log("Num Rooms: "+b.length);z.log("Seed     : "+e.seed);for(k=0;k<b.length;++k)h=b[k],z.log("   "+h.x+","+h.y+" - "+h.w+","+h.h);k=!0}}while(k);H.x+=0;G.x+=0;H={x:f.randomRange(H.x,H.x+H.w)|0,y:f.randomRange(H.y,H.y+H.h)|0};f={x:f.randomRange(G.x,G.x+G.w)|0,y:f.randomRange(G.y,G.y+G.h)|0};e[H.x][H.y]=ob.entry;e[f.x][f.y]=ob.exit;
e.startPoint=H;e.endPoint=f}return e};Gb.doesCollide=function(k,f){k.x+k.width;k.y+k.height;for(var e=0;e<f.length;++e)if(f[e]!==k){var b=f[e];b.x+b.w;b.y+b.h;if(!(k.x+k.w<b.x||k.x>b.x+b.w||k.y+k.h<b.y||k.y>b.y+b.h))return!0}return!1};Gb.squashRooms=function(k){k[0];for(var f=0;10>f;++f)for(var e=0;e<k.length;++e)for(var b=k[e];;){var h=b.x,n=b.y;1<b.x&&b.x--;1<b.y&&b.y--;if(1===b.x&&1===b.y)break;if(Gb.doesCollide(b,k)){b.x=h;b.y=n;break}}};Gb.findClosestRoom=function(k,f){for(var e={x:k.x+k.w/2,
y:k.y+k.h/2},b=f[0],h=Gb.distanceBetween(k,e,f[0]),n=0;n<f.length;n++){var t=f[n],v=Gb.distanceBetween(k,e,t);v<h&&(h=v,b=t)}return b};Gb.distanceBetween=function(k,f,e){f||(f={x:k.x+k.w/2,y:k.y+k.h/2});k=e.y+e.h/2;return Y.abs(f.x-(e.x+e.w/2))+Y.abs(f.y-k)};Gb.forEachTile=function(k,f){for(var e=0;e<k.length;++e)for(var b=k[e],h=0;h<b.length;++h){var n=f({current:k[e][h],l:(k[e-1]||[])[h+0]||ob.empty,r:(k[e+1]||[])[h+0]||ob.empty,u:k[e+0][h-1]||ob.empty,d:k[e+0][h+1]||ob.empty,lu:(k[e-1]||[])[h-
1]||ob.empty,ld:(k[e-1]||[])[h+1]||ob.empty,ru:(k[e+1]||[])[h-1]||ob.empty,rd:(k[e+1]||[])[h+1]||ob.empty});n&&n.changeTo&&(k[e][h]=n.changeTo)}};Gb.dumpToLog=function(k){z.log("MAP Seed:"+k.seed);for(var f=0;f<k.size.y;++f){for(var e="",b=0;b<k.size.x;++b)e+=k[b][f];z.log(e)}};var wb=function(k){this.config=k;this.config.gridWidth=Math.floor(k.worldWidth/k.squareWidth);this.config.gridHeight=Math.floor(k.worldHeight/k.squareHeight);this.world=Array(this.config.gridHeight);this.reinit();this.reservedCount=
0};wb.prototype.reinit=function(){for(var k=0;k<this.config.gridHeight;k++){this.world[k]||(this.world[k]=Array(this.config.gridWidth));for(var f=0;f<this.config.gridWidth;f++)this.world[k][f]=0}};wb.prototype.shiftContents=function(k){if(-1==k.y){k=this.world[this.config.gridHeight-1];for(var f=this.config.gridHeight-1;1<=f;f--)this.world[f]=this.world[f-1];this.world[0]=k;for(k=0;k<this.config.gridWidth;k++)this.world[0][k]=0}else z.logError("ERROR: Placer: we haven't implemented this yet.")};wb.prototype.worldToGrid=
function(k,f){"object"===typeof k&&(f=k.y,k=k.x);var e={};e.gridX=Math.floor(k/this.config.squareWidth);e.gridY=Math.floor(f/this.config.squareHeight);e.valid=0>e.gridX||e.gridX>=this.config.gridWidth||0>e.gridY||e.gridY>=this.config.gridHeight?!1:!0;return e};wb.prototype.gridToWorld=function(k,f){var e={};e.worldX=k*this.config.squareWidth+this.config.squareWidth/2;e.worldY=f*this.config.squareHeight+this.config.squareHeight/2;return e};wb.prototype.validLocation=function(k,f,e){void 0===e&&(e=
0);return k<e||k>=this.config.gridWidth-e||f<e||f>=this.config.gridHeight-e?!1:!0};wb.prototype.reserveOnePlace=function(k,f,e){void 0===e&&(e=this.world[f][k]+1);this.world[f][k]=e;this.reservedCount++;return!0};wb.prototype.getOnePlaceValue=function(k,f){return this.world[f][k]};wb.prototype.releaseOnePlace=function(k,f){"number"===typeof this.world[f][k]?this.world[f][k]--:this.world[f][k]=0;this.reservedCount--;return!0};wb.prototype.isOnePlaceEmpty=function(k,f){return 0==this.world[f][k]};wb.prototype.isOnePlaceEmptyAndValid=
function(k,f){return this.validLocation(k,f)?this.isOnePlaceEmpty(k,f):!1};wb.prototype.actOnBlockOfPlaces=function(k,f,e,b){if(0>k-e||k+e>=this.config.gridWidth||0>f-e||f+e>=this.config.gridHeight||!b.call(this,k,f))return!1;if(0!=e)for(var h=-e;h<=e;h++)for(var n=-e;n<=e;n++)if((0!=n||0!=h)&&!b.call(this,k+n,f+h))return!1;return!0};wb.prototype.getRandomListOfPlaces=function(k,f){var e=[];void 0===k&&(k=0);for(var b=k;b<this.config.gridWidth;b++)for(var h=k;h<this.config.gridHeight;h++)f&&0!==this.world[h][b]||
e.push({gridX:b,gridY:h});return Ld(e)};wb.prototype.findPlaceForPoints=function(k,f){f=f||0;for(var e=[],b=0;b<k.length;b++){var h=k[b];e[b]=this.worldToGrid(h.x,h.y)}k=this.getRandomListOfPlaces(f,!0);for(b=0;b<k.length;b++){h=k[b];for(var n=!0,t=0;t<e.length;t++){var v=e[t],q=h.gridX+v.gridX;v=h.gridY+v.gridY;if(!this.validLocation(q,v,f)||0!==this.world[v][q]){n=!1;break}}if(n)return{gridX:h.gridX,gridY:h.gridY,worldX:h.gridX*this.config.squareWidth+this.config.squareWidth/2,worldY:h.gridY*this.config.squareHeight+
this.config.squareHeight/2}}z.logError("Placer: no place for points");return null};wb.prototype.findNextPlace=function(k,f,e,b){void 0===b&&(b=0);void 0===e&&(e=0);b+=e;for(var h=0;h<this.config.gridHeight*this.config.gridWidth;h++)if(k++,k>=this.config.gridWidth-b&&(k=b,f++),f>=this.config.gridHeight-b&&(f=b),this.actOnBlockOfPlaces(k,f,e,this.isOnePlaceEmpty))return e={},e.gridX=k,e.gridY=f,e.worldX=k*this.config.squareWidth+this.config.squareWidth/2,e.worldY=f*this.config.squareHeight+this.config.squareHeight/
2,e;z.logError("Placer: no next place");return null};wb.prototype.findNearPlace=function(k,f,e,b){function h(r,B){if(n.validLocation(r,B,b)&&0==n.world[B][r]){var H={};H.gridX=r;H.gridY=B;H.worldX=r*n.config.squareWidth+n.config.squareWidth/2;H.worldY=B*n.config.squareHeight+n.config.squareHeight/2;return H}}0!=e&&alert("this function only works with radius 0");void 0===b&&(b=0);var n=this;for(e=0;e<this.config.gridWidth;e++){for(var t=k+e,v=-e;v<=e;v++){var q=h(t,f+v);if("undefined"!=typeof q)return q}t=
k-e;for(v=-e;v<=e;v++)if(q=h(t,f+v),"undefined"!=typeof q)return q}z.console("Placer: no place found!");return null};wb.prototype.findRandomPlace=function(k,f){void 0===f&&(f=0);return this.findNextPlace(f+Math.floor(Math.random()*(this.config.gridWidth-2*f)),f+Math.floor(Math.random()*(this.config.gridHeight-2*f)),k,f)};wb.prototype.isBlockEmpty=function(k,f,e){return this.actOnBlockOfPlaces(k,f,e,this.isOnePlaceEmpty)?!0:!1};wb.prototype.reservePlace=function(k,f,e){"object"===typeof k&&(f=k.y,
k=k.x);this.actOnBlockOfPlaces(k,f,"undefined"!=typeof e?e:0,this.reserveOnePlace)};wb.prototype.releasePlace=function(k,f,e){this.actOnBlockOfPlaces(k,f,"undefined"!=typeof e?e:0,this.releaseOnePlace)};wb.prototype.reserveWorldPlace=function(k,f,e){k=this.worldToGrid(k,f);this.reservePlace(k.gridX,k.gridY,e)};wb.prototype.releaseWorldPlace=function(k,f,e){k=this.worldToGrid(k,f);this.releasePlace(k.gridX,k.gridY,e)};wb.prototype.drawReservedDots=function(k,f,e,b){"undefined"===typeof e&&(e="#FF4040");
"undefined"===typeof f&&(f=2);for(var h=0;h<this.config.gridHeight;h++)for(var n=0;n<this.config.gridWidth;n++){var t;if(t=0!=this.world[h][n]?e:b)k.fillStyle=t,k.beginPath(),k.arc(n*this.config.squareWidth+this.config.squareWidth/2,h*this.config.squareHeight+this.config.squareHeight/2,f,0,2*Math.PI,!0),k.closePath(),k.fill()}};var nc=function(k){this.config=tb(k);this.data={}};nc.fullBlocking=-1;nc.noBlocking=0;nc.prototype.buildFromGrid=function(k,f,e,b){function h(B,H,G){var K=0>H||0>G||H>=k||
G>=f?!1:!0;K&&B.neighbors.push(t[G][H])}e=e||0;b=b||{x:0,y:0};var n=1,t=[];this.isGrid=!0;for(var v=0;v<f;v++){t[v]=[];for(var q=0;q<k;q++){var r={id:n++,blocking:{main:nc.noBlocking},pos:{x:b.x+q*e+e/2,y:b.y+v*e+e/2},neighbors:[]};t[v][q]=r;this.data[r.id]=r}}for(e=0;e<f;e++)for(b=0;b<k;b++)n=t[e][b],h(n,b-1,e),h(n,b+1,e),h(n,b,e-1),h(n,b,e+1),h(n,b-1,e-1),h(n,b+1,e-1),h(n,b-1,e+1),h(n,b+1,e+1)};nc.prototype.setEntryBlocking=function(k,f,e){void 0===e&&(e="main");void 0===f&&(f=nc.fullBlocking);
k.blocking[e]=f};nc.prototype.removeBlockingNodes=function(){for(var k in this.data){for(var f=this.data[k],e=f.neighbors.length-1;0<=e;e--)0>f.neighbors[e].blocking.main&&f.neighbors.splice(e,1);0>f.blocking.main&&delete this.data[k]}};nc.prototype.getEntryByID=function(k){return this.data[k]};nc.prototype.findClosestNode=function(k){var f=99999980000001,e=null,b;for(b in this.data){var h=this.data[b],n=h.pos.x-k.x,t=h.pos.y-k.y;n=n*n+t*t;n<f&&(f=n,e=h)}return e};nc.prototype.getNeighbors=function(k,
f){void 0===f&&(f="main");for(var e=[],b=0;b<k.neighbors.length;b++)0<=k.neighbors[b].blocking[f]&&e.push(k.neighbors[b]);return e};nc.prototype.findPath=function(k){k.cycles=k.cycles||-1;if(!k.frontier||k.done){k.path=[];k.settings||(k.settings={});k.done=!1;k.valid=!1;var f=k.start.entry;!f&&k.start.id&&(f=this.getEntryByID(k.start.id));if(!f)return k.valid=!1,k.done=!0;k.start.entry=f;k.startID=f.id;var e=k.end.entry;!e&&k.end.id&&(e=this.getEntryByID(k.end.id));if(!e)return k.valid=!1,k.done=
!0;k.end.entry=e;if(k.start.entry.id===k.end.entry.id)return k.valid=!0,k.done=!0;k.frontier=[];k.frontier.push({entry:f,id:f.id,priority:0});k.visited={};k.visited[f.id]={id:f.id,entry:f,fromID:-1,cost:0};k.closest=k.findClosest?{dist:99999999,id:f.id}:null;void 0===k.blockingSet&&(k.blockingSet="main");k.done=!1}for(e=0;(-1===k.cycles||e<k.cycles)&&k.frontier.length;){var b=k.frontier[0];k.frontier.splice(0,1);for(var h=k.visited[b.id],n=this.getNeighbors(b.entry,k.blockingSet),t=0;t<n.length;t++){var v=
n[t];f=h.cost+v.blocking[k.blockingSet];if(!k.visited[v.id]||f<k.visited[v.id].cost){for(var q={entry:v,id:v.id,priority:f},r=0;r<k.frontier.length&&!(f<k.frontier[r].priority);r++);k.frontier.splice(r,0,q);k.visited[v.id]={fromID:b.id,entry:v,id:v.id,cost:f};if(v.id===k.end.id){for(e=v.id;e!==k.start.id;)k.path.unshift(k.visited[e].entry),e=k.visited[e].fromID;k.frontier=void 0;k.visited=void 0;k.totalCost=f;k.valid=!0;return k.done=!0}}}e++}if(k.frontier.length)return!1;k.frontier=void 0;k.visited=
void 0;k.valid=!1;return k.done=!0};var Tg={HexGrid:oa,NodeGraph:sb,gridMapCreator:Gb,Placer:wb,Pathfinder:nc},na={enabled:!1,paused:!1,reason:"uninitialized",projectName:"rat",serverAddress:null,serverPort:2529,userName:null,time:0,screenCapCount:0,lastScreenDate:null},Ug={autoScreenMinSessionTime:10,autoScreenWaitTime:7200};na.updateInterval=750;na.init=function(k,f,e){na.reason="";k&&(na.projectName=k);e||(e={});this.opts=e;f&&(/:\/\//.test(f)||(f="http://"+f),na.serverAddress=f);vc(this.opts,
Ug,!0,!1);(k=e.platforms)?Array.isArray(k)||(k=[k]):k="chromeBrowser IEBrowser firefoxBrowser Wraith uwpXbox !xboxLE".split(" ");na.sessionID=Re();if("file:"!==location.protocol&&"ms-appx:"!==location.protocol&&"http:"!==location.protocol&&"https:"!==location.protocol)return na.reason="argus won't run in "+location.protocol+" protocol, currently.";if(("http:"===location.protocol||"https:"===location.protocol)&&"localhost"!==location.hostname)return na.reason="for http/s argus only captures from localhost builds, not "+
location.hostname;f=!1;for(e=0;e<k.length;e++){var b=k[e],h=!1;"!"===b.charAt(0)&&(h=!0,b=b.substring(1));if(sa[b]&&(f=!0,h))return na.reason="platform "+b+" is in exclusion list."}return f?sa.localStorage?na.serverAddress?na.enable():(z.log("rat.debug.argus: no server address. Consider using console 'argus server x.x.x' command."),na.reason="no server address provided yet"):na.reason="we need localstorage to track timing correctly":na.reason="current platform not in specified/default list"};na.useCaptureCanvas=
function(k){na.opts.captureCanvas=k};na.enable=function(k){void 0===k&&(k=!0);k&&!na.serverAddress&&(z.log("can't enable argus without serveraddress."),na.reason="no server address provided yet",k=!1);k?(na.enabled=!0,na.intervalID||(na.intervalID=window.setInterval(na.update,na.updateInterval))):(na.enabled=!1,na.intervalID&&(window.clearInterval(na.intervalID),na.intervalID=0));return na.enabled};na.update=function(){if(na.enabled&&!na.paused){na.time+=na.updateInterval/1E3;var k=!1;na.getNextAutoScreenTime().doItNow&&
(k=!0);z.state.consoleActive&&(k=!1);k&&na.doScreenCap()}};na.getNextAutoScreenTime=function(){var k={doItNow:!1,timeAhead:-1,reason:""};if(null===na.lastScreenDate)k.doItNow=!0,k.timeAhead=0;else if(1<=na.screenCapCount)k.timeAhead=-1,k.reason="only one per session";else{var f=new Date(na.lastScreenDate.getTime()+1E3*this.opts.autoScreenWaitTime);k.timeAhead=(f-new Date)/1E3;0>=k.timeAhead&&(k.timeAhead=0,k.doItNow=!0)}na.time<this.opts.autoScreenMinSessionTime&&(f=this.opts.autoScreenMinSessionTime-
na.time,k.timeAhead<f&&(k.timeAhead=f,k.doItNow=!1));return k};na.scheduleImmediateScreen=function(){this.opts.autoScreenMinSessionTime=0;na.lastScreenDate=null};na.doScreenCap=function(){if(na.serverAddress&&na.enabled){var k=na.opts.captureCanvas;k||(k=La);if(k){if(na.opts.captureScale)var f={w:k.width*na.opts.captureScale|0,h:k.height*na.opts.captureScale|0};else na.opts.captureSize&&(f=na.opts.captureSize);if(f){var e=document.createElement("canvas");e.width=f.w;e.height=f.h;f=e.getContext("2d");
"undefined"!==typeof na.opts.captureSmoothing&&de(na.opts.captureSmoothing,f);var b=e.width/k.width,h=e.height/k.height;h<b&&(b=h);f.scale(b,b);f.drawImage(k,0,0);k=e}na.lastScreenDate=new Date;k=k.toDataURL("image/jpeg",na.opts.captureQuality||.75);e=k.length;524288<e?z.log("argus screencap skipped because it's too large: "+e):(na.sendThisScreen(k),z.log("argus screencap "+na.screenCapCount+" at "+na.time+", len: "+e),na.screenCapCount++,na.writeSettings())}}else z.log("argus disabled - no screencap.")};
na.sendThisScreen=function(k){var f=na.serverAddress+":"+na.serverPort+"/screenpost/",e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&200!==e.status&&z.log("argus xmlhttp.status error: "+e.status)};e.open("POST",f,!0);k=k.replace(/ /g,"+");k="sessionid="+na.sessionID+"&projectid="+na.projectName+"&imageid="+na.screenCapCount+"&data="+k;e.setRequestHeader("Content-type","application/x-www-form-urlencoded");e.send(k)};z.registerCommand("argus",function(k,f){if(1>f.length||"help"===
f[0])1>f.length&&(f=na.enabled?"on":"off",na.enabled||(f+=" ("+na.reason+")"),z.log("argus status: "+f),z.log("      server: "+na.serverAddress)),z.logNewlines("argus commands:\n  argus server <serveraddress>\n  argus screencap\n  argus user username\n  and more...");else if("server"===f[0]&&f[1]){na.serverAddress=f[1];if("0"===f[1]||"false"===f[1])na.serverAddress=null;na.enable();z.log("argus enabled: "+na.enabled);na.writeSettings()}else"enable"===f[0]?(k=!0,f[1]&&"false"===f[1]&&(k=!1),na.enable(k),
z.log("argus enabled: "+na.enabled)):"user"!==f[0]&&"username"!==f[0]||!f[1]?"screencap"===f[0]||"screen"===f[0]||"cap"===f[0]?(z.activate(!1),na.scheduleImmediateScreen()):"time"===f[0]||"last"===f[0]||"next"===f[0]?(f="(none)",na.lastScreenDate&&(f=na.lastScreenDate.toTimeString()),na.enabled?na.lastScreenDate?(k=na.getNextAutoScreenTime(),k=0<=k.timeAhead?"+"+fg(k.timeAhead)+"s":"none ("+k.reason+")"):k="next opportunity":k="none (disabled)",na.paused&&(k+=" (paused)"),z.log("  last screen: "+
f),z.log("  next auto screen: "+k)):"pause"===f[0]||"unpause"===f[0]?(k=!na.paused,"unpause"===f[0]&&(k=!1),na.paused=k,z.log("  paused: "+na.paused)):"clear"===f[0]&&na.clearSettings():(na.userName=f[1],z.log("argus user: "+na.userName),na.writeSettings())});var Od=Xb.getLocalStorage();if(Od){var Nc=Od.getItem("rat_debugArgus");Nc&&(Nc=JSON.parse(Nc))&&(Nc.serverAddress&&(na.serverAddress=Nc.serverAddress),Nc.userName&&(na.userName=Nc.userName),Nc.lastScreenDate&&(na.lastScreenDate=new Date(Nc.lastScreenDate)))}na.writeSettings=
function(){if(Od){var k={serverAddress:na.serverAddress,userName:na.userName};na.lastScreenDate&&(k.lastScreenDate=na.lastScreenDate.toString());Od.setItem("rat_debugArgus",JSON.stringify(k))}};na.clearSettings=function(){na.serverAddress=null;na.userName=null;na.enabled=!1;na.reason="disabled through command";na.lastScreenDate=null;Od.removeItem("rat_debugArgus")};var Vg={argus:na,display:zb,trackValue:Ka,showSet:mb},Wg=z.assert;db.BoundingShape.prototype.debugDraw=function(k,f,e){tc();var b=ca;
f=f.toString();b.strokeStyle=f;b.lineWidth=1;sc(k.x,k.y);k=this.mLimits;f=this.mSize;ca.strokeRect(k.left,k.top,f.x,f.y);jb.drawCircle(this.mBounding);f=e.toString();b.strokeStyle=f;jb.drawShapeList(this.mShapes);zc()};var Zc={commandHandlers:[],OK_COMMAND:-100,CANCEL_COMMAND:-99,dispatchCommand:function(k,f){for(var e=0;e<Zc.commandHandlers.length;e++){var b=Zc.commandHandlers[e].dispatchCommand(k,f);if(b)return b}return!1},registerCommandHandler:function(k){Zc.commandHandlers.push(k)}},$c={MAX_KEY_CODE:256,
KEY_SLOTS:8,rawKeys:[0,0,0,0,0,0,0,0],newKeys:[0,0,0,0,0,0,0,0],lastKeys:[0,0,0,0,0,0,0,0],update:function(k){k=$c;for(var f=0;f<k.KEY_SLOTS;f++)k.newKeys[f]=k.rawKeys[f]&~k.lastKeys[f],k.lastKeys[f]=k.rawKeys[f]},handleKeyDown:function(k,f){k=f/32|0;$c.rawKeys[k]|=1<<f-32*k},handleKeyUp:function(k,f){k=f/32|0;$c.rawKeys[k]&=~(1<<f-32*k)},isKeyDown:function(k){var f=k/32|0;return $c.rawKeys[f]&1<<k-32*f?!0:!1},isKeyNewlyDown:function(k){var f=k/32|0;return $c.newKeys[f]&1<<k-32*f?!0:!1},isArrowKey:function(k){return k===
la.leftArrow||k===la.upArrow||k===la.rightArrow||k===la.downArrow}},Za=function b(f,e){this.events={};this.map=f;this.index=-1;void 0!==e&&0<=e&&this.checkBounds(e)&&this.map[e]?this.defaultIndex=e:this.defaultIndex=-1;this.validateMap();this.navigateSound=b.defaultNavigateSound};Za.defaultNavigateSound=void 0;Za.prototype.addMappedItems=function(f){this.map=this.map.concat(f)};Za.prototype.setOnChange=function(f){this.events.onChange=f};Za.prototype.validateMap=function(){for(var f,e=0;e<this.map.length;++e){var b=
this.map[e],h=["up","left","right","down","select"];for(f=0;f<h.length;f++){var n=b[h[f]];if(n){for(var t=null,v=0;v<this.map.length;++v)this.map[v].currObj===n&&(t=n);t||(b[h[f]]=null)}}b.currObj&&void 0===b.currObj.inputMapID&&(f=b.currObj,b=b.currObj.getBounds(),f.inputMapID=b.x+100*b.y+1E4*b.w+1E6*b.h)}};Za.prototype.setDirectionMapping=function(f,e,b){f=this.getIndexByButton(f);var h=this.getIndexByButton(b);0>f||null!==b&&0>h||(this.map[f][e]=b)};Za.prototype.handleKeyDown=function(f){switch(f.which){case la.leftArrow:var e=
"left";break;case la.upArrow:e="up";break;case la.rightArrow:e="right";break;case la.downArrow:e="down";break;case la.enter:e="select";break;default:return}return this.handleDirection(e,f)};Za.prototype.handleDirection=function(f,e){if(this.checkBounds(this.index)){var b=this.map[this.index];if("select"===f)this.doPress(this.map[this.index].currObj,e);else{if(b&&b[f]&&b.currObj!==b[f]){var h;f=b[f];for(e=0;e<this.map.length;++e)this.map[e].currObj===f&&(h=e);this.navigateSound&&V&&V.playSound(this.navigateSound);
this.focusButton(h);return!0}if(b&&b.currObj.handleDirection&&b.currObj.handleDirection(f))return!0}}else if(-1===this.index&&(-1===this.defaultIndex&&0<this.map.length?this.index=0:this.checkBounds(this.defaultIndex)&&(this.index=this.defaultIndex),this.checkBounds(this.index)))return this.doFocus(this.map[this.index].currObj),!0;return!1};Za.prototype.handleTab=function(f){var e=1;f.sysEvent.shiftKey&&(e=-1);if(this.checkBounds(this.index)){var b=this.map[this.index],h=0;if(void 0!==b.tabOrder)for(e=
b.tabOrder+e,0>e?e=this.map.length-1:e>this.map.length-1&&(e=0),b=0;b<this.map.length;++b){if(this.map[b].tabOrder===e){h=b;break}}else h=this.index+e,0>h?h=this.map.length-1:h>this.map.length-1&&(h=0);this.focusButton(h);this.index===h&&(h=this.map[h].currObj,h.handleTabbedTo&&h.handleTabbedTo(f));return!0}return!1};Za.prototype.doFocus=function(f,e){return f.Focus?f.Focus():f.focus?f.focus(e):!1};Za.prototype.doBlur=function(f){return f.Blur?f.Blur():f.blur?f.blur():!1};Za.prototype.doPress=function(f,
e){return f.Press?f.Press(e):f.press?f.press(e):!1};Za.prototype.getButtonCount=function(){return this.map.length};Za.prototype.getButton=function(f){return this.checkBounds(f)?this.map[f].currObj:null};Za.prototype.getCurrIndex=function(){return this.index};Za.prototype.getCurrIndexButton=function(){return this.checkBounds(this.index)?this.map[this.index].currObj:null};Za.prototype.getCurrentFocusedButton=Za.prototype.getCurrIndexButton;Za.prototype.getTarget=Za.prototype.getCurrIndexButton;Za.prototype.getTargetForEvent=
function(f){return this.getTarget()};Za.prototype.getIndexByButton=function(f){for(var e=0;e<this.map.length;++e)if(this.map[e].currObj===f)return e;return-1};Za.prototype.getIndexByInputMapID=function(f){for(var e=0;e<this.map.length;++e)if(this.map[e].currObj&&this.map[e].currObj.inputMapID===f)return e;return-1};Za.prototype.focusButton=function(f,e){var b=this.index;if(f===this.index)if(e)b=-1;else return f;if(this.checkBounds(f)&&this.map[f]&&(this.doFocus(this.map[f].currObj,e)&&this.checkBounds(b)&&
this.map[b]&&this.doBlur(this.map[b].currObj),this.index=f,this.events.onChange))this.events.onChange(this.map[f].currObj,this.map[b]?this.map[b].currObj:void 0);return this.index};Za.prototype.focusByButton=function(f,e){f=this.getIndexByButton(f);return 0>f?-1:this.focusButton(f,e)};Za.prototype.focusByInputMapID=function(f,e){f=this.getIndexByInputMapID(f);return 0>f?-1:this.focusButton(f,e)};Za.prototype.clearIndex=function(){this.index=-1};Za.prototype.unFocusCurrent=function(){var f=this.getCurrIndexButton();
f&&this.doBlur(f);this.index=-1};Za.prototype.reset=function(){this.index!==this.defaultIndex&&(this.checkBounds(this.index)&&this.doBlur(this.map[this.index].currObj),this.checkBounds(this.defaultIndex)&&this.doFocus(this.map[this.defaultIndex].currObj),this.index=this.defaultIndex)};Za.prototype.applyDefaultTarget=function(){-1!==this.defaultIndex&&this.focusButton(this.defaultIndex,!0)};Za.prototype.checkBounds=function(f){return 0<=f&&f<this.map.length?!0:!1};Za.prototype.dumpList=function(f){z.log("inputmap: "+
this.map.length+" elements:");for(f=0;f<this.map.length;++f){var e=this.map[f].currObj;z.log(""+f+" : "+(e.name||"(no name)")+" type: "+(e.elementType||"?"))}};Za.prototype.drawDebug=function(f){f.fillStyle="#FF00FF";f.strokeStyle="#FF00FF";var e=Ha/2048,b=50*e;f.lineWidth=3*e;var h=null;0<=this.index&&this.map[this.index]&&(h=this.map[this.index].currObj);for(var n=0;n<this.map.length;++n){var t=this.map[n],v=t.currObj;if(v){var q=v.getGlobalPos();q.x+=v.size.x/2;q.y+=v.size.y/2;f.lineWidth=3*e;
f.strokeStyle=n===this.index?"#FFFF00":"#FF00FF";f.beginPath();f.arc(q.x,q.y,b,0,2*Math.PI);f.closePath();f.stroke();v=["up","left","right","down"];for(var r=0;r<v.length;r++){var B=t[v[r]];if(B){var H=B.getGlobalPos();H.x+=B.size.x/2;H.y+=B.size.y/2;n===this.index||B===h?(f.strokeStyle="rgba(255, 255, 0, 0.5)",f.lineWidth=6*e):(f.strokeStyle="rgba(255, 0, 255, 0.3)",f.lineWidth=3*e);f.beginPath();f.moveTo(q.x,q.y);f.lineTo(H.x,H.y);f.closePath();f.stroke()}}}}};var pg=function(f,e){return"ui"!==
f.eventType?e.defaultVal:e[f.which]||e.defaultVal},Xg={left:{x:-1,y:0},right:{x:1,y:0},up:{x:0,y:-1},down:{x:0,y:1},"default":{x:0,y:0}},qg=function(f){return f===la.leftArrow?{x:-1,y:0}:f===la.rightArrow?{x:1,y:0}:f===la.upArrow?{x:0,y:-1}:f===la.downArrow?{x:0,y:1}:null},rg=Object.freeze({__proto__:null,isUIDirection:function(f){if("ui"!==f.eventType)return!1;f=f.which;return"left"===f||"right"===f||"up"===f||"down"===f},mapUIEventToValue:pg,getUIEventDirection:function(f){return pg(f,Xg)},keyToDirection:qg,
uiInputToDirection:function(f){return"left"===f?{x:-1,y:0}:"right"===f?{x:1,y:0}:"up"===f?{x:0,y:-1}:"down"===f?{x:0,y:1}:null},keyCodeToNumber:function(f){return f>=la["0"]&&f<=la["9"]?f-la["0"]:f>=la.numPad0&&f<=la.numPad9?f-la.numPad0:-1}}),M={allowedControllers:[],activeControllerID:0,controllers:[]};M.controllers.getByID=function(f){for(var e=0;e<M.controllers.length;++e)if(M.controllers[e].uniqueID===f)return M.controllers[e]};M.allowRepeatEvents={buttons:!1,directions:!0};M.eventDispatcher=
null;M.attachEventDispatcher=function(f){M.eventDispatcher=f};M.gamepadKeyFakeEnabled=!1;M.BUTTON_UP=1;M.BUTTON_DOWN=2;M.BUTTON_LEFT=4;M.BUTTON_RIGHT=8;M.BUTTON_START=16;M.BUTTON_SELECT=32;M.BUTTON_A=256;M.BUTTON_B=512;M.BUTTON_C=1024;M.BUTTON_D=2048;M.BUTTON_X=M.BUTTON_C;M.BUTTON_Y=M.BUTTON_D;M.BUTTON_LT=4096;M.BUTTON_LB=8192;M.BUTTON_RT=16384;M.BUTTON_RB=32768;M.BUTTON_DPAD_UP=65536;M.BUTTON_DPAD_DOWN=131072;M.BUTTON_DPAD_LEFT=262144;M.BUTTON_DPAD_RIGHT=524288;M.BUTTON_LEFT_STICK=1048576;M.BUTTON_RIGHT_STICK=
2097152;M.BUTTON_LSTICK_UP=16777216;M.BUTTON_LSTICK_DOWN=33554432;M.BUTTON_LSTICK_LEFT=67108864;M.BUTTON_LSTICK_RIGHT=134217728;M.BUTTON_RSTICK_UP=268435456;M.BUTTON_RSTICK_DOWN=536870912;M.BUTTON_RSTICK_LEFT=1073741824;M.BUTTON_RSTICK_RIGHT=2147483648;M.BUTTON_COUNT=32;M.GAMEPAD_CONTROLLER_MAPPING={BUTTON_A:0,BUTTON_B:1,BUTTON_C:2,BUTTON_X:2,BUTTON_D:3,BUTTON_Y:3,BUTTON_LB:4,BUTTON_RB:5,BUTTON_LT:6,BUTTON_RT:7,BUTTON_SELECT:8,BUTTON_START:9,BUTTON_LEFT_STICK:10,BUTTON_RIGHT_STICK:11,BUTTON_DPAD_UP:12,
BUTTON_DPAD_DOWN:13,BUTTON_DPAD_LEFT:14,BUTTON_DPAD_RIGHT:15,leftStick:{x:-1,y:-2},rightStick:{x:-3,y:-4},leftTrigger:6,rightTrigger:7};M.ControllerChangeType={REMOVED:0,ADDED:1,UPDATED:2};M.init=function(){M.updateEnabled=!1;M.connectPollingForced=!1;if(sa.gamepadAPI){M.updateEnabled=!0;window.addEventListener("gamepadconnected",M.onSysControllerAdded);window.addEventListener("gamepaddisconnected",M.onSysControllerRemoved);var f=navigator,e=f.getGamepads||f.mozGetGamepads||f.webkitGetGamepads||function(){return f.gamepads||
f.mozGamepads||f.webkitGamepads||[]};M.getSystemControllers=function(){var b=e.call(f);M.gamepadKeyFakeEnabled&&!z.state.consoleActive&&b.push(M.buildGamepadKeyFake());return b}}else M.updateEnabled=!0,M.getSystemControllers=function(){var b=[];M.gamepadKeyFakeEnabled&&b.push(M.buildGamepadKeyFake());return b}};M.update=function(f){M.updateEnabled&&(0<M.controllers.length||M.connectPollingForced)&&M.updateControllers(f)};M.debounceButtons=function(f){f.newButtons=f.rawButtons&~f.lastButtons;f.lastButtons=
f.rawButtons};M.getControllerByID=function(f){for(var e,b=0;b<M.controllers.length;b++)if(e=M.controllers[b],e.uniqueID===f)return e};M.getActiveController=function(){if(0>=M.controllers.length)return null;var f;if(0!==M.activeControllerID)for(f=0;f<M.controllers.length;f++)if(M.controllers[f].uniqueID===M.activeControllerID)return M.controllers[f];var e=void 0;for(f=0;f<M.controllers.length;f++)if(!e||e.index>M.controllers[f].index)e=M.controllers[f];return e};M.getCombinedControllers=function(f){if(0>=
M.controllers.length)return null;var e=new M.Controller({},"COMBINED",-1,!0,0);f&&0!==f.length||(f=M.allowedControllers);if(f&&0<f.length)for(var b=0;b<f.length;b++){var h=M.controllers.getByID(f[b]);gf(e,h)}else if(0===M.allowedControllers.length||0===M.activeControllerID)for(f=0;f<M.controllers.length;f++)gf(e,M.controllers[f]);hf(e.leftStick);hf(e.rightStick);return e};M.getActiveControllerID=function(){var f=M.getActiveController();return f?f.uniqueID:null};M.setActiveControllerID=function(f){if(f=
f||0)for(var e=0;e<M.controllers.length;e++){if(M.controllers[e].uniqueID===f)return z.log("Setting active controller to "+f),M.activeControllerID=f,!0}else return z.log("Cleared active controller"),M.activeControllerID=f,!0;z.logWarning("WARNING! Attempting to set active controller ID for controller "+f+" which cannot be found in the system");M.activeControllerID=0;return!1};M.getActiveControllerRawButtons=function(){var f=0,e=M.getActiveController();e&&(f=e.rawButtons);return f};M.controllerIDAllowed=
function(f){if(0===M.allowedControllers.length)return!0;for(var e=0;e<M.allowedControllers.length;e++)if(M.allowedControllers[e]===f)return!0;return!1};M.getButtonValue=function(f){return"object"===typeof f?f.value:f};M.buildRatControllerObject=function(f,e){switch(f){case "gamepadAPI":var b=e.axes;f=e.buttons.concat();for(var h=0;h<b.length;h++)f[-(h+1)]=b[h];b=M.GAMEPAD_CONTROLLER_MAPPING;void 0===e.connected&&(e.connected=!0);e=new M.Controller(e,e.id,e.index,e.connected,e.timestamp);e.rawButtons=
(M.getButtonValue(f[b.BUTTON_A])?M.BUTTON_A:0)|(M.getButtonValue(f[b.BUTTON_B])?M.BUTTON_B:0)|(M.getButtonValue(f[b.BUTTON_C])?M.BUTTON_C:0)|(M.getButtonValue(f[b.BUTTON_D])?M.BUTTON_D:0)|(M.getButtonValue(f[b.BUTTON_LB])?M.BUTTON_LB:0)|(M.getButtonValue(f[b.BUTTON_RB])?M.BUTTON_RB:0)|(M.getButtonValue(f[b.BUTTON_SELECT])?M.BUTTON_SELECT:0)|(M.getButtonValue(f[b.BUTTON_START])?M.BUTTON_START:0)|(M.getButtonValue(f[b.BUTTON_LEFT_STICK])?M.BUTTON_LEFT_STICK:0)|(M.getButtonValue(f[b.BUTTON_RIGHT_STICK])?
M.BUTTON_RIGHT_STICK:0)|(M.getButtonValue(f[b.BUTTON_DPAD_UP])?M.BUTTON_DPAD_UP:0)|(M.getButtonValue(f[b.BUTTON_DPAD_DOWN])?M.BUTTON_DPAD_DOWN:0)|(M.getButtonValue(f[b.BUTTON_DPAD_LEFT])?M.BUTTON_DPAD_LEFT:0)|(M.getButtonValue(f[b.BUTTON_DPAD_RIGHT])?M.BUTTON_DPAD_RIGHT:0);e.leftStick.x=f[b.leftStick.x]||0;e.leftStick.y=f[b.leftStick.y]||0;e.rightStick.x=f[b.rightStick.x]||0;e.rightStick.y=f[b.rightStick.y]||0;e.leftTrigger=f[b.leftTrigger]||0;e.rightTrigger=f[b.rightTrigger]||0;return e;default:return new M.Controller(e,
0,-1,!1,0)}};M.buildGamepadKeyFake=function(){var f={id:"GAMEPAD_KEYFAKE",index:4,axes:[],buttons:[M.keyboard.isKeyDown(la.a)|M.keyboard.isKeyDown(la.enter),M.keyboard.isKeyDown(la.b)|M.keyboard.isKeyDown(la.esc),M.keyboard.isKeyDown(la.x),M.keyboard.isKeyDown(la.y),M.keyboard.isKeyDown(la.leftBracket),M.keyboard.isKeyDown(la.rightBracket),M.keyboard.isKeyDown(la.l)|M.keyboard.isKeyDown(la.semicolon),M.keyboard.isKeyDown(la.r)|M.keyboard.isKeyDown(la.singleQuote),0,0,0,0,M.keyboard.isKeyDown(la.i),
M.keyboard.isKeyDown(la.k),M.keyboard.isKeyDown(la.j),M.keyboard.isKeyDown(la.l)]};M.keyboard.isKeyDown(la.upArrow)?f.axes[1]=-1:M.keyboard.isKeyDown(la.downArrow)&&(f.axes[1]=1);M.keyboard.isKeyDown(la.leftArrow)?f.axes[0]=-1:M.keyboard.isKeyDown(la.rightArrow)&&(f.axes[0]=1);return f};M.onSysControllerAdded=function(f){if(sa.xbox)return null;f=M.buildRatControllerObject("gamepadAPI",f.gamepad);return M.onControllerChange(M.ControllerChangeType.ADDED,f)};M.onSysControllerRemoved=function(f){if(sa.xbox)return null;
f=M.buildRatControllerObject("gamepadAPI",f.gamepad);return M.onControllerChange(M.ControllerChangeType.REMOVED,f)};M.onControllerChange=function(f,e){for(var b=-1,h=M.controllers,n=h.length-1;0<=n;--n)if(h[n].uniqueID===e.uniqueID){b=n;break}if(f===M.ControllerChangeType.REMOVED){if(-1===b)return e;e.rawButtons=0;e.leftStick.x=0;e.leftStick.y=0;e.rightStick.x=0;e.rightStick.y=0;e.connected=!1;e.leftTrigger=0;e.rightTrigger=0;e.repeatTimer.fullReset()}else f===M.ControllerChangeType.ADDED&&(e.connected=
!0);-1===b?(e.lastButtons=0,h.push(e)):(e.repeatTimer=h[b].repeatTimer,e.lastButtons=h[b].lastButtons,h[b]=e);return e};M.updateControllers=function(f){var e=M.controllers,b=M.thresholds;if(M.getSystemControllers)for(var h=M.getSystemControllers(),n=h.length-1;0<=n;--n)if(h[n]){for(var t=M.buildRatControllerObject("gamepadAPI",h[n]),v=!1,q=e.length-1;0<=q;--q)if(e[q].uniqueID===t.uniqueID){v=!0;break}M.onControllerChange(t.connected?v?M.ControllerChangeType.UPDATED:M.ControllerChangeType.ADDED:M.ControllerChangeType.REMOVED,
t)}for(n=e.length-1;0<=n;--n)h=e[n],h.leftStick.y<=-b.PRESSED&&(h.rawButtons|=M.BUTTON_LSTICK_UP),h.leftStick.y>=b.PRESSED&&(h.rawButtons|=M.BUTTON_LSTICK_DOWN),h.leftStick.x<=-b.PRESSED&&(h.rawButtons|=M.BUTTON_LSTICK_LEFT),h.leftStick.x>=b.PRESSED&&(h.rawButtons|=M.BUTTON_LSTICK_RIGHT),h.rightStick.y<=-b.PRESSED&&(h.rawButtons|=M.BUTTON_RSTICK_UP),h.rightStick.y>=b.PRESSED&&(h.rawButtons|=M.BUTTON_RSTICK_DOWN),h.rightStick.x<=-b.PRESSED&&(h.rawButtons|=M.BUTTON_RSTICK_LEFT),h.rightStick.x>=b.PRESSED&&
(h.rawButtons|=M.BUTTON_RSTICK_RIGHT),0!==(h.rawButtons&(M.BUTTON_DPAD_UP|M.BUTTON_LSTICK_UP))&&(h.rawButtons|=M.BUTTON_UP),0!==(h.rawButtons&(M.BUTTON_DPAD_DOWN|M.BUTTON_LSTICK_DOWN))&&(h.rawButtons|=M.BUTTON_DOWN),0!==(h.rawButtons&(M.BUTTON_DPAD_LEFT|M.BUTTON_LSTICK_LEFT))&&(h.rawButtons|=M.BUTTON_LEFT),0!==(h.rawButtons&(M.BUTTON_DPAD_RIGHT|M.BUTTON_LSTICK_RIGHT))&&(h.rawButtons|=M.BUTTON_RIGHT),M.getButtonValue(h.leftTrigger)>=b.PRESSED&&(h.rawButtons|=M.BUTTON_LT),M.getButtonValue(h.rightTrigger)>=
b.PRESSED&&(h.rawButtons|=M.BUTTON_RT),h.newButtons=h.rawButtons&~h.lastButtons,M.checkAndDispatchControllerEvents(h,f),h.lastButtons=h.rawButtons,h.connected||(e.splice(n,1),z.log("Controller "+h.uniqueID+" removed"))};M.setOneAllowedController=function(f){"keyboard"!==f&&"mouse"!==f&&(z.log("Allowing only controller "+f),M.allowedControllers=[f])};M.allowAllControllers=function(){M.allowedControllers=[]};M.setAllowRepeatEvents=function(f){!0===f||!1===f?(M.allowRepeatEvents.buttons=f,M.allowRepeatEvents.directions=
f):(void 0!==f.buttons&&(M.allowRepeatEvents.buttons=!!f.buttons),void 0!==f.directions&&(M.allowRepeatEvents.directions=!!f.directions))};var ke=function(f,e){this.defaults={rate:f,delay:e};this.directions=this.buttons=0;this.fullReset()};ke.prototype.fullReset=function(){this.buttons=this.defaults.delay.buttons;this.directions=this.defaults.delay.directions};ke.prototype.repeatReset=function(f){void 0===f&&(f={buttons:!0,directions:!0});f.buttons&&(this.buttons=this.defaults.rate.buttons);f.directions&&
(this.directions=this.defaults.rate.directions)};ke.prototype.elapsed=function(f){this.buttons-=f;this.directions-=f;0>this.buttons&&(this.buttons=0);0>this.directions&&(this.directions=0)};M.Controller=function(f,e,b,h,n){this.rawData=f||{};this.uniqueID=""+e+b;this.id=e;this.index=b;this.connected=h;this.timestamp=n;this.rawButtons=0;this.leftStick={x:0,y:0};this.rightStick={x:0,y:0};this.lastButtons=this.newButtons=this.rightTrigger=this.leftTrigger=0;this.repeatTimer=new ke(M.Controller.repeatRate,
M.Controller.repeatDelay)};M.Controller.repeatRate={buttons:.2,directions:.2};M.Controller.repeatDelay={buttons:.5,directions:.5};M.thresholds={LOW:.2,NORM:.5,HIGH:.8,PRESSED:.7};M.getControllerInfo=function(f){var e;sa.xbox&&(e=M.getXboxControllerInfo(f));if(!e)return null;f=-1;for(var b=0;b<M.controllers.length;b++)if(M.controllers[b].uniqueID===e.uniqueID){f=b;break}0>f&&(e=M.buildRatControllerObject("xle",{type:"gamepad",id:e.id,user:e.user,rawButtons:0,newButtons:0,lastButtons:0}),M.controllers.push(e),
f=M.controllers.length-1);return M.controllers[f]};M.clearAllControllerButtons=function(){for(var f,e=0;e<M.controllers.length;e++)f=M.controllers[e],f.rawButtons=0,f.newButtons=0,f.lastButtons=0,f.repeatTimer.fullReset()};M.getControllerDirection=function(f){var e={x:0,y:0};f&&(f.rawButtons&M.BUTTON_LEFT?--e.x:e.x=f.rawButtons&M.BUTTON_RIGHT?e.x+1:e.x+f.leftStick.x,f.rawButtons&M.BUTTON_UP?--e.y:e.y=f.rawButtons&M.BUTTON_DOWN?e.y+1:e.y+f.leftStick.y);return e};M.getGamepadDirection=M.getControllerDirection;
M.checkAndDispatchControllerEvents=function(f,e){if(M.eventDispatcher&&M.controllerIDAllowed(f.uniqueID)){var b=void 0,h;f.rawButtons!==f.lastButtons||0===f.rawButtons?f.repeatTimer.fullReset():f.repeatTimer.elapsed(e);if(f.newButtons)for(h=0;h<M.BUTTON_COUNT;h++)e=1<<h,0!==(f.newButtons&e)&&(b=b||new M.eventDispatcher.Event({controllerID:f.uniqueID},{index:f.index}),M.eventDispatcher.lastInputType="gamepad",b.eventType="buttondown",b.which=e,M.eventDispatcher.dispatchEvent(b));if(f.rawButtons!==
f.lastButtons)for(h=0;h<M.BUTTON_COUNT;h++){e=1<<h;var n=0!==(f.rawButtons&e);var t=0!==(f.lastButtons&e);!0===t&&!1===n&&(b=b||new M.eventDispatcher.Event({controllerID:f.uniqueID},{index:f.index}),M.eventDispatcher.lastInputType="gamepad",b.eventType="buttonup",b.which=e,M.eventDispatcher.dispatchEvent(b))}t=0>=f.repeatTimer.buttons&&M.allowRepeatEvents.buttons;var v=0>=f.repeatTimer.directions&&M.allowRepeatEvents.directions;if(t||v)for(e={},t&&(e.buttons=!0),v&&(e.directions=!0),f.repeatTimer.repeatReset(e),
b&&(b.repeat=!0),h=0;h<M.BUTTON_COUNT;h++)if(e=1<<h,n=0!==(f.rawButtons&e))n=0!==(e&(M.BUTTON_UP|M.BUTTON_DOWN|M.BUTTON_LEFT|M.BUTTON_RIGHT)),n&&!v||!n&&!t||(b||(b=new M.eventDispatcher.Event({controllerID:f.uniqueID},{index:f.index}),b.repeat=!0),M.eventDispatcher.lastInputType="gamepad",b.eventType="buttondown",b.which=e,M.eventDispatcher.dispatchEvent(b))}};M.processGamepadKeyDownEvent=function(f,e){};M.processGamepadKeyUpEvent=function(f,e){};M.translateEventToUI=function(f){if(("buttondown"===
f.eventType||"buttonup"===f.eventType)&&"GAMEPAD_KEYFAKE"!==f.controllerID){var e={buttondown:"ui",buttonup:"ui_up"}[f.eventType];f=f.which;if(f=f===M.BUTTON_LEFT?"left":f===M.BUTTON_UP?"up":f===M.BUTTON_RIGHT?"right":f===M.BUTTON_DOWN?"down":f===M.BUTTON_A?"enter":f===M.BUTTON_B?"back":f===M.BUTTON_START?"menu":f===M.BUTTON_SELECT?"view":null)return{uiEventType:e,uiEventCode:f,lastUIInputType:"gamepad"}}};M.isLeftStickDirectionButton=function(f){return 0!==(f&(M.BUTTON_LSTICK_UP|M.BUTTON_LSTICK_DOWN|
M.BUTTON_LSTICK_LEFT|M.BUTTON_LSTICK_RIGHT))};M.getControllers=function(){return M.controllers};M.getGamepads=M.getControllers;var X={};fd.makeEmitter(X);X.keys=la;X.keyboard=$c;X.InputMap=Za;for(var sg in rg)X[sg]=rg[sg];for(var tg in Ff)X[tg]=Ff[tg];X.gamepad=M;Fb.add(M,"gamepad");X.hasFocus=!0;window.hasFocus?X.hasFocus=window.hasFocus():document.hasFocus&&(X.hasFocus=document.hasFocus());X.mousePos={x:-1,y:-1};X.getMousePos=function(){return X.mousePos};X.lastUIInputType="mouse";X.lastInputType=
"mouse";X.useLastUIInputType=!1;X.useLastInputType=!1;X.mouseInDocument=!0;X.mouseInCanvas=!0;X.pointerTrackingEnabled=!1;X.pointerTracking=[];X.triggerMouseLeaveOnDocument=!0;X.triggerMouseLeaveOnCanvas=!1;X.standardPreventDefaultOnEvents=!1;X.addOSKeyEventListener=function(f,e,b,h){Cb(f,e,function(n){X.standardizeKeyEvent(n);b(n)},h)};X.init=function(){M.attachEventDispatcher(this)};X.setMouseHandler=function(f){X.mouseHandler=f};X.update=function(f){X.keyboard.update(f)};X.getRealMousePosition=
function(f){var e=new za(0,0);"mouseleave"===f.type||"mouseout"===f.type?(e.x=-1,e.y=-1):(f.pageX||f.pageY?(e.x=f.pageX,e.y=f.pageY):(e.x=f.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e.y=f.clientY+document.body.scrollTop+document.documentElement.scrollTop),e.x-=La.offsetLeft,e.y-=La.offsetTop,e.x/=wc,e.y/=wc,Jb&&(e.x-=Jb.x,e.y-=Jb.y),e.x/=yb.x/xc,e.y/=yb.y/xc);X.mousePos.x=e.x;X.mousePos.y=e.y;return e};X.getEventWhich=function(f){if(sa.xbox)switch(f.which){case 222:return 220;
case 223:return 192;case 192:return 222}return f.which||0};X.Event=function(f,e){e=e||{};this.sysEvent=f=f||{};if(e.translatedFrom){var b=e.translatedFrom.sysEvent;e.translatedFrom.sysEvent=void 0;vc(this,[e.translatedFrom],!1);e.translatedFrom.sysEvent=b;this.translatedFrom=e.translatedFrom;void 0!==e.which&&(this.which=e.which)}this.eventType=e.type||"";void 0===this.controllerID&&(this.controllerID=f.deviceSessionId||f.controllerID||e.defaultControllerID||0);void 0===this.index&&(this.index=e.index||
0);void 0===this.which&&(this.which=e.which,void 0===this.which&&(this.which=X.getEventWhich(f)));void 0===this.repeat&&(this.repeat=e.repeat||!1);this.eventID=X.Event.nextID++};X.Event.nextID=1;X.dispatchEvent=function(f){for(var e,b=!1,h=-1;h!==Kc.length;++h){if(-1===h)if(z.state.consoleAllowed)e={func:z.handleEvent};else continue;else e=Kc[h];if(e=e.func.call(e.thisObj,f))return!0;void 0!==e&&(b=!0)}if("ui"!==f.eventType&&"mousemove"!==f.eventType&&(f=X.translateToUIEvent(f)))return X.dispatchEvent(f);
if(b)return!1};X.standardizeKeyEvent=function(f){null===f.which&&(f.which=f.charCode?f.charCode:f.keyCode?f.keyCode:0)};X.charCodeFromEvent=function(f){return String.fromCharCode(f.which).toLowerCase()};X.mouseToRatEvent=function(f,e,b){void 0===b&&(b="touch"===f.pointerType||2===f.pointerType||3===f.pointerType);var h=b?"touch":"mouse";X.setLastInputType(h);X.setLastUIInputType(h);h=X.getRealMousePosition(f);e=new X.Event(f,{type:e,defaultControllerID:"mouse"});e.pos=h;e.isFromTouch=b;e.pointerID=
void 0!==f.pointerId?f.pointerId:-1;b&&(b=12,td()&&(b/=yb.x/xc),(h=f.webkitRadiusX)&&1!==h||(h=b),e.touchRadiusX=h,(f=f.webkitRadiusY)&&1!==f||(f=b),e.touchRadiusY=f);X.pointerTrackingEnabled&&X.trackPointer(e);f=!1;X.mouseHandler&&(f=X.mouseHandler(e));f||(f=X.dispatchEvent(e));e.handled=f;return e};X.trackPointer=function(f){function e(v){v.pointerTrackColor=new O.randomColor;n.push(v)}function b(v,q){v.pointerTrackColor=n[q].pointerTrackColor;n[q]=v}for(var h=-1,n=X.pointerTracking,t=0;t<n.length;t++)f.pointerID===
n[t].pointerID&&(h=t);"mousedown"===f.eventType&&(0<=h?b(f,h):e(f));"mousemove"===f.eventType&&(0<=h?b(f,h):e(f));("mouseup"===f.eventType||"mousecancel"===f.eventType)&&0<=h&&n.splice(h,1)};X.mouseLeaveAll=function(f){X.mouseToRatEvent(f,"mousemove",!1)};X.onMouseMove=function(f){if(!X.appBar||X.appBar.hidden)X.mouseInDocument=!0,f=X.mouseToRatEvent(f,"mousemove"),X.handlePreventDefault(f,f.handled)};X.onMouseDown=function(f){if(!X.appBar||X.appBar.hidden)window.mixer&&!X.hasFocus&&La.focus(),X.mouseInDocument=
!0,f=X.mouseToRatEvent(f,"mousedown"),X.handlePreventDefault(f,f.handled)};X.onMouseUp=function(f){if(!X.appBar||X.appBar.hidden)X.mouseInDocument=!0,f=X.mouseToRatEvent(f,"mouseup"),X.handlePreventDefault(f,f.handled)};X.onMouseCancel=function(f){if(!X.appBar||X.appBar.hidden)f=X.mouseToRatEvent(f,"mousecancel"),X.handlePreventDefault(f,f.handled)};X.onMouseLeave=function(f){if(!X.appBar||X.appBar.hidden)f=X.mouseToRatEvent(f,"mouseleave"),X.handlePreventDefault(f,f.handled)};X.onMouseWheel=function(f){var e=
window.event||f;e=e.wheelDelta?e.wheelDelta/120:e.deltaY?-e.deltaY/3:void 0!==e.detail?-e.detail:0;f=new X.Event(f,{type:"mousewheel",defaultControllerID:"mouse"});f.wheelDelta=e;f.pos={x:X.mousePos.x,y:X.mousePos.y};e=X.dispatchEvent(f);X.handlePreventDefault(f,e)};X.onKeyPress=function(f){X.setLastInputType("keyboard");var e=new X.Event(f,{type:"keypress",defaultControllerID:"keyboard"});e.key=f.key;if(!e.key||e.key&&1<e.key.length)e.key=String.fromCharCode(f.keyCode||f.charCode);e.key&&""!==e.key&&
(f=X.dispatchEvent(e),X.handlePreventDefault(e,f))};X.onKeyDown=function(f){X.setLastInputType("keyboard");X.keyboard.isKeyDown(X.getEventWhich(f));X.keyboard.handleKeyDown(f,X.getEventWhich(f));var e=new X.Event(f,{type:"keydown",defaultControllerID:"keyboard"}),b=X.dispatchEvent(e);M.processGamepadKeyDownEvent(e,f);X.handlePreventDefault(e,b)};X.onKeyUp=function(f){X.setLastInputType("keyboard");X.keyboard.handleKeyUp(f,X.getEventWhich(f));var e=new X.Event(f,{type:"keyup",defaultControllerID:"keyboard"}),
b=X.dispatchEvent(e);M.processGamepadKeyUpEvent(e,f);X.handlePreventDefault(e,b)};X.onContextMenu=function(f){f=X.mouseToRatEvent(f,"contextmenu",!1);X.handlePreventDefault(f,f.handled)};X.setTouchPositionOnEvent=function(f,e){var b=tb(e,!1,!0);if(void 0!==f.pageX||void 0!==f.pageY)b.pageX=f.pageX,b.pageY=f.pageY;void 0!==f.identifier?b.pointerId=f.identifier:void 0!==e.pointerId&&(b.pointerId=e.pointerId);return b};X.autoHandleEvents=function(){X.addOSKeyEventListener(window,"keydown",X.onKeyDown,
!1);X.addOSKeyEventListener(window,"keyup",X.onKeyUp,!1);X.addOSKeyEventListener(window,"keypress",X.onKeyPress,!1);navigator.msPointerEnabled?(Cb(window,"MSPointerMove",X.onMouseMove,!1),Cb(window,"MSPointerDown",X.onMouseDown,!1),Cb(window,"MSPointerUp",X.onMouseUp,!1)):!window.PointerEvent&&"undefined"===typeof Windows||"undefined"!=typeof window.TouchEvent?(z.log("listening for mouse and touch events"),Cb(window,"mousemove",X.onMouseMove,!1),Cb(window,"mousedown",X.onMouseDown,!1),Cb(window,"mouseup",
X.onMouseUp,!1),document.addEventListener("touchstart",Ud,{passive:!1}),document.addEventListener("touchmove",Ud,{passive:!1}),document.addEventListener("touchend",Ud,{passive:!1}),document.addEventListener("touchcancel",Ud,{passive:!1})):(z.log("listening for pointer events"),Cb(window,"pointermove",X.onMouseMove,!1),Cb(window,"pointerdown",X.onMouseDown,!1),Cb(window,"pointerup",X.onMouseUp,!1),Cb(window,"pointercancel",X.onMouseCancel,!1));Cb(window,"contextmenu",X.onContextMenu,!1);Cb(document,
"mouseenter",function(){X.mouseInDocument=!0});Cb(document,"mouseleave",function(e){X.mouseInDocument=!1;X.triggerMouseLeaveOnDocument&&X.mouseLeaveAll(e);X.onMouseLeave(e)});var f=La;f&&(Cb(f,"mouseenter",function(){X.mouseInCanvas=!0}),Cb(f,"mouseleave",function(e){X.mouseInCanvas=!1;X.triggerMouseLeaveOnCanvas&&X.mouseLeaveAll(e)}));Cb(window,"wheel",X.onMouseWheel,{passive:!1})};X.translateGamePadKeys=void 0;X.translateToUIEvent=function(f){var e=0,b="ui";if("keydown"===f.eventType||"keyup"===
f.eventType)b={keydown:"ui",keyup:"ui_up"}[f.eventType],(e=Ig(f.which))&&X.setLastUIInputType("keyboard");if(!e){var h=Fb.processUntilResult("translateEventToUI",f);h&&(b=h.uiEventType,e=h.uiEventCode,h.lastUIInputType&&X.setLastUIInputType(h.lastUIInputType))}return e?new X.Event(f.sysEvent,{translatedFrom:f,type:b,which:e}):null};X.handlePreventDefault=function(f,e){var b=X.standardPreventDefaultOnEvents;void 0!==e&&(b=e?!0:!1);void 0!==f.allowBrowserDefault&&(b=!f.allowBrowserDefault);!1===f.sysEvent.cancelable&&
(b=!1);b&&!sa.QUnit&&f.sysEvent&&f.sysEvent.preventDefault&&f.sysEvent.preventDefault()};X.setStandardPreventFlag=function(f){X.standardPreventDefaultOnEvents=f};X.setLastUIInputType=function(f){var e=X.lastUIInputType;X.lastUIInputType=f;e!==f&&this.emit("lastUIInputTypeChanged",{old:e,new:f})};X.setLastInputType=function(f){var e=X.lastInputType;X.lastInputType=f;e!==f&&this.emit("lastInputTypeChanged",{old:e,new:f})};X.usingDirectionInput=function(){return X.useLastUIInputType&&("keyboard"===X.lastUIInputType||
"gamepad"===X.lastUIInputType)||X.useLastInputType&&("keyboard"===X.lastInputType||"gamepad"===X.lastInputType)};Cb(window,"focus",function(){X.hasFocus||(X.hasFocus=!0,Ga&&Ga.fire&&Ga.fire("focus"))});Cb(window,"blur",function(){X.hasFocus&&(X.hasFocus=!1,Ga&&Ga.fire&&Ga.fire("blur"))});var yd={enabled:!0,group:function(f,e){},test:function(f,e){yd.enabled&&yd._test&&yd._test(f,e)},testGroup:function(f,e,b){yd.group(f,function(){yd.test(e,b)})}},ug={point:function(f,e){var b={},h=1-f;b.x=h*h*h*e[0].x+
3*f*h*h*e[1].x+3*f*f*h*e[2].x+f*f*f*e[3].x;b.y=h*h*h*e[0].y+3*f*h*h*e[1].y+3*f*f*h*e[2].y+f*f*f*e[3].y;return b},tangent:function(f,e){var b={},h=1-f;b.x=-3*e[0].x*h*h+e[1].x*(3*h*h-6*h*f)+e[2].x*(6*h*f-3*f*f)+3*e[3].x*f*f;b.y=-3*e[0].y*h*h+e[1].y*(3*h*h-6*h*f)+e[2].y*(6*h*f-3*f*f)+3*e[3].y*f*f;return b},length:function(f){for(var e,b=0,h=0;20>=h;h++){var n=ug.point(h/20,f);0===h&&(e=n);var t=e.x-n.x;e=e.y-n.y;b+=Math.sqrt(t*t+e*e);e=n}return b}},Bb=function t(e,b,h,n){if(Math.abs(e-b)<t.EPSILON&&
Math.abs(h-n)<t.EPSILON)this.isLinear=!0;else for(e=0>e?0:1<e?1:e,h=0>h?0:1<h?1:h,this.Cx=3*e,this.Bx=3*h-6*e,this.Ax=1-3*h+3*e,this.Cy=3*b,this.By=3*n-6*b,this.Ay=1-3*n+3*b,this.preCalcValues=Array(t.PRECALC_SIZE),e=0;e<t.PRECALC_SIZE;e++)this.preCalcValues[e]=this.calcBezier(this.Ax,this.Bx,this.Cx,e*t.PRECALC_STEP)};Bb.EPSILON=1E-6;Bb.NEWTON_MIN_SLOPE=.02;Bb.NEWTON_ITERATIONS=4;Bb.SUBDIVISION_MAX_ITERATIONS=15;Bb.PRECALC_SIZE=11;Bb.PRECALC_STEP=1/(Bb.PRECALC_SIZE-1);Bb.prototype.calcBezier=function(e,
b,h,n){return((e*n+b)*n+h)*n};Bb.prototype.calcBezierDerivative=function(e,b,h,n){return(3*e*n+2*b)*n+h};Bb.prototype.calcEaseValue=function(e){if(this.isLinear||e<Bb.EPSILON||e>1-Bb.EPSILON)return e;for(var b=0,h=1,n=null,t=e,v=0;v<Bb.PRECALC_SIZE;v++){var q=this.preCalcValues[v];if(q>e){h=v*Bb.PRECALC_STEP;b=(v-1)*Bb.PRECALC_STEP;t=this.preCalcValues[v-1];t=b+(e-t)/(q-t)*(h-b);break}}v=this.calcBezierDerivative(this.Ax,this.Bx,this.Cx,t);if(v>=Bb.NEWTON_MIN_SLOPE)for(var r=0;r<Bb.NEWTON_ITERATIONS;r++){q=
this.calcBezier(this.Ax,this.Bx,this.Cx,t)-e;if(Math.abs(q)<Bb.EPSILON){n=t;break}v=this.calcBezierDerivative(this.Ax,this.Bx,this.Cx,t);if(Math.abs(v)<Bb.EPSILON)break;t-=q/v}if(null===n){n=0;do t=b+.5*(h-b),q=this.calcBezier(this.Ax,this.Bx,this.Cx,t)-e,0<q?h=t:b=t;while(Math.abs(q)>Bb.EPSILON&&++n<Bb.SUBDIVISION_MAX_ITERATIONS);n=t}return this.calcBezier(this.Ay,this.By,this.Cy,n)};var Yg={dataCSV:Bc,dataCSVTable:Pe,tiledUtils:{getNamedLayerIndex:function(e,b){e=e.layers;for(var h=0;h<e.length;h++)if(e[h].name===
b)return h;return-1},getNamedLayer:function(e,b){e=e.layers;for(var h=0;h<e.length;h++)if(e[h].name===b)return e[h];return null}}},Cc=Y.randomVariance,le=new za,U={systems:[],stateCaching:{enabled:!0,minObjectCount:0,createPerFrame:0},System:function(e){this.options=e;this.emitters=[]}};U.System.prototype.onRemoveEmitter=void 0;U.System.prototype.onAddEmitter=void 0;U.System.prototype.emitterConstructor=void 0;U.System.infinite=-1;U.System.statusDead=0;U.System.statusActive=1;U.System.statusAlive=
1;U.System.emitTypeUnknown=0;U.System.emitTypeSingle=1;U.System.emitTypeBurst=2;U.System.emitTypeStream=3;U.System.killParticles=!0;U.System.RENDER_UNKNOWN=0;U.System.RENDER_DOT=1;U.System.RENDER_TRIANGLE=2;U.System.RENDER_BOX=3;U.System.RENDER_SPRITE=4;U.System.RENDER_TEXT=5;U.System.RENDER_CUSTOM=10;U.System.prototype.newEmitter=function(){var e=new (this.emitterConstructor||U.Emitter);this.emitters.push(e);this.options&&this.options.trackBounds&&(e.trackBounds=this.options.trackBounds);if(this.onAddEmitter)this.onAddEmitter(e);
return e};U.System.prototype.getEmitterCount=function(){return this.emitters.length};U.System.prototype.killAllEmitters=function(e){void 0===e&&(e=!0);for(var b=this.emitters.length-1;0<=b;b--)this.emitters[b].die(e)};U.System.prototype.killAllParticles=function(){for(var e=this.emitters.length-1;0<=e;e--)this.emitters[e].killAllParticles()};U.System.prototype.moveEmitterToTop=function(e){for(var b=this.emitters.length-1;0<=b;b--)if(this.emitters[b]===e){this.emitters.splice(b,1);this.emitters.push(e);
break}};U.System.prototype.removeEmitter=function(e){for(var b=this.emitters.length-1;0<=b;b--)if(this.emitters[b]===e){if(this.onRemoveEmitter)this.onRemoveEmitter(this.emitters[b]);this.emitters.splice(b,1);break}};U.System.prototype.appendEmitter=function(e){this.emitters.push(e);if(this.onAddEmitter)this.onAddEmitter(e)};U.System.prototype.update=function(e){da.pushPerfMark("PSystem:Update");for(var b=this.emitters.length-1;0<=b;b--)if(this.emitters[b].update(e)===U.System.statusDead){this.emitters[b].destroy();
if(this.onRemoveEmitter)this.onRemoveEmitter(this.emitters[b]);this.emitters.splice(b,1)}da.popPerfMark("PSystem:Update")};U.System.prototype.draw=function(e){da.pushPerfMark("PSystem:draw");e=e&&e.ctx?e.ctx:gb();var b=gb();ca=e;e.save();for(var h=0;h<this.emitters.length;h++){var n=this.emitters[h];n.flags&U.Emitter.fVisible&&n.draw(e)}e.restore();ca=b;da.popPerfMark("PSystem:draw")};U.System.prototype.applyBoundsToRectList=function(e){for(var b=0;b<this.emitters.length;b++){var h=this.emitters[b];
h.trackBounds&&0<h.bounds.w&&0<h.bounds.h&&e.add(h.bounds)}};U.System.prototype.applyToDirtyRects=U.System.prototype.applyBoundsToRectList;U.Emitter=function(){this.pos=new za(100,100);this.angle=new bc;this.startState=U.State.create();this.startVariance=U.State.create();this.asset=[];this.stateSets=[];this.stateSets[0]={state:this.startState,variance:this.startVariance};this.endState=this.startState;this.startState.color.a=1;this.startState.color.r=255;this.startState.color.g=255;this.startState.color.b=
255;this.startState.ageLimit=1;this.prevBounds={x:this.pos.x,y:this.pos.y,w:0,h:0};this.bounds={x:this.pos.x,y:this.pos.y,w:0,h:0};this.trackBounds=!1;this.particles=[]};U.Emitter.fAutoDie=1;U.Emitter.fAutoDieAfterAgeLimit=4;U.Emitter.fRadialStartVelocity=8;U.Emitter.fRadialStartOffset=16;U.Emitter.fEmitting=256;U.Emitter.fEmitImmediately=512;U.Emitter.fVisible=1024;U.Emitter.fStroke=2048;U.Emitter.fGlobalVelocity=4096;U.Emitter.fGlobalOffset=8192;U.Emitter.fKillParticleAfterAnimation=16384;U.Emitter.prototype.flags=
U.Emitter.fEmitting|U.Emitter.fVisible;U.Emitter.prototype.emitType=U.System.emitTypeStream;U.Emitter.prototype.renderType=U.System.RENDER_UNKNOWN;U.Emitter.prototype.rate=10;U.Emitter.prototype.burstCount=1;U.Emitter.prototype.burstAmount=0;U.Emitter.prototype.emitCounter=0;U.Emitter.prototype.status=U.System.statusActive;U.Emitter.prototype.ageLimit=U.System.infinite;U.Emitter.prototype.age=0;U.Emitter.prototype.font="";U.Emitter.prototype.fontSize=0;U.Emitter.prototype.createEvent=null;U.Emitter.prototype.updateEvent=
null;U.Emitter.prototype.deathEvent=null;U.Emitter.prototype.emitterDeathEvent=null;U.Emitter.prototype.customDraw=null;U.Emitter.prototype.isReadyForUse=!1;U.Emitter.prototype.setFlag=function(e){this.flags|=e};U.Emitter.prototype.clearFlag=function(e){this.flags&=~e};U.Emitter.prototype.isFlag=function(e){return 0!==(this.flags&e)};U.Emitter.prototype.startEmitting=function(){this.setFlag(U.Emitter.fEmitting)};U.Emitter.prototype.stopEmitting=function(){this.clearFlag(U.Emitter.fEmitting)};U.Emitter.prototype.isEmitting=
function(){return this.isFlag(U.Emitter.fEmitting)};U.Emitter.prototype.killAllParticles=function(){if(U.stateCaching.enabled)for(var e=0,b=this.particles.length;e!==b;e++)this.particles[e].destroy&&this.particles[e].destroy();this.particles=[]};U.Emitter.prototype.die=function(e){this.stopEmitting();this.setFlag(U.Emitter.fAutoDie);e&&this.killAllParticles()};U.Emitter.prototype.setVisible=function(e){e?this.setFlag(U.Emitter.fVisible):this.clearFlag(U.Emitter.fVisible)};U.Emitter.prototype.addState=
function(e,b){var h=this.stateSets[this.stateSets.length-1].state.copy();h.keyTime=e;h.keyFlags=b;e={state:h,variance:U.State.create()};this.stateSets.push(e);return e};U.Emitter.prototype.getInitState=function(){return this.stateSets[0]};U.Emitter.prototype.initEndState=function(e,b){e=this.addState(e,b);this.endState=e.state;this.endVariance=e.variance;return e};U.Emitter.prototype.setupStandardBurst=function(e){this.emitType=U.System.emitTypeBurst;this.rate=1;this.emitCounter=1/this.rate+1E-4;
this.burstCount=1;this.burstAmount=e;this.startEmitting()};U.Emitter.prototype.getParticleCount=function(){return this.particles.length};U.Emitter.prototype.readyForUse=function(){var e;for(e=0;e<this.stateSets.length;e++){var b=this.stateSets[e].state;"undefined"===typeof b.keyTime&&(b.keyTime=e/(this.stateSets.length-1));"undefined"===typeof b.keyFlags&&(b.keyFlags=0);"object"!==typeof b.angle&&(b.angle=new bc(b.angle))}"object"!==typeof this.angle&&(this.angle=new bc(this.angle));for(e=0;e<this.stateSets.length-
1;e++)b=this.stateSets[e].state,b.keyTimeLength=this.stateSets[e+1].state.keyTime-b.keyTime;this.stateSets[this.stateSets.length-1].state.keyTimeLength=0;1===this.stateSets.length&&(this.stateSets[this.stateSets.length-1].state.keyTimeLength=1);this.isFlag(U.Emitter.fEmitImmediately)&&(this.emitCounter=1/this.rate+1E-4);this.isReadyForUse=!0};U.Emitter.prototype.changedStates=function(){this.isReadyForUse=!1};U.Emitter.prototype.update=function(e){if(this.renderType===U.System.RENDER_UNKNOWN)return U.System.statusDead;
da.pushPerfMark("Emitter.update");this.isReadyForUse||this.readyForUse();var b;this.trackBounds&&(this.prevBounds=this.bounds,this.bounds={x:this.pos.x,y:this.pos.y,w:0,h:0});if(0<this.rate&&this.isEmitting()&&(this.emitCounter+=e,this.emitCounter>1/this.rate)){da.pushPerfMark("Emitting");this.emitCounter-=1/this.rate;if(this.emitType===U.System.emitTypeStream)this.spawnNewParticle();else if(this.emitType===U.System.emitTypeBurst&&0<this.burstCount){for(b=0;b<this.burstAmount;b++)this.spawnNewParticle();
this.burstCount--;0>=this.burstCount&&(this.rate=0,this.stopEmitting())}da.popPerfMark("Emitting")}da.pushPerfMark("p.update");for(b=this.particles.length-1;0<=b;b--){var h=this.particles[b];h.update(e,this)===U.System.statusDead?(this.deathEvent&&this.deathEvent(this,h),this.particles[b].destroy&&this.particles[b].destroy(),this.particles.splice(b,1)):this.trackBounds&&this.addToBounds(h.state.pos.x-.75*h.state.size,h.state.pos.y-.75*h.state.size,1.5*h.state.size,1.5*h.state.size)}da.popPerfMark("p.update");
da.pushPerfMark("statusUpdate");this.age+=e;0<this.ageLimit&&this.age>this.ageLimit&&(this.stopEmitting(),this.flags&U.Emitter.fAutoDieAfterAgeLimit&&(this.flags|=U.Emitter.fAutoDie));if(this.flags&U.Emitter.fAutoDie){if(0>=this.particles.length)var n=U.System.statusDead}else n=U.System.statusActive;da.popPerfMark("statusUpdate");da.popPerfMark("Emitter.update");n===U.System.statusDead&&this.emitterDeathEvent&&this.emitterDeathEvent(this);return n};U.Emitter.prototype.destroy=function(){if(this.onDestroy)this.onDestroy(this);
this.killAllParticles();if(U.stateCaching.enabled){for(var e=0,b=this.stateSets.length;e!==b;++e)U.State.destroy(this.stateSets[e].state),U.State.destroy(this.stateSets[e].variance);this.stateSets=[];this.isReadyForUse=!1}};U.Emitter.prototype.spawnNewParticle=function(){function e(H,G,K,u,A){H.x=K.x;H.y=K.y;K=le;G.flags&U.Emitter.fRadialStartOffset?(B=Y.random()*Y.PI2,K.setFromAngle(B),K.scale(u.offset.x+Cc(A.offset.x))):(K.x=u.offset.x+Cc(A.offset.x),K.y=u.offset.y+Cc(A.offset.y));G.isFlag(U.Emitter.fGlobalOffset)||
(K=G.angle.rotateVector(K));H.x+=K.x;H.y+=K.y}da.pushPerfMark("spawnNewParticle");var b=new U.One;var h=this.stateSets;da.pushPerfMark("setupStates");for(var n=0,t=h.length;n!==t;++n){var v=U.State.create();var q=h[n].state;var r=h[n].variance;v.keyTime=q.keyTime;v.keyTimeLength=q.keyTimeLength;v.size=q.size;v.grow=q.grow;v.roll=q.roll;v.friction=q.friction;v.color.r=q.color.r;v.color.g=q.color.g;v.color.b=q.color.b;v.color.a=q.color.a;this.posInterp&&e(v.pos,this,q.pos,q,r);r.size&&(v.size+=2*r.size*
Y.random()-r.size);r.grow&&(v.grow+=2*r.grow*Y.random()-r.grow);r.roll&&(v.roll+=2*r.roll*Y.random()-r.roll);r.friction&&(v.friction+=2*r.friction*Y.random()-r.friction);r.color.r&&(v.color.r+=2*r.color.r*Y.random()-r.color.r,v.color.r=0>v.color.r?0:255<v.color.r?255:v.color.r|0);r.color.g&&(v.color.g+=2*r.color.g*Y.random()-r.color.g,v.color.g=0>v.color.g?0:255<v.color.g?255:v.color.g|0);r.color.b&&(v.color.b+=2*r.color.b*Y.random()-r.color.b,v.color.b=0>v.color.b?0:255<v.color.b?255:v.color.b|0);
r.color.a&&(v.color.a+=2*r.color.a*Y.random()-r.color.a,v.color.a=0>v.color.a?0:1<v.color.a?1:v.color.a);b.states[n]=v}da.popPerfMark("setupStates");da.pushPerfMark("initialState");b.state.size=b.states[0].size;b.state.grow=b.states[0].grow;b.state.color.a=b.states[0].color.a;b.state.color.r=b.states[0].color.r;b.state.color.g=b.states[0].color.g;b.state.color.b=b.states[0].color.b;b.state.friction=b.states[0].friction;b.state.roll=b.states[0].roll;e(b.state.pos,this,this.pos,this.startState,this.startVariance);
b.state.angle.angle=this.angle.angle;b.state.angle.angle+=this.startState.angle.angle+Cc(this.startVariance.angle.angle);if(this.flags&U.Emitter.fRadialStartVelocity){var B=Y.random()*Y.PI2;b.state.vel=new za;b.state.vel.setFromAngle(B);b.state.vel.scale(this.startState.vel.x+Cc(this.startVariance.vel.x))}else b.state.vel=new za(this.startState.vel.x+Cc(this.startVariance.vel.x),this.startState.vel.y+Cc(this.startVariance.vel.y));b.state.accel=new za(this.startState.accel.x+Cc(this.startVariance.accel.x),
this.startState.accel.y+Cc(this.startVariance.accel.y));this.isFlag(U.Emitter.fGlobalVelocity)||(b.state.vel=this.angle.rotateVector(b.state.vel));b.ageLimit=this.startState.ageLimit+Cc(this.startVariance.ageLimit);da.popPerfMark("initialState");b.asset=null;this.renderType===U.System.RENDER_SPRITE?(h=this.asset,this.assetSpawnFunction&&(h=this.assetSpawnFunction(this)),Array.isArray(h)&&(h=h[Y.random()*h.length|0]),b.setImageAsset(h)):this.renderType===U.System.RENDER_TEXT&&(h=this.asset,Array.isArray(this.asset)&&
(h=this.asset[Y.random()*this.asset.length|0]),b.text=h);if(this.createEvent&&(da.pushPerfMark("createEvent"),h=this.createEvent(this,b),da.popPerfMark("createEvent"),!1===h)){da.popPerfMark("spawnNewParticle");return}b.state.posCalculated.x=b.state.pos.x;b.state.posCalculated.y=b.state.pos.y;this.trackBounds&&this.addToBounds(b.state.pos.x-.75*b.state.size,b.state.pos.y-.75*b.state.size,1.5*b.state.size,1.5*b.state.size);this.particles.push(b);da.popPerfMark("spawnNewParticle");return b};U.Emitter.prototype.addToBounds=
function(e,b,h,n){e<this.bounds.x&&(this.bounds.w+=this.bounds.x-e,this.bounds.x=e);b<this.bounds.y&&(this.bounds.h+=this.bounds.y-b,this.bounds.y=b);e+h>this.bounds.x+this.bounds.w&&(this.bounds.w=e+h-this.bounds.x);b+n>this.bounds.y+this.bounds.h&&(this.bounds.h=b+n-this.bounds.y)};U.Emitter.prototype.spawn=function(e){"undefined"===typeof e&&(e=1);for(var b,h=0;h<e;h++)b=this.spawnNewParticle();return b};U.Emitter.prototype.draw=function(e){da.pushPerfMark("Emitter.Draw");this.preDraw&&this.preDraw(e,
this);var b=!1;this.renderType===U.System.RENDER_TEXT&&(e.textBaseline="middle",e.textAlign="center",this.flags&U.Emitter.fStroke&&(b=!0));da.pushPerfMark("particle.Draw");for(var h=0;h<this.particles.length;h++){var n=this.particles[h],t=n.state;e.save();e.translate(t.pos.x,t.pos.y);t.angle.angle&&e.rotate(t.angle.angle);if(this.renderType===U.System.RENDER_BOX){var v=t.size;e.fillStyle=t.color.toString();e.fillRect(-v/2,-v/2,v,v)}else if(this.renderType===U.System.RENDER_TRIANGLE){v=t.size/2;var q=
Y.PI2/3;e.fillStyle=t.color.toString();e.beginPath();e.moveTo(v,0);e.lineTo(Y.cos(q)*v,Y.sin(q)*v);e.lineTo(Y.cos(2*q)*v,Y.sin(2*q)*v);e.closePath();e.fill()}else if(this.renderType===U.System.RENDER_DOT)e.fillStyle=t.color.toString(),e.beginPath(),v=t.size/2,e.arc(0,0,v,0,1.9999*Y.PI,!1),e.closePath(),e.fill();else if(this.renderType===U.System.RENDER_SPRITE){if(n.asset)if(e.globalAlpha=t.color.a,v=t.size*n.scaleWidth,t=t.size*n.scaleHeight,n.asset.isImageRef){var r=n.asset.image,B=n.asset.frame;
q=n.asset.flags;var H=!!r.frames,G=r.getImageFrame(H?0:B),K=0,u=0;G&&(H?(r=r.frames[B],K=v/r.origSize.w,u=t/r.origSize.h,B=r.box.w*K,H=r.box.h*u,K*=r.trimRect.x,u*=r.trimRect.y,q&xa.centeredX&&(K-=v/2),q&xa.centeredY&&(u-=t/2),e.drawImage(G,r.drawBox.x,r.drawBox.y,r.drawBox.w,r.drawBox.h,K,u,B,H)):(q&xa.centeredX&&(K=-v/2),q&xa.centeredY&&(u=-t/2),e.drawImage(G,K,u,v,t)))}else e.drawImage(n.asset,0,0,n.asset.width,n.asset.height,-v/2,-t/2,v,t)}else this.renderType===U.System.RENDER_TEXT?(e.font=(t.size*
this.fontSize|0)+"px "+this.font,b&&(e.strokeStyle="rgba("+(t.color.r>>3)+","+(t.color.g>>3)+","+(t.color.b>>3)+","+t.color.a+")",e.lineWidth=12,e.strokeText(n.text,0,0)),e.fillStyle=t.color.toString(),e.fillText(n.text,0,0)):this.renderType!==U.System.RENDER_CUSTOM&&z.logError("Error:  Unknown particle render type");this.customDraw&&this.customDraw(e,n,this);e.restore()}da.popPerfMark("particle.Draw");this.postDraw&&this.postDraw(e,this);da.popPerfMark("Emitter.Draw")};U.Emitter.prototype.setAdditive=
function(){this.preDraw=U.Emitter.preDrawAdditive;this.postDraw=U.Emitter.postDrawAdditive};U.Emitter.preDrawAdditive=function(e,b){b.oldOperation=e.globalCompositeOperation;e.globalCompositeOperation="lighter"};U.Emitter.postDrawAdditive=function(e,b){e.globalCompositeOperation=b.oldOperation};U.State=function(){this.pos=new za;this.offset=new za;this.angle=new bc;this.vel=new za;this.accel=new za;this.color=new O(0,0,0,0);this.protoObject=U.State.prototype};U.State.prototype.size=0;U.State.prototype.grow=
0;U.State.prototype.roll=0;U.State.prototype.ageLimit=0;U.State.prototype.friction=0;U.State.prototype.nextInCache=void 0;U.State.prototype.reset=function(){this.size=this.protoObject.size;this.grow=this.protoObject.grow;this.roll=this.protoObject.roll;this.ageLimit=this.protoObject.ageLimit;this.friction=this.protoObject.friction;this.keyFlags=this.keyTime=this.nextInCache=void 0;this.pos=new za;this.offset.x=0;this.offset.y=0;this.angle.angle=0;this.vel.x=0;this.vel.y=0;this.accel.x=0;this.accel.y=
0;this.color.r=0;this.color.g=0;this.color.b=0;this.color.a=0};U.State.prototype.copy=function(){var e=U.State.create();e.size=this.size;e.grow=this.grow;e.roll=this.roll;e.ageLimit=this.ageLimit;e.friction=this.friction;e.keyTime=this.keyTime;e.keyFlags=this.keyFlags;e.pos.x=this.pos.x;e.pos.y=this.pos.y;e.offset.x=this.offset.x;e.offset.y=this.offset.y;e.angle.angle=this.angle.angle;e.vel.x=this.vel.x;e.vel.y=this.vel.y;e.accel.x=this.accel.x;e.accel.y=this.accel.y;e.color.r=this.color.r;e.color.g=
this.color.g;e.color.b=this.color.b;e.color.a=this.color.a;return e};U.State.cache=void 0;U.State.cacheSize=0;U.State.count=0;U.State.create=function(){if(U.State.cache){var e=U.State.cache;U.State.cache=e.nextInCache;--U.State.cacheSize;e.reset();return e}++U.State.count;return new U.State};U.State.destroy=function(e){e&&(e.nextInCache=U.State.cache,U.State.cache=e,++U.State.cacheSize)};U.State.FillCache=function(e){e=U.stateCaching.minObjectCount-U.State.count;if(0<e){for(var b=Y.min(e,U.stateCaching.createPerFrame),
h=b;0<h;--h)U.State.destroy(new U.State),++U.State.count;e-=b}0>=e&&mc&&mc.removeUpdater(U.State.FillCache)};U.One=function(){this.state=U.State.create();this.states=[];this.ageLimit=this.age=0;this.pos=this.state.pos;this.state.posCalculated=new za;this.curKeyIndex=0};U.One.prototype.copy=function(){var e=new U.One;for(b in this)e[b]=this[b];e.pos=this.pos.copy();e.state=this.state.copy();var b=this.states.length;e.states=[];for(var h=0;h<b;h++)e.states[h]=this.states[h].copy();return e};U.One.prototype.update=
function(e,b){var h=U.System.statusActive,n=this.age/this.ageLimit;var t=this.states.length-1;for(var v=this.curKeyIndex+1;v<t;v++)n>=this.states[v].keyTime&&(this.curKeyIndex=v);v=this.curKeyIndex;var q=v+1;q>t?(q=v,t=0):(t=(n-this.states[v].keyTime)/this.states[v].keyTimeLength,t=0>t?0:1<t?1:t);v=this.states[v];var r=this.states[q];q=this.state;q.size+=q.grow*e;0>q.size&&(q.size=0);var B=q.vel,H=q.friction;0<H&&(H=1-H*e,B.x*=H,B.y*=H);H=q.accel;B.x+=H.x*e;B.y+=H.y*e;H=q.posCalculated;H.x+=B.x*e;
H.y+=B.y*e;b.posInterp?(b.posInterp(v.pos,r.pos,le,t,n),q.pos.x=Y.interpolate(H.x,le.x,n),q.pos.y=Y.interpolate(H.y,le.y,n)):(q.pos.x=H.x,q.pos.y=H.y);q.angle.angle+=q.roll*e;this.asset&&this.asset.isImageRef&&(this.asset.update(e),b.flags&U.Emitter.fKillParticleAfterAnimation&&this.asset.animOneShot&&(t=this.asset.getAnimCompletion(),1<=t&&(h=U.System.statusDead)));b=1-t;r.color.r!==v.color.r?(n=r.color.r*t+b*v.color.r,q.color.r=0>n?0:255<n?255:n|0):q.color.r=r.color.r;r.color.g!==v.color.g?(n=r.color.g*
t+b*v.color.g,q.color.g=0>n?0:255<n?255:n|0):q.color.g=r.color.g;r.color.b!==v.color.b?(n=r.color.b*t+b*v.color.b,q.color.b=0>n?0:255<n?255:n|0):q.color.b=r.color.b;r.color.a!==v.color.a?(t=r.color.a*t+b*v.color.a,q.color.a=0>t?0:1<t?1:t):q.color.a=r.color.a;this.age+=e;this.age>=this.ageLimit&&(h=U.System.statusDead);return h};U.One.prototype.setImageAsset=function(e,b){e.isImageRef?(this.asset=new Fa(e),e=e.getSize(),this.scaleWidth=1,this.scaleHeight=e.h/e.w):0<e.width&&0<e.height&&(this.asset=
e,this.scaleWidth=1,this.scaleHeight=e.width/e.height)};U.One.prototype.destroy=function(){U.State.destroy(this.state);this.state=void 0;for(var e=0,b=this.states.length;e!==b;++e)U.State.destroy(this.states[e]);this.states=[]};U.createSystem=function(e){e=new U.System(e);return U.systems[U.systems.length]=e};U.removeSystem=function(e){for(var b=U.systems.length,h=0;h<b;h++)if(U.systems[h]===e){U.systems.splice(h,1);break}};U.getSystemCount=function(){return U.systems.length};U.getAllEmitterCount=
function(){for(var e=0,b=U.systems.length,h=0;h<b;h++){var n=U.systems[h].getEmitterCount();e+=n}return e};U.getAllParticleCount=function(){for(var e=U.systems.length,b=0,h=0;h<e;h++)for(var n=U.systems[h].getEmitterCount(),t=0;t<n;t++)b+=U.systems[h].emitters[t].getParticleCount();return b};U.init=function(e){U.stateCaching.enabled?(0>=U.stateCaching.createPerFrame&&(U.stateCaching.createPerFrame=U.stateCaching.minObjectCount,U.State.FillCache(0),U.stateCaching.createPerFrame=0),mc&&mc.addUpdater(U.State.FillCache)):
(U.stateCaching.minObjectCount=0,U.stateCaching.createPerFrame=0)};var hc=function(){this.currentFocus=[]};hc.prototype.reset=function(e){this.currentFocus[e||0]={exclusive:null}};hc.prototype.resetAll=function(){for(var e in this.currentFocus)this.currentFocus[e]={exclusive:null}};hc.prototype.setExclusive=function(e,b,h){void 0===h&&(h=9999999);e=e||0;this.currentFocus[e]||(this.currentFocus[e]={});this.currentFocus[e].exclusive=b;this.currentFocus[e].exclusivePriority=h};hc.prototype.remove=function(e,
b){e=e||0;this.currentFocus[e]||(this.currentFocus[e]={});this.currentFocus[e].exclusive===b&&(this.currentFocus[e].exclusive=null,this.currentFocus[e].priority=9999999)};hc.prototype.removeAll=function(e){for(var b in this.currentFocus)this.remove(b,e)};hc.prototype.getExclusive=function(e){e=e||0;return this.currentFocus[e]?this.currentFocus[e].exclusive:null};hc.prototype.getFocus=hc.prototype.getExclusive;hc.prototype.getExclusivePriority=function(e){e=e||0;return this.currentFocus[e]&&this.currentFocus[e].exclusive&&
void 0!==this.currentFocus[e].exclusivePriority?this.currentFocus[e].exclusivePriority:9999999};hc.prototype.startLostElementCheck=function(e){this.currentFocus[e]&&this.currentFocus[e].exclusive&&(this.currentFocus[e].exclusive.traverseOrderIndex=9999999)};hc.prototype.finishLostElementCheck=function(e){this.currentFocus[e]&&this.currentFocus[e].exclusive&&9999999===this.currentFocus[e].exclusive.traverseOrderIndex&&this.removeAll(this.currentFocus[e].exclusive)};var Pd={debugOffscreens:!1,allowOffscreens:$a.allowOffscreens};
z.registerCommand("debugOffscreens",function(){Pd.debugOffscreens=!Pd.debugOffscreens},["debugOffscreen","showOffscreens"]);var Dc=new hc,vg=Object.freeze({__proto__:null,settings:Pd,focusTracker:Dc}),Wa={constructables:{},addConstructable:function(e,b){Wa.constructables[e]=b},inDesignTime:!1};Wa.calcBounds=te.calcBounds;Wa.getSetupCallsForType=function(e){"Container"===e&&(e="Element");Wa.constructables[e]||(z.logWarning("WARNING! Unknown pane type '"+e+"' hit in createPaneFromData.  Falling back to Element."),
e="Element");var b=Wa.constructables[e];if(!b)return z.logError("Unable to find createFromData for element of type "+e),null;for(var h=b;h&&!h.setupFromData;)h=h.prototype?h.prototype.parentConstructor:void 0;h||(z.logWarning("WARNING! Unable to find setupFromData for element of type "+e+".  Reverting to Element"),h=Wa.constructables.Element);return{paneType:e,elementClass:b,setupClass:h}};Wa.createPaneFromData=function(e,b){if(e._editor&&e._editor.designTimeOnly)return null;b=b?b.getBounds():{x:0,
y:0,w:0,h:0};var h=Wa.getSetupCallsForType(e.type),n=new h.elementClass;h.setupClass.setupFromData&&h.setupClass.setupFromData(n,e,b);Wa.createChildrenFromData(n,e.children);if(e.onCreate)e.onCreate(n);return n};Wa.createChildrenFromData=function(e,b){if(e&&b)for(var h=0;h!==b.length;++h){var n=Wa.createPaneFromData(b[h],e);n&&e.appendSubElement(n)}};Wa.createTreeFromData=function(e,b){return Wa.createPaneFromData(e,{getBounds:function(){return b?b:new ub.Rect(0,0,Ha,Ra)}})};Wa.preLoadAssetsFromData=
function(e){var b=[];0<b.length&&Oa.preLoadImages(b);(function t(n){if("object"===typeof n&&null!==n)for(var v in n){var q=n[v];if(void 0!==q&&Yb(n,v))if("string"===typeof q){var r=q.substring(q.length-4).toLowerCase();".png"!==r&&".jpg"!==r&&".gif"!==r&&".svg"!==r&&".bmp"!==r&&".ico"!==r||b.push(q)}else"object"===typeof q&&t(q)}})(e)};Wa.getParentDataSetupClass=function(e){do e&&(e=e.prototype?e.prototype.parentConstructor:void 0);while(e&&!e.setupFromData);return e};Wa.callParentSetupFromData=function(e,
b,h,n){(e=Wa.getParentDataSetupClass(e))&&e.setupFromData(b,h,n)};Wa.canSetupFromData=function(e){return e.setupFromData||Wa.getParentDataSetupClass(e)?!0:!1};var Sa={ref:null,userRef:null,sessionRef:null,id:0,enableUIRecording:!1,init:function(e,b){Sa.ref=null;"undefined"!==typeof Firebase&&(Sa.ref=new Firebase(e));if(Sa.ref){b=b||{trackSessionTime:!0};Sa.opts=b;e=Qa.getStorage(Qa.permanentLocal);b=e.getItem("rat_anon_id");if(!b){var h=new Date;b=h.getUTCFullYear()-2E3;var n=""+(h.getUTCMonth()+
1);10>n&&(n="0"+n);h=""+h.getUTCDate();10>h&&(h="0"+h);b="rid_"+b+n+h+"_"+Math.floor(1E8*Math.random());e.setItem("rat_anon_id",b);console.log(b)}Sa.id=b;Sa.userRef=Sa.ref.child(b);"undefined"!==typeof navigator&&(e={},e.appCodeName=navigator.appCodeName||0,e.appName=navigator.appName||0,e.appVersion=navigator.appVersion||0,e.platform=navigator.platform||0,e.userAgent=navigator.userAgent||0,e.cpuClass=navigator.cpuClass||0,Sa.userRef.child("clientInfo").set(e));e=(new Date).toUTCString();Sa.sessionRef=
Sa.userRef.child("sessions").push({timeStart:e,server_ts:Firebase.ServerValue.TIMESTAMP});Sa.sessionRef.child("server_te").onDisconnect().set(Firebase.ServerValue.TIMESTAMP);this.sLog=""}else z.logError("telemetry initialized, but no system is hooked up.")},userIncrement:function(e,b){if(Sa.ref&&Sa.userRef){b||(b=1);try{Sa.userRef.child(e).transaction(function(h){return h+b})}catch(h){}}},userWrite:function(e,b){Sa.ref&&Sa.userRef&&(b||(b=!0),Sa.userRef.child(e).set(b))},sessionIncrement:function(e,
b){if(Sa.ref&&Sa.sessionRef){b||(b=1);try{Sa.sessionRef.child(e).transaction(function(h){return h+b})}catch(h){}Sa.trackSessionTime()}},sessionLog:function(e,b){Sa.ref&&Sa.userRef&&(this.sLog+=""+e,("undefined"===typeof b||b)&&this.sessionWrite("log",this.sLog))},sessionWrite:function(e,b){Sa.ref&&Sa.userRef&&(Sa.sessionRef.child(e).set(b),Sa.trackSessionTime())},trackSessionTime:function(){if(Sa.opts.trackSessionTime){var e=(new Date).toUTCString();Sa.sessionRef.child("timeLast").set(e)}},globalIncrement:function(e,
b){Sa.ref&&(b||(b=1),Sa.ref.child("global").child(e).transaction(function(h){return h+b}))},record:function(e,b){if(Sa.ref&&Sa.sessionRef)try{var h=new Date,n=h.getTime(),t=h.getUTCHours(),v=h.getUTCMinutes(),q=h.getUTCSeconds();Sa.sessionRef.child((9>t?"0":"")+t+"_"+(9>v?"0":"")+v+"_"+(9>q?"0":"")+q+"_"+e).setWithPriority(b,n)}catch(r){}},recordUI:function(e,b){Sa.enableUIRecording&&Sa.record(e,b)}},w=function h(b){void 0===this.id&&(this.id=this.uniqueID=h.nextElementID++,this.place=new Mf(0,0,
0),this.center=new za(0,0),this.color=new O,this.size=new za(0,0),this.scale=new za(1,1),this.opacity=1,this.tempRect=new ub.Rect,this.contentOffset=new za(0,0),this.contentSize=new za(0,0),this.contentScale=new za(1,1),this.contentScaleMin=new za(.1,.1),this.contentScaleMax=new za(10,10),this.flags=0,this.flags|=h.enabledFlag,this.flags|=h.visibleFlag,this.flags|=h.tracksMouseFlag,this.name="ui-"+this.id,this.commandInfo=this.command=0,this.callbackInfo=this.callback=null,this.events={},this.frameWidth=
0,this.frameColor=new O(0,0,0),this.frameOutset=0,this.offscreen=null,this.useOffscreen=!1,this.needsUpdate=this.isDirty=!0,b?b.appendSubElement(this):this.parent=null,this.toolTip=null)};w.nextElementID=1;w.nextTraverseOrderIndex=0;w.mouseMoveCallCount=0;w.updateCallCount=0;w.prototype.elementType="element";w.prototype.extraBoundsRadiusX=0;w.prototype.extraBoundsRadiusY=0;w.highlightedFlag=1;w.enabledFlag=2;w.pressedFlag=4;w.toggledFlag=8;w.visibleFlag=16;w.clipFlag=32;w.targetableFlag=64;w.targetedFlag=
128;w.mouseInFlag=256;w.trackingMouseDownFlag=512;w.tracksMouseFlag=1024;w.handleAllMouseInMe=2048;w.exclusiveHighlightFlag=524288;w.autoSizeAfterLoadFlag=4096;w.autoCenterAfterLoadFlag=8192;w.autoScaleAfterLoadFlag=16384;w.adjustForScaleFlag=65536;w.unSmoothFlag=131072;w.drawTiledFlag=1048576;w.prototype.flagsThatDirtyMe=w.visibleFlag;w.prototype.flagsThatDirtyParent=w.visibleFlag;w.prototype.appendSubElement_unsafe=function(b){this.subElements?this.subElements.push(b):this.subElements=[b];b.parent=
this;b.toolTip&&b.toolTipScreenWasAssumed&&(b.toolTipScreen=b.getTopParent());this.setDirty(!0);this.setNeedsUpdate(!0)};w.prototype.appendSubElement=function(b){this.findSubElementByUniqueID(b.uniqueID,!1)&&z.logWarningOnce("WARNING: appending subelement with duplicate ID:  "+b.uniqueID,"dupID");this.appendSubElement_unsafe(b)};w.prototype.appendSubElementAfter=function(b,h){return this.insertSubElement(b,h+1)};w.prototype.appendSubElementAfterElement=function(b,h){var n=this.getSubElementIndex(h);
0>n&&(z.logErrorOnce("ERROR: attempting append after element not in tree: "+h.uniqueID,"noAfterElem"),n=0);return this.appendSubElementAfter(b,n)};w.prototype.insertSubElement=function(b,h){this.findSubElementByUniqueID(b.uniqueID)&&z.logWarningOnce("WARNING: appending subelement with duplicate ID:  "+b.uniqueID,"dupID");void 0===h&&(h=0);this.subElements?this.subElements.splice(h,0,b):this.subElements=[b];b.parent=this;b.toolTip&&b.toolTipScreenWasAssumed&&(b.toolTipScreen=b.getTopParent());this.setDirty(!0)};
w.prototype.insertSubElementBefore=function(b,h){var n=this.getSubElementIndex(h);0>n&&(z.logErrorOnce("ERROR: attempting insert before element not in tree: "+h.uniqueID,"noBeforeElem"),n=0);this.insertSubElement(b,n)};w.prototype.replaceSubElement=function(b,h){var n=this.getSubElementIndex(b);0>n?z.logErrorOnce("ERROR: replaceSubElement failed to find: "+b.uniqueID,"noReplaceElem"):(h.parent=this,h.setPos(b.getPos()),h.setSize(b.getSize()),this.subElements[n]=h,this.setDirty(!0))};w.prototype.moveSubElementToFront=
function(b){var h=this.getSubElementIndex(b);0<=h&&(this.subElements.splice(h,1),this.subElements.push(b),this.setDirty(!0))};w.prototype.moveSubElementBefore=function(b,h){var n=this.getSubElementIndex(b);0<=n&&(this.subElements.splice(n,1),this.insertSubElementBefore(b,h))};w.prototype.handleRemovedFromParent=function(){this.flags&w.tracksMouseFlag&&Dc.removeAll(this)};w.prototype.getParent=function(){return this.parent};w.prototype.getTopParent=function(){for(var b=this;b.parent;)b=b.parent;return b};
w.prototype.removeSubElementByID=function(b){if(this.subElements){var h;for(h=0;h<this.subElements.length;h++)if(this.subElements[h].id===b)return this.handleRemovedFromParent(),this.subElements.splice(h,1),this.setDirty(!0),!0;for(h=0;h<this.subElements.length;h++)if(this.subElements[h].removeSubElementByID(b))return this.setDirty(!0),!0}return!1};w.prototype.removeSubElementByUniqueID=function(b){if(this.subElements){var h;for(h=0;h<this.subElements.length;h++)if(this.subElements[h].uniqueID===
b)return this.handleRemovedFromParent(),this.subElements.splice(h,1),this.setDirty(!0),!0;for(h=0;h<this.subElements.length;h++)if(this.subElements[h].removeSubElementByID(b))return this.setDirty(!0),!0}return!1};w.prototype.removeSubElement=function(b){return this.removeSubElementByUniqueID(b.uniqueID)};w.prototype.removeFromParent=function(){this.parent&&this.parent.removeSubElement(this)};w.prototype.detachAllChildren=function(){var b=this.subElements||[];this.subElements=void 0;for(var h=0;h!==
b.length;++h)b[h].parent=null;this.setDirty(!0);return b};w.prototype.removeAllSubElements=function(b){if(this.subElements)for(var h=0;h<this.subElements.length;h++)this.subElements[h].removeAllSubElements(!0);b&&this.killMyAnimators&&this.killMyAnimators();this.subElements=[];this.setDirty(!0)};w.prototype.findSubElementByID=function(b,h){void 0===h&&(h=!0);var n;if(this.subElements)for(var t=0;t!==this.subElements.length;++t)if(n=this.subElements[t])if(n.id===b||h&&(n=this.subElements[t].findSubElementByID(b,
h)))return n};w.prototype.findSubElementByUniqueID=function(b,h){void 0===h&&(h=!0);var n;if(this.subElements)for(var t=0;t!==this.subElements.length;++t)if(n=this.subElements[t])if(n.uniqueID===b||h&&(n=this.subElements[t].findSubElementByUniqueID(b,h)))return n};w.prototype.getSubElement=function(b){return!this.subElements||this.subElements.length<b?null:this.subElements[b]};w.prototype.getSubElementIndex=function(b){if(this.subElements)for(var h=0;h<this.subElements.length;++h)if(this.subElements[h].uniqueID===
b.uniqueID)return h;return-1};w.prototype.getSubElementCount=function(b){return this.subElements?this.subElements.length:0};w.prototype.dumpTree=function(b,h){"undefined"===typeof b&&(b=0);var n=this.isVisible();h||(h={lines:[],totalCount:0,hiddenCount:0,updateCount:0,parentHidden:!1});h.totalCount++;var t=h.totalCount;this.needsUpdate&&h.updateCount++;n&&!h.parentHidden||h.hiddenCount++;var v=h.lines.length;h.lines.push("");if(this.subElements){var q=h.parentHidden;n||(h.parentHidden=!0);this.useOffscreen&&
(h.parentHidden=!0);for(r=0;r<this.subElements.length;r++)this.subElements[r].dumpTree(b+1,h);h.parentHidden=q}q="";var r;for(r=0;r<b;r++)q+="._";b=this.getBounds();b.x=""+Y.floor(100*b.x)/100;b.y=""+Y.floor(100*b.y)/100;b.w=""+Y.floor(100*b.w)/100;b.h=""+Y.floor(100*b.h)/100;r="";this.xuiElemType&&(r=" "+this.xuiElemType);var B="";h.totalCount>t&&(B=" subCount: "+(h.totalCount-t));t=this.constructor?"("+this.constructor.name+")":"";n=n?"vis":"!vis";this.useOffscreen&&(n="Offscreen");h.parentHidden&&
(n="("+n+")");h.lines[v]=q+this.id+": "+this.elementType+" :"+this.name+t+r+" : "+n+" : "+(this.needsUpdate?"upd":"!upd")+" : "+b.x+", "+b.y+" ("+b.w+" x "+b.h+")"+B;return h};w.prototype.setColor=function(b){var h=this.color;"string"===typeof b&&(b=new O(b));this.color=b;this.color.equal(h)||this.setDirty(!0)};w.prototype.getColor=function(){return this.color?this.color.copy():null};w.prototype.setSize=function(b,h){void 0!==b.h?(h=b.h,b=b.w):void 0!==b.x&&(h=b.y,b=b.x);if(this.size.x!==b||this.size.y!==
h)this.size.x=b,this.size.y=h,this.boundsChanged()};w.prototype.setWidth=function(b){this.size.x!==b&&(this.size.x=b,this.boundsChanged())};w.prototype.setHeight=function(b){this.size.y!==b&&(this.size.y=b,this.boundsChanged())};w.prototype.setBounds=function(b,h,n,t){void 0!==b.x?(this.place.pos.x=b.x,this.place.pos.y=b.y,this.size.x=b.w,this.size.y=b.h):(this.place.pos.x=b,this.place.pos.y=h,this.size.x=n,this.size.y=t);this.boundsChanged()};w.prototype.getSize=function(){var b={};b.x=this.size.x;
b.y=this.size.y;b.w=this.size.x;b.h=this.size.y;return b};w.prototype.getWidth=function(){return this.size.x};w.prototype.getHeight=function(){return this.size.y};w.prototype.setContentSize=function(b,h){this.contentSize.x=b;this.contentSize.y=h};w.prototype.setContentSizeFromSubElements=function(){var b=this.calculateContentBounds();this.setContentSize(b.w,b.h)};w.prototype.setBoundsFromContent=function(b){var h=this.calculateContentBounds(),n=h.x-b,t=h.y-b;this.setPos(this.place.pos.x+n,this.place.pos.y+
t);for(var v=0;this.subElements&&v<this.subElements.length;v++){var q=this.subElements[v];q.setPos(q.place.pos.x-n,q.place.pos.y-t)}this.setSize(h.w+2*b,h.h+2*b)};w.prototype.calculateBoundsForElements=function(b){for(var h=9999,n=-9999,t=9999,v=-9999,q=0;b&&q<b.length;q++){var r=b[q],B=r.place,H=B.pos.x-r.center.x,G=B.pos.y-r.center.y,K=Math.cos(B.rot.angle),u=Math.sin(B.rot.angle);B=function(A,E){var S=H+A*K-E*u;A=G+A*u+E*K;S<h&&(h=S);S>n&&(n=S);A<t&&(t=A);A>v&&(v=A)};B(0,0);B(r.size.x*r.scale.x,
0);B(r.size.x*r.scale.x,r.size.y*r.scale.y);B(0,r.size.y*r.scale.y)}return{x:h,y:t,w:n-h,h:v-t}};w.prototype.calculateContentBounds=function(){return this.calculateBoundsForElements(this.subElements)};w.prototype.getContentSize=function(){return this.contentSize.copy()};w.prototype.setPos=function(b,h){void 0!=b.x&&(h=b.y,b=b.x);if(this.place.pos.x!==b||this.place.pos.y!==h)this.place.pos.x=b,this.place.pos.y=h,this.boundsChanged()};w.prototype.getPos=function(){return this.place.pos};w.prototype.getPosX=
function(){return this.place.pos.x};w.prototype.getPosY=function(){return this.place.pos.y};w.prototype.setPosX=function(b){this.place.pos.x!==b&&(this.place.pos.x=b,this.boundsChanged())};w.prototype.setPosY=function(b){this.place.pos.y!==b&&(this.place.pos.y=b,this.boundsChanged())};w.prototype.setScale=function(b,h){b&&b.x&&b.y&&(h=b.y,b=b.x);void 0===h&&(h=b);this.scale.x=b;this.scale.y=h;this.parent&&this.parent.setDirty(!0)};w.prototype.getScale=function(){return this.scale};w.prototype.getScaleX=
function(){return this.scale.x};w.prototype.getScaleY=function(){return this.scale.y};w.prototype.setRotation=function(b){this.place.rot.angle=b;this.parent&&this.parent.setDirty(!0)};w.prototype.getRotation=function(){return this.place.rot.angle};w.prototype.setOpacity=function(b){this.opacity!==b&&(this.opacity=b,this.parent&&this.parent.setDirty(!0))};w.prototype.getOpacity=function(){return this.opacity};w.prototype.setOpacityRecursive=function(b){this.applyRecursively(w.prototype.setOpacity,
b)};w.prototype.setID=function(b){this.id=b};w.prototype.setFrame=function(b,h,n){this.frameWidth=b;"undefined"!==typeof h?"string"===typeof h?this.frameColor.copyFrom(O.makeFromStyleString(h)):this.frameColor.copyFrom(h):void 0===h&&this.frameColor.copyFrom(O.white);"undefined"!==typeof n&&(this.frameOutset=n);this.parent&&this.parent.setDirty(!0)};w.prototype.setFrameRandom=function(b){this.frameWidth=b;this.frameColor.setRandom();this.parent&&this.parent.setDirty(!0)};w.prototype.getGlobalPos=
function(b,h){void 0===b&&(h=b=0);void 0!==b.x&&(h=b.y,b=b.x);var n=this;do b-=n.center.x,h-=n.center.y,b*=n.scale.x,h*=n.scale.y,b+=n.place.pos.x,h+=n.place.pos.y,n.parent&&(b*=n.parent.contentScale.x,h*=n.parent.contentScale.y,b+=n.parent.contentOffset.x,h+=n.parent.contentOffset.y),n=n.parent;while(n);return{x:b,y:h}};w.prototype.localToGlobalPos=w.prototype.getGlobalPos;w.prototype.getGlobalContentPos=function(b,h){"undefined"===typeof b&&(h=b=0);void 0!==b.x&&(h=b.y,b=b.x);b*=this.contentScale.x;
h*=this.contentScale.y;b+=this.contentOffset.x;h+=this.contentOffset.y;return this.getGlobalPos(b,h)};w.prototype.parentToLocalPos=function(b,h){b=new za(b,h);b.x-=this.place.pos.x;b.y-=this.place.pos.y;b.x/=this.scale.x;b.y/=this.scale.y;return b};w.prototype.parentToLocalContentPos=function(b,h){b=this.parentToLocalPos(b,h);b.x-=this.contentOffset.x;b.y-=this.contentOffset.y;b.x/=this.contentScale.x;b.y/=this.contentScale.y;return b};w.prototype.localToContentPos=function(b,h){void 0!==b.x&&(h=
b.y,b=b.x);b-=this.contentOffset.x;h-=this.contentOffset.y;b/=this.contentScale.x;h/=this.contentScale.y;return{x:b,y:h}};w.prototype.globalToLocalPos=function(b,h){b||(b=0);h||(b=0);b=this.parent?this.parent.globalToLocalPos(b,h):{x:b,y:h};b.x-=this.place.pos.x;b.y-=this.place.pos.y;b.x/=this.scale.x;b.y/=this.scale.y;return b};w.prototype.globalToLocalContentPos=function(b,h){b=this.globalToLocalPos(b,h);return this.localToContentPos(b.x,b.y)};w.prototype.applyRecursively=function(b,h,n){if(n&&
n.call(this,h))return!1;var t=b.call(this,h);if(t)return t;if(this.subElements)for(var v=0;v<this.subElements.length;v++)if(t=this.subElements[v].applyRecursively(b,h,n))return t;return!1};w.prototype.callForSubElements=function(b,h){if(this.subElements)for(var n=0,t=this.subElements.length;n!==t;++n){var v=b.call(this.subElements[n],h);if(v)return v}return!1};w.prototype.callForSubElementsWithPos=function(b,h,n,t){if(this.subElements){h=this.parentToLocalContentPos(h.x,h.y);h.x+=this.center.x;h.y+=
this.center.y;for(var v=this.subElements.length-1;0<=v;v--){var q=b.call(this.subElements[v],h,n,t);if(q)return q}}return!1};w.prototype.update=function(b){w.updateCallCount++;var h=!1;if(this.updateSelf){var n=this.updateSelf(b);if(void 0===n||!0===n)h=!0}if(this.subElements)for(n=this.subElements.length-1;0<=n;--n){var t=this.subElements[n];t.needsUpdate&&(t=t.update(b),void 0===t||!0===t)&&(h=!0)}this.toolTip&&(h=this.updateToolTip(b));this.updateSelfPost&&(b=this.updateSelfPost(b),void 0===b||
!0===b)&&(h=!0);h||(this.needsUpdate=!1);return this.needsUpdate};w.prototype.setNeedsUpdate=function(b){void 0===b&&(b=!0);if(this.needsUpdate=b)for(b=this.parent;b;)b.needsUpdate=!0,b=b.parent};w.prototype.autoCenter=function(b,h){b||void 0===b?(this.center.x=this.size.x/2,this.center.y=this.size.y/2,h&&(this.place.pos.x+=this.size.x/2,this.place.pos.y+=this.size.y/2)):this.center.x=this.center.y=0};w.prototype.centerFromSize=w.prototype.autoCenter;w.prototype.setCenter=function(b,h){this.center.x=
b;this.center.y=h;this.parent&&this.parent.setDirty(!0)};w.prototype.getAnchor=function(b,h){return{x:this.center.x,y:this.center.y}};w.prototype.centerAt=function(b,h){b.x&&(h=b.y,b=b.x);b-=this.scale.x*this.size.x/2;h-=this.scale.y*this.size.y/2;b+=this.center.x*this.scale.x;h+=this.center.y*this.scale.y;this.setPos(b,h)};w.prototype.getCenterPos=function(){return{x:this.scale.x*this.size.x/2-this.center.x,y:this.scale.y*this.size.y/2-this.center.x}};w.prototype.getCenterPosInParent=function(){var b=
this.getCenterPos();b.x+=this.place.pos.x;b.y+=this.place.pos.y;return b};w.prototype.centerInParent=function(){this.parent&&(this.place.pos.x=(this.parent.size.x-this.scale.x*this.size.x)/2+this.center.x,this.place.pos.y=(this.parent.size.y-this.scale.y*this.size.y)/2+this.center.y,this.parent.setDirty(!0))};w.prototype.centerHighInParent=function(){this.parent&&(this.place.pos.x=(this.parent.size.x-this.scale.x*this.size.x)/2,this.place.pos.y=(this.parent.size.y-this.scale.y*this.size.y)/3,this.parent.setDirty(!0))};
w.prototype.centerInParentHorizontally=function(){this.parent&&(this.place.pos.x=(this.parent.size.x-this.size.x)/2,this.parent.setDirty(!0))};w.prototype.centerInParentVertically=function(){this.parent&&(this.place.pos.y=(this.parent.size.y-this.size.y)/2,this.parent.setDirty(!0))};w.prototype.fitToParentSize=function(){this.parent&&this.setBounds(0,0,this.parent.size.x,this.parent.size.y)};w.prototype.autoSizeToParent=w.prototype.fitToParentSize;w.prototype.sizeToParent=w.prototype.fitToParentSize;
w.prototype.fitToContentSize=function(){this.size.x=this.contentSize.x;this.size.y=this.contentSize.y;this.boundsChanged()};w.prototype.autoSizeToContent=w.prototype.fitToContentSize;w.prototype.fitToParentContentSize=function(){this.parent&&(this.size.x=this.parent.contentSize.x,this.size.y=this.parent.contentSize.y,this.boundsChanged())};w.prototype.matchBoundsToElement=function(b){this.place.pos.x=b.place.pos.x;this.place.pos.y=b.place.pos.y;this.place.rot.angle=b.place.rot.angle;this.size.x=b.size.x;
this.size.y=b.size.y;this.setCenter(b.center.x,b.center.y);this.boundsChanged()};w.prototype.insetBounds=function(b){this.place.pos.x+=b;this.place.pos.y+=b;this.size.x-=2*b;this.size.y-=2*b;this.boundsChanged()};w.prototype.getBounds=function(b){b=b||new ub.Rect;b.x=this.place.pos.x-this.center.x*this.scale.x;b.y=this.place.pos.y-this.center.y*this.scale.y;b.w=this.size.x*this.scale.x;b.h=this.size.y*this.scale.y;return b};w.prototype.getBoundsInParent=w.prototype.getBounds;w.prototype.getLocalBounds=
function(){return new ub.Rect(0-this.center.x,0-this.center.y,this.size.x,this.size.y)};w.prototype.getMyLocalBounds=w.prototype.getLocalBounds;w.prototype.getGlobalBounds=function(){var b=this.getGlobalPos(),h=this.getGlobalPos(this.size.x,this.size.y);return new ub.Rect(b.x,b.y,h.x-b.x,h.y-b.y)};w.prototype.adjustBoundsForPointer=function(b,h){var n=this.extraBoundsRadiusX,t=this.extraBoundsRadiusY;h&&h.isFromTouch&&(n+=h.touchRadiusX,t+=h.touchRadiusY);b.x-=n;b.y-=t;b.w+=2*n;b.h+=2*t;return b};
w.prototype.findSubElementByPoint=function(b,h,n){var t=this.parentToLocalContentPos(b.x,b.y);t.x+=this.center.x;t.y+=this.center.y;var v=null;if(this.subElements)for(var q=this.subElements.length-1;0<=q;q--){var r=this.subElements[q];if((r.flags&h)===h&&(v=r.findSubElementByPoint(t,h)))break}if(v)return v;h=this.getBounds(this.tempRect);n&&this.adjustBoundsForPointer(h,n);return db.pointInsideRect(b,h)?this:null};w.prototype.doStopMouseTracking=function(){this.isEnabled()&&(this.setEnabled(!1),this.setEnabled(!0));
this.stopMouseTracking&&this.stopMouseTracking()};w.prototype.stopMouseTrackingRecurse=function(){this.doStopMouseTracking();this.callForSubElements(w.prototype.stopMouseTrackingRecurse)};w.prototype.mouseEnter=function(b){0!==(this.flags&w.enabledFlag)&&(b=this.flags,this.flags|=w.mouseInFlag,this.flags&w.trackingMouseDownFlag&&(this.flags|=w.pressedFlag),this.checkFlagsChanged(b))};w.prototype.mouseLeave=function(b){0!==(this.flags&w.enabledFlag)&&(b=this.flags,this.flags&=~w.mouseInFlag,0===(this.flags&
w.trackingMouseDownFlag)&&this.setHighlighted(!1,!1),this.flags&=~w.pressedFlag,this.checkFlagsChanged(b))};w.prototype.mouseDown=function(b,h){if(0===(this.flags&w.enabledFlag)||0===(this.flags&w.tracksMouseFlag))return!1;b=this.flags;this.flags|=w.trackingMouseDownFlag;this.flags|=w.pressedFlag;this.targetMe(h);this.checkFlagsChanged(b);return!1};w.prototype.mouseUp=function(b,h){if(0===(this.flags&w.enabledFlag))return!1;var n=this.flags;this.flags&=~w.trackingMouseDownFlag;this.flags&=~w.pressedFlag;
h.isFromTouch&&(this.setHighlighted(!1,!1),this.flags&=~w.mouseInFlag);var t=!1;n&w.trackingMouseDownFlag&&(t=this.getLocalBounds(),this.adjustBoundsForPointer(t,h),db.pointInsideRect(b,t)?(t=this.trigger(h))&&cc.fireEvent("uiTriggered",this):(this.setHighlighted(!1,!1),t=!1));this.checkFlagsChanged(n);return t};w.prototype.handleMouseMove=function(b,h,n){if(!this.isVisible())return!1;w.mouseMoveCallCount++;"undefined"===typeof h&&(h=!1);var t=!1,v=this.getBounds(this.tempRect);this.adjustBoundsForPointer(v,
n);(v=db.pointInsideRect(b,v))||0===(this.flags&w.clipFlag)||(h=!0);this.mousePos=b=this.parentToLocalContentPos(b.x,b.y);!this.mouseMove||!v&&h||this.mouseMove(b,n)&&(t=!0);b.x+=this.center.x;b.y+=this.center.y;if(this.subElements)for(var q=this.subElements.length-1;0<=q;q--){var r=this.subElements[q];r.flags&w.tracksMouseFlag&&r.handleMouseMove(b,h,n)&&(t=!0)}this.traverseOrderIndex=w.nextTraverseOrderIndex++;!h&&v&&0===(this.flags&w.mouseInFlag)&&this.mouseEnter(n);(h||!v&&this.flags&w.mouseInFlag)&&
this.mouseLeave(n);!h&&v&&0===(this.flags&w.highlightedFlag)&&0!==(this.flags&w.enabledFlag)&&this.setHighlighted(!0,!0,!1);if(t)return t};w.prototype.handlePositionalEvent=function(b,h,n,t){if(!this.isVisible())return!1;var v=this.getBounds(this.tempRect);this.adjustBoundsForPointer(v,h);v=db.pointInsideRect(b,v);var q=!1;if(this.subElements&&(v||0===(this.flags&w.clipFlag))){var r=this.parentToLocalContentPos(b.x,b.y);r.x+=this.center.x;r.y+=this.center.y;for(var B=this.subElements.length-1;0<=
B;B--)if(n(this.subElements[B],r,h))return!0}v&&!q&&(b=this.parentToLocalPos(b.x,b.y),q=t(this,b,h));return q};w.prototype.handleMouseDown=function(b,h){if(!this.isVisible())return!1;var n=this.getBounds(this.tempRect);this.adjustBoundsForPointer(n,h);n=db.pointInsideRect(b,n);var t=!1;if(n||0===(this.flags&w.clipFlag))t=this.callForSubElementsWithPos(w.prototype.handleMouseDown,b,h);n&&(!t||this.flags&w.handleAllMouseInMe)&&(b=this.parentToLocalPos(b.x,b.y),t=this.mouseDown(b,h));return t};w.prototype.handleMouseUp=
function(b,h){if(!this.isVisible||!this.isVisible())return!1;var n=this.parentToLocalPos(b.x,b.y);(n=this.mouseUp(n,h))||(n=this.callForSubElementsWithPos(w.prototype.handleMouseUp,b,h));return n};w.prototype.handleMouseCancel=function(b){var h=!1;this.mouseCancel&&(h=this.mouseCancel(b));h||(h=this.callForSubElements(w.prototype.handleMouseCancel,b));return h};w.prototype.handleMouseLeaveAll=function(b){var h=!1;this.mouseLeaveAll&&(h=this.mouseLeaveAll(b));return h=h||this.callForSubElements(w.prototype.handleMouseLeaveAll,
b)};w.prototype.handleContextMenu=function(b,h){return this.handlePositionalEvent(b,h,function(n,t,v){return n.handleContextMenu(t,v)},function(n,t,v){return n.contextMenuEvent?n.contextMenuEvent(t,v):!1})};w.prototype.handleMouseWheel=function(b,h){return this.handlePositionalEvent(b,h,function(n,t,v){return n.handleMouseWheel(t,v)},function(n,t,v){return n.mouseWheelEvent?n.mouseWheelEvent(t,v):!1})};w.prototype.handleKeyDown=function(b){return this.keyDown?this.keyDown(b):!1};w.prototype.handleKeyUp=
function(b){return this.keyUp?this.keyUp(b):!1};w.prototype.handleKeyPress=function(b){return this.keyPress?this.keyPress(b):!1};w.prototype.handleButtonDown=function(b){return!1};w.prototype.handleButtonUp=function(b){return!1};w.prototype.handleEvent=function(b){w.mouseMoveCallCount=0;var h=!1;"keydown"===b.eventType?h=this.handleKeyDown(b):"keyup"===b.eventType?h=this.handleKeyUp(b):"keypress"===b.eventType?h=this.handleKeyPress(b):"mousedown"===b.eventType?h=this.handleMouseDown(b.pos,b):"mouseup"===
b.eventType?h=this.handleMouseUp(b.pos,b):"mousemove"===b.eventType?h=this.handleMouseMove(b.pos,!1,b):"mousecancel"===b.eventType?h=this.handleMouseCancel(b):"mouseleave"===b.eventType?h=this.handleMouseLeaveAll(b):"contextmenu"===b.eventType?h=this.handleContextMenu(b.pos,b):"mousewheel"===b.eventType?h=this.handleMouseWheel(b.pos,b):"buttondown"===b.eventType?h=this.handleButtonDown(b):"buttonup"===b.eventType?h=this.handleButtonUp(b):"ui"===b.eventType?h=this.handleUIInput(b):"ui_up"===b.eventType&&
(h=this.handleUIUpInput(b));if(h)return h;this.parent&&(h=this.parent.handleEvent(b));return h};w.prototype.handleUIInput=function(b){return!1};w.prototype.handleUIUpInput=function(b){return!1};w.prototype.targetMe=function(b){if(this.isTargetable()&&this.isEnabled()&&this.isVisible()){for(var h=this;h.parent&&!h.inputMap;)h=h.parent;if(h.setCurrentTarget)return h.setCurrentTarget(this,b),!0}return!1};w.prototype.focus=function(b){if(this.isTargetable()&&this.isEnabled()&&this.isVisible()){var h=
this.isHighlighted();if(b=this.setHighlighted(!0,!0,b,!1)){if(!h&&this.events.onFocus)this.events.onFocus(this);this.setTargeted(!0)}return b}return!1};w.prototype.blur=function(){if(this.isTargetable()&&this.isEnabled()&&this.isVisible()){var b=this.isHighlighted();this.setHighlighted(!1);if(b&&this.events.onBlur)this.events.onBlur(this);this.setTargeted(!1)}return!0};w.prototype.press=function(b){return this.trigger(b)?(cc.fireEvent("uiTriggered",this),!0):!1};w.prototype.trigger=function(b){var h=
this.telemetryName||this.name,n=!1;0!==this.command&&(Sa&&h&&Sa.recordUI("UI com",h),Zc.dispatchCommand(this.command,this.commandInfo)&&(n=!0));this.callback&&(Sa&&h&&Sa.recordUI("UI cb",h),(b=this.callback(this,this.callbackInfo,b))||void 0===b)&&(n=!0);n&&this.clickSound&&V&&V.playSound(this.clickSound);return n};w.prototype.setCommand=function(b,h){this.command=b;this.commandInfo=h};w.prototype.setCallback=function(b,h){this.callback=b;"undefined"!==typeof h&&(this.callbackInfo=h)};w.prototype.getCallback=
function(){return this.callback};w.prototype.setFlagsChangedCallback=function(b,h){this.flagsChangedCallback=b;"undefined"!==typeof h&&(this.callbackInfo=h)};w.prototype.setCallbackInfo=function(b){this.callbackInfo=b};w.prototype.setFlag=function(b,h){var n=this.flags;"undefined"===typeof h&&(h=!0);this.flags=h?this.flags|b:this.flags&~b;this.checkFlagsChanged(n)};w.prototype.clearFlag=function(b){this.setFlag(b,!1)};w.prototype.clearAfterLoadFlags=function(){this.setFlag(w.autoScaleAfterLoadFlag|
w.autoSizeAfterLoadFlag|w.autoCenterAfterLoadFlag,!1)};w.prototype.setVisible=function(b){this.setFlag(w.visibleFlag,b)};w.prototype.isVisible=function(){return 0!==(this.flags&w.visibleFlag)};w.prototype.isVisibleInTree=function(){var b=this;do{if(!b.isVisible())return!1;b=b.parent}while(b);return!0};w.prototype.setHighlighted=function(b,h,n,t){void 0==h&&(h=!0);void 0==t&&(t=!0);var v=this.flags;if(b){b=Dc.getExclusive();var q=0!==(this.flags&w.exclusiveHighlightFlag);if(q&&t&&Dc.getExclusivePriority()<
this.traverseOrderIndex)return!1;q&&(q=this.traverseOrderIndex,t||(q=void 0),Dc.setExclusive(0,this,q),b&&b!==this&&b.setHighlighted(!1));this.flags|=w.highlightedFlag;!this.focusSound||!V||n||v&w.highlightedFlag||V.playSound(this.focusSound)}else this.flags&=~w.highlightedFlag,Dc.remove(0,this);h&&this.checkFlagsChanged(v);return!0};w.prototype.isHighlighted=function(b){return 0!==(this.flags&w.highlightedFlag)};w.prototype.setEnabled=function(b){var h=this.flags;"undefined"===typeof b&&(b=!0);b?
this.flags|=w.enabledFlag:(this.flags&=~w.enabledFlag,this.setHighlighted(!1,!1),this.flags&=~w.pressedFlag,this.flags&=~w.mouseInFlag,this.flags&=~w.trackingMouseDownFlag);this.checkFlagsChanged(h)};w.prototype.isEnabled=function(){return 0!==(this.flags&w.enabledFlag)};w.prototype.setToggled=function(b){this.setFlag(w.toggledFlag,b)};w.prototype.isToggled=function(){return 0!==(this.flags&w.toggledFlag)};w.prototype.setClipped=function(b){this.setFlag(w.clipFlag,b)};w.prototype.setClip=w.prototype.setClipped;
w.prototype.isClipped=function(b){return 0!==(this.flags&w.clipFlag)};w.prototype.isPressed=function(){return 0!==(this.flags&w.pressedFlag)};w.prototype.setTracksMouse=function(b){this.setFlag(w.tracksMouseFlag,b)};w.prototype.isTargetable=function(){return 0!==(this.flags&w.targetableFlag)};w.prototype.setTargetable=function(b){this.setFlag(w.targetableFlag,b)};w.prototype.canBeTarget=w.prototype.isTargetable;w.prototype.isTargeted=function(){return 0!==(this.flags&w.targetedFlag)};w.prototype.setTargeted=
function(b){this.setFlag(w.targetedFlag,b)};w.prototype.setAdjustForScale=function(b){this.setFlag(w.adjustForScaleFlag,b)};w.prototype.setHandleAllMouseInMe=function(b){this.setFlag(w.handleAllMouseInMe,b)};w.prototype.scroll=function(b,h){this.contentOffset.x+=b;this.contentOffset.y+=h;this.viewChanged&&this.viewChanged()};w.prototype.setContentOffset=function(b,h){b&&void 0!==b.x&&(h=b.y,b=b.x);void 0!==b&&(this.contentOffset.x=b);void 0!==h&&(this.contentOffset.y=h);this.viewChanged&&this.viewChanged()};
w.prototype.getContentOffset=function(){return this.contentOffset.copy()};w.prototype.getScroll=w.prototype.getContentOffset;w.prototype.pointIsInView=function(b,h,n){h||(h=0);n||(n=0);var t=this.contentOffset,v=this.contentScale;return 0>(b.x-h)*v.x+t.x||0>(b.y-n)*v.y+t.y||(b.x+h)*v.x+t.x>this.size.x||(b.y+n)*v.y+t.y>this.size.y?!1:!0};w.prototype.scrollToShowLimited=function(b,h,n,t,v,q){q||(q=this.contentOffset);var r=this.contentScale;t=this.size.x-(b.x+t)*r.x;h=-(b.x-h)*r.x;q.x>t&&q.x<h?q.x=
(h+t)/2:q.x>t?q.x=t:q.x<h&&(q.x=h);v=this.size.y-(b.y+v)*r.y;b=-(b.y-n)*r.y;q.y>v&&q.y<b?q.y=(b+v)/2:q.y>v?q.y=v:q.y<b&&(q.y=b);this.clampScroll(q);this.viewChanged&&this.viewChanged()};w.prototype.scrollToShow=function(b,h,n,t){this.scrollToShowLimited(b,h,n,h,n,t)};w.prototype.scrollToShowElement=function(b,h,n){"undefined"===typeof h&&(h=0);"undefined"===typeof n&&(n=0);b=b.getBounds(this.tempRect);this.scrollToShow({x:b.x+b.w/2,y:b.y+b.h/2},b.w/2+h,b.h/2+n)};w.prototype.scrollToCenter=function(b,
h){h||(h=this.contentOffset);h.x=this.size.x/2-b.x*this.contentScale.x;h.y=this.size.y/2-b.y*this.contentScale.y;this.clampScroll(h);this.viewChanged&&this.viewChanged()};w.prototype.scrollToCenterContent=function(b){b||(b=this.contentOffset);b.x=this.size.x/2-this.contentSize.x/2*this.contentScale.x;b.y=this.size.y/2-this.contentSize.y/2*this.contentScale.y};w.prototype.clampScroll=function(b){b||(b=this.contentOffset);if(!(0>=this.contentSize.x||0>=this.contentSize.y)){var h=-(this.contentSize.x*
this.contentScale.x-this.size.x),n=-(this.contentSize.y*this.contentScale.y-this.size.y);b.x<h&&(b.x=h);b.y<n&&(b.y=n);0<b.x&&(b.x=0);0<b.y&&(b.y=0)}};w.prototype.setContentScale=function(b,h){void 0!==b&&(this.contentScale.x=b);void 0!==h&&(this.contentScale.y=h);this.setDirty(!0);this.viewChanged&&this.viewChanged()};w.prototype.stepZoom=function(b){this.contentScale.x+=b;this.contentScale.y+=b;this.clampContentScale();this.setDirty(!0);this.viewChanged&&this.viewChanged()};w.prototype.clampContentScale=
function(){this.contentScale.x=(1E6*(this.contentScale.x+1E-7)|0)/1E6;this.contentScale.y=(1E6*(this.contentScale.y+1E-7)|0)/1E6;this.contentScale.x<this.contentScaleMin.x&&(this.contentScale.x=this.contentScaleMin.x);this.contentScale.y<this.contentScaleMin.y&&(this.contentScale.y=this.contentScaleMin.y);this.contentScale.x>this.contentScaleMax.x&&(this.contentScale.x=this.contentScaleMax.x);this.contentScale.y>this.contentScaleMax.y&&(this.contentScale.y=this.contentScaleMax.y)};w.prototype.setContentScaleLimits=
function(b,h){this.contentScaleMin.x=this.contentScaleMin.y=b;this.contentScaleMax.x=this.contentScaleMax.y=h};w.prototype.drawTiled=function(b,h){};w.prototype.setContextID=function(b){this.contextID=b};w.prototype.draw=function(b){if(this.isVisible()){void 0===b&&(b=!1);if(this.preDraw){var h=this.preDraw(b);if(h&&h.abortDraw)return}this.useOffscreen&&(!this.offscreen||this.isDirty||this.checkDirty&&this.checkDirty())&&this.renderOffscreen();h=gb(this.contextID);b||(tc(),this.applyTransformation?
this.applyTransformation(h):(sc(this.place.pos.x,this.place.pos.y),this.place.rot.angle&&He(this.place.rot.angle),1===this.scale.x&&1===this.scale.y||jd(this.scale.x,this.scale.y)),dd.totalElementsDrawn++,1>this.opacity&&(h.globalAlpha=this.opacity));var n;this.flags&w.unSmoothFlag&&(n=de(!1));0<this.frameWidth&&(h.strokeStyle=this.frameColor.toString(),h.lineWidth=this.frameWidth,h.strokeRect(-this.center.x-this.frameOutset,-this.center.y-this.frameOutset,this.size.x+2*this.frameOutset,this.size.y+
2*this.frameOutset));!b&&this.flags&w.clipFlag&&(h.beginPath(),h.rect(-this.center.x,-this.center.y,this.size.x,this.size.y),h.clip());if(!b&&this.useOffscreen&&this.offscreen)this.offscreen.render(h,-this.center.x,-this.center.y);else{this.events.beforeDraw&&this.events.beforeDraw(this,h);this.drawSelfPre&&this.drawSelfPre(this,h);this.drawSelf(h);if(this.events.onDrawSelf)this.events.onDrawSelf(this,h);if(this.subElements){var t=this.contentOffset.x,v=this.contentOffset.y;this.ignoreCenter||(t-=
this.center.x,v-=this.center.y);0===t&&0===v||sc(t,v);1===this.contentScale.x&&1===this.contentScale.y||jd(this.contentScale.x,this.contentScale.y);if(this.events.onPreDrawChildren)this.events.onPreDrawChildren(this,h);this.drawSubElements();if(this.events.onDrawChildren)this.events.onDrawChildren(this,h);1===this.contentScale.x&&1===this.contentScale.y||jd(1/this.contentScale.x,1/this.contentScale.y);0===t&&0===v||sc(-t,-v)}this.drawSelfPost&&this.drawSelfPost(this,h);this.events.afterDraw&&this.events.afterDraw(this,
h)}this.flags&w.unSmoothFlag&&de(n);Yd(this.contextID);this.postDraw&&this.postDraw(b,h);b||zc()}};w.prototype.drawSelf=function(b){};w.prototype.drawSubElements=function(){if(this.subElements){var b=this.tempRect;b.x=-this.contentOffset.x;b.y=-this.contentOffset.y;b.w=this.size.x/this.contentScale.x;b.h=this.size.y/this.contentScale.y;for(var h=0;h<this.subElements.length;h++){var n=this.subElements[h];if(n.flags&w.visibleFlag){var t=!0;if(0!==(this.flags&w.clipFlag)&&0===n.place.rot.angle){var v=
n.getBounds(this.tempRect);db.rectOverlapsRect(v,b)||(t=!1)}t&&n.draw()}}}};w.prototype.boundsChanged=function(){this.toolTip&&this.positionToolTip(this.toolTipPlacement,this.toolTipPlacementOffset,this.toolTipPlacementFromMouse);this.setDirty(!0)};w.prototype.flagsChanged=function(b){};w.prototype.checkFlagsChanged=function(b){b!==this.flags&&(this.flagsChanged(b),0!==((b^this.flags)&this.flagsThatDirtyMe)&&this.setDirty(!0),0!==((b^this.flags)&this.flagsThatDirtyParent)&&this.parent&&this.parent.setDirty(!0,
!0),this.flagsChangedCallback&&this.flagsChangedCallback(b,this.callbackInfo),this.toolTip&&this.setNeedsUpdate(this.updateToolTip(0)))};w.prototype.frameAllRandom=function(){this.applyRecursively(w.prototype.setFrameRandom,1)};var wg=["before_","on_","after_"];w.prototype.fireCustomTrigger=function(b,h){for(var n,t=0;t!==wg.length&&(n=wg[t]+b,!this[n]||(n=this[n](this,b,h),void 0===n||n));++t);};w.prototype.setUseOffscreen=function(b){$a.allowOffscreens&&(this.useOffscreen!==b&&this.setDirty(!0),
this.useOffscreen=b)};w.prototype.setDirty=function(b,h){if(this.isVisible()||h)void 0===b&&(b=!0),(this.isDirty=b)&&this.parent&&this.parent.setDirty(!0,h)};w.prototype.setDirtyRecursive=function(b){this.setDirty(b);this.applyRecursively(function(h){this.isDirty=h},b)};w.prototype.renderOffscreen=function(){var b=this.size.x,h=this.size.y;this.offscreenSize&&(b=this.offscreenSize.x||b,h=this.offscreenSize.y||h);if(this.offscreen){var n=this.offscreen;n.setSize(b,h,!0)}else this.offscreen=n=new $a(b,
h);b=n.getContext();h=gb();ca=b;this.useOffscreen=!1;this.ignoreCenter=!0;this.draw(!0);(Pd.debugOffscreens||mb&&mb.setTarget.show.offscreens)&&n.applyDebugOverlay();this.ignoreCenter=!1;this.useOffscreen=!0;ca=h;this.isDirty=!1;this.applyRecursively(function(t){this.isDirty=!1})};w.editProperties=[{label:"basic",props:[{propName:"type",type:"string"},{propName:"id",type:"string"},{propName:"name",type:"string"}]},{label:"location",props:[{label:"pos",propName:"bounds",type:"xyvector",valueType:"float"},
{label:"size",propName:"bounds",type:"whvector",valueType:"float"},{propName:"autoCenter",type:"boolean",tipText:"anchor from center"},{propName:"rotation",type:"float",tipText:"rotation around anchor, in radians"}]},{label:"appearance",defaultClosed:!0,props:[{propName:"color",type:"color",tipText:"content color, used depending on type"},{propName:"frameSize",type:"float"},{propName:"frameColor",type:"color"},{propName:"frameOutset",type:"float",tipText:"expand or shrink frame (in pixels)"}]},{label:"flags",
defaultClosed:!0,props:[{propName:"visible",type:"boolean"},{propName:"enabled",type:"boolean"},{propName:"toggled",type:"boolean"},{propName:"clip",type:"boolean"},{propName:"autoSizeAfterLoad",type:"boolean"},{propName:"autoScaleAfterLoad",type:"boolean"},{propName:"unSmooth",type:"boolean"},{propName:"drawTiled",type:"boolean"},{propName:"useOffscreen",type:"boolean"}]}];w.setupFromData=function(b,h,n){b.setBounds(te.calcBounds(h,n));void 0===h.rotation&&void 0===h.rot||b.setRotation(h.rotation||
h.rot);void 0!==h.autoCenter&&b.autoCenter(h.autoCenter);h.frame&&b.setFrame(h.frame.size,O.fixColorStyle(h.frame.color),h.frame.outset);void 0!==h.frameSize&&b.setFrame(h.frameSize,O.fixColorStyle(h.frameColor),h.frameOutset);void 0!==h.id&&b.setID(h.id);h.color&&b.setColor(new O(h.color));void 0!==h.visible&&b.setVisible(!!h.visible);void 0!==h.highlighted&&b.setHighlighted(!!h.highlighted);void 0!==h.enabled&&b.setEnabled(!!h.enabled);void 0!==h.toggled&&b.setToggled(!!h.toggled);void 0!==h.clip&&
b.setClip(!!h.clip);void 0!==h.autoSizeAfterLoad&&b.setFlag(w.autoSizeAfterLoadFlag,!!h.autoSizeAfterLoad);void 0!==h.autoScaleAfterLoad&&b.setFlag(w.autoScaleAfterLoadFlag,!!h.autoScaleAfterLoad);void 0!==h.drawTiled&&(h.drawTiled?(b.setFlag(w.autoSizeAfterLoadFlag,!1),b.setFlag(w.drawTiledFlag,!0)):b.setFlag(w.drawTiledFlag,!1));void 0!==h.unSmooth&&b.setFlag(w.unSmoothFlag,!!h.unSmooth);h.contentSize&&h.contentSize.x&&b.setContentSize(h.contentSize.x,h.contentSize.y);h.contentOffset&&b.setContentOffset(h.contentOffset.x,
h.contentOffset.y);h.contentScale&&b.setContentScale(h.contentScale.x,h.contentScale.y);h.callback&&b.setCallback(h.callback,h.callbackInfo);h.onFocus&&(b.events.onFocus=h.onFocus);h.onBlur&&(b.events.onBlur=h.onBlur);h.beforeDraw&&(b.events.beforeDraw=h.beforeDraw);h.onDrawSelf&&(b.events.onDrawSelf=h.onDrawSelf);h.onPreDrawChildren&&(b.events.onPreDrawChildren=h.onPreDrawChildren);h.onDrawChildren&&(b.events.onDrawChildren=h.onDrawChildren);h.afterDraw&&(b.events.afterDraw=h.afterDraw);void 0!==
h.useOffscreen&&b.setUseOffscreen(h.useOffscreen)};var Tb=function(){};Tb.prototype.attach=function(b,h){var n=this;n.targetPane=b;n.pointers={};n.pointerCount=0;n.grabOffset=new za(0,0);n.curOffset={x:0,y:0};n.alreadyPassedThreshold=!1;n.alreadyPassedMeaningfulThreshold=!1;n.smoothDragTimer=0;n.resetFling();n.resetZoomTracking();h=h||{};vc(h,{allowFling:!0,allowPinchZoom:!0,minimumDragThreshold:50,meaningfulDragThreshold:75,smoothDrag:!1,allowX:!0,allowY:!0,flingMinVel:400,flingMaxVel:3E3,flingHardVel:8E3,
flingRequiresDrag:!0,zoomMax:2,zoomMin:.5},!0);n.opts=h;var t=b.mouseDown,v=b.handleMouseMove,q=b.mouseUp,r=b.mouseCancel,B=b.mouseCancelAll,H=b.updateSelf;b.detachDragHandler=function(){n.opts.detachHandler&&n.opts.detachHandler();b.mouseDown=t;b.handleMouseMove=v;b.mouseUp=q;b.mouseCancel=r;b.mouseCancelAll=B;b.updateSelf=H;b.detachDragHandler=null};b.mouseDown=function(G,K){if(b.isEnabled()){var u=G.x+b.place.pos.x,A=G.y+b.place.pos.y;n.pointers[K.pointerID]={grabPos:{x:u,y:A},lastPos:{x:u,y:A},
delta:{x:0,y:0},flingLastTime:Date.now(),flingTrack:[]};n.resetGrabOffset();1<n.pointerCount&&(n.resetZoomTracking(),n.alreadyPassedMeaningfulThreshold||(n.alreadyPassedMeaningfulThreshold=!0,b.callForSubElements(w.prototype.stopMouseTrackingRecurse)));n.opts.flingStopHandler&&n.opts.flingStopHandler()}return t?t.call(b,G,K):!0};b.mouseUp=function(G,K){var u=q.call(b,G,K),A=n.pointers[K.pointerID];if(!A)return u;n.addFlingMovement(A,{x:G.x+b.place.pos.x,y:G.y+b.place.pos.y},A.lastPos);delete n.pointers[K.pointerID];
n.pointerCount--;if(0>=n.pointerCount){G=!n.opts.flingRequiresDrag||n.alreadyPassedThreshold;n.alreadyPassedThreshold=!1;n.alreadyPassedMeaningfulThreshold=!1;if(n.opts.allowFling&&G){n.flingVelocity={x:0,y:0};n.flingHard=!1;for(var E=K=G=0,S=0;S<A.flingTrack.length;S++)G+=A.flingTrack[S].dpos.x,K+=A.flingTrack[S].dpos.y,E+=A.flingTrack[S].dt;G/=E;K/=E;A=n.opts.flingMinVel;E=n.opts.flingMaxVel;S=n.opts.flingHardVel;G*G+K*K>=A*A&&(n.smoothDragTimer=0,G*G+K*K>S*S&&(n.flingHard=!0),A=E/Math.sqrt(G*G+
K*K),1>A&&(G*=A,K*=A),n.flingVelocity.x=G,n.flingVelocity.y=K,n.opts.flingHandler&&n.opts.flingHandler(n.flingVelocity,n.curOffset,n.grabOffset))}n.opts.releaseHandler&&n.opts.releaseHandler(n.flingVelocity,n.curOffset,n.grabOffset)}else n.resetGrabOffset();return u};b.handleMouseMove=function(G,K,u){var A=!0;v&&(A=v.call(b,G,K,u));if(u=n.pointers[u.pointerID]){n.addFlingMovement(u,G,u.lastPos);u.lastPos.x=G.x;u.lastPos.y=G.y;K=G.x-u.grabPos.x;G=G.y-u.grabPos.y;n.opts.allowX||(K=0);n.opts.allowY||
(G=0);u.delta.x=K;u.delta.y=G;u=K=G=0;for(var E in n.pointers)u++,K+=n.pointers[E].delta.x,G+=n.pointers[E].delta.y;K/=u;G/=u;if(n.alreadyPassedThreshold||Math.abs(K)>n.opts.minimumDragThreshold||Math.abs(G)>n.opts.minimumDragThreshold)n.alreadyPassedThreshold=!0,E=n.grabOffset.x+K,u=n.grabOffset.y+G,n.curOffset.x=E,n.curOffset.y=u,n.opts.smoothDrag&&(E=ra.deltaTime.deltaTime,n.smoothDragTimer=E,u=n.getSmoothDragOffset(E),E=u.x,u=u.y),n.setDragOffset(E,u),b.viewChanged&&b.viewChanged();E=n.opts.meaningfulDragThreshold;
(Math.abs(K)>E||Math.abs(G)>E)&&!n.alreadyPassedMeaningfulThreshold&&(n.alreadyPassedMeaningfulThreshold=!0,b.callForSubElements(w.prototype.stopMouseTrackingRecurse));n.opts.allowPinchZoom&&1<n.pointerCount&&(n.alreadyPassedThreshold=!0,K=n.getRange(),G=K.y-n.grabRange.y,0!==K.x-n.grabRange.x||0!==G)&&(G=b.contentScale.x,E=Math.sqrt(K.dist2)/Math.sqrt(n.grabRange.dist2)*n.grabZoom,E>n.opts.zoomMax&&(E=n.opts.zoomMax),E<n.opts.zoomMin&&(E=n.opts.zoomMin),G=E-G,E=b.globalToLocalPos(K.mx,K.my),E=b.localToContentPos(E.x,
E.y),K=n.getDragOffset(),b.stepZoomAnchored(G,E),G=n.getDragOffset(),E=G.y-K.y,n.grabOffset.x+=G.x-K.x,n.grabOffset.y+=E)}return A};b.mouseCancel=function(G){var K=!1;r&&(K=r.call(b,G));if(!n.pointers[G.pointerID])return K;delete n.pointers[G.pointerID];n.pointerCount--;0>n.pointerCount&&(n.alreadyPassedThreshold=!1,n.alreadyPassedMeaningfulThreshold=!1);return K};b.mouseCancelAll=function(){var G=!1;B&&(G=B.call(b));n.pointerCount=0;n.pointers={};n.alreadyPassedThreshold=!1;n.alreadyPassedMeaningfulThreshold=
!1;n.opts.releaseHandler&&n.opts.releaseHandler({x:0,y:0},n.curOffset);return G};b.updateSelf=function(G){H&&H.call(b,G);n.opts.smoothDrag&&n.smoothDragTimer&&(n.smoothDragTimer+=G,.25<=n.smoothDragTimer?(n.smoothDragTimer=0,n.setDragOffset(n.curOffset.x,n.curOffset.y)):(G=n.getSmoothDragOffset(n.smoothDragTimer),n.setDragOffset(G.x,G.y)))}};Tb.prototype.detach=function(){this.targetPane&&this.targetPane.detachDragHandler&&this.targetPane.detachDragHandler()};Tb.prototype.setOpts=function(b){vc(this.opts,
b,!0,!0)};Tb.prototype.resetGrabOffset=function(){var b=this.getDragOffset();this.grabOffset={x:b.x,y:b.y};this.curOffset={x:b.x,y:b.y};this.pointerCount=0;for(var h in this.pointers)b=this.pointers[h],b.grabPos.x=b.lastPos.x,b.grabPos.y=b.lastPos.y,b.delta.x=b.delta.y=0,this.pointerCount++};Tb.prototype.resetFling=function(){this.flingVelocity={x:0,y:0};this.flingHard=!1};Tb.prototype.addFlingMovement=function(b,h,n){var t=Date.now(),v=ra.deltaTime.deltaTime,q={x:(h.x-n.x)/v,y:(h.y-n.y)/v};h={x:h.x-
n.x,y:h.y-n.y};this.opts.allowX||(q.x=0);this.opts.allowY||(q.y=0);b.flingTrack.push({time:t,wdpos:q,dpos:h,dt:v});b.flingLastTime=t;t-=100;for(v=b.flingTrack.length-1;0<=v;v--)b.flingTrack[v].time<t&&b.flingTrack.splice(v,1)};Tb.prototype.resetZoomTracking=function(){2>this.pointerCount||(this.grabZoom=this.targetPane.contentScale.x,this.grabRange=this.getRange(),0===this.grabRange.x&&(this.grabRange.x=1),0===this.grabRange.y&&(this.grabRange.y=1))};Tb.prototype.getRange=function(){var b=999999999,
h=999999999,n=-999999999,t=-999999999,v=0,q=0,r=0,B;for(B in this.pointers){var H=this.pointers[B];r++;v+=H.lastPos.x;q+=H.lastPos.y;H.lastPos.x<b&&(b=H.lastPos.x);H.lastPos.y<h&&(h=H.lastPos.y);H.lastPos.x>n&&(n=H.lastPos.x);H.lastPos.y>t&&(t=H.lastPos.y)}b=n-b;h=t-h;return{x:b,y:h,mx:v/r,my:q/r,dist2:b*b+h*h}};Tb.prototype.getDragOffset=function(){if(this.opts.getDragOffset){var b=this.opts.getDragOffset();return{x:b.x,y:b.y}}return{x:this.targetPane.center.x,y:this.targetPane.center.y}};Tb.prototype.setDragOffset=
function(b,h){this.opts.setDragOffset?this.opts.setDragOffset(b,h):(this.targetPane.contentOffset.x=b,this.targetPane.contentOffset.y=h)};Tb.prototype.isTrackingDrag=function(){return this.alreadyPassedThreshold};Tb.prototype.isTrackingZoom=function(){return 1<this.pointerCount};Tb.prototype.getSmoothDragOffset=function(b){var h=b/.25,n=this.getDragOffset();b=Y.interp(n.x,this.curOffset.x,h);h=Y.interp(n.y,this.curOffset.y,h);return{x:b,y:h}};var Va={animators:[],addAnimator:function(b){Va.animators.push(b)}},
Ue=0;Va.updateAnimators=function(b){++Ue;for(var h=Va.animators.length-1;0<=h;h--)Va.animators[h].update(b)&&Va.animators.splice(h,1);--Ue};Va.update=Va.updateAnimators;Va.resetStartStateForAllAnimatorsForElement=function(b,h){for(var n=Va.animators.length-1;0<=n;n--){var t=Va.animators[n];t.target?t.target!==b||void 0!==h&&t.type!==h||t.resetTargetState():(z.log("JS FAILURE: animator is missing target! check that on construction all objects have a target!\n"),Va.animators.splice(n,1))}};Va.finishAnimatorsForElement=
function(b,h,n){for(var t=Va.animators.length-1;0<=t;t--){var v=Va.animators[t];v.target?v.target!==b||void 0!==h&&v.type!==h||(v.finish(),n&&!Ue&&Va.animators.splice(t,1)):(z.log("JS FAILURE: animator is missing target! check that on construction all objects have a target!\n"),Va.animators.splice(t,1))}};Va.killAnimatorsForElement=function(b,h){for(var n=0,t=Va.animators.length-1;0<=t;t--){var v=Va.animators[t];if(!v.target)z.log("JS FAILURE: animator is missing target! check that on construction all objects have a target!\n"),
Va.animators.splice(t,1);else if(void 0===h||v.type===h)if(null===b||v.target===b)Va.animators.splice(t,1),n++}return n};Va.killAllAnimators=function(b){return Va.killAnimatorsForElement(null,b)};Va.getAnimatorsForElement=function(b,h,n){for(var t=[],v=Va.animators.length-1;0<=v;v--){var q=Va.animators[v];q.target!==b||void 0!==h&&q.type!==h||void 0!==n&&q.id!==n||t.push(q)}return t};Va.elementHasAnimator=function(b,h,n){for(var t=Va.animators.length-1;0<=t;t--){var v=Va.animators[t];if(!(v.target!==
b||void 0!==h&&v.type!==h||void 0!==n&&v.id!==n))return!0}return!1};Va.killAnimators=function(){Va.animators=[]};var ma=function q(h,n,t,v){"boolean"===typeof t&&3===arguments.length&&(v=t,t=void 0);this.id=t;this.type=h;this.relative=!!v;this.target=n;this.startValue=new za(0,0);this.endValue=new za(0,0);this.paused=!1;this.time=this.startTime=-1;this.delay=0;this.interpFilter=q.filterEaseInOut;this.flags=0;this.setAutoDie(!0);this.speed=1;this.continuousVal=0;this.continuousSign=1;this.doneCallback=
this.delayCallback=null;this.target?(this.targetStartState={x:this.target.place.pos.x,y:this.target.place.pos.y,cx:this.target.contentOffset.x,cy:this.target.contentOffset.y,sx:this.target.scale.x,sy:this.target.scale.y,w:this.target.size.x,h:this.target.size.y,r:this.target.place.rot.angle,opacity:this.target.opacity,visible:this.target.isVisible()?1:0},q.list[h]&&(this.custom=q.list[h]),this.custom&&this.custom.init&&this.custom.init(this),Va.addAnimator(this)):z.log("No target input for animator! Bad juju! Not adding it to the animator list")};
ma.mover="mover";ma.rotator="rotator";ma.rotater=ma.rotator;ma.scaler="scaler";ma.resizer="resizer";ma.fader="fader";ma.scroller="scroller";ma.visible="visible";ma.list={};ma.floater="floater";ma.list.floater={propPath:"place.pos",init:function(h){h.interpFilter=ma.filterLinear},update:function(h,n,t){n=Math.sin(n*Math.PI*2);t=Y.interpolate(h.startValue.x,h.endValue.x,n);n=Y.interpolate(h.startValue.y,h.endValue.y,n);h.relative&&(t+=h.targetStartState.x,n+=h.targetStartState.y);h.target.place.pos.x=
t;h.target.place.pos.y=n;h.target.parent&&h.target.parent.setDirty(!0)},resetTargetState:function(h){var n=h.targetStartState;h.target.setPos(n.x,n.y)}};ma.wobbler="wobbler";ma.list.wobbler={propPath:"place.rot.angle",init:function(h){h.interpFilter=ma.filterLinear},update:function(h,n,t){n=h.startValue.x+Math.random()*(h.endValue.x-h.startValue.x);h.relative&&(n+=h.targetStartState.r);h.target.place.rot.angle=n;h.target.parent&&h.target.parent.setDirty(!0)},resetTargetState:function(h){h.target.setRotation(h.targetStartState.r)}};
ma.centerer="centerer";ma.list.centerer={propPath:"center",init:function(h){h.interpFilter=ma.filterEaseInOut},update:function(h,n,t){t=Y.interpolate(h.startValue.x,h.endValue.x,n);n=Y.interpolate(h.startValue.y,h.endValue.y,n);h.relative&&(t+=h.targetStartState.x,n+=h.targetStartState.y);Ed(h.target,h.custom.propPath,{x:t,y:n});h.target.parent&&h.target.parent.setDirty(!0)},resetTargetState:function(h){var n=h.targetStartState;Ed(h.target,h.custom.propPath,{x:n.x,y:n.y})}};ma.shaker="shaker";ma.list.shaker=
{propPath:"place.pos",init:function(h){h.interpFilter=ma.filterLinear},update:function(h,n,t){n=h.startValue.x+Math.random()*(h.endValue.x-h.startValue.x);t=h.startValue.y+Math.random()*(h.endValue.y-h.startValue.y);n+=h.targetStartState.x;t+=h.targetStartState.y;h.target.place.pos.x=n;h.target.place.pos.y=t;h.target.parent&&h.target.parent.setDirty(!0)},resetTargetState:function(h){var n=h.targetStartState;h.target.setPos(n.x,n.y)}};ma.colorer="colorer";ma.list.colorer={init:function(h){h.interpFilter=
ma.filterImmediate;h.targetStartState.color=h.target.getColor()},update:function(h,n,t){h.target.setColor(h.startValue.x)},resetTargetState:function(h){h.target.setColor(h.targetStartState.color)}};ma.autoDieFlag=1;ma.autoRemoveTargetFlag=2;ma.autoResetStateFlag=4;ma.prototype.setFlag=function(h,n){this.flags=n||void 0===n?this.flags|h:this.flags&~h};ma.prototype.setAutoDie=function(h){this.setFlag(ma.autoDieFlag,h)};ma.prototype.setAutoRemoveTarget=function(h){this.setFlag(ma.autoRemoveTargetFlag,
h)};ma.prototype.setAutoResetStateFlag=function(h){this.setFlag(ma.autoResetStateFlag,h)};ma.prototype.setDoneCallback=function(h){this.doneCallback=h};ma.prototype.setDelayDoneCallback=function(h){this.delayCallback=h};ma.prototype.setTimer=function(h){this.time=this.startTime=h};ma.prototype.setInfiniteTimer=function(){this.setTimer(-1)};ma.prototype.setDelay=function(h){this.delay=h};ma.prototype.setPaused=function(h){void 0===h&&(h=!0);this.paused=h};ma.prototype.setSpeed=function(h){this.speed=
h};ma.prototype.setStartEnd=function(h,n){this.startValue.x=h;this.startValue.y=h;this.endValue.x=n;this.endValue.y=n;this.update(0)};ma.prototype.setStartEndVectors=function(h,n){h?(this.startValue.x=h.x,this.startValue.y=h.y):(h=this.getCurrentValueForType(),this.startValue.x=h.x,this.startValue.y=h.y);this.endValue.x=n.x;this.endValue.y=n.y;this.update(0)};ma.prototype.getStartVector=function(){return{x:this.startValue.x,y:this.startValue.y}};ma.prototype.getEndVector=function(){return{x:this.endValue.x,
y:this.endValue.y}};ma.prototype.setStartVector=function(h){this.startValue.x=h.x;this.startValue.y=h.y;this.update(0)};ma.prototype.setEndVector=function(h){this.endValue.x=h.x;this.endValue.y=h.y;this.update(0)};ma.filterNone=function(h){return 0};ma.filterImmediate=function(h){return 1};ma.filterRandomOnOff=function(h){return Math.random()+.5|0};ma.filterRandom=function(h){return Math.random()};ma.filterLinear=function(h){return h};ma.filterEaseInOut=function(h){return h*h*(3-2*h)};ma.filterEaseIn=
function(h){return h*h};ma.filterEaseOut=function(h){return h*(2-h)};ma.filterEaseThereAndBack=function(h){return.5>h?ma.filterEaseInOut(2*h):1-ma.filterEaseInOut(2*(h-.5))};ma.filterEaseInElastic=function(h){return h};ma.filterEaseOutElastic=function(h){return 0>=h?0:1<=h?1:Math.pow(2,-10*h)*Math.sin(2*(h-.4/(2*Math.PI)*1.5707)*Math.PI/.4)+1};ma.prototype.setInterpFilter=function(h){this.interpFilter=h};ma.prototype.clearInterpFilter=function(){this.setInterpFilter(null)};ma.prototype.update=function(h){if(!this.target||
this.paused)return!1;if(0<this.delay){this.delay-=h;if(0<this.delay)return!1;0<this.time&&(this.time+=this.delay,0>this.time&&(this.time=0));this.delayCallback&&this.delayCallback(this.target,this)}var n=!1,t=null;0>this.time?this.type===ma.rotator?this.target.place.rot.angle+=this.speed*h:this.custom?(this.continuousVal+=this.speed*h,t=this.continuousVal%1):(this.continuousVal+=this.continuousSign*this.speed*h,1<this.continuousVal?(this.continuousVal=1,this.continuousSign=-this.continuousSign):0>
this.continuousVal&&(this.continuousVal=0,this.continuousSign=-this.continuousSign),t=this.continuousVal):(this.time-=h,0>this.time&&(this.time=0,n=!0),t=0>=this.startTime?1:1-this.time/this.startTime);null!==t&&(void 0!==this.interpFilter&&(t=this.interpFilter(t)),this.custom&&this.custom.update?this.custom.update(this,t,h):(h=Y.interpolate(this.startValue.x,this.endValue.x,t),t=Y.interpolate(this.startValue.y,this.endValue.y,t),this.type===ma.mover?(this.relative&&(h+=this.targetStartState.x,t+=
this.targetStartState.y),this.target.place.pos.x=h,this.target.place.pos.y=t,this.target.parent&&this.target.parent.setDirty(!0)):this.type===ma.rotator?(this.relative&&(h+=this.targetStartState.r),this.target.place.rot.angle=h,this.target.parent&&this.target.parent.setDirty(!0)):this.type===ma.scaler?(this.relative&&(h+=this.targetStartState.sx,t+=this.targetStartState.sy),this.target.setScale(h,t)):this.type===ma.resizer?(this.relative&&(h+=this.targetStartState.w,t+=this.targetStartState.h),this.target.setSize(h,
t)):this.type===ma.fader?(this.relative&&(h+=this.targetStartState.opacity),this.target.setOpacityRecursive(h)):this.type===ma.scroller?(this.relative&&(h+=this.targetStartState.cx,t+=this.targetStartState.cy),this.target.contentOffset.x=h,this.target.contentOffset.y=t,this.target.viewChanged&&this.target.viewChanged()):this.type===ma.visible&&this.target.setVisible(!!h)));return n&&(this.flags&ma.autoResetStateFlag&&this.resetTargetState(),this.doneCallback&&this.doneCallback(this.target,this),this.flags&
ma.autoRemoveTargetFlag&&this.target.removeFromParent(),this.flags&ma.autoDieFlag)?!0:!1};ma.prototype.getCurrentValueForType=function(){return this.type===ma.mover?this.target.place.pos:this.type===ma.rotator?this.target.place.rot.angle:this.type===ma.scaler?this.target.scale:this.type===ma.resizer?this.target.size:this.type===ma.fader?this.target.opacity:this.type===ma.scroller?this.target.contentOffset:this.type===ma.visible?this.target.isVisible()?1:0:this.custom&&this.custom.propPath?qd(this.target,
this.custom.propPath):null};ma.prototype.die=function(h){this.target=null};ma.prototype.getElapsed=function(h){return this.startTime-this.time};ma.prototype.finish=function(){0>this.time||(this.delay=0,this.update(this.time+1E-4))};ma.prototype.resetTargetState=function(){var h=this.targetStartState;switch(this.type){case ma.mover:this.target.setPos(h.x,h.y);break;case ma.rotator:this.target.setRotation(h.r);break;case ma.scaler:this.target.setScale(h.sx,h.sy);break;case ma.resizer:this.target.setSize(h.w,
h.h);break;case ma.fader:this.target.setOpacity(h.opacity);break;case ma.scroller:this.target.setContentOffset(h.cx,h.cy);break;case ma.visible:this.target.setVisible(h.visible);break;default:this.custom&&this.custom.resetTargetState&&this.custom.resetTargetState(this)}};var kb=function t(n){t.prototype.parentConstructor.call(this,n);var v=this;this.setClip(!0);this.lastMousePos=new za(0,0);(this.dragHandler=new Tb).attach(this,{allowPinchZoom:!1,allowFling:!0,minimumDragThreshold:10,meaningfulDragThreshold:15,
smoothDrag:!0,getDragOffset:function(){return v.contentOffset},setDragOffset:function(q,r){v.killAllAnimators(ma.scroller);v.contentOffset.x=q;v.contentOffset.y=r;v.clampScroll()},flingHandler:function(q){v.flingHandler(q)},flingStopHandler:function(){v.stopFling()}});this.flingVelocity={x:0,y:0};this.wheelSensitivity=32;this.wheelAffects="y"};cb(kb,w);kb.prototype.elementType="scrollView";kb.prototype.setDragOpts=function(n){this.dragHandler.setOpts(n)};kb.prototype.supportZoom=function(n){n||void 0===
n?(this.wheelAffects="z",this.wheelSensitivity=.1,this.allowPinchZoom=!0):this.allowPinchZoom=!1;this.dragHandler.setOpts({allowPinchZoom:this.allowPinchZoom})};kb.prototype.setContentScaleLimits=function(n,t){kb.prototype.parentPrototype.setContentScaleLimits.call(this,n,t);this.dragHandler.setOpts({zoomMin:n,zoomMax:t})};kb.prototype.setWheelSensitivity=function(n){this.wheelSensitivity=n};kb.prototype.isTrackingDrag=function(){return this.dragHandler.isTrackingDrag()};kb.prototype.isTrackingZoom=
function(){return this.dragHandler.isTrackingZoom()};kb.prototype.mouseWheelEvent=function(n,t){return this.isEnabled()?"y"===this.wheelAffects||"x"===this.wheelAffects?("y"===this.wheelAffects?this.contentOffset.y+=t.wheelDelta*this.wheelSensitivity:this.contentOffset.x+=t.wheelDelta*this.wheelSensitivity,this.clampScroll(),this.viewChanged&&this.viewChanged(),!0):"z"===this.wheelAffects?(this.stepZoomAnchored(t.wheelDelta*this.wheelSensitivity,this.mousePos),!0):!1:!1};kb.prototype.stepZoomAnchored=
function(n,t){var v=this.getTargetContentOffset();this.contentOffset.x=v.x;this.contentOffset.y=v.y;this.killAllAnimators(ma.scroller);t||(t=this.parentToLocalContentPos(this.place.pos.x+this.size.x/2,this.place.pos.y+this.size.y/2));v=t.x;t=t.y;var q=this.contentScale.x,r=this.contentScale.y;this.stepZoom(n);this.contentOffset.x-=v*this.contentScale.x-v*q;this.contentOffset.y-=t*this.contentScale.y-t*r;this.clampScroll();this.viewChanged&&this.viewChanged()};kb.prototype.getCenteredContentPos=function(){return this.parentToLocalContentPos(this.place.pos.x+
this.size.x/2,this.place.pos.y+this.size.y/2)};kb.prototype.mouseDown=function(n,t){this.stopFling();return kb.prototype.parentPrototype.mouseDown.call(this,n,t)};kb.prototype.mouseUp=function(n,t){return kb.prototype.parentPrototype.mouseUp.call(this,n,t)};kb.prototype.handleMouseMove=function(n,t,v){return kb.prototype.parentPrototype.handleMouseMove.call(this,n,t,v)};kb.prototype.isFlung=function(n){return this.flags&w.trackingMouseDownFlag||0===this.flingVelocity.x&&0===this.flingVelocity.y?!1:
!0};kb.prototype.flingHandler=function(n){this.flingVelocity=n};kb.prototype.stopFling=function(){this.flingVelocity={x:0,y:0}};kb.prototype.updateSelf=function(n){this.dragHandler.opts.allowFling&&this.isFlung()&&(this.contentOffset.x+=this.flingVelocity.x*n,this.contentOffset.y+=this.flingVelocity.y*n,this.clampScroll(),this.viewChanged&&this.viewChanged(),n*=3E3,0>this.flingVelocity.x?(this.flingVelocity.x+=n,0<this.flingVelocity.x&&(this.flingVelocity.x=0)):0<this.flingVelocity.x&&(this.flingVelocity.x-=
n,0>this.flingVelocity.x&&(this.flingVelocity.x=0)),0>this.flingVelocity.y?(this.flingVelocity.y+=n,0<this.flingVelocity.y&&(this.flingVelocity.y=0)):0<this.flingVelocity.y&&(this.flingVelocity.y-=n,0>this.flingVelocity.y&&(this.flingVelocity.y=0)))};kb.editProperties=[{label:"scroll",props:[{propName:"contentSize",type:"sizevector",valueType:"float"},{propName:"wheelSensitivity",type:"float",defValue:32,tipText:"If used for zoom, use a really low value, like 0.1"},{propName:"wheelAffects",type:"string",
defValue:"y"},{propName:"allowPinchZoom",type:"boolean",tipText:"Not supported yet!"},{propName:"allowFling",type:"boolean"}]}];kb.setupFromData=function(n,t,v){Wa.callParentSetupFromData(kb,n,t,v);n.wheelSensitivity=t.wheelSensitivity||n.wheelSensitivity;n.wheelAffects=t.wheelAffects||n.wheelAffects;n.allowPinchZoom=t.allowPinchZoom||n.allowPinchZoom;n.dragHandler.setOpts({allowPinchZoom:n.allowPinchZoom});n.allowFling=t.allowFling||n.allowFling};var Ia=function q(t,v){var r=t;if("number"===typeof t||
"string"===typeof t)r=null,v=t;q.prototype.parentConstructor.call(this,r);void 0===v?this.shapeType=q.circleShape:this.setShapeType(v);this.cornerRadius=5;this.strokeWidth=-1;this.strokeInset=0;this.strokeColor=null};cb(Ia,w);Ia.prototype.elementType="shape";Ia.noShape=0;Ia.circleShape=1;Ia.squareShape=2;Ia.roundRectShape=3;Ia.triangleShape=4;Ia.pathShape=5;Ia.typeNames={none:Ia.noShape,circle:Ia.circleShape,square:Ia.squareShape,rect:Ia.squareShape,roundRect:Ia.roundRectShape,roundrect:Ia.roundRectShape,
triangle:Ia.triangleShape,tri:Ia.triangleShape,path:Ia.pathShape};Ia.prototype.setShapeType=function(t){"string"===typeof t&&(t=Ia.typeNames[t]);t!=this.shapeType&&this.setDirty(!0);this.shapeType=t};Ia.prototype.setShape=Ia.prototype.setShapeType;Ia.prototype.setCornerRadius=function(t){0>t&&(t=0);t!=this.cornerRadius&&this.setDirty(!0);this.cornerRadius=t};Ia.prototype.setStroke=function(t,v){t===this.strokeWidth&&v==this.strokeColor||this.setDirty(!0);this.strokeWidth=t;this.strokeColor=v};Ia.prototype.setStrokeInset=
function(t){t!==this.strokeInset&&this.setDirty(!0);this.strokeInset=t};Ia.prototype.makePath=function(t,v){v=v||0;this.shapeType===Ia.circleShape?(t.beginPath(),v=Y.min(this.size.x,this.size.y)/2-v,t.arc(this.size.x/2-this.center.x,this.size.y/2-this.center.y,v,0,2*Math.PI,!0),t.closePath()):this.shapeType===Ia.squareShape?(t.beginPath(),t.rect(0-this.center.x+v,0-this.center.y+v,this.size.x-2*v,this.size.y-2*v),t.closePath()):this.shapeType===Ia.triangleShape?(t.beginPath(),t.moveTo(0-this.center.x+
v,0-this.center.y+v),t.lineTo(0-this.center.x+v,this.size.y-this.center.y-v),t.lineTo(this.size.x-this.center.x-v,this.size.y/2-this.center.y),t.closePath()):this.shapeType===Ia.roundRectShape&&jb.roundRect({x:0-this.center.x+v,y:0-this.center.y+v,w:this.size.x-2*v,h:this.size.y-2*v},this.cornerRadius)};Ia.prototype.drawSelf=function(){var t=gb();this.makePath(t,0);t.fillStyle=this.color.toString();t.fill();this.strokeWidth&&this.strokeColor&&(0!==this.strokeInset&&this.makePath(t,this.strokeInset),
t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor.toString(),t.stroke())};Ia.editProperties=[{label:"shape",props:[{propName:"shapeType",type:"integer"},{propName:"cornerRadius",type:"float"},{label:"strokeWidth",propName:"strokeWidth",type:"float"},{label:"strokeColor",propName:"strokeColor",type:"color"}]}];Ia.setupFromData=function(t,v,q){Wa.callParentSetupFromData(Ia,t,v,q);void 0!==v.shapeType&&(t.shapeType=v.shapeType);void 0!==v.cornerRadius&&t.setCornerRadius(v.cornerRadius);void 0!==
v.strokeWidth&&(t.strokeWidth=v.strokeWidth);void 0!==v.strokeColor&&(t.strokeColor=v.strokeColor)};var Oc=function q(v){q.prototype.parentConstructor.call(this,v);this.fillCur=5;this.fillTotal=10;this.fillRatio=.5;this.allowUnderFill=this.allowOverFill=!1;this.fillStyle="stroke";this.fillShape="circle";this.lineWidth=1;this.setTracksMouse(!1)};cb(Oc,w);Oc.prototype.elementType="fill";Oc.prototype.setFill=function(v,q){if(this.fillCur!==v||void 0!==q&&this.fillTotal!==q)this.fillCur=v,void 0!==q&&
(this.fillTotal=q),!this.allowUnderFill&&0>this.fillCur&&(this.fillCur=0),!this.allowOverFill&&this.fillCur>this.fillTotal&&(this.fillCur=this.fillTotal),this.fillRatio=this.fillCur/this.fillTotal,this.setDirty(!0)};Oc.prototype.setLineWidth=function(v){this.lineWidth!==v&&this.setDirty(!0);this.lineWidth=v};Oc.setupFromData=function(v,q,r){Wa.callParentSetupFromData(Oc,v,q,r);q.allowOverFill&&(v.allowOverFill=q.allowOverFill);q.allowUnderFill&&(v.allowUnderFill=q.allowUnderFill);v.setFill(q.currentFill||
0,q.maxFill);v.fillStyle=q.fillStyle||v.fillStyle;v.fillShape=q.fillShape||v.fillShape;void 0!==q.lineWidth&&(v.lineWidth=q.lineWidth)};var ld=function r(q){r.prototype.parentConstructor.call(this,q);this.fillStyle="fill";this.fillShape="rectangle";this.minColor=O.red;this.maxColor=O.green;this.backColor=O.black;this.borderColor=O.blue;this.startAngle=-Y.HALFPI;this.fullArcLength=Y.PI2};cb(ld,Oc);ld.prototype.elementType="fillBar";ld.prototype.setColors=function(q,r,B){this.backColor=q;this.minColor=
r.min||r;this.maxColor=r.max||r;this.borderColor=B;this.workColor=new O;"string"===typeof this.backColor&&(this.backColor=new O(this.backColor));"string"===typeof this.minColor&&(this.minColor=new O(this.minColor));"string"===typeof this.maxColor&&(this.maxColor=new O(this.maxColor));"string"===typeof this.borderColor&&(this.borderColor=new O(this.borderColor));this.setDirty(!0)};ld.prototype.drawSelf=function(){var q=ca;q.save();var r=this.fillRatio;0>r?r=0:1<r&&(r=1);if(this.minColor.r!==this.maxColor.r||
this.minColor.g!==this.maxColor.g||this.minColor.b!==this.maxColor.b||this.minColor.a!==this.maxColor.a){var B=this.workColor;O.interp(this.minColor,this.maxColor,r,B)}else B=this.minColor;var H=this.getWidth();var G=this.getHeight();var K=this.startAngle,u=K+this.fullArcLength*r,A=this.size.x/2+this.center.x,E=this.size.y/2+this.center.y;"circle"===this.fillShape?(r=H<G?H/2:G/2,"radialStroke"===this.fillStyle&&this.borderColor&&(q.strokeStyle=this.borderColor.toString(),q.lineWidth=this.borderLineWidth||
this.lineWidth,q.beginPath(),q.arc(A,E,r,this.startAngle,this.startAngle+this.fullArcLength,!1),q.stroke()),"radialFill"===this.fillStyle?(this.backColor&&(q.fillStyle=this.backColor.toString(),q.beginPath(),q.arc(A,E,r,0,2*Math.PI,!1),q.closePath(),q.fill()),q.fillStyle=B.toString(),q.beginPath(),q.moveTo(A,E),q.arc(A,E,r,K,u,!1),q.closePath(),q.fill()):"radialStroke"===this.fillStyle?(this.backColor&&(q.strokeStyle=this.backColor.toString(),q.lineWidth=this.lineWidth,q.beginPath(),q.arc(A,E,r,this.startAngle,
this.startAngle+this.fullArcLength,!1),q.stroke()),q.strokeStyle=B.toString(),q.lineWidth=this.lineWidth,q.beginPath(),q.arc(A,E,r,K,u,!1),q.stroke()):z.log("FillBar does not support fillStyle "+this.fillStyle+" with shape "+this.fillShape),"radialStroke"!==this.fillStyle&&this.borderColor&&this.lineWidth&&(q.strokeStyle=this.borderColor.toString(),q.lineWidth=this.lineWidth,q.beginPath(),q.arc(A,E,r,K,u,!1),q.stroke())):(q.translate(-this.center.x,-this.center.y),this.flipX&&(q.translate(this.size.x,
0),q.scale(-1,1)),q.fillStyle=this.backColor.toString(),q.fillRect(0,0,H,G),"radialFill"===this.fillStyle?(q.beginPath(),q.rect(0,0,H,G),q.clip(),r=2*(H>G?H:G),q.beginPath(),q.moveTo(A,E),q.arc(A,E,r,K,u,!1),q.closePath(),q.fillStyle=B.toString(),q.fill()):"radialStroke"===this.fillStyle?z.log("FillBar does not support fillStyle "+this.fillStyle+" with shape "+this.fillShape):"fill"===this.fillStyle?(q.fillStyle=B.toString(),q.fillRect(0,0,H*r,G)):(q.strokeStyle=B.toString(),q.lineWidth=this.lineWidth,
q.strokeRect(0,0,H*r,G)),this.borderColor&&(q.strokeStyle=this.borderColor.toString(),q.lineWidth=this.lineWidth,q.strokeRect(0,0,this.getWidth(),this.getHeight())));q.restore()};ld.setupFromData=function(q,r,B){r.colors=r.colors||{};Wa.callParentSetupFromData(ld,q,r,B);B=new O(r.colors.background||O.black);var H=new O(r.colors.minBody||r.colors.body||q.color||O.red),G=new O(r.colors.maxBody||r.colors.body||q.color||O.green);r=new O(r.colors.border||(r.border?r.border.color:void 0)||O.blue);q.setColors(B,
{min:H,max:G},r)};var Pc=function(q){this.states=q;this.bestState=q.normal};Pc.prototype.getBestState=function(q){var r=this.states.normal,B=q.flags||0;q.tracking&&(B|=w.trackingMouseDownFlag);q.highlighted&&(B|=w.highlightedFlag);q.targeted&&(B|=w.targetedFlag);B&w.highlightedFlag&&this.states.highlighted&&(r=this.states.highlighted);B&w.targetedFlag&&this.states.targeted&&(r=this.states.targeted);B&w.trackingMouseDownFlag&&this.states.tracking&&(r=this.states.tracking);return r};Pc.prototype.setStateFor=
function(q,r){this.bestState=r=this.getBestState(r);q.strokeStyle=r.color.toString();q.fillStyle=r.color.toString();r.width&&(q.lineWidth=r.width)};Pc.prototype.drawRect=function(q,r){"frame"===(this.bestState.type||"frame")?q.strokeRect(r.x,r.y,r.w,r.h):q.fillRect(r.x,r.y,r.w,r.h)};Pc.prototype.drawForElement=function(q,r){this.drawRect(q,{x:0,y:0,w:r.size.x,h:r.size.y})};Pc.prototype.setAndDraw=function(q,r){this.setStateFor(q,r);this.drawForElement(q,r)};Pc.prototype.setAndDrawRect=function(q,
r,B){this.setStateFor(q,r);this.drawRect(q,B)};var Qc={isWhitespace:function(q){return" "===q||"\t"===q||"\n"===q||"\r"===q||q===String.fromCharCode(12288)},skipWhitespaceAhead:function(q,r){for(;r<q.length&&Qc.isWhitespace(q.charAt(r));r++);return r},isAlphabetic:function(q){return 4096>q},isTwoPartPunctuation:function(q){return"?"===q||"!"===q||";"===q||":"===q},canBreakBetween:function(q,r){if(""===q||""===r)return!0;var B=q.charCodeAt(0),H=r.charCodeAt(0),G=!1;Qc.isAlphabetic(B)&&Qc.isAlphabetic(H)||
(G=!0);if(Qc.isWhitespace(r)||"-"===q)G=!0;if(Qc.isNonBeginningChar(H)||Qc.isNonEndingChar(B))G=!1;return G},wrapString:function(q,r,B,H,G,K){for(var u=[],A=0,E="",S=0,aa=0,R=0,Q={ctx:B},ea={},F=0;F<q.length;F++){for(var y=q[F];H&&y===H;){y=2;var I=q[F+1];Q.string=q;Q.stringPos=F+2;G[I]?(G[I].measure(Q,ea),R+=ea.width||0,y+=ea.consumeCharacters||0):z.logWarningOnce("word wrap special code "+I+" not handled.");F+=y;y=q[F];q[F]!==H&&(F--,y="")}if("\n"===y)u.push(q.substring(A,F)),S=aa=A=F+1,R=0,E="";
else if(I=E+y,B.measureText(I).width+R>r?(I=!0,S===A&&(K?S=aa=F:I=!1),I&&(u.push(q.substring(A,S)),A=S=aa,R=0,F=A-1,E=y="")):E=I,""===y&&(y="x"),F>=q.length-1||q[F+1]!==H&&Qc.canBreakBetween(y,q[F+1]))S=F+1,aa=Qc.skipWhitespaceAhead(q,F+1)}A!==q.length&&u.push(q.substring(A,q.length));return u},isNonBeginningChar:function(q){return 69===q||160===q||65292===q||65294===q||65306===q||65072===q||65104===q||183===q||65110===q||65373===q||12303===q||65116===q||8221===q||58===q||93===q||8226===q||8231===
q||8230===q||65105===q||65108===q||65111===q||12305===q||12301===q||65118===q||12318===q||59===q||125===q||65307===q||65281===q||65106===q||65109===q||12309===q||12297===q||65114===q||8217===q||8242===q||37===q||176===q||8243===q||8451===q||12299===q||65285===q||65341===q||65504===q||8211===q||8212===q||65377===q||65380===q||12387===q||12419===q||12421===q||12423===q||12483===q||12515===q||12517===q||12519===q||12353===q||12355===q||12357===q||12359===q||12361===q||12430===q||12449===q||12451===q||
12453===q||12455===q||12457===q||12526===q||34===q||33===q||41===q||44===q||46===q||63===q||12289===q||12290===q||12540===q||65281===q||65289===q||65311===q||65392===q||65438===q||65439===q},isNonEndingChar:function(q){return 12304===q||12300===q||65117===q||12317===q||91===q||12308===q||12296===q||65113===q||8216===q||8245===q||123===q||65371===q||12302===q||65115===q||8220===q||92===q||36===q||65505===q||12298===q||65284===q||65339===q||65510===q||65509===q||34===q||40===q||65288===q}},ia=function H(r,
B){if("string"!==typeof r){var G=r;r=B}H.prototype.parentConstructor.call(this,G);this.value=void 0===r?"":r;this.font="arial";this.fontStyle="";this.fontSize=15;this.fontLineSpacing=2;this.fontLineHeight=16;this.fontDescriptor="15px arial";this.strokeWidth=-1;this.strokeColor=null;this.textShadowEnabled=!1;this.textShadowColor=new O(0,0,0,.5);this.textShadowOffset={x:1,y:1};this.textShadowBlur=0;this.forceWrap=this.autoWrap=!1;this.stopLength=-1;this.drawnLengthTotal=0;this.size.x=100;this.maxWidth=
this.size.x;this.overriddenMaxWidth=!1;this.size.y=this.fontLineHeight;this.fitParams={tryCount:4,squishPerTry:.1};this.textInset={x:0,y:0};this.rawTextWidth=this.textHeight=this.textWidth=0;this.align=H.alignLeft;this.baseline=H.baselineMiddle;this.name="<txt>"+this.id+"("+this.value+")";this.textChanged();this.setTracksMouse(!1)};cb(ia,w);ia.prototype.elementType="textBox";ia.alignLeft=0;ia.alignCenter=1;ia.alignRight=2;ia.baselineTop=0;ia.baselineMiddle=1;ia.baselineBottom=2;ia.specialCharacter=
"\u2121";ia.specialPushColorCode="\u2193";ia.specialPopColorCode="\u2191";ia.specialImageCode="\u263a";ia.specialDraws=null;ia.fontHeightOverrides={};ia.prototype.setTextValue=function(r){var B=this.value;this.value=""+r;this.name="<txt>"+this.id+"("+this.value+")";B!==this.value&&this.textChanged()};ia.prototype.getTextValue=function(r){var B=this.value;B&&r&&(B=B.trim());return B};ia.prototype.translateAndSetTextValue=function(r){fa&&(r=fa.getString(r));r!==this.value&&(this.value=r,this.textChanged())};
ia.prototype.setSpecialDraw=function(r){var B=r.code,H=this;r.measure=function(G,K){r.measureFunc?(G.code=B,G.data=r,G.segment=G.segment||{},G.textBox=H,r.measureFunc(G,K)):K.consumeCharacters=K.width=0};this.specialDraws||(this.specialDraws={});this.specialDraws[B]=r;this.textChanged()};ia.prototype.enableDefaultSpecialFormatting=function(){var r={colorStack:[]},B=this.value;this.value="";this.setSpecialDraw({code:ia.specialPushColorCode,measureFunc:function(H,G){G.consumeCharacters=3;G.width=0;
if(H.segment){G=H.string.charCodeAt(H.stringPos);var K=H.string.charCodeAt(H.stringPos+1),u=H.string.charCodeAt(H.stringPos+2);H.segment.fillStyle="rgb("+G+","+K+","+u+")"}},preDrawFunc:function(H,G){H.data.myData.colorStack=[]},drawFunc:function(H,G){H.data.myData.colorStack.push(H.ctx.fillStyle);H.ctx.fillStyle=H.segment.fillStyle},myData:r});this.setSpecialDraw({code:ia.specialPopColorCode,drawFunc:function(H,G){H.ctx.fillStyle=0<H.data.myData.colorStack.length?H.data.myData.colorStack.pop():"#FF2020"},
myData:r});this.setSpecialDraw({code:ia.specialImageCode,measureFunc:function(H,G){var K=H.string.indexOf(ia.specialImageCode,H.stringPos);K>H.stringPos?(G.consumeCharacters=K-H.stringPos+1,G.width=H.textBox.fontLineHeight,H.segment.imageKey=H.string.substring(H.stringPos,K),ia.specialImageMap||z.logWarningOnce("textbox special image map used but missing")):(z.logWarningOnce("textbox special image code missing terminator"),G.consumeCharacters=0,G.width=0)},preDrawFunc:null,drawFunc:function(H,G){G=
H.ctx;var K=ia.specialImageMap[H.segment.imageKey];if(K){var u=H.textBox,A=H.x;H=H.y;var E=u.fontLineHeight,S=E;u.specialImageAdjust&&(E*=u.specialImageAdjust.scale,S*=u.specialImageAdjust.scale,A+=u.specialImageAdjust.x,H+=u.specialImageAdjust.y);u.baseline===ia.baselineMiddle?H-=E/2:u.baseline===ia.baselineBottom&&(H-=E);K.draw(G,A,H,S,E)}}});this.value=B;this.textChanged()};ia.formatText=function(r,B){function H(aa,R,Q){function ea(p,x,C){for(;x<p.length;x++){a:for(var J=p;J[x]===G;)if(x=J[x+1]===
A?J.indexOf(A,x+2):J[x+1]===K?J.indexOf(u,x+2):J.indexOf(G,x+2),0>x){x=-1;break a}if(0>x)break;if(p[x]===C)return x}return-1}var F="",y=-1;do if(y=ea(aa,0,R),0<=y){var I=ea(aa,y+1,R);0>I&&(I=aa.length);F+=aa.substring(0,y);F+=G;F+=K;F+=Q;F+=aa.substring(y+1,I);F+=G;F+=u;aa=aa.substring(I+1)}while(0<=y);return F+aa}if(""===r)return"";if(!r)return null;if(!B||0===B.length)return r;for(var G=ia.specialCharacter,K=ia.specialPushColorCode,u=ia.specialPopColorCode,A=ia.specialImageCode,E=0;E<B.length;E++){var S=
B[E].color;"string"===typeof S&&(S=new O(S));S=String.fromCharCode(S.r,S.g,S.b);r=H(r,B[E].formatChar,S)}return r=r.split("\\n").join("\n")};ia.setFontHeightOverride=function(r,B){ia.fontHeightOverrides[r]=B};ia.setSpecialImageMap=function(r){ia.specialImageMap=r};ia.makeSpecialImageString=function(r){return""+ia.specialCharacter+ia.specialImageCode+r+ia.specialImageCode};ia.prototype.setSpecialImageAdjust=function(r){r=tb(r);r.x=r.x||0;r.y=r.y||0;r.scale=r.scale||1;this.specialImageAdjust=r};ia.prototype.updateFontDescriptor=
function(){var r=this.fontDescriptor;this.fontDescriptor=(""+this.fontStyle+" "+this.fontSize+"px "+this.font).trim();r!==this.fontDescriptor&&this.value&&0<this.value.length&&this.textChanged()};ia.prototype.setFont=function(r,B,H){this.font=r;B&&this.setFontSize(B);H&&this.setFontStyle(H);this.updateFontDescriptor()};ia.prototype.setFontStyle=function(r){this.fontStyle=r;this.updateFontDescriptor()};ia.prototype.setFontColor=ia.prototype.setColor;ia.prototype.setFontSize=function(r){this.fontSize=
r;var B=0;this.font&&(B=ia.fontHeightOverrides[this.font]);this.fontLineHeight=B?r*B|0:r+1;this.updateFontDescriptor()};ia.prototype.getFontSize=function(){return this.fontSize};ia.prototype.setLineHeight=function(r){this.fontLineHeight=r};ia.prototype.setAutoWrap=function(r,B){void 0===B&&(B=!1);var H=this.autoWrap,G=this.forceWrap;this.autoWrap=r;this.forceWrap=B;H===r&&G===B||this.textChanged()};ia.prototype.setSquishToFit=function(r){this.fitParams.tryCount=r.tryCount||this.fitParams.tryCount;
this.fitParams.squishPerTry=r.squishPerTry||this.fitParams.squishPerTry};ia.prototype.setStopLength=function(r){this.stopLength=void 0!==r?r:-1};ia.prototype.getDrawnLengthTotal=function(r){return this.drawnLengthTotal};ia.prototype.overrideMaxWidth=function(r){-1==r&&(r=9999);this.maxWidth=r;this.overriddenMaxWidth=!0;this.textChanged();this.setDirty(!0)};ia.prototype.setTextInset=function(r,B){var H=!1;void 0!==r&&(this.textInset.x=r,H=!0);void 0!==B&&(this.textInset.y=B,H=!0);H&&(this.textChanged(),
this.setDirty(!0))};ia.prototype.centerText=function(){this.setAlign(ia.alignCenter);this.setBaseline(ia.baselineMiddle)};ia.prototype.leftAlignText=function(){this.setAlign(ia.alignLeft)};ia.prototype.rightAlignText=function(){this.setAlign(ia.alignRight)};ia.prototype.setAlign=function(r){"string"===typeof r&&("left"===r?r=ia.alignLeft:"center"===r?r=ia.alignCenter:"right"===r&&(r=ia.alignRight));r!==this.align&&this.setDirty(!0);this.align=r};ia.prototype.setAlignment=ia.prototype.setAlign;ia.prototype.setBaseline=
function(r){"string"===typeof r&&("top"===r?r=ia.baselineTop:"middle"===r?r=ia.baselineMiddle:"bottom"===r&&(r=ia.baselineBottom));r!==this.baseline&&this.setDirty(!0);this.baseline=r};ia.prototype.setStroke=function(r,B,H){r&&void 0===B&&void 0===H&&"number"!==typeof r&&(H=r.doCleanup,B=r.color,r=r.lineWidth||r.width);void 0===H&&(H=!1);r===this.strokeWidth&&this.strokeCleanup===H||this.setDirty(!0);this.setStrokeColor(B);this.strokeWidth=r;this.strokeCleanup=H};ia.prototype.setStrokeColor=function(r){(this.strokeColor!==
r||this.strokeColor&&r&&this.strokeColor.equal&&!this.strokeColor.equal(r))&&this.setDirty(!0);this.strokeColor=r};ia.prototype.setMiterLimit=function(r){this.miterLimit=r};ia.prototype.setShadowEnabled=function(r){r=void 0===r?!0:!!r;this.textShadowEnabled!==r&&(this.textShadowEnabled=r,this.setDirty(!0))};ia.prototype.setShadow=function(r,B,H,G){var K=!1;r&&!this.textShadowColor.equal(r)&&(K=!0,this.textShadowColor.copyFrom(r));void 0!==B&&B!==this.textShadowOffset.x&&(K=!0,this.textShadowOffset.x=
B);void 0!==H&&H!==this.textShadowOffset.y&&(K=!0,this.textShadowOffset.y=H);void 0!==G&&G!==this.textShadowBlur&&(K=!0,this.textShadowBlur=G);this.textShadowEnabled=!0;K&&this.setDirty(!0)};ia.prototype.setupAlignX=function(r,B){r.textAlign="left";r=this.align===ia.alignLeft?this.strokeWidth/2+this.textInset.x:this.align===ia.alignCenter?this.size.x/2-B/2:this.size.x-B-this.textInset.x;this.ignoreCenter||(r-=this.center.x);return r};ia.prototype.setupAlignY=function(r){this.baseline===ia.baselineTop?
(r.textBaseline="top",r=this.textInset.y):this.baseline===ia.baselineMiddle?(r.textBaseline="middle",r=this.size.y/2):(r.textBaseline="bottom",r=this.size.y-this.textInset.y);this.ignoreCenter||(r-=this.center.y);return r};ia.prototype.textChanged=function(){this.setDirty();if(!this.value||0>=this.value.length||!ca)this.lines=[],this.rawTextWidth=this.textHeight=this.textWidth=0,this.setContentSize(0,0);else{ca.font=this.fontDescriptor;var r=this.maxWidth;r-=2*this.textInset.x;0<this.strokeWidth&&
this.strokeColor&&(r-=this.strokeWidth);this.drawnLengthTotal=0;this.wrapAndFitText(r);this.lines=this.makeLineSegments(this.lines,ca);var B=this.processLineWidths(),H=r/B;1<H&&(H=1);for(var G=0;G<this.lines.length;G++){for(var K=this.lines[G],u=0,A=0;A<K.segments.length;A++){var E=K.segments[A];E.width*=H;E.x=u;u+=E.width}K.width*=H}this.rawTextWidth=B;B>r&&(B=r);this.textWidth=B;this.setContentSize(this.textWidth+2*this.textInset.x,this.textHeight+2*this.textInset.y)}};ia.prototype.wrapAndFitText=
function(r){for(var B=this.fitParams.tryCount,H=this.fontLineHeight,G=1,K=this.fitParams.squishPerTry,u=!1,A=0;!u&&A<B;A++){this.autoWrap?(H=ia.specialCharacter,this.specialDraws||(H=0),this.lines=Qc.wrapString(this.value,r*G,ca,H,this.specialDraws,this.forceWrap)):this.lines=this.value.split("\n");if(!this.lines||1>this.lines.length){this.lines=[];this.setContentSize(0,0);return}H=this.fontLineHeight*this.lines.length+this.fontLineSpacing*(this.lines.length-1);var E=this.size.y-2*this.textInset.y;
1<this.lines.length&&H>E?G+=K:u=!0}this.textHeight=H};ia.prototype.makeLineSegments=function(r,B){function H(I,p,x,C){I={text:I.substring(x,C)};x=B.measureText(I.text);I.width=x.width||x;p.segments.push(I)}for(var G={ctx:B,textBox:this},K={},u=this.specialDraws,A=0;A<r.length;A++){var E=r[A];if(u&&0<=E.indexOf(ia.specialCharacter)){for(var S={segments:[]},aa=0,R=0;R<E.length;R++)for(;E[R]===ia.specialCharacter;){aa<R&&H(E,S,aa,R);aa={isSpecial:!0};var Q=0,ea=2,F=E[R+1];aa.code=F;G.string=E;G.stringPos=
R+2;G.segment=aa;var y=u[F];y?(G.data=y,y.measure(G,K),Q=K.width||0,ea+=K.consumeCharacters||0):z.logWarningOnce("textbox segmenting special code "+F+" not handled.");aa.text=E.substring(R,R+ea);aa.width=Q;S.segments.push(aa);aa=R+=ea}aa<E.length&&H(E,S,aa,E.length);r[A]=S}else E={text:E,width:B.measureText(E).width},r[A]={segments:[E]}}return r};ia.prototype.processLineWidths=function(){for(var r=0,B=0;B<this.lines.length;B++){for(var H=0,G=this.lines[B],K=0;K<G.segments.length;K++){var u=G.segments[K];
H+=u.width;u.isSpecial||(this.drawnLengthTotal+=u.text.length)}G.width=H;G.width>r&&(r=G.width)}return r};ia.prototype.getTextWidth=function(){return this.maxWidth<this.textWidth?this.maxWidth:this.textWidth};ia.prototype.getTextHeight=function(){return this.textHeight};ia.prototype.getRawTextWidth=function(){return this.rawTextWidth};ia.prototype.prepStyle=function(r){r.font=this.fontDescriptor;r.fillStyle=this.color.a?this.color.toString():this.color;0<this.strokeWidth&&this.strokeColor&&(r.strokeStyle=
this.strokeColor.toString(),r.lineWidth=this.strokeWidth);this.miterLimit&&(this.oldMiterLimit=r.miterLimit,r.miterLimit=this.miterLimit);this.textShadowEnabled&&0<this.textShadowColor.a&&(r.shadowColor=this.textShadowColor.toString(),r.shadowOffsetX=this.textShadowOffset.x,r.shadowOffsetY=this.textShadowOffset.y,r.shadowBlur=this.textShadowBlur)};ia.prototype.unPrepStyle=function(r){this.oldMiterLimit&&(r.miterLimit=this.oldMiterLimit)};ia.prototype.drawSegment=function(r,B,H,G,K){0<this.strokeWidth&&
this.strokeColor&&r.strokeText(K,B,H,G);r.fillText(K,B,H,G);if(this.strokeCleanup&&0<=this.strokeWidth&&this.strokeColor){var u=r.globalAlpha,A=r.lineWidth,E=A/50;1>E&&(E=1);r.globalAlpha*=.3;r.lineWidth=E;r.strokeText(K,B,H,G);r.globalAlpha=u;r.lineWidth=A}};ia.prototype.drawLine=function(r,B,H,G){for(var K=0;K<G.segments.length&&!(0<=this.stopLength&&this.drawnLength>=this.stopLength);K++){var u=G.segments[K];if(u.isSpecial){var A=this.specialDraws[u.code];if(!A)break;A.drawFunc({code:u.code,data:A,
segment:u,ctx:r,textBox:this,string:u.text,stringPos:2,x:B,y:H,width:u.width},{})}else{A=u.text;var E=u.text.length;0<=this.stopLength&&this.drawnLength+E>=this.stopLength&&(E=this.stopLength-this.drawnLength,A=A.substr(0,E));this.drawSegment(r,B,H,u.width,A);this.drawnLength+=E}B+=u.width}};ia.prototype.drawSelf=function(){if(this.value){var r=gb();this.prepStyle(r);for(var B in this.specialDraws){var H=this.specialDraws[B];H.preDrawFunc&&H.preDrawFunc({code:B,data:H,ctx:r,textBox:this},{})}this.drawnLength=
0;if(0<this.lines.length){B=this.setupAlignY(r);H=this.fontLineHeight+this.fontLineSpacing;var G=this.lines.length*H;this.baseline===ia.baselineMiddle?B-=(G-H)/2:this.baseline===ia.baselineBottom&&(B-=G-H);for(var K=0;K<this.lines.length;K++)G=this.setupAlignX(r,this.lines[K].width),this.drawLine(r,G,B,this.lines[K]),B+=H}else G=this.setupAlignX(r,this.textWidth),B=this.setupAlignY(r),this.drawLine(r,G,B,{segments:[{text:this.value}]});this.unPrepStyle(r)}};ia.prototype.boundsChanged=function(){this.overriddenMaxWidth||
(this.maxWidth=this.size.x);ia.prototype.parentPrototype.boundsChanged.call(this);this.textChanged();this.setDirty(!0)};ia.standardFontEditProperties={label:"font",props:[{label:"font",propName:"font.font",type:"string",defValue:"impact"},{label:"size",propName:"font.size",type:"float",defValue:40},{label:"style",propName:"font.style",type:"string"},{label:"lineHeight",propName:"font.lineHeight",type:"float"}]};ia.standardFontStrokeEditProperties={label:"stroke",props:[{label:"width",propName:"font.stroke.width",
type:"float"},{label:"color",propName:"font.stroke.color",type:"color"},{label:"cleanup",propName:"font.stroke.doCleanup",type:"boolean",tipText:"expensive way to try to make edges nicer"}]};ia.editProperties=[{label:"text",props:[{propName:"text",type:"string"},{propName:"translateText",type:"string",tipText:"overrides text, tries to translate first"},{propName:"autoWrap",type:"boolean"}]},ia.standardFontEditProperties,{label:"align",props:[{propName:"align",type:"string",defValue:"left"},{propName:"baseline",
type:"string",defValue:"middle",tipText:"vertical alignment"}]},ia.standardFontStrokeEditProperties];ia.setupFromData=function(r,B,H){Wa.callParentSetupFromData(ia,r,B,H);B.font&&(void 0!=B.font.font&&r.setFont(B.font.font),void 0!=B.font.size&&r.setFontSize(B.font.size),void 0!=B.font.style&&r.setFontStyle(B.font.style),B.font.lineHeight&&r.setLineHeight(B.font.lineHeight),void 0!=B.font.stroke&&r.setStroke(B.font.stroke.width,O.fixColorStyle(B.font.stroke.color),B.font.stroke.doCleanup));"left"===
B.align?r.setAlign(ia.alignLeft):"center"===B.align?r.setAlign(ia.alignCenter):"right"===B.align&&r.setAlign(ia.alignRight);"top"===B.baseline?r.setBaseline(ia.baselineTop):"middle"===B.baseline||"center"===B.baseline?r.setBaseline(ia.baselineMiddle):"bottom"===B.baseline&&r.setBaseline(ia.baselineBottom);void 0!==B.autoWrap&&r.setAutoWrap(!!B.autoWrap);B.translateText?r.translateAndSetTextValue(B.translateText||""):r.setTextValue(B.text||"")};var Pb={blobs:{},init:function(){Pb.localSave=Qa.getStorage(Qa.permanentLocal,
"rat");if(Pb.localSave){var r=Pb.localSave.getObject("rat_clipboard");r&&2===r.version&&(Pb.blobs=r.blobs)}},cache:function(){Pb.localSave&&Pb.localSave.setObject("rat_clipboard",{version:2,blobs:Pb.blobs})},store:function(r,B){"string"===typeof r&&(r={type:r,value:B});Array.isArray(r)||(r=[r]);Pb.blobs={};for(B=0;B<r.length;B++){var H=r[B];Pb.blobs[H.type]={type:H.type,value:H.value}}Pb.cache()},retrieve:function(r){return Pb.blobs[r]?Pb.blobs[r].value:null},getData:function(){return Pb.blobs?Pb.blobs:
null}},Xa=function G(B,H){this.config={};this.config.enters=[{action:"toggleActive"},{ctrlKey:!0,action:"insertCR"}];this.config.maxLength=-1;this.supportPan=!0;this.pan={x:20,y:0};G.prototype.parentConstructor.call(this,B,H);this.setTracksMouse(!0);this.setTargetable(!0);this.flags|=w.exclusiveHighlightFlag;this.editFrameLook={normalColor:new O(180,180,180),highlightColor:new O(255,255,180),activeColor:new O(255,255,255),lineWidth:2};this.editFillLook={activeColor:new O(20,20,20,.2)};this.editSelectionLook=
{normalColor:new O(200,200,180,.2),activeColor:new O(255,255,180,.8),caratColor:new O(255,255,255),caratWidth:2,caratBlinkSpeed:2};this.timer=0;this.active=!1;this.overrideMaxWidth(-1);B=0;this.value?B=this.value.length:this.value="";this.setCursorPos(B)};cb(Xa,ia);Xa.prototype.elementType="editText";Xa.prototype.flagsThatDirtyMe=w.highlightedFlag|w.enabledFlag;Xa.prototype.setEnterHandling=function(B){"string"===typeof B?B={action:B}:"function"===typeof B&&(B={action:B});B||(B=[]);Array.isArray(B)||
(B=[B]);this.config.enters=B};Xa.prototype.setMaxTextLength=function(B){this.config.maxLength=B};Xa.prototype.setTextValue=function(B){Xa.prototype.parentPrototype.setTextValue.call(this,B);var H=0;B&&(H=B.length);this.setCursorPos(H)};Xa.prototype.textChanged=function(){0<this.config.maxLength&&this.value.length>this.config.maxLength&&(this.value=this.value.substring(0,this.config.maxLength));this.textChangeCallback&&this.textChangeCallback(this,this.value);Xa.prototype.parentPrototype.textChanged.call(this);
this.updatePan()};Xa.prototype.setCursorPos=function(B){this.selectionRight=this.selectionLeft=this.selectionEnd=this.selectionAnchor=this.cursorPos=B;this.timer=0;this.setDirty(!0);this.updatePan()};Xa.prototype.selectAll=function(){this.cursorPos=this.value.length;this.selectionLeft=this.selectionAnchor=0;this.selectionRight=this.selectionEnd=this.value.length;this.timer=0;this.setDirty(!0);this.updatePan()};Xa.prototype.updateSelectionLeftRight=function(){this.selectionAnchor<this.selectionEnd?
(this.selectionLeft=this.selectionAnchor,this.selectionRight=this.selectionEnd):(this.selectionLeft=this.selectionEnd,this.selectionRight=this.selectionAnchor)};Xa.prototype.updatePan=function(){if(0===this.cursorPos)this.pan.x=0;else{ca.font=this.fontDescriptor;var B=this.value.substring(0,this.cursorPos);B=ca.measureText(B).width;if(this.pan.x<B-4&&this.pan.x+this.size.x>B+4)var H=this.pan.x+this.size.x+4>this.textWidth?this.textWidth-this.size.x+4:this.pan.x;else H=B-this.size.x+4,this.pan.x>H&&
(H=B-4);this.pan.x=H;0>this.pan.x&&(this.pan.x=0)}};Xa.prototype.setActive=function(B){B!=this.active&&this.setDirty(!0);(this.active=B)?this.timer=0:this.caratBlinkOn=!1};Xa.prototype.drawFrame=function(B){var H=this.editFrameLook;B.lineWidth=H.lineWidth;var G=0,K=0!==(this.flags&w.targetedFlag),u=this.flags&w.enabledFlag&&this.flags&w.highlightedFlag;B.strokeStyle=this.active?H.activeColor.toString():u?H.highlightColor.toString():H.normalColor.toString();if(u||K)B.lineWidth=H.lineWidth+1,G=1;B.strokeRect(-this.center.x-
G,-this.center.y-G,this.size.x+2*G,this.size.y+2*G)};Xa.prototype.drawSelf=function(){var B=gb();this.active&&(B.fillStyle=this.editFillLook.activeColor.toString(),B.fillRect(-this.center.x,-this.center.y,this.size.x,this.size.y));this.drawFrame(B);var H=!1;this.supportPan&&(H=!0,B.save(),B.beginPath(),B.rect(1-this.center.x,1-this.center.y,this.size.x-2,this.size.y-2),B.clip(),B.translate(-this.pan.x,-this.pan.y));Xa.prototype.parentPrototype.drawSelf.call(this);var G=this.editSelectionLook,K=this.setupAlignX(B,
this.textWidth);if(this.selectionAnchor!==this.selectionEnd){var u=-this.center.y+2,A=this.size.y-4,E=K,S=this.value.substring(0,this.selectionAnchor);S=ca.measureText(S);E+=S.width;var aa=K+1;S=this.value.substring(0,this.selectionEnd);S=ca.measureText(S);aa+=S.width;B.fillStyle=this.active?G.activeColor.toString():G.normalColor.toString();B.fillRect(E,u,aa-E,A)}u=this.caratBlinkOn;this.active&&u&&(K+=1,u=-this.center.y+2,A=G.caratWidth,E=this.size.y-4,aa=this.value.substring(0,this.cursorPos),aa=
ca.measureText(aa).width,B.fillStyle=G.caratColor.toString(),B.fillRect(K+aa,u,A,E));H&&B.restore()};Xa.prototype.updateSelf=function(B){this.active&&(this.timer+=B,B=this.caratBlinkOn,this.caratBlinkOn=1>this.timer*this.editSelectionLook.caratBlinkSpeed*2%2,B!=this.caratBlinkOn&&this.setDirty(!0))};Xa.prototype.keyDown=function(B){B.which;if(B.which>=la.f1&&B.which<=la.f12)return!1;if(B.which===la.esc)return this.active?(this.setActive(!1),!0):!1;if(B.which===la.enter)for(var H=0;H<this.config.enters.length;H++){var G=
this.config.enters[H];if(!!B.sysEvent.ctrlKey===!!G.ctrlKey&&!!B.sysEvent.shiftKey===!!G.shiftKey&&!!B.sysEvent.altKey===!!G.altKey)return"function"===typeof G.action?G.action(this,this.value,B):"toggleActive"===G.action?this.active?this.setActive(!1):this.setActive(!0):"insertCR"===G.action&&this.insertText("\n"),!0}if(this.active){var K=this;H=function(aa){var R=K.value.slice(0,aa);aa=K.value.slice(aa+1,K.value.length);K.value=R+aa;K.textChanged()};G=function(aa){aa=K.value.slice(0,K.selectionLeft);
var R=K.value.slice(K.selectionRight,K.value.length);K.value=aa+R;K.textChanged()};var u=B.sysEvent.shiftKey,A=!1,E=!1,S=this.cursorPos;if(B.which===la.c&&B.sysEvent.ctrlKey)return(B=K.value.slice(K.selectionLeft,K.selectionRight))&&0<B.length&&(Pb.store("text",B),console.log("copy "+B)),!0;if(B.which===la.v&&B.sysEvent.ctrlKey){if(B=Pb.retrieve("text"))console.log("paste "+B),this.insertText(B);return!0}if(B.which===la.x&&B.sysEvent.ctrlKey)return(B=K.value.slice(K.selectionLeft,K.selectionRight))&&
0<B.length&&(Pb.store("text",B),console.log("cut "+B),this.insertText("")),!0;B.which===la.backspace?(B.sysEvent.preventDefault(),this.selectionEnd!=this.selectionAnchor?(G(),S=this.selectionLeft):0<this.cursorPos&&(H(this.cursorPos-1),S=this.cursorPos-1),u=!1,A=!0):B.which===la.del?(this.selectionEnd!=this.selectionAnchor?(G(),S=this.selectionLeft):this.cursorPos<this.value.length&&H(this.cursorPos),u=!1,A=!0):B.which===la.leftArrow?(S=u||this.selectionEnd==this.selectionAnchor?this.cursorPos-1:
this.selectionLeft,A=!0):B.which===la.rightArrow?(S=u||this.selectionEnd==this.selectionAnchor?this.cursorPos+1:this.selectionRight,A=!0):B.which===la.home?(S=0,A=!0):B.which===la.end?(S=this.value.length,A=!0):B.which===la.a&&B.sysEvent.ctrlKey&&(this.selectionAnchor=0,this.selectionEnd=S=this.value.length,E=A=!0);if(A)return S=Math.max(S,0),S=Math.min(S,this.value.length),E||(this.selectionEnd=u?S:this.selectionAnchor=S),this.updateSelectionLeftRight(),this.cursorPos=S,this.updatePan(),this.timer=
0,this.setDirty(!0),!0}else if(B.which===la.backspace||B.which===la.del)return B.sysEvent.preventDefault(),this.setTextValue(""),!0;return!1};Xa.prototype.keyPress=function(B){if(!this.active)return!1;B=B.key;if(32>B.charCodeAt(0))return!1;"\n"!==B&&"\t"!==B&&this.insertText(B);return!0};Xa.prototype.insertText=function(B){var H=this.value.slice(0,this.selectionLeft),G=this.value.slice(this.selectionRight,this.value.length);this.value=H+B+G;this.textChanged();this.setCursorPos(this.selectionLeft+
B.length)};Xa.prototype.blur=function(){this.setActive(!1);return Xa.prototype.parentPrototype.blur.call(this)};Xa.prototype.handleTabbedTo=function(B){this.setActive(!0);this.selectAll()};Xa.prototype.pointToCharIndex=function(B){ca.font=this.fontDescriptor;for(var H=this.value.length,G=0,K=1;K<=this.value.length;K++){var u=this.value.substring(0,K);u=ca.measureText(u);if(B.x+this.center.x+this.pan.x<G+(u.width-G)/2){H=K-1;break}G=u.width}return H};Xa.prototype.mouseDown=function(B,H){Xa.prototype.parentPrototype.mouseDown.call(this,
B,H);this.active?(B=this.pointToCharIndex(B),H.sysEvent.shiftKey?(this.selectionEnd=B,this.updateSelectionLeftRight()):this.selectionEnd=this.selectionAnchor=this.selectionLeft=this.selectionRight=B,this.cursorPos=B):(this.setActive(!0),this.config.selectAllOnClickActivate?this.selectAll():(H=this.pointToCharIndex(B),this.setCursorPos(H)));this.trackingClick=!0;this.timer=0;this.setDirty(!0);return!0};Xa.prototype.mouseUp=function(B,H){Xa.prototype.parentPrototype.mouseUp.call(this,B,H);return this.trackingClick?
(this.trackingClick=!1,!0):!1};Xa.prototype.mouseMove=function(B,H){return this.trackingClick?(B=this.pointToCharIndex(B),B!=this.selectionEnd&&this.setDirty(!0),this.cursorPos=this.selectionEnd=B,this.updateSelectionLeftRight(),this.updatePan(),!0):!1};Xa.prototype.trigger=function(){this.active||(this.setActive(!0),this.selectAll());return Xa.prototype.parentPrototype.trigger.call(this)};Xa.setupFromData=function(B,H,G){Wa.callParentSetupFromData(Xa,B,H,G)};var pb=function u(H,G,K){K=K||{};u.prototype.parentConstructor.call(this,
H);this.setTracksMouse(!1);this.setTargetable(!0);this.flags|=w.exclusiveHighlightFlag;this.makeDOMObject(H,G,K)};cb(pb,ia);pb.prototype.elementType="domEditText";pb.prototype.letSlashThrough=!1;var ic=ia.prototype;pb.prototype.flagsThatDirtyMe=w.highlightedFlag|w.enabledFlag;pb.prototype.makeDOMObject=function(H,G,K){var u=this;this.editDiv=G;H=K.class||"textarea";var A="textarea"===H?document.createElement(H):document.createElement("input");A.setAttribute("type","text");this.domEditBox=A;K.className&&
(A.className=K.className);A.style.position="absolute";A.style.resize="none";A.style.display="block";this.updateDOMPlacement({x:0,y:0,w:100,h:20});A.addEventListener("keydown",function(E){E.keyCode!==la.leftArrow&&E.keyCode!==la.upArrow&&E.keyCode!==la.rightArrow&&E.keyCode!==la.downArrow||E.stopPropagation();E.keyCode===la.tab&&E.preventDefault();u.letSlashThrough||E.keyCode!==la.forwardSlash||E.stopPropagation();E.keyCode===la.backspace&&E.stopPropagation()},!1);A.addEventListener("input",function(E){u.textChangeCallback&&
u.textChangeCallback(u,A.value)},!1);A.addEventListener("focus",function(E){u.focusCallback&&u.focusCallback(E)},!1);A.addEventListener("blur",function(E){u.blurCallback&&u.blurCallback(E)},!1);G.appendChild(A)};pb.prototype.mouseDown=function(H,G){G.isFromTouch&&(G.allowBrowserDefault=!0);if(ic.mouseDown)return ic.mouseDown.call(this,H,G)};pb.prototype.mouseUp=function(H,G){G.isFromTouch&&(G.allowBrowserDefault=!0);if(ic.mouseUp)return ic.mouseUp.call(this,H,G)};pb.prototype.mouseMove=function(H,
G){G.isFromTouch&&(G.allowBrowserDefault=!0);if(ic.mouseMove)return ic.mouseMove.call(this,H,G)};pb.prototype.mouseCancel=function(H){H.isFromTouch&&(H.allowBrowserDefault=!0);if(ic.mouseCancel)return ic.mouseCancel.call(this,H)};pb.prototype.getDOMElement=function(){return this.domEditBox};pb.prototype.allowTooltip=function(){return"visible"!==this.editDiv.style.visibility?!1:!0};pb.prototype.updateDOMPlacement=function(H){H||(H={x:this.place.pos.x,y:this.place.pos.y,w:this.size.x,h:this.size.y});
var G=this.domEditBox,K=this.parent.getGlobalPos(H.x,H.y);G.style.top=""+(K.y|0)+"px";G.style.left=""+(K.x|0)+"px";G.style.width=""+H.w+"px";G.style.height=""+H.h+"px"};pb.prototype.setFocusCallback=function(H){this.focusCallback=H};pb.prototype.setBlurCallback=function(H){this.blurCallback=H};pb.prototype.setTextChangeCallback=function(H){this.textChangeCallback=H};pb.prototype.targetMe=function(H){if("mousemove"!==H.eventType)return ic.targetMe.call(this,H)};pb.prototype.boundsChanged=function(){this.updateDOMPlacement();
return ic.boundsChanged.call(this)};pb.prototype.setTextValue=function(H){ic.setTextValue.call(this,H);this.domEditBox.value=H};pb.prototype.getTextValue=function(){return this.domEditBox.value};pb.prototype.selectAll=function(){this.domEditBox.select()};pb.prototype.selectAllWithoutFocus=function(){var H=document.activeElement;this.domEditBox.setSelectionRange(0,this.domEditBox.value.length);H&&"function"===typeof H.focus&&H.focus()};pb.prototype.drawSelf=function(){};pb.prototype.updateSelf=function(H){};
pb.prototype.blur=function(){this.domEditBox.blur();return ic.blur.call(this)};pb.prototype.trigger=function(){return ic.trigger.call(this)};var Ta=function A(G,K,u){var E=null;G&&G.elementType&&(E=G,G=K,K=u,u=null);A.prototype.parentConstructor.call(this,E);this.flags|=w.autoSizeAfterLoadFlag;this.imageScaleX=this.imageScaleY=1;this.name="<sprite>"+this.id;this.loadImage(G,K,u);this.setTracksMouse(!1)};cb(Ta,w);Ta.prototype.elementType="sprite";Ta.prototype.handleImageFlags=function(G){G=this.imageRef;
this.flags&w.autoScaleAfterLoadFlag?this.scaleImageToSize():this.flags&w.autoSizeAfterLoadFlag&&this.sizeToImage();this.flags&w.autoCenterAfterLoadFlag&&this.autoCenter(!0);G&&(G=G.getFrameSize(0),this.setContentSize(G.w,G.h),this.updateNeedsUpdate());this.setDirty(!0)};Ta.prototype.updateNeedsUpdate=function(){this.imageRef&&(1>=this.imageRef.getFrameCount()?this.setNeedsUpdate(!1):this.setNeedsUpdate(!0))};Ta.prototype.loadImage=function(G,K,u){if(G&&void 0!==G){this.imageRef=De(G,K,u);var A=this;
this.imageRef.setOnLoad(function(){A.handleImageFlags(A.imageRef);if(A.onLoad)A.onLoad(A.onLoadArg)});"string"===typeof G&&(this.name="<sprite>"+G+this.id)}};Ta.prototype.useImageRef=function(G){G&&(this.imageRef=G);if(G)if(this.imageRef.isLoaded())this.handleImageFlags(this.imageRef);else{var K=this;this.imageRef.setOnLoad(function(){K.handleImageFlags(K.imageRef)})}this.setDirty(!0)};Ta.prototype.setImageRef=Ta.prototype.useImageRef;Ta.prototype.getImageRef=function(){return this.imageRef};Ta.prototype.sizeToImage=
function(){if(this.imageRef){var G=this.imageRef.getFrameSize(0);this.setSize(G.w,G.h)}};Ta.prototype.scaleImageToSize=function(G,K){if(this.imageRef){G=G||1;K=K||1;var u=this.imageRef.getFrameSize(0);this.imageScaleX=this.size.x/u.w*G;this.imageScaleY=this.size.y/u.h*K;this.setDirty(!0)}};Ta.prototype.centerSprite=function(){var G=this.imageRef.getSize(),K=this.size.y-G.h*this.imageScaleY;this.contentOffset.x=(this.size.x-G.w*this.imageScaleX)/2;this.contentOffset.y=K/2};Ta.prototype.setSize=function(G,
K){this.flags&=~w.autoSizeAfterLoadFlag;Ta.prototype.parentPrototype.setSize.call(this,G,K)};Ta.prototype.setImageScale=function(G,K){this.imageScaleX=G;this.imageScaleY=K;this.setDirty(!0)};Ta.prototype.getImageScale=function(){return{x:this.imageScaleX,y:this.imageScaleY}};Ta.prototype.autoCenter=function(G,K){void 0===G&&(G=!0);G&&"undefined"!==typeof this.imageRef&&!this.imageRef.isLoaded()?this.flags|=w.autoCenterAfterLoadFlag:Ta.prototype.parentPrototype.autoCenter.call(this,G,K)};Ta.prototype.setOutline=
function(G,K){this.outline===G&&this.outlineScale===K||this.setDirty(!0);this.outline=G;this.outlineScale=K};Ta.prototype.setCompositeOperation=function(G){this.compositeOperation!==G&&this.setDirty(!0);this.compositeOperation=G};Ta.prototype.updateSelf=function(G){if(this.imageRef){var K=this.imageRef.getFrame();this.imageRef.update(G);this.imageRef.getFrame()!==K&&this.setDirty(!0)}};Ta.prototype.drawTiled=function(G,K){if(this.isVisible()){dd.totalElementsDrawn++;var u=gb();tc();sc(this.place.pos.x,
this.place.pos.y);this.place.rot.angle&&He(this.place.rot.angle);1===this.scale.x&&1===this.scale.y||jd(this.scale.x,this.scale.y);u.globalAlpha=this.opacity;0<this.frameWidth&&(u.strokeStyle=this.frameColor.toString(),u.lineWidth=this.frameWidth,u.strokeRect(-this.center.x-this.frameOutset,-this.center.y-this.frameOutset,this.size.x+2*this.frameOutset,this.size.y+2*this.frameOutset));this.flags&w.clipFlag&&(u.beginPath(),u.moveTo(0,0),u.lineTo(this.size.x,0),u.lineTo(this.size.x,this.size.y),u.lineTo(0,
this.size.y),u.lineTo(0,0),u.clip());this.drawMyImageTiled(G,K);zc()}};Ta.prototype.drawMyImageTiled=function(G,K){for(var u=gb(),A=this.imageRef.getSize(),E=0;E<G;E+=A.w)for(var S=0;S<K;S+=A.h){tc();var aa=A.w+E>G?G-E:A.w;var R=A.h+S>K?K-S:A.h;sc(E,S);this.imageRef.draw(u,0,0,aa,R,0,0,aa,R);zc()}};Ta.prototype.drawSelf=function(){if(0!==(this.flags&w.drawTiledFlag))this.drawMyImageTiled(this.size.x,this.size.y);else if(this.imageRef){var G=gb();if(this.outline){var K=this.imageRef.getSize();G.globalCompositeOperation=
"destination-out";var u=K.w*this.outlineScale,A=K.h*this.outlineScale;this.imageRef.draw(G,-(this.center.x+(u-K.w)/2),-(this.center.y+(A-K.h)/2),u,A);G.globalCompositeOperation="source-over"}if(this.compositeOperation){var E=G.globalCompositeOperation;G.globalCompositeOperation=this.compositeOperation}u=this.imageRef.getSize();K=u.w*this.imageScaleX;u=u.h*this.imageScaleY;this.flags&w.autoScaleAfterLoadFlag&&(K=this.size.x,u=this.size.y);this.imageRef.draw(G,-this.center.x+this.contentOffset.x,-this.center.y+
this.contentOffset.y,K,u);this.compositeOperation&&(G.globalCompositeOperation=E)}};Ta.prototype.boundsChanged=function(){this.flags&w.autoScaleAfterLoadFlag&&void 0!==this.imageRef&&this.scaleImageToSize();Ta.prototype.parentPrototype.boundsChanged.call(this)};Ta.prototype.setOnLoad=function(G,K){this.onLoad=G;this.onLoadArg=K};Ta.editProperties=[{label:"image",props:[{propName:"resource",type:"resource"},{propName:"outline",type:"float"}]}];Ta.setupFromData=function(G,K,u){Wa.callParentSetupFromData(Ta,
G,K,u);K.outline&&G.setOutline(!0,K.outline);K.onLoad&&G.setOnLoad(K.onLoad,G);K.resource&&G.loadImage(K.resource);K.animSpeed&&G.imageRef&&(G.imageRef.animSpeed=K.animSpeed)};var xb=function E(K,u,A){if("string"===typeof K||Array.isArray(K))A=u,u=K,K=null;E.prototype.parentConstructor.call(this,K);this.blockSize=new za(4,4);this.resource=u;if(void 0!==u){this.imageRef=new Fa(u);var S=this;this.imageRef.setOnLoad(function(aa){aa=S.imageRef.getSize();S.updateWithNewImageSize(aa.w,aa.h)})}K=u;Array.isArray(K)&&
(K=K[0]);this.name="<bbx>"+K+this.id;void 0!==A?(me[A]&&(A=me[A]),this.drawType=A):this.drawType=E.defaultDrawType};cb(xb,w);xb.TILE=0;xb.STRETCH=1;var me={stretch:xb.STRETCH,tile:xb.TILE};xb.defaultDrawType=xb.TILE;xb.prototype.elementType="bubbleBox";xb.prototype.setTileCounts=function(K,u){this.forceTilesWide=K;this.forceTilesHigh=u};xb.prototype.updateWithNewImageSize=function(K,u){var A=4;K/3===Y.floor(K/3)&&(A=3);this.forceTilesWide&&(A=this.forceTilesWide);var E=A;u===K/A&&(E=1);this.forceTilesHigh&&
(E=this.forceTilesHigh);this.blockSize=new za(K/A|0,u/E|0);this.blockRows=E;1===E&&(this.blockSize.y=u);this.setDirty(!0)};xb.prototype.useImageRef=function(K){this.imageRef=K;var u=this;this.imageRef.setOnLoad(function(A){A=K.getSize();u.updateWithNewImageSize(A.w,A.h);u.updateNeedsUpdate()});this.setDirty(!0)};xb.prototype.updateNeedsUpdate=function(){this.imageRef&&(1>=this.imageRef.getFrameCount()?this.setNeedsUpdate(!1):this.setNeedsUpdate(!0))};xb.prototype.getImageRef=function(){return this.imageRef};
xb.prototype.updateSelf=function(K){Ta.prototype.updateSelf.call(this,K)};xb.prototype.drawSelf=function(K){if(this.imageRef&&null!==this.imageRef.getImageFrame(0)){var u=!1,A=Y.floor(this.size.x),E=Y.floor(this.size.y);if(this.flags&w.adjustForScaleFlag&&(1!==Zb.m[0][0]||1!==Zb.m[1][1])){u=!0;var S=Ie({x:0,y:0});E=Ie({x:this.size.x,y:this.size.y});tc();K.setTransform(1,0,0,1,0,0);A=Y.floor(E.x-S.x);E=Y.floor(E.y-S.y);S.x=Y.floor(S.x);S.y=Y.floor(S.y);K.translate(S.x,S.y);1===this.blockRows&&(K.scale(1,
E/this.size.y),E=this.size.y)}this.imageRef.drawAsBubble(K,-this.center.x,-this.center.y,A,E,this.blockSize.x,this.blockSize.y,this.forceRows,this.drawType===xb.STRETCH);u&&zc()}};xb.setDefaultDrawType=function(K){me[K]&&(K=me[K]);xb.defaultDrawType=K===xb.STRETCH?xb.STRETCH:xb.TILE};var ba=function F(u,A,E,S,aa,R,Q,ea){var y=arguments,I=u;"object"!==typeof u||u&&!u.elementType?I=null:(y=Array.prototype.slice.call(arguments),y.splice(0,1));F.prototype.parentConstructor.call(this,I);this.flags|=w.autoSizeAfterLoadFlag;
this.setTargetable(!0);this.flags|=w.exclusiveHighlightFlag;this.isSetup=!1;void 0!==y[0]&&this.setupButton.apply(this,y)};cb(ba,w);ba.prototype.elementType="button";ba.prototype.flagsThatDirtyMe=w.highlightedFlag|w.enabledFlag|w.pressedFlag|w.toggledFlag;ba.prototype.textInset=8;ba.prototype.textOffsetX=0;ba.prototype.textOffsetY=0;ba.prototype.useFontSize=!1;ba.spriteType=1;ba.bubbleType=2;ba.cheapType=3;ba.coolType=4;ba.typeNames={sprite:ba.spriteType,bubble:ba.bubbleType,cheap:ba.cheapType,cool:ba.coolType};
ba.defaultClickSound=void 0;ba.defaultFocusSound=void 0;ba.standardCornerScale=1/6;ba.prototype.setupButton=function(u,A,E,S,aa,R,Q){this.isSetup&&(this.removeAllSubElements(),this.text=this.buttonImage=null,this.colorStates=void 0);this.isSetup=!0;"string"===typeof u&&(u=ba.typeNames[u]);this.type=u;u===ba.spriteType?this.buttonImage=new Ta:u===ba.bubbleType?this.buttonImage=new xb:u!==ba.cheapType&&u!==ba.coolType||!A||(this.buttonImage=new Ta);this.buttonImage&&(this.appendSubElement(this.buttonImage),
this.buttonImage.name+="(button)",this.copyContentFlagsToImage());(A||E||S||aa)&&this.setStandardImages(A,E,S,aa);this.toggles=!1;this.clickSound=ba.defaultClickSound;this.focusSound=ba.defaultFocusSound;this.name="<but>"+this.id;this.buttonImage&&this.boundsChanged();this.cornerRadius=10;this.cornerRadiusSet=!1;this.setDirty(!0)};ba.makeSpriteButton=function(u,A,E,S,aa,R){return new ba(ba.spriteType,u,A,E,S,aa,R)};ba.makeBubbleButton=function(u,A,E,S){return new ba(ba.bubbleType,u,A,E,S)};ba.createStandardColorStates=
function(u,A){"string"===typeof u&&(u=new O(u));"undefined"===typeof A&&(A=4);var E=[];E.push({flags:w.enabledFlag,color:u.copy(),textColor:new O(4*u.r,4*u.g,4*u.b,u.a),frameColor:new O(u.r/4,u.g/4,u.b/4,u.a),frameWidth:A});E.push({flags:w.enabledFlag|w.highlightedFlag,color:new O(u.r+50,u.g+50,u.b+50,u.a),textColor:new O(6*u.r,6*u.g,6*u.b,u.a),frameColor:new O(u.r/5,u.g/5,u.b/5,u.a),frameWidth:A});E.push({flags:w.enabledFlag|w.pressedFlag,color:new O(u.r/2,u.g/2,u.b/2,u.a),textColor:new O(4*u.r,
4*u.g,4*u.b,u.a),frameColor:new O(u.r/5,u.g/5,u.b/5,u.a),frameWidth:A});var S=E[E.length-1];E.push({flags:w.enabledFlag|w.highlightedFlag|w.pressedFlag,color:S.color.copy(),textColor:E[1].textColor.copy(),frameColor:S.frameColor.copy(),frameWidth:S.frameWidth});E.push({flags:w.enabledFlag|w.toggledFlag,color:E[0].color.copy(),textColor:new O(10*u.r,10*u.g,10*u.b,u.a),frameColor:new O(4*u.r,4*u.g,4*u.b,u.a),frameWidth:A});E.push({flags:w.enabledFlag|w.toggledFlag|w.highlightedFlag,color:E[1].color.copy(),
textColor:E[1].textColor.copy(),frameColor:new O(4*u.r,4*u.g,4*u.b,u.a),frameWidth:A});E.push({flags:w.enabledFlag|w.toggledFlag|w.pressedFlag,color:E[2].color.copy(),textColor:E[2].textColor.copy(),frameColor:new O(4*u.r,4*u.g,4*u.b,u.a),frameWidth:A});E.push({flags:0,color:new O(120,120,120,u.a),textColor:new O(64,64,64,u.a),frameColor:new O(64,64,64,u.a),frameWidth:A});return E};ba.prototype.applyStandardColorStates=function(u){this.colorStates=ba.createStandardColorStates(u)};ba.createInvisibleColorStates=
function(){for(var u=new O(0,0,0,0),A=[],E=[w.enabledFlag,w.enabledFlag|w.highlightedFlag,w.enabledFlag|w.pressedFlag,w.enabledFlag|w.highlightedFlag|w.pressedFlag,0],S=0;S<E.length;S++)A.push({flags:E[S],color:u.copy(),textColor:u.copy(),frameColor:u.copy(),frameWidth:1});return A};ba.prototype.applyInvisibleColorStates=function(){this.colorStates=ba.createInvisibleColorStates()};ba.makeCheapButton=function(u,A){var E;A&&(E=ba.createStandardColorStates(A));return ba.makeCheapButtonWithColors(u,E)};
ba.makeCheapButtonWithColors=function(u,A){var E=null,S=null;u&&"object"===typeof u&&u.elementType?E=u:S=u;u=new ba(E,ba.cheapType,S);A&&(u.colorStates=A);return u};ba.makeCoolButton=function(u,A){A=ba.createStandardColorStates(A);return ba.makeCoolButtonWithColors(u,A)};ba.makeCoolButtonWithColors=function(u,A){var E=null,S=null;u&&"object"===typeof u&&u.elementType?E=u:S=u;u=new ba(E,ba.coolType,S);u.colorStates=A;return u};ba.prototype.checkDirty=function(){return this.buttonImage&&this.buttonImage.isDirty||
this.text&&this.text.isDirty||this.isDirty?!0:!1};ba.prototype.setOutline=function(u,A){this.buttonImage&&this.buttonImage.setOutline(u,A)};ba.prototype.copyContentFlagsToImage=function(){if(this.buttonImage){var u=0|w.autoSizeAfterLoadFlag|w.autoScaleAfterLoadFlag|w.autoCenterAfterLoadFlag,A=this.buttonImage.flags;this.buttonImage.flags&=~u;this.buttonImage.flags|=this.flags&u;this.buttonImage.checkFlagsChanged(A)}};ba.prototype.setFlag=function(u,A){ba.prototype.parentPrototype.setFlag.call(this,
u,A);this.copyContentFlagsToImage()};ba.prototype.boundsChanged=function(){this.setContentSize(this.size.x,this.size.y);this.type===ba.bubbleType?this.buttonImage&&this.buttonImage.setSize(this.size.x,this.size.y):this.type===ba.spriteType&&this.buttonImage&&this.buttonImage.setSize(this.size.x,this.size.y);this.text&&this.resizeTextBox();this.type!==ba.coolType||this.cornerRadiusSet||(this.cornerRadius=this.size.y*ba.standardCornerScale|0);ba.prototype.parentPrototype.boundsChanged.call(this)};ba.prototype.setSize=
function(u,A){this.flags&=~w.autoSizeAfterLoadFlag;ba.prototype.parentPrototype.setSize.call(this,u,A)};ba.prototype.centerContent=function(){this.buttonImage&&this.buttonImage.centerInParent();this.text&&this.text.centerInParent()};ba.prototype.scaleImageToSize=function(){this.buttonImage&&this.buttonImage.scaleImageToSize()};ba.prototype.setAdjustForScale=function(u){w.prototype.setAdjustForScale.call(this,u);this.buttonImage&&this.buttonImage.setAdjustForScale(u)};ba.prototype.setAutoRepeat=function(u){if(u){var A=
{initialDelay:1,startDelay:.5,delayMultiplier:1,minimumDelay:.1,isTracking:!1};vc(A,u,!0,!0);this.autoRepeat=A;this.resetAutoRepeat()}else this.autoRepeat=null};ba.prototype.resetAutoRepeat=function(u){if(u=this.autoRepeat)u.timer=u.initialDelay,u.delay=u.initialDelay,u.pressCount=0,u.isTracking=!1};ba.prototype.startAutoRepeat=function(u){this.autoRepeat&&(this.autoRepeat.isTracking=!0)};ba.prototype.stopAutoRepeat=function(u){this.autoRepeat&&(this.autoRepeat.isTracking=!1)};ba.prototype.trackAutoRepeat=
function(u){var A=this.autoRepeat;A&&(this.isPressed()||A.isTracking)&&(A.timer-=u,0>=A.timer&&(this.press(),1===A.pressCount?A.delay=A.startDelay:(A.delay*=A.delayMultiplier,A.delay=Math.max(A.delay,A.minimumDelay)),A.timer=A.delay))};ba.prototype.setTextInset=function(u){this.textInset!=u&&(this.textInset=u,this.resizeTextBox())};ba.prototype.setTextOffset=function(u,A){void 0!==u.x&&(A=u.y,u=u.x);if(this.textOffsetX!==u||this.textOffsetY!==A)this.textOffsetX=u,this.textOffsetY=A,this.resizeTextBox()};
ba.prototype.setTextPosition=function(u,A){this.text&&(this.text.place.pos.x===u&&this.text.place.pos.y===A||this.setDirty(!0),this.text.place.pos.x=u,this.text.place.pos.y=A,this.text.setAlign(ia.alignLeft),this.text.setBaseline(ia.baselineTop))};ba.prototype.getTextBox=function(){return this.text};ba.prototype.checkAndMakeTextBox=function(){this.text||(this.text=new ia(""),this.text.setEnabled(!1),this.resizeTextBox(),this.appendSubElement(this.text),this.text.centerText());return this.text};ba.prototype.resizeTextBox=
function(){this.text&&(this.text.setPos(this.textInset+this.textOffsetX,this.textOffsetY),this.text.setSize(this.size.x-2*this.textInset,this.size.y),this.useFontSize?this.text.setFontSize(this.useFontSize):this.text.setFontSize(.7*this.size.y|0))};ba.prototype.removeTextBox=function(){this.text&&(this.removeSubElement(this.text),this.text=null)};ba.prototype.setTextValue=function(u){this.checkAndMakeTextBox().setTextValue(u);this.name="<but>"+this.id+"("+u+")";this.telemetryName=u};ba.prototype.translateAndSetTextValue=
function(u){this.name="<but>"+this.id+"("+u+")";this.telemetryName=u;this.checkAndMakeTextBox().translateAndSetTextValue(u)};ba.prototype.setFont=function(u,A,E){this.checkAndMakeTextBox().setFont(u,A,E);A&&(this.useFontSize=A)};ba.prototype.setFontStyle=function(u){this.checkAndMakeTextBox().setFontStyle(u)};ba.prototype.setFontSize=function(u){this.checkAndMakeTextBox().setFontSize(u);this.useFontSize=u};ba.prototype.setTextColors=function(u,A,E,S){this.setCommonStatesByField("textColor",u,A,E,
S)};ba.prototype.setTextColor=ba.prototype.setTextColors;ba.prototype.setTextOffsets=function(u,A,E,S){this.setCommonStatesByField("textOffset",u,A,E,S)};ba.prototype.setBodyColors=function(u,A,E,S){this.setCommonStatesByField("color",u,A,E,S)};ba.createBodyColorStates=function(u,A,E,S){return ba.createCommonStatesByField("color",u,A,E,S)};ba.prototype.setFrameColors=function(u,A,E,S){this.setCommonStatesByField("frameColor",u,A,E,S)};ba.prototype.setCornerRadius=function(u){u!=this.cornerRadius&&
this.setDirty(!0);this.cornerRadius=u;this.cornerRadiusSet=!0};ba.prototype.setCustomBounds=function(u){this.customBounds!==u&&this.setDirty(!0);this.customBounds&&u&&(this.customBounds.x!==u.x||this.customBounds.y!==u.y||this.customBounds.w!==u.w||this.customBounds.h!==u.h)&&this.setDirty(!0);this.customBounds=u};ba.prototype.getImage=function(){return this.buttonImage};ba.prototype.setStandardImages=function(u,A,E,S){void 0===A&&(A=u);void 0===E&&(E=u);void 0===S&&(S=u);if("string"!==typeof u){var aa=
u;u=void 0}if("string"!==typeof A){var R=A;A=void 0}if("string"!==typeof E){var Q=E;E=void 0}if("string"!==typeof S){var ea=S;S=void 0}this.setStateImages([{state:w.enabledFlag,resource:u,imageRef:aa},{state:w.enabledFlag|w.highlightedFlag,resource:A,imageRef:R},{state:w.enabledFlag|w.pressedFlag,resource:E,imageRef:Q},{state:w.enabledFlag|w.highlightedFlag|w.pressedFlag,resource:E,imageRef:Q},{state:w.enabledFlag|w.toggledFlag,resource:E,imageRef:Q},{state:w.enabledFlag|w.toggledFlag|w.highlightedFlag,
resource:A,imageRef:R},{state:w.enabledFlag|w.toggledFlag|w.pressedFlag,resource:u,imageRef:aa},{state:0,resource:S,imageRef:ea}])};ba.prototype.setStateTextColors=function(u){this.setStatesByField(u,"textColor")};ba.prototype.setTextColorStates=ba.prototype.setStateTextColors;ba.prototype.setStateTextOffsets=function(u){this.setStatesByField(u,"textOffset")};ba.prototype.setStateColors=function(u){this.setStatesByField(u,"color")};ba.prototype.setStateFrameColors=function(u){this.setStatesByField(u,
"frameColor")};ba.prototype.setStateFrameWidths=function(u){this.setStatesByField(u,"frameWidth")};ba.prototype.setStateFrameWidth=ba.prototype.setStateFrameWidths;ba.prototype.setStateImages=function(u,A,E){for(var S=0;S<u.length;S++){var aa=u[S],R=!1;"undefined"===typeof aa.imageRef&&(aa.resource||z.logError("Error:  no imageRef or image specified in setStateImages"),aa.imageRef=De(aa.resource,A,E),Array.isArray(aa.resource)?aa.imageRef.setAnimSpeed(3):R=!0);"undefined"===typeof aa.doUpdate&&(aa.doUpdate=
R||!aa.imageRef?!1:!0)}this.setStatesByField(u,"imageRef");this.setStatesByField(u,"doUpdate")};ba.createCommonStatesByField=function(u,A,E,S,aa){function R(ea,F){ea={state:ea};ea[u]=F;Q.push(ea)}"undefined"===typeof E&&(E=A);"undefined"===typeof S&&(S=A);"undefined"===typeof aa&&(aa=A);var Q=[];R(w.enabledFlag,A);R(w.enabledFlag|w.highlightedFlag,E);R(w.enabledFlag|w.pressedFlag,S);R(w.enabledFlag|w.highlightedFlag|w.pressedFlag,S);R(w.enabledFlag|w.toggledFlag,S);R(w.enabledFlag|w.toggledFlag|w.highlightedFlag,
E);R(w.enabledFlag|w.toggledFlag|w.pressedFlag,A);R(0,aa);return Q};ba.prototype.setCommonStatesByField=function(u,A,E,S,aa){A=ba.createCommonStatesByField(u,A,E,S,aa);this.setStatesByField(A,u)};ba.prototype.setStatesByField=function(u,A){this.colorStates||(this.colorStates=[]);for(var E=null,S=0;S<u.length;S++){var aa=u[S],R=this.getMyMatchingStateIndex(aa.state,!0);aa=aa[A];"undefined"!==typeof aa&&("textColor"!==A&&"color"!==A&&"frameColor"!==A||"string"!==typeof aa||(aa=O.makeFromStyleString(aa)),
"imageRef"===A&&aa&&!E&&(E=aa),this.colorStates[R][A]=aa)}E&&this.buttonImage&&(this.buttonImage.useImageRef(E),this.setContentSize(this.buttonImage.size.x,this.buttonImage.size.y),this.flags&w.autoSizeAfterLoadFlag&&this.autoSize());this.setDirty(!0)};ba.prototype.setAllStatesByField=function(u,A){for(var E=[],S=0;S<this.colorStates.length;S++){var aa={state:this.colorStates[S].flags};aa[u]=A;E.push(aa)}this.setStatesByField(E,u)};ba.prototype.setFrameWidth=function(u){this.setAllStatesByField("frameWidth",
u)};ba.getMatchingStateIndex=function(u,A,E){if(!u)return-1;if(!Array.isArray(u))return z.logError("using getMatchingStateIndex instead of getMyMatchingStateIndex?"),-1;for(var S=-1,aa=0;aa<u.length;aa++)if(u[aa].flags===A)return aa;if(0>S){if(!E)return-1;S=u.length;u[S]={flags:A,textColor:O.white}}return S};ba.getMatchingState=function(u,A){if(!Array.isArray(u))return z.logError("using getMatchingStateIndex instead of getMyMatchingStateIndex?"),null;A=ba.getMatchingStateIndex(u,A);return 0<=A?u[A]:
null};ba.prototype.getMyMatchingStateIndex=function(u,A){return ba.getMatchingStateIndex(this.colorStates,u,A)};ba.prototype.getMyMatchingState=function(u){return ba.getMatchingState(this.colorStates,u)};ba.copyStates=function(u){for(var A=tb(u,!0),E=0;E<u.length;E++)u[E].color&&(A[E].color=new O(u[E].color)),u[E].textColor&&(A[E].textColor=new O(u[E].textColor)),u[E].frameColor&&(A[E].frameColor=new O(u[E].frameColor));return A};ba.prototype.setStroke=function(u,A,E){this.checkAndMakeTextBox();this.text.setStroke(u,
A,E)};ba.prototype.findBestStateMatch=function(u,A){"undefined"===typeof u&&(u=this.flags);A||(A=this.colorStates);if(!A)return null;for(var E=0,S=0,aa=0;aa<A.length;aa++){for(var R=0,Q=0;4>Q;Q++){var ea=1<<Q;(u&ea)===(A[aa].flags&ea)&&R++}R>=S&&(E=aa,S=R)}return A[E]};ba.prototype.updateDisplayState=function(){if(this.colorStates){var u=this.findBestStateMatch(this.flags,this.colorStates);this.text&&(u.textColor&&this.text.setColor(u.textColor),u.font&&(u.font.font&&this.text.setFont(u.font.font),
u.font.size&&this.text.setFontSize(u.font.size)),u.stroke&&this.text.setStroke(u.stroke.lineWidth||0,u.stroke.color,u.stroke.doCleanup),u.textOffset&&this.text.setPos(this.textInset+u.textOffset.x,u.textOffset.y))}return u};ba.prototype.getCurrentDisplayState=function(){return this.displayState};ba.prototype.drawSelf=function(){var u=gb(),A=this.updateDisplayState();this.displayState=A;if(this.type===ba.cheapType&&"undefined"!==typeof A){u.fillStyle=A.color.toString();this.customBounds?u.fillRect(this.customBounds.x-
this.center.x,this.customBounds.y-this.center.y,this.customBounds.w,this.customBounds.h):u.fillRect(-this.center.x,-this.center.y,this.size.x,this.size.y);var E=4;void 0!==A.frameWidth&&(E=A.frameWidth);E&&(u.lineWidth=E,u.strokeStyle=A.frameColor.toString(),u.strokeRect(-this.center.x,-this.center.y,this.size.x+0,this.size.y+0))}else this.type===ba.coolType&&"undefined"!==typeof A?(this.customBounds?jb.roundRect({x:this.customBounds.x-this.center.x,y:this.customBounds.y-this.center.y,w:this.customBounds.w,
h:this.customBounds.h},this.cornerRadius):jb.roundRect({x:0-this.center.x,y:0-this.center.y,w:this.size.x,h:this.size.y},this.cornerRadius),u.fillStyle=A.color.toString(),u.fill(),E=4,void 0!==A.frameWidth&&(E=A.frameWidth),E&&(u.lineWidth=E,u.lineCap="round",u.strokeStyle=A.frameColor.toString(),u.stroke())):"undefined"!==typeof this.buttonImage&&A&&(this.buttonImage.imageRef=A.imageRef,this.buttonImage.updateNeedsUpdate())};ba.prototype.updateSelf=function(u){var A=!1;if("undefined"!==typeof this.colorStates)for(var E=
0;E<this.colorStates.length;E++)this.buttonImage&&this.buttonImage.imageRef&&this.buttonImage.imageRef===this.colorStates[E].imageRef||!this.colorStates[E].imageRef||!this.colorStates[E].doUpdate||(this.colorStates[E].imageRef.update(u),A=!0);this.autoRepeat&&(this.trackAutoRepeat(u),A=!0);return A};ba.prototype.flagsChanged=function(u){ba.prototype.parentPrototype.flagsChanged.call(this,u);var A=this.findBestStateMatch();A&&A.imageRef&&A.imageRef.isAnimOneShot()&&A.imageRef.restartAnim();(u&w.highlightedFlag&&
!(this.flags&w.highlightedFlag)||(u&w.enabledFlag)!=(this.flags&w.enabledFlag))&&this.stopAutoRepeat()};ba.prototype.handleUIInput=function(u){var A=!1;"enter"===u.which&&(this.autoRepeat&&(this.resetAutoRepeat(),this.startAutoRepeat()),(A=this.trigger(u))&&cc.fireEvent("uiTriggered",this));return A};ba.prototype.handleUIUpInput=function(u){this.stopAutoRepeat();return!1};ba.prototype.trigger=function(u){if(this.toggles){var A=this.flags;this.flags=this.flags&w.toggledFlag?this.flags&~w.toggledFlag:
this.flags|w.toggledFlag;this.checkFlagsChanged(A)}if(this.autoRepeat){if(0<this.autoRepeat.pressCount&&u&&("mouseup"===u.eventType||"buttonup"===u.eventType||"uiup"===u.eventType))return!1;this.autoRepeat.pressCount++}ba.prototype.parentPrototype.trigger.call(this,u);return!0};ba.prototype.mouseDown=function(u,A){ba.prototype.parentPrototype.mouseDown.call(this);this.resetAutoRepeat();this.autoRepeat&&this.press(A);return this.flags&w.enabledFlag?!0:!1};ba.prototype.autoSize=function(){0===this.buttonImage.size.x&&
this.buttonImage.setOnLoad?this.buttonImage.setOnLoad(jf,this):jf(this)};ba.prototype.setToggles=function(u){this.toggles=u};ba.setDefaultTextInset=function(u){ba.prototype.textInset=u};ba.editProperties=[{label:"button",props:[{propName:"buttonType",type:"integer",defValue:ba.coolType,tipText:"1=sprite,2=bubble,3=cheap,4=cool"},{propName:"toggles",type:"boolean"},{propName:"text",type:"string",tipText:"button text (if needed)"},{propName:"textColor",type:"color"},{propName:"textInset",type:"float",
tipText:"how far in from edges text draws"},{propName:"textUseOffscreen",type:"boolean"},{propName:"cornerRadius",type:"float",tipText:"for button type 4 (cool)"}]},{label:"resources",defaultClosed:!0,props:[{propName:"resource",type:"resource"},{propName:"resourceHi",type:"resource"},{propName:"resPressed",type:"resource"},{propName:"resDisabled",type:"resource"},{propName:"extra1",type:"resource"},{propName:"extra2",type:"resource"}]},ia.standardFontEditProperties];ba.setupFromData=function(u,A,
E){Wa.callParentSetupFromData(ba,u,A,E);A.extra1=A.extra1||void 0;A.extra2=A.extra2||void 0;"string"===typeof A.buttonType&&(A.buttonType=ba.typeNames[A.buttonType]);if(A.buttonType===ba.cheapType||A.buttonType===ba.coolType)u.setupButton(A.buttonType,void 0,void 0,void 0,void 0,A.extra1,A.extra2),u.colorStates=A.colors||A.color,void 0===u.colorStates&&(u.colorStates=new O(140,140,140)),!1===Array.isArray(u.colorStates)&&(u.colorStates=ba.createStandardColorStates(u.colorStates)),void 0!==A.toggles&&
(u.setToggles(!0),u.setToggled(!!A.toggled));else if(A.buttonType===ba.bubbleType||A.buttonType===ba.spriteType)u.setupButton(A.buttonType,A.res||A.resource,A.resHi||A.resourceHi,A.resPressed||A.resourcePressed,A.resDisabled||A.resourceDisabled,A.extra1,A.extra2),A.toggles&&(u.setToggles(!0),u.setToggled(!!A.toggled));void 0!==A.cornerRadius?u.setCornerRadius(A.cornerRadius):u.cornerRadius=u.size.y*ba.standardCornerScale|0;A.font&&(A.font.font&&u.setFont(A.font.font),A.font.size&&u.setFontSize(A.font.size),
A.font.style&&u.setFontStyle(A.font.style),A.font.stroke&&u.setStroke(A.font.stroke.width,A.font.stroke.color));if(A.textColor&&(u.checkAndMakeTextBox().setColor(A.textColor),A.buttonType===ba.cheapType||A.buttonType===ba.coolType))for(E=0;E<u.colorStates.length;E++)u.colorStates[E].textColor=new O(A.textColor);A.text&&u.translateAndSetTextValue(A.text);A.textInset&&u.setTextInset(A.textInset);void 0!==A.textUseOffscreen&&u.checkAndMakeTextBox().setUseOffscreen(A.textUseOffscreen)};var Ub=function S(A,
E){S.prototype.parentConstructor.call(this,A);this.setClip(!0);this.setProps(E);this.itemList=[];this.nextPos=0;this.wheelAffects="y";this.supportZoom(!1)};cb(Ub,kb);Ub.prototype.elementType="ListBox";Ub.prototype.setProps=function(A){this.props=A||this.props||{};this.props.orientation||(this.props.orientation="down")};Ub.prototype.setUserData=function(A){this.userData=A};Ub.prototype.setOrientation=function(A){this.props.orientation=A};Ub.prototype.addItem=function(A){this.itemList.push(A);A.setPos(0,
this.nextPos);var E=A.getSize();this.contentSize.y+=E.y;E.x>this.contentSize.x&&(this.contentSize.x=E.x);E=this.getNextPosSpace(E.y);"up"===this.props.orientation&&(E*=-1);this.nextPos+=E;this.appendSubElement(A)};Ub.prototype.getNextPosSpace=function(A){return A+(this.props.rowSpace||0)};Ub.prototype.getItem=function(A){return this.itemList[A]};Ub.prototype.buildFromListText=function(A,E){this.buildButtonRows(A.length,E);for(E=0;E<A.length;E++)this.getItem(E).setTextValue(A[E])};Ub.prototype.buildButtonRows=
function(A,E){this.setProps(E);E.listBackgroundColor&&this.makeBackground(E.listBackgroundColor);var S=E.rowHeight||E.fontHeight,aa=S*A;this.size.x;this.nextPos="up"===this.props.orientation?aa-this.getNextPosSpace(S):0;var R=this;for(aa=0;aa<A;aa++){var Q=E.listColorStates;Q=Q?ba.copyStates(Q):ba.createStandardColorStates(E.listColor||O.gray,0);Q=ba.makeCheapButtonWithColors(null,Q);Q.setCallback(function(F,y){E.selectCallback&&E.selectCallback(y,R.userData)},aa);E.fontName&&Q.setFont(E.fontName);
Q.setSize(this.size.x,S);var ea=E.buttonTextAlignment||"left";Q.checkAndMakeTextBox().setAlignment(ea);this.addItem(Q)}this.elementBackground&&this.elementBackground.setSize(this.contentSize);"up"===this.props.orientation&&this.setContentOffset(0,-(this.contentSize.y*this.contentScale.y-this.size.y))};Ub.prototype.scrollToShowIndex=function(A){(A=this.getItem(A))&&this.scrollToShowElement(A)};Ub.editProperties=[{label:"list box",props:[]}];Ub.setupFromData=function(A,E,S){Wa.callParentSetupFromData(Ub,
A,E,S)};var Eb=function aa(E,S){aa.prototype.parentConstructor.call(this,E);this.setProps(S);this.itemList=null;this.listType="custom";this.dropButton=this.listBox=null;this.listPos={x:0,y:0,w:0,h:0};this.knownContentOffset=null};cb(Eb,w);Eb.prototype.elementType="DropList";Eb.prototype.setProps=function(E){this.props=E||this.props||{}};Eb.prototype.setButton=function(E){var S=this;this.dropButton=E;E.setCallback(function(aa,R){S.toggleListBox()},this.props)};Eb.prototype.replaceButton=function(E){this.dropButton&&
this.dropButton.parent.removeSubElement(this.dropButton);this.setButton(E)};Eb.prototype.getButton=function(){return this.dropButton};Eb.prototype.setListHeight=function(E){this.listPos.h=E;"up"===this.props.orientation&&(this.listPos.y=-E)};Eb.prototype.setUserData=function(E){this.userData=E};Eb.prototype.setCurrentItem=function(E){this.currentItemIndex=E;this.itemList&&(E=this.itemList[E])&&this.dropButton&&"string"===typeof E&&this.dropButton.setTextValue(E)};Eb.prototype.buildFromListText=function(E,
S){this.buildCheapButton(S);this.buildFromList(E,"text",S)};Eb.prototype.buildCheapButton=function(E){var S=E.buttonColorStates;S||(S=ba.createStandardColorStates(E.buttonColor||O.darkGray,0));S=ba.makeCheapButtonWithColors(null,S);this.appendSubElement(S);var aa=E.buttonTextAlignment||"left";S.checkAndMakeTextBox().setAlignment(aa);this.setButton(S);S.setSize(this.size.x,this.size.y);if(E.downImageSprite){S.appendSubElement(E.downImageSprite);aa=E.downImageSprite.getSize();var R=(this.size.y-aa.y)/
2;E.downImageSprite.setPos(this.size.x-aa.x-R,R)}else{E=new Ia(S);var Q=this.size.y-32;E.setPos(this.size.x-Q-16,16);E.setSize(Q,Q);E.drawSelf=function(ea){ea.fillStyle="#000000";jb.fillPolygon(Q/2,Q/2-8,Q/2,Math.PI/2,3)}}return S};Eb.prototype.buildFromList=function(E,S,aa){this.buildFromProps(aa);this.setList(E,S);this.setCurrentItem(0)};Eb.prototype.setList=function(E,S){this.listType=S;this.itemList=E};Eb.prototype.buildFromProps=function(E){var S=this;this.setProps(E);var aa=E.listRowWidth||
this.size.x;if("up"===E.orientation){this.listPos.x=0;this.listPos.y=0;E.listOffset&&(this.listPos.x+=E.listOffset.x,this.listPos.y+=E.listOffset.y);var R=this.getGlobalPos(this.listPos);this.listPos.h=R.y;this.listPos.y-=this.listPos.h}else this.listPos.x=0,this.listPos.y=this.size.y,E.listOffset&&(this.listPos.x+=E.listOffset.x,this.listPos.y+=E.listOffset.y),R=this.getGlobalPos(this.listPos),this.listPos.h=Ra-R.y;this.listPos.w=aa;E._originalSelectCallback=E.selectCallback;E.selectCallback=function(Q,
ea){S.setCurrentItem(Q);S.toggleListBox();E._originalSelectCallback&&E._originalSelectCallback(Q,ea)}};Eb.prototype.listBoxIsVisible=function(){return null!==this.listBox};Eb.prototype.isOpen=Eb.prototype.listBoxIsVisible;Eb.prototype.showListBox=function(){if(!this.listBox){var E=this.listBox=new Ub(this,this.props);E.setBounds(this.listPos);if(this.props.buildListBox){var S=this.props.buildListBox(E,this.itemList,this.props);S&&(this.listBox=S)}else"text"===this.listType&&E.buildFromListText(this.itemList,
this.props);E.scrollToShowIndex(this.currentItemIndex)}};Eb.prototype.hideListBox=function(){this.listBox&&(this.knownContentOffset=this.listBox.getContentOffset(),this.removeSubElement(this.listBox),this.listBox=null)};Eb.prototype.toggleListBox=function(){this.listBox?this.hideListBox():this.showListBox();this.props.listShowCallback&&this.props.listShowCallback(this,this.listBoxIsVisible(),this.props)};var oc=function Q(S,aa,R){Q.prototype.parentConstructor.call(this,S,aa,R);Ta.call(this);this.fillStyle=
"radialFill";this.fillShape="rectangle"};cb(oc,Oc);Nf(oc,Ta);oc.prototype.elementType="fillSprite";oc.prototype.updateSelf=function(S){oc.prototype.parentPrototype.updateSelf&&oc.prototype.parentPrototype.updateSelf(S);Ta.prototype.updateSelf.call(this,S)};oc.prototype.drawSelf=function(){if(this.imageRef){var S=gb();tc();oc.prototype.parentPrototype.drawSelf&&oc.prototype.parentPrototype.drawSelf.call(this);var aa=this.getWidth(),R=this.getHeight();this.percent;if(sa.Wraith)z.logWarningOnce("WARNING!  Attempting to use a circle FillSprite while running in Wraith.   This is currently not support",
"WraithFillSpriteSupport",1);else{var Q=this.size.x/2+this.center.x,ea=this.size.y/2+this.center.y;if("radialStroke"===this.fillStyle||"stroke"===this.fillStyle)z.log("FillSprite does not support fillStyle "+this.fillStyle+" with shape "+this.fillShape);else{if("radialFill"===this.fillStyle){var F=-Y.HALFPI,y=F+this.percent*Y.PI2;aa="circle"===this.fillShape?aa<R?aa:R:2*(aa>R?aa:R);jb.radialClip(S,Q,ea,aa,F,y,!1)}else"fill"===this.fillStyle&&("circle"===this.fillStyle?z.log("FillSprite does not support fillStyle "+
this.fillStyle+" with shape "+this.fillShape):(S.beginPath(),S.moveTo(-this.center.x,-this.center.y),S.rect(-this.center.x,-this.center.y,aa*this.percent,R),S.clip()));Ta.prototype.drawSelf.call(this)}S.restore()}}};oc.setupFromData=function(S,aa,R){Wa.callParentSetupFromData(oc,S,aa,R);Ta.setupFromData(S,aa,R)};var Rc=function R(aa){R.prototype.parentConstructor.call(this);$a.allowOffscreens||z.logWarning("WARNING!  You're trying to use an OffscreenImage() object, but offscreens are not allowed by this host!");
this.offscreen=null;aa&&this.setOffscreen(aa);this.setTracksMouse(!1)};cb(Rc,w);Rc.prototype.elementType="OffscreenImage";Rc.prototype.setOffscreen=function(aa){this.offscreen=aa;this.offscreen.enableDirtyRects();this.contentSize.x=aa.width;this.contentSize.y=aa.height};Rc.prototype.buildFrom=function(aa){var R=aa.getBounds();if(this.offscreen){var Q=this.offscreen;Q.setSize(R.w,R.h,!0)}else Q=new $a(R.w,R.h);Q.enableDirtyRects();var ea=Q.getContext(),F=gb();ca=ea;aa.setVisible(!0);aa.setBounds(0,
0,R.w,R.h);aa.draw();($a.debugOffscreens||mb&&mb.setTarget.show.offscreens)&&Q.applyDebugOverlay();aa.setBounds(R);ca=F;this.setOffscreen(Q);this.setBounds(R);aa.getParent()&&(this.getParent()&&this.removeFromParent(),R=aa.getParent().getSubElementIndex(aa),0>R&&(R=0),aa.getParent().insertSubElement(this,R))};Rc.prototype.updateFromSinglePane=function(aa,R){aa=this.offscreen;var Q=aa.getContext(),ea=gb();ca=Q;aa.dirtyRects.clear();Q=R.getBounds();aa.dirtyRects.add(Q);aa.clipToDirty();aa.erase();R.setVisible(!0);
R.draw();($a.debugOffscreens||mb&&mb.setTarget.show.offscreens)&&aa.applyDebugOverlay();aa.unclip();ca=ea};Rc.prototype.drawSelf=function(){var aa=gb();this.offscreen&&this.offscreen.render(aa,-this.center.x,-this.center.y)};Rc.setupFromData=function(aa,R,Q){Wa.callParentSetupFromData(Rc,aa,R,Q)};var Ja=function Q(R){Q.prototype.parentConstructor.call(this,R);this.setClip(!0);this.orientation="horizontal";this.disableAttachedButtons=this.wraps=!1;this.hideAttachedButtons=!0;this.displayPageIndex=
this.pageIndex=0;this.lastFocusedPageIndex=-1;this.pageCount=0;this.pageAnim=null;this.pageSize={x:0,y:0};this.pageContentOffset={x:0,y:0};this.config={animTime:.5};this.pages=[];this.wheelAffects="x";this.supportZoom(!1)};cb(Ja,kb);Ja.prototype.elementType="PageSlider";Ja.prototype.setUserData=function(R){this.userData=R};Ja.prototype.setAnimTime=function(R){this.config.animTime=R};Ja.prototype.setOrientation=function(R){this.orientation=R};Ja.prototype.boundsChanged=function(){this.pageSize={x:this.size.x,
y:this.size.y};this.updateContentSize();for(var R=0;R<this.pages.length;R++)this.updatePagePos(R)};Ja.prototype.setPageSize=function(R,Q){this.pageSize={x:R,y:Q}};Ja.prototype.setPageContentOffset=function(R){this.pageContentOffset=R};Ja.prototype.setPageCount=function(R){var Q=this.pageCount;this.pageCount=R;if(this.pageIndex>R-1)this.setPageIndex(R-1,!1);else if(0===Q||this.pageIndex===R-1)this.callCreatePage(this.pageIndex),this.lastFocusedPageIndex=-1,this.updateFocusedPage();this.updateButtonState();
this.updateContentSize()};Ja.prototype.updateContentSize=function(){this.contentSize.x=this.pageSize.x*this.pageCount;this.contentSize.y=this.pageSize.y};Ja.prototype.setPageIndex=function(R,Q){void 0===Q&&(Q=!0);this.pages[this.displayPageIndex|0]||(Q=!1);this.wraps?R=(R+this.pageCount)%this.pageCount:R>=this.pageCount&&(R=this.pageCount-1);this.pageIndex=R;this.updateButtonState();Q?this.startPageAnimation():this.snapPageAnimation()};Ja.prototype.getPageIndex=function(){return this.pageIndex};Ja.prototype.getPage=
function(R){return this.pages[R]};Ja.prototype.attachButtons=function(R,Q){"string"===typeof R&&(R=this.parent.findSubElementByID(R));"string"===typeof Q&&(Q=this.parent.findSubElementByID(Q));this.button1=R;this.button2=Q;this.button1.setCallback(function(ea,F){F.goToDeltaPage(-1)},this);this.button2.setCallback(function(ea,F){F.goToDeltaPage(1)},this);this.updateButtonState()};Ja.prototype.goToDeltaPage=function(R,Q){R=this.pageIndex+R;0>R&&(R=0);this.setPageIndex(R,Q)};Ja.prototype.updateButtonState=
function(){var R=this,Q=function(F){if(R.disableAttachedButtons||R.hideAttachedButtons)R.disableAttachedButtons&&F.setEnabled(!1),R.hideAttachedButtons&&F.setVisible(!1),F.setHighlighted(!1),F.clearFlag(w.pressedFlag)},ea=function(F){F.setVisible(!0);F.setEnabled(!0)};this.button1&&(0===this.pageIndex?Q(this.button1):ea(this.button1));this.button2&&(this.pageIndex>=this.pageCount-1?Q(this.button2):ea(this.button2))};Ja.prototype.setCreatePage=function(R){this.createPageFunc=R;0<this.pageCount&&this.callCreatePage(this.pageIndex)};
Ja.prototype.setDeletePage=function(R){this.deletePageFunc=R};Ja.prototype.setVisiblePageChanged=function(R){this.visiblePageChangedFunc=R;this.updateFocusedPage()};Ja.prototype.callCreatePage=function(R){R|=0;var Q=this.pages[R];Q&&this.removeSubElement(Q);if(this.createPageFunc&&!(0>R)){var ea=this.createPageFunc(R,{container:this,size:this.pageSize,oldPage:Q},this.userData);ea&&this.appendSubElement(ea);Q!==ea&&this.deletePageFunc&&this.callDeletePage(Q);this.pages[R]=ea;this.updatePagePos(R)}};
Ja.prototype.updatePagePos=function(R){var Q=this.pages[R];Q&&(R=R*this.pageSize.x+this.pageContentOffset.x,this.pageContentOffset.y,Q.setPos(R,0))};Ja.prototype.callDeletePage=function(R){R&&this.deletePageFunc&&this.deletePageFunc(R,{container:this,size:this.pageSize},this.userData)};Ja.prototype.mouseWheelEvent=function(R,Q){return Ja.prototype.parentPrototype.mouseWheelEvent.call(this,R,Q)};Ja.prototype.mouseDown=function(R,Q){return Ja.prototype.parentPrototype.mouseDown.call(this,R,Q)};Ja.prototype.mouseUp=
function(R,Q){var ea=0!==(this.flags&w.trackingMouseDownFlag);R=Ja.prototype.parentPrototype.mouseUp.call(this,R,Q);ea&&!this.isFlung()&&this.settleOnFocusedPage();return R};Ja.prototype.settleOnFocusedPage=function(){var R=this.displayPageIndex+.5|0;R===this.displayPageIndex?this.setPageIndex(R,!1):(this.setPageIndex(R,!0),this.quickSettleToPage())};Ja.prototype.mouseCancelAll=function(){this.settleOnFocusedPage()};Ja.prototype.handleMouseMove=function(R,Q,ea){R=Ja.prototype.parentPrototype.handleMouseMove.call(this,
R,Q,ea);this.flags&w.trackingMouseDownFlag&&this.updateDisplayPageFromScroll();return R};Ja.prototype.keyDown=function(R){return R.which===la.pageUp?(this.goToDeltaPage(-1),!0):R.which===la.pageDown?(this.goToDeltaPage(1),!0):!1};Ja.prototype.startPageAnimation=function(){this.pageAnim=this.displayPageIndex===this.pageIndex?null:{time:0,totalTime:this.config.animTime,source:this.displayPageIndex,dest:this.pageIndex}};Ja.prototype.snapPageAnimation=function(){this.pageAnim=null;this.displayPageIndex=
this.pageIndex;this.contentOffset.x=-this.displayPageIndex*this.pageSize.x;this.viewChanged()};Ja.prototype.snapPageAnimationTemp=function(){this.saveSlide={contentOffset:this.getContentOffset()};this.contentOffset.x=-this.pageIndex*this.pageSize.x};Ja.prototype.restorePageAnimationTemp=function(){this.contentOffset.x=this.saveSlide.contentOffset.x;this.contentOffset.y=this.saveSlide.contentOffset.y;delete this.saveSlide};Ja.prototype.quickSettleToPage=function(){if(this.pageAnim){var R=this.pageAnim.dest-
this.displayPageIndex;R=Math.abs(R);this.pageAnim.totalTime=R*this.config.animTime}};Ja.prototype.setDisplayPage=function(R){R=Math.max(R,0);this.displayPageIndex=R=Math.min(R,this.pageCount-1)};Ja.prototype.viewChanged=function(){this.updateDisplayPageFromScroll();var R=this.displayPageIndex|0,Q=R+1;this.displayPageIndex===R&&(Q=-1);this.pages[R]||this.callCreatePage(R);-1==Q||this.pages[Q]||this.callCreatePage(Q);for(var ea in this.pages)if(ea!==""+R&&(-1===Q||ea!==""+Q)){var F=this.pages[ea];F&&
this.removeSubElement(F);this.callDeletePage(F);delete this.pages[ea]}this.updateFocusedPage()};Ja.prototype.updateDisplayPageFromScroll=function(){this.setDisplayPage(-this.contentOffset.x/this.pageSize.x)};Ja.prototype.updateSelf=function(R){Ja.prototype.parentPrototype.updateSelf.call(this,R);if(this.isFlung()){var Q=this.flingVelocity.x/this.pageSize.x,ea=-this.dragHandler.grabOffset.x/this.pageSize.x+.5|0,F=-1,y=4;this.flingHard&&(y=1);0<Q&&Q<1*y/this.config.animTime?(F=this.displayPageIndex|
0,F===ea&&(F=ea-1)):0>Q&&Q>-1*y/this.config.animTime&&(F=this.displayPageIndex+.5+.05|0,F===ea&&(F=ea+1));-1<F&&(this.setPageIndex(F,!0),this.quickSettleToPage(),this.flingVelocity.x=this.flingVelocity.y=0)}this.pageAnim&&(this.pageAnim.time+=R,this.pageAnim.time>=this.pageAnim.totalTime?(this.setDisplayPage(this.pageIndex),this.pageAnim=null):(R=ma.filterEaseOut(this.pageAnim.time/this.pageAnim.totalTime),this.setDisplayPage(Y.interpolate(this.pageAnim.source,this.pageAnim.dest,R))),this.contentOffset.x=
-this.displayPageIndex*this.pageSize.x,this.viewChanged())};Ja.prototype.updateFocusedPage=function(R){R=this.displayPageIndex+.5|0;if(this.lastFocusedPageIndex!==R){var Q=this.pages[this.lastFocusedPageIndex];Q&&Q.setEnabled&&Q.setEnabled(!1);(Q=this.pages[R])&&Q.setEnabled&&Q.setEnabled(!0);this.visiblePageChangedFunc&&this.visiblePageChangedFunc(R,{container:this,size:this.pageSize},this.userData);this.lastFocusedPageIndex=R}};Ja.editProperties=[{label:"page slider",props:[{propName:"orientation",
type:"string",defValue:"horizontal"},{propName:"pageCount",type:"integer",defValue:"10"},{propName:"startingPage",type:"integer",defValue:"0"}]}];Ja.setupFromData=function(R,Q,ea){Wa.callParentSetupFromData(Ja,R,Q,ea)};var Pa=function y(Q,ea,F){y.prototype.parentConstructor.call(this,Q);F||(F={truncValues:!0,showWhenInactive:!0});this.target=ea;this.config=F;this.editable=!0;this.drawStates=new Pc({normal:{color:new O(160,160,160,1),width:2},highlighted:{color:new O(200,220,200),width:2},targeted:{color:new O(160,
220,220),width:4}});this.handleStates=new Pc({normal:{color:new O(160,160,160),type:"frame"},highlighted:{color:new O(200,220,200,.5),type:"fill"},tracking:{color:new O(255,255,200),type:"fill"}});this.setTargetable(!0);this.setTracksMouse(!0);this.flags|=w.exclusiveHighlightFlag;this.handles=[];Q=y.baseHandleSize;for(ea=0;5>ea;ea++)this.handles[ea]={tracking:!1,x:0,y:0,w:Q,h:Q};this.handles[0].adjustX=1;this.handles[0].adjustY=1;this.handles[0].adjustW=-1;this.handles[0].adjustH=-1;this.handles[1].adjustX=
0;this.handles[1].adjustY=1;this.handles[1].adjustW=1;this.handles[1].adjustH=-1;this.handles[2].adjustX=1;this.handles[2].adjustY=0;this.handles[2].adjustW=-1;this.handles[2].adjustH=1;this.handles[3].adjustX=0;this.handles[3].adjustY=0;this.handles[3].adjustW=1;this.handles[3].adjustH=1;this.handles[4].adjustX=1;this.handles[4].adjustY=1;this.handles[4].adjustW=0;this.handles[4].adjustH=0;this.positionHandles()};cb(Pa,w);Pa.prototype.elementType="sizeBox";Pa.baseHandleSize=40;Pa.uiScale=1;Pa.snapToGrid=
!1;Pa.gridSize=20;Pa.gridOffset={x:0,y:0};Pa.prototype.setEditable=function(Q){!Q&&4<this.handles.length&&(this.handles=[this.handles[4]]);this.editable=Q};Pa.prototype.boundsChanged=function(){if(this.config.truncValues){var Q=this.config.truncValues;this.place.pos.x=(this.place.pos.x*Q|0)/Q;this.place.pos.y=(this.place.pos.y*Q|0)/Q;this.size.x=(this.size.x*Q|0)/Q;this.size.y=(this.size.y*Q|0)/Q}0>this.size.x&&(this.size.x=0);0>this.size.y&&(this.size.y=0);Pa.prototype.parentPrototype.boundsChanged.call(this);
this.positionHandles()};Pa.prototype.positionHandles=function(){var Q=Pa.baseHandleSize,ea=this.size.x;this.size.y<this.size.x&&(ea=this.size.y);ea=.2*ea|0;ea<Q&&(Q=ea);5>Q&&(Q=5);if(4<this.handles.length){for(ea=0;4>ea;ea++)this.handles[ea].w=Q,this.handles[ea].h=Q;this.handles[1].x=this.size.x-Q;this.handles[2].y=this.size.y-Q;this.handles[3].x=this.size.x-Q;this.handles[3].y=this.size.y-Q}Q=this.handles.length-1;this.handles[Q].w=this.size.x;this.handles[Q].h=this.size.y;this.handles[Q].invisible=
!0};Pa.prototype.drawSelfPost=function(){if(this.config.showWhenInactive||this.isHighlighted()||this.isTargeted()){var Q=gb();Q.save();this.center&&Q.translate(-this.center.x,-this.center.y);this.drawStates.setAndDraw(Q,this);0===this.center.x&&0===this.center.y||this.drawStates.drawRect(Q,{x:this.center.x-5,y:this.center.y-5,w:10,h:10});if(this.flags&w.mouseInFlag)for(var ea=0;ea<this.handles.length;ea++){var F=this.handles[ea];F.invisible||this.handleStates.setAndDrawRect(Q,F,F)}ea=24*Pa.uiScale|
0;Q.fillStyle="#408080";Q.font=""+ea+"px arial";Q.textAlign="left";Q.fillText(this.name,45,ea,800);Q.restore()}};Pa.snapPos=function(Q){Q.x=Pa.snapValueX(Q.x);Q.y=Pa.snapValueY(Q.y);return Q};Pa.snapValueX=function(Q){return Pa.snapToGrid?Q=((Q+Pa.gridOffset.x%Pa.gridSize)/Pa.gridSize|0)*Pa.gridSize:Q};Pa.snapValueY=function(Q){return Pa.snapToGrid?Q=((Q+Pa.gridOffset.y%Pa.gridSize)/Pa.gridSize|0)*Pa.gridSize:Q};Pa.prototype.mouseDown=function(Q,ea){Pa.prototype.parentPrototype.mouseDown.call(this,
Q,ea);if(!this.editable)return!1;this.origBounds={x:this.place.pos.x,y:this.place.pos.y,w:this.size.x,h:this.size.y};if(ea=this.posToHandle(Q))this.trackHandle=ea,ea.tracking=!0,ea.grabPos=this.getGlobalPos(Q.x,Q.y),ea.lastPos={x:ea.grabPos.x,y:ea.grabPos.y},ea.changed=!1;return!0};Pa.prototype.mouseUp=function(Q,ea){Xa.prototype.parentPrototype.mouseUp.call(this,Q,ea);this.trackHandle&&this.completeChangeCallback&&this.trackHandle.changed&&this.completeChangeCallback(this,"bounds");for(Q=0;Q<this.handles.length;Q++)this.handles[Q].tracking=
!1;this.trackHandle=null;return!1};Pa.prototype.mouseMove=function(Q,ea){if(this.trackHandle){var F=this.getGlobalPos(Q.x,Q.y);Q=F.x-this.trackHandle.grabPos.x;ea=F.y-this.trackHandle.grabPos.y;Q*=Pa.uiScale;ea*=Pa.uiScale;0!==this.trackHandle.adjustX&&(this.place.pos.x=Pa.snapValueX(this.origBounds.x+Q));0!==this.trackHandle.adjustY&&(this.place.pos.y=Pa.snapValueY(this.origBounds.y+ea));0!==this.trackHandle.adjustW&&(this.size.x=Pa.snapValueX(this.origBounds.w+Q*this.trackHandle.adjustW));0!==this.trackHandle.adjustH&&
(this.size.y=Pa.snapValueY(this.origBounds.h+ea*this.trackHandle.adjustH));this.trackHandle.lastPos.x=F.x;this.trackHandle.lastPos.y=F.y;if(X.keyboard.isKeyDown(la.shift)){var y=this.size.x/this.origBounds.w,I=this.size.y/this.origBounds.h;F=this.origBounds.w/this.origBounds.h;y*y>I*I?(y=this.size.y,this.size.y=this.size.x/F,this.place.pos.y+=this.trackHandle.adjustY*(y-this.size.y)):(y=this.size.x,this.size.x=this.size.y*F,this.place.pos.x+=this.trackHandle.adjustX*(y-this.size.x))}this.trackHandle.changed=
0!==Q&&0!=ea?!0:!1;this.boundsChanged();this.updateAfterMove()}else{for(ea=0;ea<this.handles.length;ea++)this.handles[ea].highlighted=!1;if(Q=this.posToHandle(Q))Q.highlighted=!0}return!1};Pa.prototype.updateAfterMove=function(){this.changeCallback&&this.changeCallback(this,"bounds")};Pa.prototype.posToHandle=function(Q){var ea=Q.x+this.center.x;Q=Q.y+this.center.y;for(var F=0;F<this.handles.length;F++){var y=this.handles[F];if(ea>y.x&&Q>y.y&&ea<y.x+y.w&&Q<y.y+y.h)return y}return null};Pa.prototype.keyDown=
function(Q){var ea=X.keyToDirection(Q.which);if(this.editable&&ea&&!Q.sysEvent.altKey&&!Q.sysEvent.ctrlKey){var F=1;Q.sysEvent.shiftKey&&(F=10);this.place.pos.x+=ea.x*F;this.place.pos.y+=ea.y*F;this.updateAfterMove();return!0}return!1};Pa.setupFromData=function(Q,ea,F){Wa.callParentSetupFromData(Pa,Q,ea,F)};var Sc=function ea(){ea.prototype.parentConstructor.call(this);this.setTracksMouse(!1)};cb(Sc,w);Sc.prototype.elementType="spiderChart";Sc.START_ANGLE=-Y.PI/2;Sc.prototype.setData=function(ea){this.data=
ea;"undefined"===typeof this.data.normalizeScale&&(this.data.normalizeScale=1);ea=1;for(var F=0;F<this.data.sets.length;F++)for(var y=this.data.sets[F],I=0;I<y.points.length;I++)y.points[I]>ea&&(ea=y.points[I]);this.data.normalizeTarget=ea};var xg=!0;Sc.prototype.drawSelf=function(){var ea=gb();ea.fillStyle="#AAEEFF";ea.fillRect(0,0,this.size.x,this.size.y);var F=this.data.sets[0].points.length,y=2*Y.PI/F,I;tc();ea.translate(this.size.x/2,this.size.y/2);if(this.data.drawAxes.color){var p=Sc.START_ANGLE;
for(I=0;I<F;I++){var x=this.data.drawAxes.scale*this.size.x/2;var C=x*Y.cos(p);x*=Y.sin(p);ea.beginPath();ea.moveTo(0,0);ea.lineTo(C,x);ea.strokeStyle=this.data.drawAxes.color.toString();ea.stroke();p+=y}}if(this.data.drawAxes.hashColor)for(var J=this.data.drawAxes.hashCount,D=0;D<J;D++){p=Sc.START_ANGLE;ea.beginPath();for(I=0;I<F;I++)x=(D+1)/J*this.data.normalizeScale*this.size.x/2,C=x*Y.cos(p),x*=Y.sin(p),0===I?ea.moveTo(C,x):ea.lineTo(C,x),p+=y;ea.closePath();ea.strokeStyle=this.data.drawAxes.hashColor.toString();
ea.stroke()}for(F=0;F<this.data.sets.length;F++){C=this.data.sets[F];C.fillColor&&(ea.fillStyle=C.fillColor.toString());C.strokeColor&&(ea.strokeStyle=C.strokeColor.toString());ea.lineWidth=C.strokeWidth;p=Sc.START_ANGLE;ea.beginPath();for(I=0;I<C.points.length;I++)x=C.points[I],this.data.normalize&&(x=x/this.data.normalizeTarget*this.data.normalizeScale*this.size.x/2),J=x*Y.cos(p),D=x*Y.sin(p),xg&&(z.log(". "+C.points[I]+"("+x+") : "+J+", "+D),xg=!1),0===I?ea.moveTo(J,D):ea.lineTo(J,D),p+=y;ea.closePath();
C.fillColor&&ea.fill();C.strokeColor&&ea.stroke()}zc()};var eb=function y(F){y.prototype.parentConstructor.call(this,F);this.setTracksMouse(!0);this.setTargetable(!0);this.editBodyLook={normalColor:new O(20,20,20)};this.editFrameLook={normalColor:new O(180,180,180),highlightColor:new O(255,255,180),targetColor:new O(255,255,255),lineWidth:2};this.editSelectionLook={normalColor:new O(200,200,180,.2)};this.nextNodeID=1;this.setFont("arial",13,"")};cb(eb,w);eb.prototype.elementType="treeView";eb.prototype.flagsThatDirtyMe=
w.highlightedFlag|w.enabledFlag;eb.prototype.setFont=function(F,y,I){this.font=F;y&&(this.lineHeight=this.fontSize=y);I&&(this.fontStyle=I);this.fontDescriptor=(""+this.fontStyle+" "+this.fontSize+"px "+this.font).trim()};eb.prototype.setLineHeight=function(F){this.lineHeight=F};eb.prototype.setTreeValues=function(F){function y(T,W,ka){T._treeView||(T._treeView={});var ja=[];ja[0]={flags:w.enabledFlag,color:new O(0,0,0,0),frameColor:new O(0,0,0,0),textColor:new O(180,180,180)};ja[1]={flags:w.enabledFlag|
w.highlightedFlag,color:new O(80,80,80),frameColor:new O(0,0,0,0),textColor:new O(180,180,180)};ja[2]={flags:w.enabledFlag|w.toggledFlag,color:new O(40,40,180),frameColor:new O(0,0,0,0),textColor:new O(180,180,180)};ja=ba.makeCheapButtonWithColors(null,ja);ja.setToggles(!0);ja.setFont(p.font,p.fontSize,p.fontStyle);ja.setTextValue(T.label);ja.getTextBox().setAlign(ia.alignLeft);ja.setPos(W,ka);ja.setSize(p.size.x-W-100,x);ja.setCallback(function(qa,ta){p.selectNodeByID(qa.treeNode._treeView.treeNodeID)},
null);p.appendSubElement(ja);T._treeView.treeNodeID||(T._treeView.treeNodeID=p.nextNodeID++);T._treeView.treeIndex=C++;T._treeView.elem=ja;ja.treeNode=T;return x}function I(T,W,ka,ja){for(var qa=ja,ta=0;ta<W.length;ta++){var wa=W[ta];y(wa,ka,ja);wa._treeView.parentNode=T;ja+=x+4;wa.children&&(wa=I(wa,wa.children,ka+30,ja),ja+=wa)}return ja-qa}var p=this;this.tree=F;this.removeAllSubElements();var x=this.lineHeight,C=0;F=0;var J=5,D=5;this.tree&&(F=y(this.tree,J,D),D+=F+4,this.tree.children&&(F+=I(this.tree,
this.tree.children,J+30,D)));this.elemCount=C;this.setContentSize(this.size.x,F+4);this.setDirty(!0)};eb.prototype.getTreeValues=function(){return this.tree};eb.prototype.removeChildFrom=function(F,y){if(F.children)for(var I=0;I<F.children.length;I++)if(F.children[I]._treeView.treeNodeID===y._treeView.treeNodeID)return F.children.splice(I,1),y._treeView.parentNode=null,this.removeChildCallback&&this.removeChildCallback(this,this.tree,F,y),!0;return!1};eb.prototype.addChildTo=function(F,y,I){F.children||
(F.children=[]);void 0===I&&(I=F.children.length);F.children.splice(I,0,y);y._treeView.parentNode=F;this.addChildCallback&&this.addChildCallback(this,this.tree,F,y,I);return!0};eb.prototype.getChildIndex=function(F,y){if(F.children)for(var I=0;I<F.children.length;I++)if(F.children[I]._treeView.treeNodeID===y._treeView.treeNodeID)return I;return-1};eb.prototype.isDescendentOf=function(F,y){do if(y=y._treeView.parentNode,y===F)return!0;while(y);return!1};eb.prototype.applyToTree=function(F,y,I){I||
(I=this.tree);if(I){var p=F(I,y);if(void 0!==p)return p;if(I.children)for(p=0;p<I.children.length;p++){var x=this.applyToTree(F,y,I.children[p]);if(void 0!==x)return x}}};eb.prototype.selectNodeByID=function(F){var y=null;this.applyToTree(function(I,p){I._treeView.elem&&(I._treeView.treeNodeID===p?(y=I,I._treeView.elem.setToggled(!0)):I._treeView.elem.setToggled(!1))},F);this.selectionCallback&&this.selectionCallback(this,this.tree,[y])};eb.prototype.selectNodeByIndex=function(F){(F=this.getNodeByIndex(F))&&
this.selectNodeByID(F._treeView.treeNodeID)};eb.prototype.selectNode=function(F){F&&F._treeView?this.selectNodeByID(F._treeView.treeNodeID):this.selectNodeByID(-99999)};eb.prototype.getNodeByIndex=function(F){return this.applyToTree(function(y,I){if(y._treeView.treeIndex===I)return y},F)};eb.prototype.getSelectedNode=function(){return this.applyToTree(function(F,y){if(F._treeView.elem&&F._treeView.elem.isToggled())return F})};eb.prototype.getNodeParent=function(F){function y(I){for(var p=0;p<I.children.length;p++){var x=
I.children[p];if(x._treeView.treeNodeID===F._treeView.treeNodeID)return I;if(x.children&&(x=y(x)))return x}return null}return F?y(this.tree):null};eb.prototype.moveNode=function(F,y){if(!F)return!1;var I=!1,p=this.getNodeParent(F),x=null;p&&(x=this.getNodeParent(p));if(y===la.leftArrow)x&&(I=this.getChildIndex(x,p),this.removeChildFrom(p,F),this.addChildTo(x,F,I),I=!0);else if(y===la.rightArrow){x=F._treeView.treeIndex;do y=this.getNodeByIndex(++x);while(y&&this.isDescendentOf(F,y));p&&y&&(this.removeChildFrom(p,
F),this.addChildTo(y,F,0),I=!0)}else y===la.upArrow?(x=this.getChildIndex(p,F),0<x&&(this.removeChildFrom(p,F),this.addChildTo(p,F,x-1),I=!0)):y===la.downArrow&&(x=this.getChildIndex(p,F),x<p.children.length-1&&(this.removeChildFrom(p,F),this.addChildTo(p,F,x+1),I=!0));return I?(this.setTreeValues(this.tree),this.selectNodeByID(F._treeView.treeNodeID),this.changeCallback&&this.changeCallback(this,this.tree,""),!0):!1};eb.prototype.drawFrame=function(F){};eb.prototype.drawSelf=function(){gb()};eb.prototype.updateSelf=
function(F){};eb.prototype.keyDown=function(F){F.which;var y=this.getSelectedNode();if(!F.sysEvent.altKey&&y){var I=y._treeView.treeIndex;if(F.which===la.upArrow&&0<I)return this.selectNodeByIndex(I-1),!0;if(F.which===la.downArrow&&I<this.elemCount-1)return this.selectNodeByIndex(I+1),!0}I=!1;qg(F.which)&&F.sysEvent.altKey&&(this.moveNode(y,F.which),I=!0);return I?!0:!1};eb.prototype.mouseDown=function(F,y){return eb.prototype.parentPrototype.mouseDown.call(this,F,y)};eb.prototype.mouseUp=function(F,
y){return eb.prototype.parentPrototype.mouseUp.call(this,F,y)};eb.prototype.mouseMove=function(F,y){};eb.prototype.trigger=function(){return eb.prototype.parentPrototype.trigger.call(this)};eb.setupFromData=function(F,y,I){Wa.callParentSetupFromData(eb,F,y,I)};var pc={},jc;pc._buildInputTableFromPreppedTargets=function(F,y,I){void 0===I.wrapHoriz&&(I.wrapHoriz=!1);void 0===I.wrapVert&&(I.wrapVert=!1);void 0===I.searchAngleRatio&&(I.searchAngleRatio=1);void 0===I.directionPreference&&(I.directionPreference=
2);for(var p=[],x=0;x<y.length;x++){var C=y[x],J={currObj:C.el},D=C.pos;J.up=Vd(x,D,"up",I,F);J.down=Vd(x,D,"down",I,F);J.left=Vd(x,D,"left",I,F);J.right=Vd(x,D,"right",I,F);p.push(J);C.mapEntry=J}y.sort(function(T,W){return T.pos.y<W.pos.y?-1:T.pos.y>W.pos.y?1:T.pos.x<W.pos.x?-1:1});for(F=0;F<y.length;F++)y[F].mapEntry.tabOrder=F;return p};pc.buildInputTableFromContainer=function(F,y){jc=[];F.applyRecursively(kf,jc,lf);if(0>=jc.length)return null;F=pc._buildInputTableFromPreppedTargets(F,jc,y);jc=
void 0;return F};pc.buildInputTableFromTargets=function(F,y,I){jc=[];for(var p=0;p<y.length;p++)kf.call(y[p]);F=pc._buildInputTableFromPreppedTargets(F,jc,I);jc=void 0;return F};pc.findBestDefaultItemIndex=function(F,y){function I(x){for(var C=0;C<F.length;C++)if(F[C].currObj===x)return C;return-1}if(!y.restoreFocus&&!y.defaultFocus)return-1;if(y.defaultFocusTo){var p=I(y.defaultFocusTo);if(0<=p)return p}for(p=0;p<F.length;p++)if(F[p].currObj.isTargeted())return p;for(p=0;p<F.length;p++)if(F[p].currObj.isHighlighted())return p;
return y.defaultFocusFallbackTo&&(p=I(y.defaultFocusFallbackTo),0<=p)?p:void 0!==y.defaultFocusNth&&0<=y.defaultFocusNth&&y.defaultFocusNth<F.length?y.defaultFocusNth:-1};pc.buildInputMapFromTargets=function(F,y,I){F=pc.buildInputTableFromTargets(F,y,I);I=pc.findBestDefaultItemIndex(F,I);return new Za(F,I)};pc.collectInputs=function(F,y,I){F&&F.applyRecursively(function(p){this.isTargetable()&&this.isEnabled()&&this.isVisible()&&p.push(this)},y,lf)};var pa={screenStack:[],regScreens:{},setUIRoot:function(F){pa.popAllScreens();
F&&pa.pushScreen(F)},getTopScreen:function(){return 0<pa.screenStack.length?pa.screenStack[pa.screenStack.length-1]:null},pushScreen:function(F){if(F){var y=pa.getTopScreen();y&&y.saveCurrentTarget();if(F.isOverlay)F.isModal()&&(pa.clearStackMouseTracking(),Dc.resetAll());else for(var I,p=pa.screenStack.length-1;0<=p;--p){I=pa.screenStack[p];if(I.isSuspended)break;I.deactivate({allowOnlySuspend:!0})}pa.screenStack.push(F);F.activate();X.usingDirectionInput()&&F.applyDefaultTarget();F.movedToForeground&&
F.movedToForeground();y&&y.movedToBackground&&y.movedToBackground()}},insertScreen:function(F){pa.screenStack.length?(F.deactivate({allowOnlySuspend:!0}),pa.screenStack.unshift(F)):pa.pushScreen(F)},removeScreen:function(F){for(var y=0;y<pa.screenStack.length;++y)if(pa.screenStack[y].id===F.id)return y===pa.screenStack.length-1?pa.popScreen():pa.removeScreenAtIndex(y)},getScreenIndex:function(F){for(var y=0;y<pa.screenStack.length;++y)if(pa.screenStack[y].id===F.id)return y;return-1},getScreenByID:function(F){for(var y=
0;y<pa.screenStack.length;++y)if(pa.screenStack[y].id===F)return pa.screenStack[y];return null},isTopScreen:function(F){return 1>pa.screenStack.length?!1:pa.screenStack[pa.screenStack.length-1].id===F.id?!0:!1},removeScreenAtIndex:function(F){if(!(0>F||F>=pa.screenStack.length)){var y=pa.screenStack[F];pa.screenStack.splice(F,1);y.deactivate();y.destroy();return y}},popScreen:function(){var F=pa.screenStack[pa.screenStack.length-1];if(!F)return null;F.isModal()&&pa.clearStackMouseTracking();pa.removeScreenAtIndex(pa.screenStack.length-
1);for(var y,I=pa.screenStack.length-1;0<=I;--I)if(y=pa.screenStack[I])if(y.activate(),!y.isOverlay)break;(y=pa.getTopScreen())&&X.usingDirectionInput()&&y.restoreSavedTarget();y&&y.movedToForeground&&y.movedToForeground();return F},popAllScreens:function(){for(var F=pa.screenStack.length-1;0<=F;--F)pa.screenStack[F].deactivate(),pa.screenStack[F].destroy();pa.screenStack=[]},registerScreen:function(F,y){pa.regScreens[F]={creator:y}},clearStackMouseTracking:function(){for(var F,y=pa.screenStack.length-
1;0<=y;--y)F=pa.screenStack[y],F.applyRecursively(function(I){this.toolTip&&(this.toolTip.setVisible(!1),this.toolTip.timer=0);this.mouseLeave();this.mouseCancelAll&&this.mouseCancelAll()})},setTooltipContextID:function(F){pa.tooltipContextID=F},switchToScreen:function(F,y,I){I=I||[];var p=pa.regScreens[F];if(!p)return z.logError("ERROR: no such registered screen: "+F),null;I=p.creator.apply(void 0,I);if(!I)return z.logError("Error: screen creator failed "+F),null;I._screenTag=F;y||pa.popScreen();
pa.pushScreen(I);return I},dispatchEvent:function(F){var y=!1;w.nextTraverseOrderIndex=0;"mousemove"!==F.eventType&&"touchmove"!==F.eventType||Dc.startLostElementCheck(0);for(var I=pa.screenStack.length-1;0<=I;I--){if(I>pa.screenStack.length-1){y=!0;break}var p=pa.screenStack[I];if("undefined"===typeof p){console.log("bogus screen at "+I);break}var x=p.modal;if(p.isSuspended&&!p.forceScreenActive)break;y=null;"mousedown"!==F.eventType&&"mouseup"!==F.eventType&&"mousemove"!==F.eventType&&"contextmenu"!==
F.eventType&&"touchstart"!==F.eventType&&"touchend"!==F.eventType&&"mousewheel"!==F.eventType&&"touchmove"!==F.eventType&&(p.inputMap&&(y=p.inputMap.getTargetForEvent(F)),!y&&p.targets&&(y=p.targets[0]));if(y=y?y.handleEvent(F):p.handleEvent(F))break;if(x){if("mousedown"===F.eventType||"touchstart"===F.eventType){I=db.pointInRect(F.pos,p.getBounds());var C;p.allowClickAway&&!I?C="clickAway":p.allowClickBodyClose&&I&&(C="clickBody");C&&(p.handleUserClose(C,F),y=!0)}break}}"mousemove"!==F.eventType&&
"touchmove"!==F.eventType||Dc.finishLostElementCheck(0);return y},dispatchCommand:function(F,y){for(var I=pa.screenStack.length-1;0<=I;I--){var p=pa.screenStack[I];if("undefined"!==typeof p.handleCommand&&(p=p.handleCommand(F,y)))return p}return!1},updateScreens:function(F){w.updateCallCount=0;for(var y,I=pa.screenStack.length-1;0<=I;--I)if(y=pa.screenStack[I]){if(y.isSuspended&&!y.forceScreenActive)break;da.pushPerfMark(y._screenTag||"???");pa.screenStack[I].update(F);da.popPerfMark(y._screenTag||
"???")}},drawScreens:function(F){var y,I=pa.screenStack;for(y=0;y<I.length;y++){var p=I[y];if(!p.isSuspended||p.forceScreenActive)da.pushPerfMark(p._screenTag||"???"),p.draw(),y===I.length-1&&pa.drawTooltips(p),da.popPerfMark(p._screenTag||"???")}(y=pa.getTopScreen())&&y.inputMap&&mb&&mb.setTarget.show.inputmap&&y.inputMap.drawDebug(F)},drawTooltips:function(F){if(F.activeToolTip&&F.isVisible()){if(pa.tooltipContextID){var y=gb(pa.tooltipContextID);y.clearRect(0,0,y.canvas.width,y.canvas.height);
y.save();Je();"visible"!==y.canvas.style.visibility&&(y.canvas.style.visibility="visible")}else y=gb();F.activeToolTip.setVisible(!0);F.activeToolTip.draw();F.activeToolTip=null;pa.tooltipContextID&&(y.restore(),Yd(pa.tooltipContextID))}else pa.tooltipContextID&&(F=Vc[pa.tooltipContextID],"visible"==F.canvas.style.visibility&&(F.canvas.style.visibility="hidden"))},makeTooltipContext:function(F){if(sa.IEBrowser&&10>=sa.IEVersion)return z.logWarning("Warning: we don't currently support tooltipcontext in IE<11"),
null;var y=document.createElement("canvas");y.id="tooltip_layer";document.body.appendChild(y);var I=y.getContext("2d");y.width=F.width;y.height=F.height;y.style.position="fixed";y.style.visibility="hidden";y.style["pointer-events"]="none";F={canvas:y,ctx:I};Vc.tooltip_layer=F;pa.setTooltipContextID("tooltip_layer");return F},updateTooltipContext:function(){if(pa.tooltipContextID){var F=Vc[pa.tooltipContextID];if(F){var y=La;F.canvas.width=y.width;F.canvas.height=y.height;F.canvas.style.left=y.style.left;
F.canvas.style.top=y.style.top;F.canvas.style.width=y.style.width;F.canvas.style.height=y.style.height;F.ctx.strokeStyle="#00FFFF";F.ctx.lineWidth=8;F.ctx.strokeRect(0,0,F.canvas.width,F.canvas.height)}}},onWindowResize:function(){for(var F,y=pa.screenStack.length-1;0<=y;--y){F=pa.screenStack[y];if(F.isSuspended&&!F.forceScreenActive){F.resizeWhileSuspended&&F.resizeWhileSuspended();break}if(F.onWindowResize)F.onWindowResize()}},centerAllScreens:function(){for(var F,y=pa.screenStack.length-1;0<=y;--y)F=
pa.screenStack[y],F.centerInDisplay()},getScreenStack:function(){for(var F=[],y=0;y<pa.screenStack.length;++y)F.push(pa.screenStack[y]);return F},forEachScreenTopDown:function(F){for(var y,I=pa.screenStack.length-1;0<=I;--I)if(y=pa.screenStack[I],F(y))return y;return null}};pa.update=pa.updateScreens;pa.draw=pa.drawScreens;re("resize",pa.onWindowResize);X.registerEventHandler(pa.dispatchEvent);z.registerCommand("frames",function(F,y){pa&&(F=pa.getTopScreen())&&F.frameAllRandom()},["showFrames","dframe"]);
z.registerCommand("dtree",function(F,y){if(pa)if(F=pa.getTopScreen()){F=F.dumpTree();for(y=0;y<F.lines.length;y++)z.log(F.lines[y]);z.log("total:"+F.totalCount+" (vis: "+(F.totalCount-F.hiddenCount)+", hid: "+F.hiddenCount+")")}else z.log("no top screen in stack to dump.")},["dumpTree"]);Zc.registerCommandHandler(pa);var Da=function I(y){I.prototype.parentConstructor.call(this);this.setBounds(0,0,Ha,Ra);this.name="<screen>"+this.id};cb(Da,w);Da.prototype.modal=!1;Da.prototype.inputMap=null;Da.prototype.targets=
null;Da.prototype.allowClickAway=!1;Da.prototype.allowClickBodyClose=!1;Da.prototype.allowBackClose=!1;Da.prototype.userCloseCallback=null;Da.prototype.userPostCloseCallback=null;Da.prototype.closeSound=null;Da.prototype.isDeactivated=!0;Da.prototype.isOverlay=!0;Da.prototype.savedTarget=void 0;Da.prototype.isSuspended=!0;Da.prototype.resizePending=!1;Da.prototype.elementType="screen";nf(Da.prototype,"fullOpaque",function(y){this.setOverlay(!y)},function(){return!this.isOverlay});Da.prototype.destroy=
function(){};Da.prototype.setOverlay=function(y){this.isOverlay=y};Da.prototype.deactivate=function(y){y=!0===y?{allowOnlySuspend:!0}:y||{};this.isSuspended||(this.isSuspended=!0,this.screenSuspend&&this.screenSuspend());y.allowOnlySuspend&&this.screenSuspend||this.isDeactivated||(this.isDeactivated=!0,this.screenDeactivate&&this.screenDeactivate())};Da.prototype.activate=function(){this.isDeactivated&&(this.isDeactivated=!1,this.screenActivate&&this.screenActivate());if(this.isSuspended&&(this.isSuspended=
!1,this.screenResume&&this.screenResume(),this.resizePending&&(this.resizePending=!1,this.onWindowResize)))this.onWindowResize()};Da.prototype.resizeWhileSuspended=function(){this.resizePending=!0};Da.prototype.haveResized=function(){this.resizePending=!1};Da.prototype.onWindowResize=function(){this.haveResized()};Da.prototype.setModal=function(y){this.modal=y};Da.prototype.isModal=function(){return this.modal};Da.prototype.setAllowClickAway=function(y,I){this.allowClickAway=y;I&&(this.userCloseCallback=
I)};Da.prototype.setAllowClickBodyClose=function(y,I){this.allowClickBodyClose=y;I&&(this.userCloseCallback=I)};Da.prototype.setAllowBackClose=function(y,I){this.allowBackClose=y;I&&(this.userCloseCallback=I)};Da.prototype.setUserCloseCallback=function(y){this.userCloseCallback=y};Da.prototype.setUserPostCloseCallback=function(y){this.userPostCloseCallback=y};Da.prototype.expandToDisplay=function(){this.setPos(0,0);this.setSize(Ha,Ra)};Da.prototype.centerInDisplay=function(){var y=this.getSize();
this.setPos(Math.floor((Ha-y.w)/2),Math.floor((Ra-y.h)/2))};Da.prototype.centerHighInDisplay=function(){var y=this.getSize();this.setPos(Math.floor((Ha-y.w)/2),Math.floor((Ra-y.h)/3))};Da.prototype.centerInDisplayByFraction=function(y,I){var p=this.getSize();this.setPos(Math.floor((Ha-p.w)*y),Math.floor((Ra-p.h)*I))};Da.prototype.limitToSafeAreaX=function(y){void 0===y&&(y=.03*Ha|0);var I=Ha,p=this.place.pos,x=this.getWidth(),C=p.x-this.center.x;C<y&&(C=y);C+x>I-y&&(C=I-y-x);p.x=C+this.center.x;this.boundsChanged()};
Da.prototype.limitToSafeAreaY=function(y){void 0===y&&(y=.03*Ra|0);var I=Ra,p=this.place.pos,x=this.getHeight(),C=p.y-this.center.y;C<y&&(C=y);C+x>I-y&&(C=I-y-x);p.y=C+this.center.y;this.boundsChanged()};Da.prototype.limitToSafeArea=function(y){this.limitToSafeAreaX();this.limitToSafeAreaY()};Da.prototype.setCurrentTarget=function(y,I){null===y?this.clearCurrentTarget():this.inputMap?this.inputMap.focusByButton(y,!0):(this.targets||(this.targets=[]),(I=this.targets[0])&&I!==y&&(I.Blur?I.Blur():I.blur&&
I.blur()),(this.targets[0]=y)&&y!==I&&y.focus())};Da.prototype.clearCurrentTarget=function(y){this.inputMap?this.inputMap.unFocusCurrent():this.targets=null};Da.prototype.getCurrentTarget=function(y){y=y||0;return this.inputMap?this.inputMap.getTarget():this.targets&&this.targets[y]?this.targets[y]:null};Da.prototype.saveCurrentTarget=function(){this.inputMap&&(this.savedTarget=this.inputMap.getCurrentFocusedButton())};Da.prototype.clearSavedTarget=function(){this.savedTarget=null};Da.prototype.restoreSavedTarget=
function(){if(this.inputMap){var y=-1;this.savedTarget&&(y=this.inputMap.focusByButton(this.savedTarget,!0),0>y&&this.savedTarget.inputMapID&&(y=this.inputMap.focusByInputMapID(this.savedTarget.inputMapID,!0)));0>y&&X.usingDirectionInput()&&this.applyDefaultTarget();this.savedTarget=null;return y}};Da.prototype.applyDefaultTarget=function(){this.inputMap&&this.inputMap.applyDefaultTarget()};Da.prototype.handleUserClose=function(y,I){var p=this.closeSound||this.clickAwaySound;p&&V&&V.playSound(p);
if(this.userCloseCallback&&(p=this.userCloseCallback.call(this,y,I),void 0!==p&&!1===p))return;pa.removeScreen(this);this.userPostCloseCallback&&this.userPostCloseCallback.call(this,y,I)};Da.prototype.close=function(y){this.handleUserClose("forced",y)};Da.prototype.handleUIInput=function(y){var I;if(I=this.inputMap&&"ui"===y.eventType)I=y.which,I="up"===I||"down"===I||"left"===I||"right"===I||"enter"===I?!0:!1;return I?("enter"===y.which&&(y.which="select"),this.inputMap.handleDirection(y.which,y)):
"back"===y.which&&this.allowBackClose?(this.handleUserClose("back",y),!0):!1};Da.prototype.handleKeyDown=function(y){return y.which===la.tab&&this.inputMap?this.inputMap.handleTab(y):Da.prototype.parentPrototype.handleKeyDown.call(this,y)};Da.prototype.autoBuildInputMap=function(y,I,p,x){if(null===y||"object"!==typeof y)y={wrapHoriz:y,wrapVert:I,searchAngleRatio:p,directionPreference:x};(I=this.inputMap?this.inputMap.getCurrentFocusedButton():null)&&void 0===y.restoreFocus&&(y.restoreFocus=!0);this.inputMap=
null;if(!this.subElements)return null;p=pc.buildInputTableFromContainer(this,y);if(!p)return null;x=-1;X.usingDirectionInput()&&(x=0,y.defaultFocusTo&&(y.restoreFocus=!0,I=y.defaultFocusTo));if(y.restoreFocus)for(I||(I=y.defaultFocusTo),y=0;y<p.length;y++)if(p[y].currObj===I){x=y;break}return this.inputMap=new Za(p,x)};var Mb=function(y){this.sourceList=y.sourceList;this.manager=y.manager;this.id=y.id;this.tracking=this.targets=null;this.committed=[];this.opts={allowFling:y.allowFling,allowCommittedFling:y.allowCommittedFling,
allowTwoPartTap:y.allowTwoPartTap}};Mb.prototype.syncSourceList=function(y){if(this.tracking){for(var I=-1,p=this.sourceList[this.tracking.sourceIndex],x=0;x<y.length;x++)if(y[x].uniqueID===p.uniqueID){I=x;break}0<=I?this.tracking.sourceIndex=I:(this.clearTracking(),this.manager.endDragTargetList())}this.sourceList=y};Mb.prototype.posToSourceIndex=function(y,I){for(var p=-1,x=0;x<this.sourceList.length;x++){var C=this.sourceList[x];if(C.isEnabled()){var J=C.getGlobalBounds();C.adjustBoundsForPointer(J,
I);if(db.pointInsideRect(y,J)){p=x;break}}}return p};Mb.prototype.posToTargetIndex=function(y,I){if(!this.targets)return-1;I=-1;for(var p=999999999,x=0;x<this.targets.length;x++){var C=this.targets[x];if(C.enabled){C=C.screenPos;var J=y.x-C.x,D=y.y-C.y;J=Math.sqrt(J*J+D*D);J<C.r&&J<p&&(p=J,I=x)}}return I};Mb.prototype.getFlingTargetIndex=function(y,I,p,x,C){if(!this.targets)return-1;var J=Math.sqrt(x.x*x.x+x.y*x.y),D=x.x/J;x=x.y/J;y=y.getWidth();window.clearDebugVectors();window.setDebugVector(I,
{x:I.x+200*D,y:I.y+200*x},"#0080F0");console.log("--- targets:");for(J=0;J<this.targets.length;J++){var T=this.targets[J];console.log("  target "+J+" pos "+T.screenPos.x+","+T.screenPos.y+" r "+T.screenPos.r)}console.log("---");T=J=-1;for(var W=0;W<this.targets.length;W++){var ka=this.targets[W];if(ka.enabled){var ja=ka.screenPos;ka=ja.x-I.x;var qa=ja.y-I.y,ta=Math.sqrt(ka*ka+qa*qa);ja.x-p.x;ja.y-p.y;window.setDebugVector(p,ja,"#FF4040");var wa=ka/ta,Ca=qa/ta;ja=ta/y;var Ea=Math.max(1,ja);Ea=Math.min(3,
Ea);Ea=1-(Ea-1)/2;var va=.95-.95*Ea;wa=D*wa+x*Ca;console.log("checking candidate "+W+" dot "+wa+", of allowed "+va);console.log("    nearness "+Ea+", widthUnits = "+ta/y);wa>va&&(Ea=20*wa+1/ja,console.log("  "+W+" OK... Weight "+Ea+" from dot "+wa+", dist "+ja),Ea>T&&(console.log("  Best: "+W),T=Ea,J=W,C.x=ka,C.y=qa,C.dist=ta))}}return J};Mb.prototype.isTrackingDrag=function(){return this.tracking};Mb.prototype.clearTracking=function(){this.tracking.dragHandler&&this.tracking.dragHandler.detach();
this.targets=this.tracking=null};Mb.prototype.mouseMove=function(y,I){if(this.tracking){var p=this.sourceList[this.tracking.sourceIndex];if(!p)return this.clearTracking(),!1;this.tracking.dragHandler||p.setPos(y.x+this.tracking.sourceRelPos.x,y.y+this.tracking.sourceRelPos.y);if(!this.targets)return!1;y=this.posToTargetIndex(y,I);0<=y&&this.targets[y];for(I=0;I<this.targets.length;I++)this.targets[I].highlighted=I!==y?!1:!0;return!1}y=this.posToSourceIndex(y,I);for(I=0;I<this.sourceList.length;I++)p=
this.sourceList[I],I!==y?p.setHighlighted(!1):p.setHighlighted(!0);return 0<=y};Mb.prototype.mouseDown=function(y,I){var p=this.posToSourceIndex(y,I);if(-1<p){var x=this.sourceList[p],C={x:x.place.pos.x-y.x,y:x.place.pos.y-y.y};x.isBeingDragged=!0;this.tracking={sourceIndex:p,sourceRelPos:C,sourceOrigPos:{x:x.place.pos.x,y:x.place.pos.y}};this.attachDragHandler(this.tracking,x,y,I);this.manager&&this.manager.getDragTargetList&&(this.targets=this.manager.getDragTargetList(x,this));if(this.targets)for(y=
0;y<this.targets.length;y++)I=this.targets[y],void 0===I.enabled&&(I.enabled=!0);return!0}return!1};Mb.prototype.attachDragHandler=function(y,I,p,x){y.dragHandler&&(z.logError("DragSet: did not expect to still have a draghandler"),this.dragHandler.detach(),this.dragHandler=null);I.setTracksMouse(!0);y=y.dragHandler=new Tb;var C=this;console.log("attach drag handler");y.attach(I,{allowPinchZoom:!1,allowFling:!0,minimumDragThreshold:0,meaningfulDragThreshold:0,smoothDrag:!1,getDragOffset:function(){return I.place.pos},
setDragOffset:function(J,D){I.killAllAnimators(ma.mover);I.setPos(J,D)},flingHandler:function(J,D,T){z.log("ds fling vel "+J.x+", "+J.y);D=I.parent.localToGlobalPos(D.x,D.y);T=I.parent.localToGlobalPos(T.x,T.y);C.handleFlingRelease(J,D,T)},flingStopHandler:function(){},releaseHandler:function(J,D){I.isInCommittedFling||(J=I.parent.localToGlobalPos(D.x,D.y),C.handleNormalRelease(J,null))},detachHandler:function(){I.setTracksMouse(!1)}});p=I.globalToLocalPos(p.x,p.y);I.mouseDown(p,x)};Mb.prototype.mouseUp=
function(y,I){return this.tracking&&this.tracking.dragHandler?!1:this.handleNormalRelease(y,I)};Mb.prototype.handleNormalRelease=function(y,I){this.manager.endDragTargetList&&this.manager.endDragTargetList();if(this.tracking){var p=this.sourceList[this.tracking.sourceIndex];if(!p)return this.clearTracking(),!1;p.isBeingDragged=!1;y=this.posToTargetIndex(y,I);0<=y&&p.isEnabled()?this.executeTargetDrop(this.targets[y],p,this.tracking.sourceIndex):this.manager.cancelDragDrop&&this.manager.cancelDragDrop(this,
this.tracking.sourceIndex,p,this.tracking.sourceOrigPos);this.clearTracking();return!0}this.targets=null;return!1};Mb.prototype.handleFlingRelease=function(y,I,p){var x=this;this.manager.endDragTargetList&&this.manager.endDragTargetList();if(this.tracking){var C=this.sourceList[this.tracking.sourceIndex];if(!C)return this.clearTracking(),!1;C.isBeingDragged=!1;var J={};I=this.getFlingTargetIndex(C,I,p,y,J);if(0<=I){console.log("good fling to target "+I);C.isInCommittedFling=!0;var D=this.targets[I];
I=J.dist/Math.sqrt(y.x*y.x+y.y*y.y);y={source:C,target:D,timeMax:I,time:0};J=new ma(ma.mover,C);J.setInterpFilter(ma.filterEaseOut);J.setTimer(I);I=C.getPos();p=C.parent.globalToLocalPos(D.screenPos.x,D.screenPos.y);J.setStartEndVectors(I,p);J.setDoneCallback(function(){x.executeTargetDrop(D,C,-1)});y.animator=J;console.log("made committed fling entry: "+y.timeMax);this.committed.push(y)}else this.manager.cancelDragDrop&&this.manager.cancelDragDrop(this,this.tracking.sourceIndex,C,this.tracking.sourceOrigPos);
this.clearTracking();return!0}this.targets=null;return!1};Mb.prototype.executeTargetDrop=function(y,I,p){I.isInCommittedFling=!1;I.triggerSourceAction&&I.triggerSourceAction(y,this,p,I);y.target.triggerTargetAction&&y.target.triggerTargetAction(y,this,p,I);this.manager.doneWithDragDrop&&this.manager.doneWithDragDrop(this,p,I)};Mb.prototype.cancelAll=function(y,I){this.manager&&this.manager.endDragTargetList();if(this.tracking){y=this.sourceList[this.tracking.sourceIndex];if(!y)return this.clearTracking(),
!1;y.isBeingDragged=!1;this.manager&&this.manager.cancelDragDrop(this,this.tracking.sourceIndex,y,this.tracking.sourceOrigPos);this.clearTracking();return!0}this.targets=null;return!1};Mb.prototype.update=function(y){};Mb.prototype.updateTargetEnabled=function(y,I){if(this.targets)for(var p=0;p<this.targets.length;p++){var x=this.targets[p];x.id===y&&(x.enabled=I,this.mouseMove(X.mousePos,null))}};Mb.prototype.drawDebug=function(y){y.strokeStyle="#FFFFFF";if(this.targets)for(var I=0;I<this.targets.length;I++){var p=
this.targets[I];p.enabled?p.highlighted?(y.lineWidth=25,y.strokeStyle="#FFFFB0"):(y.lineWidth=8,y.strokeStyle="#80A0A0"):(y.lineWidth=8,y.strokeStyle="#402020");p=p.screenPos;y.beginPath();y.arc(p.x,p.y,p.r,0,2*Math.PI);y.stroke()}};Mb.prototype.draw=function(y){};var Ec=function C(I,p,x){C.prototype.parentConstructor.call(this);this.style=C.FADE_TYPE;this.fadeInTime=.5;this.displayTime=1;this.fadeOutTime=.5;this.minFadeAlpha=0;this.maxFadeAlpha=1;this.onDeath=p;I(this,x);pa.getTopScreen().appendSubElement(this);
this.startAppear()};cb(Ec,w);Ec.prototype.elementType="rat_notification";Ec.FADE_TYPE=1;Ec.prototype.startAppear=function(){var I=new ma(ma.fader,this);I.setTimer(this.fadeInTime);I.setStartEnd(this.minFadeAlpha,this.maxFadeAlpha);I.setAutoDie();I.setDoneCallback(Zg)};var Zg=function(I,p){p=new ma(ma.fader,I);p.setTimer(I.fadeOutTime);p.setStartEnd(I.maxFadeAlpha,I.minFadeAlpha);p.setAutoDie();p.setAutoRemoveTarget();p.delay=I.displayTime;p.setDoneCallback($g)},$g=function(I,p){I.onDeath(I)};Ec.prototype.setDuration=
function(I){this.displayTime=I};Ec.prototype.setLeadInOut=function(I,p){this.fadeInTime=I;this.fadeOutTime="undefined"===typeof p?I:p};Ec.prototype.checkStacksWith=function(I){var p=this.getPos();I=I.getPos();z.log("Comparing two notes: ("+p.x+","+p.y+") and ("+I.x+","+I.y+")");return p.x===I.x&&p.y===I.y};Ec.prototype.doStackWith=function(I){var p=I.getPos();I=I.getSize();z.log("before bump: ("+p.x+","+p.y+") and height: "+I.h);this.setPos(p.x,p.y-I.h);p=this.getPos();z.log("After bump: ("+p.x+","+
p.y+")")};var Fc=function(){this.active=[];this.waiting=[];this.maxActive=1};Fc.prototype.requestNotification=function(I,p){this.active.length<this.maxActive?this.startNotification(I,p):this.enqueueNotification(I,p)};Fc.prototype.startNotification=function(I,p){I=new Ec(I,this.killNotification.bind(this),p);for(p=0;p<this.active.length;p++)I.checkStacksWith(this.active[p])&&I.doStackWith(this.active[p]);this.active.splice(this.active.length,0,I)};Fc.prototype.enqueueNotification=function(I,p){this.waiting.splice(this.waiting.length,
0,{callback:I,args:p})};Fc.prototype.dequeueNotification=function(){var I=this.waiting[0];this.waiting.splice(0,1);return I};Fc.prototype.killNotification=function(I){for(var p=0;p<this.active.length;p++)if(this.active[p]===I){this.active.splice(p,1);break}0<this.waiting.length&&(I=this.dequeueNotification(),this.startNotification(I.callback,I.args))};Fc.prototype.setMaxActive=function(I){this.maxActive=I};Fc.prototype.clearActive=function(){this.waiting=[]};Fc.prototype.clearWaiting=function(){this.active=
[]};Fc.prototype.clearAll=function(){this.clearActive();this.clearWaiting()};var zd=function x(p){p=fa.getString(p);x.prototype.parentConstructor.call(this,p)};cb(zd,ia);zd.prototype.setTextValue=function(p){zd.prototype.parentPrototype.translateAndSetTextValue.call(this,p)};zd.prototype.setTextValueRaw=function(p){zd.prototype.parentPrototype.setTextValue.call(this,p)};w.prototype.makeBackground=function(p){var x=new Ia(Ia.squareShape);x.setColor(p);this.insertSubElement(x);x.fitToParentSize();return this.elementBackground=
x};w.prototype.setBackground=w.prototype.makeBackground;w.prototype.setBackgroundFrame=function(p,x){this.elementBackground&&this.elementBackground.setFrame(p,x)};w.TOOL_TIP_TIME=.5;w.prototype.updateToolTip=function(p){if(!this.toolTip)return!1;if(("touch"===X.lastUIInputType&&this.flags&w.pressedFlag||"mouse"===X.lastUIInputType&&this.flags&w.mouseInFlag||"keyboard"===X.lastUIInputType&&this.toolTip.showForKeyboard&&this.flags&w.highlightedFlag||"controller"===X.lastUIInputType&&this.toolTip.showForController&&
this.flags&w.highlightedFlag)&&this.flags&w.visibleFlag&&(!this.allowTooltip||this.allowTooltip()))return this.toolTip.timer+=p,this.toolTip.timer>w.TOOL_TIP_TIME&&(this.toolTipPlacementFromMouse&&this.positionToolTip(this.toolTipPlacement,this.toolTipPlacementOffset,this.toolTipPlacementFromMouse),p=this.getGlobalPos(this.toolTipOffset.x,this.toolTipOffset.y),this.toolTip.setPos(p.x,p.y),p=new ub.Rect(0,0,Ha-this.toolTip.size.x,Ra-this.toolTip.size.y),this.toolTip.place.pos.limitToRect(p),this.toolTip.moveCallback&&
this.toolTip.moveCallback(this,this.toolTip),this.toolTipScreen.activeToolTip=this.toolTip),!0;this.toolTip.setVisible(!1);this.toolTip.timer=0;return!1};w.prototype.setTextToolTip=function(p,x,C,J){C||(C=O.black);x||(x=O.white);var D=new Ia(Ia.squareShape);D.setSize(200,20);D.setColor(C);D.setFrame(1,x);C=new ia(p);C.setFont("arial");C.setTextValue(p);C.setColor(x);this.sizeTextToolTip({fontSize:15},D,C);D.appendSubElement(C);this.setToolTip(D,J,"rightHigh",{x:6,y:0});return{container:D,textBox:C}};
w.prototype.addTextToolTip=w.prototype.setTextToolTip;w.prototype.sizeTextToolTip=function(p,x,C){x||(x=this.toolTip);C||(C=x.subElements[0]);"object"!==typeof p?p={fontSize:p}:p||(p={});p.fontSize=p.fontSize||15;p.maxWidth=p.maxWidth||1E3;p.maxHeight=p.maxWidth||p.fontSize;p.extraSpace=p.extraSpace||{};p.extraSpace.x=p.extraSpace.x||14;p.extraSpace.y=p.extraSpace.y||4;C.setSize(p.maxWidth,p.maxHeight);C.setFontSize(p.fontSize);C.setPos(p.extraSpace.x/2,p.extraSpace.y/2);var J=C.contentSize.x+p.extraSpace.x,
D=C.contentSize.y+p.extraSpace.y;p.extraSpace.right&&(J+=p.extraSpace.right);p.extraSpace.bottom&&(D+=p.extraSpace.bottom);x.setSize(J,D);C.autoSizeToContent()};w.prototype.positionToolTip=function(p,x,C){var J=this.toolTip;if(J){"undefined"===typeof x&&(x={x:0,y:0});var D=J.getSize(),T=this.getSize();C&&(T.x=T.y=16);if("none"===p||""===p)var W=D=0;else"top"===p?(W=(T.x-D.x)/2,D=-D.y):"topLeft"===p?(W=-D.x,D=-D.y):"topRight"===p?(W=T.x,D=-D.y):"bottom"===p?(W=(T.x-D.x)/2,D=T.y):"bottomLeft"===p?(W=
-D.x,D=T.y):"bottomRight"===p?(W=T.x,D=T.y):(W=T.x,D=T.y/3-D.y/2);C&&this.mousePos&&(W+=this.mousePos.x,D+=this.mousePos.y);J.setPos(W+x.x,D+x.y);this.toolTipPlacement=p;this.toolTipPlacementOffset={x:x.x,y:x.y};this.toolTipPlacementFromMouse=C;this.toolTipOffset=J.getPos().copy()}};w.prototype.setToolTip=function(p,x,C,J,D){"undefined"===typeof J&&(J={x:0,y:0});this.toolTip=p;this.positionToolTip(C,J,D);p.setVisible(!1);p.timer=0;x||(x=this.getTopParent(),this.toolTipScreenWasAssumed=!0);this.toolTipScreen=
x;this.setTracksMouse(!0)};w.prototype.getToolTip=function(){return this.toolTip};w.prototype.setToolTipScreen=function(p){this.toolTip&&(this.toolTipScreen=p,this.toolTipScreenWasAssumed=!1)};w.prototype.setToolTipMoveCallback=function(p){this.toolTip&&(this.toolTip.moveCallback=p)};w.prototype.setToolTipScreenRecursive=function(p){this.applyRecursively(w.prototype.setToolTipScreen,p)};w.prototype.animateScrollToShow=function(p,x,C,J){var D=this.contentOffset.copy();this.scrollToShow(p,x,C,D);return D.x!==
this.contentOffset.x||D.y!==this.contentOffset.y?this.animateScroll(D,J):null};w.prototype.animateScrollToShowElement=function(p,x,C,J){"undefined"===typeof x&&(x=0);"undefined"===typeof C&&(C=0);"undefined"===typeof J&&(J=0);p=p.getBounds(this.tempRect);this.animateScrollToShow({x:p.x+p.w/2,y:p.y+p.h/2},p.w/2+x,p.h/2+C,J)};w.prototype.animateScrollToCenter=function(p,x){var C=this.contentOffset.copy();this.scrollToCenter(p,C);this.animateScroll(C,x)};w.prototype.animateScroll=function(p,x){var C=
Va.killAnimatorsForElement(this,ma.scroller),J=new ma(ma.scroller,this);J.setTimer(x);J.setStartEndVectors({x:this.contentOffset.x,y:this.contentOffset.y},{x:p.x,y:p.y});J.setAutoDie();C&&J.setInterpFilter(ma.filterEaseOut);return J};w.prototype.animateScrollToShowLimited=function(p,x,C,J,D,T){var W=this.contentOffset.copy();this.scrollToShowLimited(p,x,C,J,D,W);return W.x!==this.contentOffset.x||W.y!==this.contentOffset.y?this.animateScroll(W,T):null};w.prototype.animateScrollToShow=function(p,x,
C,J){return this.animateScrollToShowLimited(p,x,C,x,C,J)};w.prototype.animateScrollToShowElement=function(p,x,C,J){"undefined"===typeof x&&(x=0);"undefined"===typeof C&&(C=0);"undefined"===typeof J&&(J=0);p=p.getBounds(this.tempRect);this.animateScrollToShow({x:p.x+p.w/2,y:p.y+p.h/2},p.w/2+x,p.h/2+C,J)};w.prototype.killAllAnimators=function(p){return Va.killAnimatorsForElement(this,p)};w.prototype.killMyAnimators=w.prototype.killAllAnimators;w.prototype.getTargetContentOffset=function(){var p=Va.getAnimatorsForElement(this,
ma.scroller);return p&&0<p.length?p[0].endValue:this.contentOffset.copy()};w.prototype.slideInFrom=function(p,x,C){void 0===x&&(x=1);p=p||"left";var J=this.getPos().copy(),D=this.getPos().copy();"left"===p&&(D.x=-this.getWidth()-20+this.center.x);"right"===p&&(D.x=Ha+20+this.center.x);"top"===p&&(D.y=-this.getHeight()-20+this.center.y);"bottom"===p&&(D.y=Ra+20+this.center.y);p=new ma(ma.mover,this);p.setTimer(x);C?p.setStartEndVectors(J,D):p.setStartEndVectors(D,J);return p};w.prototype.slideOutTo=
function(p,x){return this.slideInFrom(p,x,!0)};w.prototype.slideTo=function(p,x){void 0===x&&(x=1);p={x:p.x,y:p.y};var C=this.getPos().copy(),J=new ma(ma.mover,this);J.setTimer(x);J.setStartEndVectors(C,p);return J};w.prototype.scaleUpFrom=function(p,x,C){void 0===x&&(x=1);var J={x:.001,y:.001},D=this.getScale(),T=this.getPos().copy();p||(p={x:T.x,y:T.y});var W=new ma(ma.mover,this);W.setTimer(x);C?W.setStartEndVectors(T,p):W.setStartEndVectors(p,T);p=new ma(ma.scaler,this);p.setTimer(x);C?p.setStartEndVectors(D,
J):p.setStartEndVectors(J,D);return{moveAnimator:W,scaleAnimator:p}};w.prototype.zoomInFrom=w.prototype.scaleUpFrom;w.prototype.scaleDownTo=function(p,x){return this.scaleUpFrom(p,x,!0)};w.prototype.fadeIn=function(p,x,C){void 0===p&&(p=1);void 0===x&&(x=0);void 0===C&&(C=1);var J=new ma(ma.fader,this);J.setTimer(p);J.setStartEnd(x,C);return J};w.prototype.fadeOut=function(p,x,C){void 0===x&&(x=1);void 0===C&&(C=0);this.fadeIn(p,x,C)};var Ad={settings:Pd,focusTracker:Dc,Element:w,Shape:Ia,ScrollView:kb,
StateLook:Pc,TextBox:ia,BubbleBox:xb,Sprite:Ta,Button:ba,TranslatedTextBox:zd,EditText:Xa,DOMEditText:pb,DragHandler:Tb,ListBox:Ub,DropList:Eb,Fill:Oc,FillBar:ld,FillSprite:oc,OffscreenImage:Rc,PageSlider:Ja,SizeBox:Pa,SpiderChart:Sc,TreeView:eb,Animator:ma,animationManager:Va,FocusTracker:hc,DragSet:Mb,Screen:Da,inputMapBuilder:pc,Notification:Ec,doConfirmDialog:function(p){var x=p.width,C=p.height;"undefined"===typeof x&&(x=420);"undefined"===typeof C&&(C=200);"undefined"===typeof p.title&&(p.title=
"");"undefined"===typeof p.body&&(p.body="");"undefined"===typeof p.yesText&&(p.yesText="Yes");"undefined"===typeof p.yesCommand&&(p.yesCommand=Zc.OK_COMMAND);"undefined"===typeof p.noText&&(p.noText="");"undefined"===typeof p.noCommand&&(p.noCommand=Zc.CANCEL_COMMAND);"undefined"===typeof p.userData&&(p.userData=null);p.bgColor||(p.bgColor={r:80,g:80,b:80});p.frameColor||(p.frameColor={r:120,g:120,b:120});p.pos||(p.pos={x:Ha/2-x,y:Ha/3-C/2});p.titleFont||(p.titleFont=p.font);p.bodyFont||(p.bodyFont=
p.font);p.buttonFont||(p.buttonFont=p.font);p.titleFont||(p.titleFont={font:"Impact",size:14});p.bodyFont||(p.titleFont={font:"Arial",size:12});var J=new Screen;J.setModal(!0);J.setPos(p.pos.x,p.pos.y);J.setSize(x,C);J.setBackground(new O(p.bgColor.r,p.bgColor.g,p.bgColor.b));J.setFrame(4,new O(120,120,120));""!==p.title&&(x=new ia(p.title),x.setFont(p.titleFont.font||p.titleFont),x.setFontSize(p.titleFont.size||14),x.setPos(0,0),x.setSize(J.size.x,14),x.setAlign(ia.alignCenter),x.setColor(new O(250,
250,220)),J.appendSubElement(x));""!==p.body&&(x=new ia(p.body),x.setFont(p.bodyFont.font||p.bodyFont),x.setFontSize(p.bodyFont.size||12),x.setPos(0,40),x.setSize(J.size.x,14),x.setAlign(ia.alignCenter),x.setColor(new O(190,190,190)),J.appendSubElement(x));C=2*J.size.y/3-30;""!==p.yesText&&(x=ba.makeCheapButton(null,new O(150,200,150)),x.setTextValue(p.yesText),x.setSize(70,30),x.setPos(50,C),x.setCommand(p.yesCommand,p.userData),J.appendSubElement(x));""!==p.noText&&(x=ba.makeCheapButton(null,new O(150,
200,150)),x.setTextValue(p.noText),x.setSize(70,30),x.setPos(J.size.x-30-70,C),x.setCommand(p.noCommand,p.userData),J.appendSubElement(x));pa.pushScreen(J);J.handleCommand=function(D,T){pa.popScreen();return!1};return J},NotificationManager:Fc,uiData:Wa};Fb.add(Va,"animationManager");for(var Ve in Ad)Wa.canSetupFromData(Ad[Ve])&&Wa.addConstructable(Ve,Ad[Ve]);for(var yg in vg)Ad[yg]=vg[yg];var We={init:function(){We.updateAchievement=sa.Wraith?Wraith.UpdateAchievement:function(){}}};We.init();var Tc=
{Connection:function(p,x){x||(x=firebase);this.db=x=x.database();this.baseRef=x.ref(p);this.state="init";this.connected=!1;if("firebase"in window){z.log("firebase connection init");this.connectedRef=x.ref(".info/connected");var C=this;this.connectCallback=this.connectedRef.on("value",function(J){"init"===C.state&&(C.state="ok");!0===J.val()?(z.log("++ rat.firebase connected"),C.connected=!0,C.connectFunction&&C.connectFunction(C)):(z.log("-- rat.firebase disconnected"),C.connected=!1,C.disconnectFunction&&
C.disconnectFunction(C))})}else z.log("!no firebase!")}};Tc.Connection.prototype.onDisconnect=function(p){this.disconnectFunction=p};Tc.Connection.prototype.onConnect=function(p){this.connectFunction=p};Tc.Connection.prototype.ref=function(p){return this.baseRef.child(p)};Tc.Connection.prototype.close=function(){this.connectedRef&&this.connectCallback&&(this.connectedRef.off("value",this.connectCallback),this.connectedRef=this.connectCallback=null);this.baseRef=null};Tc.Connection.prototype.isReady=
function(){return"ok"!=this.state?!1:!0};Tc.Connection.prototype.isConnected=function(){return this.connected};var hb={init:function(p,x){z.log("matchmaking init");hb.connection=new Tc.Connection(p,x);hb.mGamesRef=hb.connection.ref("match/")},shutDown:function(){z.log("matchmaking shut down");hb.connection.close();hb.connection=null},isReady:function(){return hb.connection.isReady()},isConnected:function(){return hb.connection.connected},watchGameList:function(p,x){hb.mGamesRef.on("value",function(C){C=
C.val();var J=[];hb.gameListVal=C;var D=0,T;for(T in C)if(Yb(C,T)){D++;if(20<D)break;C[T].id=T;J.push(C[T]);hb.augmentPlayerInfo(T);hb.augmentAgeInfo(T)}p(J)})},unwatchGameList:function(){hb.mGamesRef.off()},augmentPlayerInfo:function(p){if(hb.gameListVal[p])hb.connection.ref("games/"+p+"/_players/").on("value",function(x){if(hb.gameListVal[p]){var C=0,J=null;if(x=x.val())for(var D in x)C++,x[D].isHost&&(J=x[D].name);hb.gameListVal[p].activePlayerCount=C;hb.gameListVal[p].activeHostName=J}})},augmentAgeInfo:function(p){hb.connection.ref("games/"+
p+"/_info/").on("value",function(x){hb.gameListVal[p]&&(x=x.val())&&x.hostHeartbeat&&(x=(new Date).getTime()-x.hostHeartbeat,hb.gameListVal[p].age=x)})},deleteOldGames:function(p){p||(p=12E5);console.log("checking to delete with age "+p/6E4+" minutes");var x=hb.connection.ref("games/");x.once("value",function(C){if(C=C.val()){var J=0,D=0,T;for(T in C){var W=C[T];6E5<(new Date).getTime()-W._info.hostHeartbeat&&(z.log("M KILL OLD "+T),x.child(T).remove(),D++);J++}z.log("Checked "+J+" games for age, deleted "+
D)}})},deleteEmptyGames:function(){console.log("checking to delete with no players.");var p=hb.connection.ref("games/");p.once("value",function(x){if(x=x.val()){var C=0,J=0,D;for(D in x){var T=x[D];T._players&&T._players!=={}||(z.log("M KILL EMPTY "+D),p.child(D).remove(),J++);C++}z.log("Checked "+C+" games for empty, deleted "+J)}})},hostGame:function(p,x,C,J){var D=hb.mGamesRef.push();hb.hostGameWithID(D.key,p,x,C,J);return D.key},hostGameWithID:function(p,x,C,J,D){C||(C={});D=hb.mGamesRef.child(p);
D.onDisconnect().remove();D.set({name:x,config:C});J&&J({isHost:!0,name:x,id:p,config:C})},joinGame:function(p,x,C){if(!this.gameListVal)return!1;C=this.gameListVal[p];if(!C)return!1;x&&(C=tb(C,!0),C.id=p,C.isHost=!1,x(C));return!0}},N={playerList:{},map:{},debugLog:function(p){},init:function(p,x,C){N.config=p||{};void 0===N.config.hostMigration&&(N.config.hostMigration=!0);void 0===N.config.hostHeartbeatFrequency&&(N.config.hostHeartbeatFrequency=2);N.projectRoot=N.config.projectRoot||"";p=N.config.useFirebase;
N.timer=0;N.debugLog("sync init "+N.config.id);N.connection=new Tc.Connection(N.projectRoot,p);N.connection.onDisconnect(function(J){console.log("ON DIS")});N.connection.onConnect(function(J){console.log("ON CON");N.connectMyPlayerInfo()});N.handler=C;N.myPlayerInfo=x;x.isHost&&(N.isHost=!0);N.mRef=N.connection.ref("games/"+N.config.id);x=new Date;C=x.toUTCString();x={lastDate:x.getTime(),lastDateString:C};C=N.mRef.child("_info/");N.statsRef=C;C.on("value",function(J){N.gameStats=J.val()});C.update(x);
N.hookUpPlayerList();N.hookUpEventList();N.hookUpRequestList();N.hookUpChat();N.hookUpMatchConfig();N.setupOwnershipTracking();N.debugLog("sync init done");z.registerCommand("disconnect",function(J,D){N.connection.db.goOffline()});z.registerCommand("connect",function(J,D){N.connection.db.goOnline()},["reconnect"]);return{playerID:N.myPlayerInfo._syncID}},shutDown:function(){N.playersRef.off();N.connection.close();N.connection=null},isReady:function(){return N.connection.isReady()},isConnected:function(){return N.connection.isConnected()},
getMatchConfig:function(){if(N.config.matchConfig)return N.config.matchConfig},hookUpPlayerList:function(){N.playersRef=N.mRef.child("_players/");N.isHost&&N.playersRef.set({});N.myPlayerRef=N.playersRef.push();N.myPlayerInfo._syncID=N.myPlayerRef.key;N.connectMyPlayerInfo();N.playersRef.on("value",function(p){N.playerList=p.val();null===N.playerList&&(N.playerList={});p=N.myPlayerInfo._syncID;N.playerList[p]&&(N.myPlayerInfo=N.playerList[p]);N.myPlayerInfo._syncID=p;N.handler.playerListChanged&&
N.handler.playerListChanged(N.playerList)});N.playersRef.on("child_removed",function(p){var x=p.val();if(N.config.hostMigration&&x.isHost)if(N.myPlayerInfo._syncID===p.key)N.demoteHost();else for(var C in N.playerList)if(!N.playerList[C].isHost){C===N.myPlayerInfo._syncID&&N.promoteHost(0);break}})},hookUpEventList:function(){N.eventsRef=N.mRef.child("_events/");N.eventsRef.push({syncJoin:!0});N.eventsRef.limitToLast(1).once("child_added",function(p){N.eventsRef.startAt(null,p.key).on("child_added",
function(x){(x=x.val())&&N.handler.handleSyncEvent&&!x.syncJoin&&N.handler.handleSyncEvent(x)})})},hookUpRequestList:function(){function p(x){N.isHost&&(x=x.val())&&!x.syncJoin&&("own"===x.code||"disown"===x.code?N.handleOwnership(x):N.handler.handleSyncRequest&&N.handler.handleSyncRequest(x))}N.requestsRef=N.mRef.child("_requests/");N.isHost?(z.log("Aggressive read child approach..."),N.requestsRef.on("child_added",p)):(N.requestsRef.push({syncJoin:!0}),N.requestsRef.limitToLast(1).once("child_added",
function(x){N.requestsRef.startAt(null,x.key).on("child_added",p)}))},hookUpChat:function(){N.chatLog=[];N.chatRef=N.mRef.child("_chat/");N.chatRef.limitToLast(10).on("child_added",function(p){if(p=p.val())N.chatLog.unshift(p),10<N.chatLog.length&&N.chatLog.pop(),N.handler.handleChat&&N.handler.handleChat(p),N.chatLog.sort(function(x,C){return C.timestamp-x.timestamp})})},hookUpMatchConfig:function(){N.matchRef=N.mRef.child("_match/");if(N.isHost&&N.config.matchConfig)N.config.matchConfig.id=N.config.id,
N.matchRef.set(N.config.matchConfig);else N.matchRef.on("value",function(p){N.config.matchConfig=p.val();z.log("got matchconfig: "+N.config.matchConfig)})},setupOwnershipTracking:function(){N.ownList={};N.ownRef=N.mRef.child("_own/");N.ownRef.on("value",function(p){(p=p.val())||(p={});N.ownList=p})},iOwn:function(p){return p._syncID?N.ownList[p._syncID]===N.myPlayerInfo._syncID?!0:!1:!1},getOwner:function(p){return p._syncID?N.ownList[p._syncID]:0},handleOwnership:function(p){if("own"===p.code){if(N.ownList[p.params.syncID])return!1;
N.ownRef.child(p.params.syncID).set(p.params.playerID);return!0}return"disown"===p.code?(N.ownList[p.params.syncID]===p.params.playerID&&N.ownRef.child(p.params.syncID).set(null),!0):!1},demoteHost:function(){z.log("demote me from host.");N.isHost&&(N.isHost=!1,N.myPlayerInfo.isHost=!1,N.updateOperations(),N.handler&&N.handler.demoteHost&&N.handler.demoteHost())},promoteHost:function(p){z.log("promote me to host.");N.isHost=!0;N.myPlayerInfo.isHost=!0;N.updateOperations();N.config.matchConfig&&N.config.matchConfig.id&&
N.config.matchConfig.isPublic&&hb&&(hb.init(N.projectRoot),hb.hostGameWithID(N.config.matchConfig.id,N.config.matchConfig.name,N.config.matchConfig),hb.shutDown());N.handler&&N.handler.promoteHost&&N.handler.promoteHost(p);N.myPlayerRef.set(N.myPlayerInfo)},updateOperations:function(){for(var p in N.map){var x=N.map[p];x.operations=N.isHost?x.hostOperations:x.clientOperations}},connectMyPlayerInfo:function(){N.myPlayerRef.onDisconnect().remove();N.myPlayerInfo.isHost=!!N.myPlayerInfo.isHost;N.myPlayerRef.set(N.myPlayerInfo)},
updatePlayer:function(p,x){N.playersRef.child(p).transaction(function(C){if(C)return x})},prop:{}};N.prop.none=0;N.prop.change=1;N.prop.init=2;N.prop.writeNext=4;N.prop.low=8;N.prop.reckon=16;N.register=function(p,x,C){var J=C?C.props:null;if(J)J=tb(J,!0);else{var D=N.pickDefaultProps(x);J=D.props;0===D.propCount&&(J=void 0,z.logWarning("WARNING: defaulting to all props for "+p))}var T=C?C.hostOperations:null;T||(T={write_init:!0,write:!0,read:!0});var W=C?C.clientOperations:null;W||(W={write_init:!1,
write:!0,read:!0});D=N.isHost?T:W;var ka=C?C.readCallback:null,ja=C?C.lowTimer:void 0;ja||(ja=3);C=Array.isArray(x);var qa=N.mRef.child(p);N.map[p]={sourceData:x,props:J,curData:{},ref:qa,operations:D,hostOperations:T,clientOperations:W,isArray:C,lowTimer:ja,lowTimerMax:ja};if(D.write_init||D.write)if(N.debugLog("write initial value "+p),C)for(!D.write_init&&0<x.length&&z.log("rat sync ERROR: please don't register an array with write but no write_init"),T=0;T<x.length;T++){W=N.copyProps(x[T],J);ja=
qa.push(W);var ta=ja.key;x[T]._syncID=ja.key;N.map[p].curData[ta]=W}else J=N.copyProps(x,J),N.map[p].curData=J,D.write_init&&qa.set(J);if(D.read)if(C)qa.on("child_added",function(wa){if(N.suppressRead!==p){var Ca=N.map[p];N.debugLog("read: child_added "+p+" : "+wa.key);var Ea=wa.val();wa=wa.key;0>N.findInSourceListByID(x,wa)&&(Ca.curData[wa]=Ea,Ea._syncID=wa,Ca=tb(Ea,!0),x.push(Ca))}}),qa.on("child_removed",function(wa){var Ca=N.map[p];N.debugLog("read: child_removed "+p+" : "+wa.key);var Ea=N.findInSourceListByID(x,
wa.key);0<=Ea&&(delete Ca.curData[wa.key],x.splice(Ea,1))}),qa.on("child_changed",function(wa){var Ca=N.map[p],Ea=wa.key,va=N.findInSourceListByID(x,Ea);N.debugLog("read: child_changed "+p+" : "+wa.key+" :#"+va);0<=va&&(wa=wa.val(),Ca.isWriting||N.applyProps(wa,Ca.sourceData[va],Ca.props),Ca.curData[Ea]=N.copyProps(wa,Ca.props),ka&&!Ca.isWriting&&ka(p,wa,va))});else qa.on("value",function(wa){var Ca=N.map[p];N.debugLog("read: value for '"+p+"' : "+wa.key);if(wa=wa.val())Ca.isWriting||N.applyProps(wa,
Ca.sourceData,Ca.props),Ca.curData=N.copyProps(wa,Ca.props),ka&&!Ca.isWriting&&ka(p,wa)})};N.pickDefaultProps=function(p){Array.isArray(p)&&(p=p[0]);if(!p)return{propCount:0,props:{}};var x={},C=0,J;for(J in p)Yb(p,J)&&"function"!==typeof p[J]&&(C++,x[J]=1);return{propCount:C,props:x}};N.findInSourceListByID=function(p,x){for(var C=0;C<p.length;C++)if(p[C]._syncID===x)return C;return-1};N.copyProps=function(p,x){if(Array.isArray(p)){for(var C=[],J=0;J<p.length;J++){var D=N.copyProps(p[J],x);C.push(D)}return C}C=
{};for(J in x)x=typeof p[J],"undefined"!==x&&"function"!==x&&(C[J]="object"===x?tb(p[J],!0):p[J]);return C};N.applyProps=function(p,x,C){for(var J in p)"object"===typeof p[J]?(x[J]&&"object"===typeof x[J]||(x[J]={}),N.applyProps(p[J],x[J],null)):x[J]=p[J]};N.update=function(p){var x=N.timer;N.timer+=p;for(var C in N.map){var J=N.map[C];J.lowTimer&&!J.updateLow&&(J.lowTimer-=p,0>=J.lowTimer&&(J.updateLow=!0,J.lowTimer=J.lowTimerMax))}N.config.hostMigration&&N.config.matchConfig&&(x/2|0)!==(N.timer/
2|0)&&N.checkActiveHost();N.isHost&&(x/2|0)!==(N.timer/2|0)&&N.checkActiveOwners();p=N.config.hostHeartbeatFrequency;0<p&&N.isHost&&(x/p|0)!==(N.timer/p|0)&&N.writeHostHeartbeat()};N.writeHostHeartbeat=function(){var p=new Date,x=p.toUTCString();p={hostHeartbeat:p.getTime(),hostHeartbeatString:x};N.statsRef.update(p)};N.checkActiveHost=function(p,x){if(N.isConnected()&&N.gameStats){p=!1;var C,J;for(J in N.playerList)N.playerList[J].isHost?p=!0:C||(C=J);p||(z.log("detected no host"),C===N.myPlayerInfo._syncID&&
(C=0,N.gameStats.hostHeartbeat&&(C=((new Date).getTime()-N.gameStats.hostHeartbeat)/1E3),N.promoteHost(C)))}};N.checkActiveOwners=function(){var p={},x=!1,C;for(C in N.ownList)N.playerList[N.ownList[C]]||(p[C]=null,x=!0,z.log("Dead owner - object available again."));x&&N.ownRef.update(p)};N.updateObjectIfChanged=function(p,x){function C(Ca,Ea,va,Ma){var ua=!1;if(Array.isArray(Ea)&&void 0!==va){Ca.length!==Ea.length&&(N.debugLog("write [] "+Ma+" (whole array) "),W[Ma]=Ea,T=!0);for(var Aa=0;Aa<Ea.length;Aa++)C(Ca[Aa],
Ea[Aa],va,Ma+"/"+Aa)&&(ua=!0);return ua}var Hb=va;void 0===Hb&&(Hb=Ea);for(Aa in Hb){Hb=!1;var Vb=0;va&&va[Aa]&&"object"!==typeof va[Aa]&&(Vb=va[Aa]);Vb&N.prop.writeNext&&(Hb=!0,va[Aa]&=~N.prop.writeNext,Vb&=N.prop.reckon,Vb&=N.prop.low);if(!(Vb&N.prop.reckon)){var Uc=Ea[Aa],md=Ca[Aa];if(Uc&&!md||md&&!Uc||typeof md!==typeof Uc)Hb=!0;if(Hb||"object"!==typeof Uc)Uc!==md&&(Hb=!0);else{var Gc=void 0;va&&"object"===typeof va[Aa]&&(Gc=va[Aa]);C(md,Uc,Gc,Ma+"/"+Aa)&&(ua=!0)}!Hb||Vb&N.prop.low&&!D.updateLow||
(N.debugLog("write-> "+Ma+" . "+Aa),W[Ma+"/"+Aa]=Uc,ua=T=!0)}}return ua}function J(Ca,Ea,va,Ma){W={};T=!1;C(Ca,Ea,va,"");if(Ea._syncUpdates){for(var ua in Ea._syncUpdates)W[ua]=Ea._syncUpdates[ua];delete Ea._syncUpdates;T=!0}T&&Ma.update(W)}var D=N.map[p];if(D&&D.operations.write){var T=!1,W={};x||(x=D.sourceData);D.isWriting=!0;if(D.isArray){for(var ka=0;ka<x.length;ka++){W={};var ja=x[ka]._syncID;if(ja)J(D.curData[ja],x[ka],D.props,D.ref.child(ja));else{var qa=N.copyProps(x[ka],D.props);N.suppressRead=
p;var ta=D.ref.push(qa);N.suppressRead=0;ja=ta.key;x[ka]._syncID=ta.key;D.curData[ja]=qa;N.debugLog("write-> "+p+" child "+ja+" (new)")}}for(var wa in D.curData)0>N.findInSourceListByID(x,wa)&&(N.debugLog("delete-> "+p+" child "+wa),delete D.curData[wa],D.ref.child(wa).remove())}else J(D.curData,x,D.props,D.ref);D.isWriting=!1;D.updateLow=!1}};N.updateAllChanges=function(){for(var p in N.map)N.updateObjectIfChanged(p,N.map[p].sourceData)};N.markChanged=function(p,x,C){x._syncUpdates=x._syncUpdates||
{};x._syncUpdates["/"+C]=x[C]};N.queueRequest=function(p,x,C){p={code:p,params:x,timestamp:(new Date).getTime(),playerID:N.myPlayerInfo._syncID};N.requestsRef.push(p)};N.requestOwnership=function(p,x,C){x||void 0===C||(x=N.map[p].sourceData[C]);x&&N.queueRequest("own",{key:p,syncID:x._syncID,playerID:N.myPlayerInfo._syncID})};N.releaseOwnership=function(p,x,C){x||void 0===C||(x=N.map[p].sourceData[C]);x&&N.queueRequest("disown",{key:p,syncID:x._syncID,playerID:N.myPlayerInfo._syncID})};N.queueEvent=
function(p,x){p={code:p,params:x,timestamp:(new Date).getTime()};N.eventsRef.push(p)};N.queueChat=function(p,x,C){x||(x="chat");C||(C=null);p={text:p,code:x,params:C,timestamp:(new Date).getTime(),playerID:N.myPlayerInfo._syncID,playerName:N.myPlayerInfo.name};N.chatRef.push(p)};N.watchObject=function(p,x){N.mRef.child(p).on("value",function(C){x(p,C.val())})};var Hc=function(p,x,C){this.type=p;"undefined"===typeof this.type&&(this.type=ib.topType);"undefined"===typeof x&&(x="");this.localUserID=
x;"undefined"===typeof C&&(C=10);this.trackCount=C;this.lastWritePriority=this.lastWriteKey=null;this.scoreList=[]};Hc.prototype.isValid=function(){return!0};Hc.prototype.setLocalUserID=function(p){this.localUserID=p};Hc.prototype.getScores=function(){return this.scoreList};Hc.prototype.findScoreIndexByKey=function(p){for(var x=0;x<this.scoreList.length;x++)if(this.scoreList[x].keyName===p)return x;return-1};Hc.prototype.updateRanks=function(){for(var p=0;p<this.scoreList.length;p++)this.scoreList[p].rank=
p+1};Hc.prototype.getScorePosition=function(p){if(!this.isValid()||0===this.scoreList.length)return 0;if(this.scoreList[this.scoreList.length-1].score>=p)return this.scoreList.length;var x=0,C=this.scoreList.length-1;do{var J=Math.floor((x+C)/2);this.scoreList[J].score>=p?x=J+1:C=J-1}while(C>x);x===C&&(J=this.scoreList[x].score>=p?x+1:x);return J};Hc.prototype.debugDumpScores=function(){};var ib=function T(x,C,J,D){T.prototype.parentConstructor.call(this,C,J,D);this.address=x;this.scoreView=null;
this.changed=!0;if(x=T.getFirebase())this.boardRef=new x,this.startTracking()};cb(ib,Hc);ib.getFirebase=function(){if("undefined"!==typeof Firebase)return Firebase};ib.topType=1;ib.aboveType=2;ib.belowType=3;ib.allType=4;ib.prototype.isValid=function(){return this.boardRef?!0:!1};ib.prototype.startTracking=function(){if(this.boardRef){var x=this.type===ib.aboveType||this.type===ib.belowType;if(!x||!this.scoreView)if(!x||!this.lastWritePriority){this.scoreView&&this.scoreView.off();this.scoreList=
[];this.scoreView=this.type===ib.topType?this.boardRef.limit(this.trackCount):this.type===ib.belowType?this.boardRef.endAt(this.lastWritePriority).limit(this.trackCount):this.type===ib.aboveType?this.boardRef.startAt(this.lastWritePriority).limit(this.trackCount):this.boardRef;var C=this;this.scoreView.on("child_added",function(J,D){C.handleScoreAdded(J,D)});this.scoreView.on("child_removed",function(J){C.handleScoreRemoved(J)});x=function(J,D){C.handleScoreRemoved(J);C.handleScoreAdded(J,D)};this.scoreView.on("child_moved",
x);this.scoreView.on("child_changed",x)}}};ib.prototype.updateRanks=function(){this.type!==ib.topType&&this.type!==ib.allType||Hc.prototype.updateRanks.call(this)};ib.prototype.handleScoreAdded=function(x,C){var J={},D=x.val();J.data=D.data;J.keyName=x.name();J.name=D.name;J.score=D.score;J.rank=null;null!==C?(x=this.findScoreIndexByKey(C),0>x&&(x=0)):x=this.scoreList.length;this.scoreList.splice(x,0,J);this.updateRanks();this.changed=!0};ib.prototype.handleScoreRemoved=function(x){x=this.findScoreIndexByKey(x.name());
-1!==x&&this.scoreList.splice(x,1);this.changed=!0};ib.prototype.postScore=function(x,C){if(this.boardRef){var J=1E4*x;x={score:x,data:C,name:this.localUserID};C=this.boardRef.push();C.setWithPriority(x,J);this.lastWriteKey=C.name();this.lastWritePriority=J;this.startTracking()}};ib.prototype.clearScores=function(){};var Qd=function(x,C,J,D){this.topScores=new ib(x,ib.topType,C,10);this.aboveScores=new ib(x,ib.aboveType,C,D+1);this.belowScores=new ib(x,ib.belowType,C,D+1);this.numTop=J;this.numAround=
D;this.scoreList=[]};Qd.prototype.setLocalUserID=function(x){this.topScores.setLocalUserID(x);this.aboveScores.setLocalUserID(x);this.belowScores.setLocalUserID(x)};Qd.prototype.postScore=function(x,C){this.topScores.postScore(x,C);this.aboveScores.lastWriteKey=this.topScores.lastWriteKey;this.aboveScores.lastWritePriority=this.topScores.lastWritePriority;this.aboveScores.startTracking();this.belowScores.lastWriteKey=this.topScores.lastWriteKey;this.belowScores.lastWritePriority=this.topScores.lastWritePriority;
this.belowScores.startTracking()};Qd.prototype.collateLists=function(){if(this.topScores.changed||this.aboveScores.changed||this.belowScores.changed){this.scoreList=[];var x=this.numTop,C;for(C=0;C<this.aboveScores.scoreList.length;C++)this.scoreList[this.scoreList.length]=this.aboveScores.scoreList[C];for(C=1;C<this.belowScores.scoreList.length;C++)this.scoreList[this.scoreList.length]=this.belowScores.scoreList[C];if(0<this.scoreList.length)for(C=0;C<this.topScores.scoreList.length;C++)if(this.topScores.scoreList[C].keyName===
this.scoreList[0].keyName){for(var J=this.topScores.scoreList[C].rank,D=0;D<this.scoreList.length;D++)this.scoreList[D].rank=J++;C<this.numTop&&(x=C);break}for(C=0;C<x&&C<this.topScores.scoreList.length;C++)this.scoreList.splice(C,0,this.topScores.scoreList[C]);x===this.numTop&&this.scoreList.length>this.numTop&&(this.scoreList[this.numTop].gap=!0);for(C=0;C<this.scoreList.length;C++)this.scoreList[C].isUser=this.scoreList[C].keyName===this.topScores.lastWriteKey?!0:!1;this.topScores.changed=!1;this.aboveScores.changed=
!1;this.belowScores.changed=!1}};Qd.prototype.getScores=function(){this.collateLists();return this.scoreList};var ne=function(x,C,J,D){ib.prototype.parentConstructor.call(this,C,J,D);this.boardName=x;this.scoreList=Qa.getStorage(Qa.permanentLocal).getObject(this.boardName);this.scoreList||(this.scoreList=[]);this.updateRanks()};cb(ne,Hc);ne.prototype.postScore=function(x,C){var J=1E4*x;C={score:x,data:C,name:this.localUserID};x=this.getScorePosition(x);this.scoreList.splice(x,0,C);this.updateRanks();
this.lastWriteKey=this.localUserID;this.lastWritePriority=J;this.scoreList.length>this.trackCount&&this.scoreList.splice(this.trackCount,this.scoreList.length-this.trackCount);Qa.getStorage(Qa.permanentLocal).setObject(this.boardName,this.scoreList)};ne.prototype.clearScores=function(){this.scoreList=[];Qa.getStorage(Qa.permanentLocal).setObject(this.boardName,this.scoreList)};var ah={achievements:We,firebase:Tc,match:hb,sync:N,Scoreboard:ib,LocalScoreboard:ne,RelevantScores:Qd},ad={makeScreen:function(x,
C,J){if(!ad.auditionScreen)return x=new ad.AuditionScreen(x,C,J),ad.auditionScreen=x,x.setModal(!0),x.name="keyAnimAuditionScreen",pa.pushScreen(x),x},killScreen:function(){var x=ad.auditionScreen;if(x&&(pa.popScreen(),ad.auditionScreen=null,x.opts.onKilled))x.opts.onKilled(x)}},Wb=function T(C,J,D){T.prototype.parentConstructor.call(this);this.animSet=this.skin=null;this.opts=D=D||{};D.uiScale=D.uiScale||1;this.buildScreenUI(D.uiScale);this.buildFromAssets(C,J)};cb(Wb,Da);ad.AuditionScreen=Wb;Wb.prototype.buildFromAssets=
function(C,J){this.skin=C;this.animSet=J;this.curAnimIndex=0;this.animSet.setAnimByIndex(0);this.updateCurText()};Wb.prototype.updateCurText=function(){var C=this.animSet.getAnimCount();C="#"+(this.curAnimIndex+1)+"/"+C+"\n";var J=this.animSet.getCurAnimation();J&&(C+=J.getName());this.curText.setTextValue(C)};Wb.prototype.updatePlaybackText=function(){var C="";if(this.animSet&&0<=this.curAnimIndex){var J=this.animSet.getCurAnimation();if(J){var D=J.getTime();J=J.getTimeEnd();C+=gg(D,2,2)+" / "+J}}this.playbackText.setTextValue(C)};
Wb.prototype.updateSelf=function(C){this.animSet&&this.animSet.update(C);this.updatePlaybackText()};Wb.prototype.drawSelfPost=function(C,J){if(C.skin){C=C.skin;var D=C.getSize(),T=D.w;D=D.h;var W=.5*Ha,ka=.3*Ra;C.isCenteredX()||(W-=T/2,ka-=D/2);var ja;this.animSet&&0<=this.curAnimIndex&&(ja=this.animSet.getCurAnimation());J.save();J.translate(W,ka);ja&&(ka=ja.getTransform("root"),J.translate(5*ka.translation.x,5*ka.translation.y),J.rotate(ka.rotation),J.scale(ka.scale.x,ka.scale.y));C.draw(J,0,0,
T,D);J.restore();this.debugDrawAnimCurve(J,ja)}};Wb.prototype.debugDrawAnimCurve=function(C,J){};Wb.prototype.keyDown=function(C){if(C.which===la.leftBracket)this.goToPrev();else if(C.which===la.rightBracket)this.goToNext();else if(C.which===la[" "])this.togglePlay();else return!1;return!0};Wb.prototype.goToFirst=function(){this.curAnimIndex=0;this.animSet.setAnimByIndex(this.curAnimIndex);this.updateCurText()};Wb.prototype.goToPrev=function(){this.curAnimIndex--;var C=this.animSet.getAnimCount();
0>this.curAnimIndex&&(this.curAnimIndex=C-1);this.animSet.setAnimByIndex(this.curAnimIndex);this.updateCurText()};Wb.prototype.goToNext=function(){this.curAnimIndex++;var C=this.animSet.getAnimCount();this.curAnimIndex>=C&&(this.curAnimIndex=0);this.animSet.setAnimByIndex(this.curAnimIndex);this.updateCurText()};Wb.prototype.play=function(){var C=this.animSet.getCurAnimation();C&&(C.setTime(0),C.autoUpdateTime=!0)};Wb.prototype.pause=function(){};Wb.prototype.togglePlay=function(){};Wb.prototype.buildScreenUI=
function(C){function J(Ca,Ea,va,Ma,ua){var Aa=ba.makeCoolButton(null,new O(150,150,200));Aa.setTextValue(Ca);Aa.setSize(qa,ta);Aa.setPos(Ea,va);Aa.setCallback(ua,Ma);T.appendSubElement(Aa)}function D(){var Ca=30+wa+qa/2;wa+=1.1*qa|0;return Ca}var T=this;T.removeAllSubElements();T.setPos(0,0);T.setSize(Ha,Ra);var W=new Ia(Ia.squareShape);W.setPos(0,0);W.setSize(Ha,Ra);W.setColor(new O(0,0,0));T.appendSubElement(W);W=new ia("KeyAnim Auditioning");W.setPos(0,0);W.setSize(Ha,40*C);W.setFont("Arial");
W.setFontSize(24*C);W.setColor(O.yellow);W.centerText();T.appendSubElement(W);W=new ia("[current]");var ka=150*C,ja=Ra-ka-160;W.setPos(50,ja);W.setSize(Ha-100,ka);W.setFont("Arial");W.setFontSize(18*C);W.setColor(O.white);W.setFrame(4,O.darkGray);W.setAlign("left");W.setBaseline("top");T.appendSubElement(W);T.curText=W;W=new ia("[playback]");ka=50*C;W.setPos(50,ja-ka-10);W.setSize(Ha-100,ka);W.setFont("Arial");W.setFontSize(18*C);W.setColor(O.white);W.setFrame(4,O.darkGray);W.setAlign("left");W.setBaseline("top");
T.appendSubElement(W);T.playbackText=W;var qa=100*C,ta=30*C,wa=0;C=Ra-90-ta;J("Prev",D(),C,"prev",function(Ca,Ea){T.goToPrev()});J("Next",D(),C,"next",function(Ca,Ea){T.goToNext()});J("Play",D(),C,"play",function(Ca,Ea){T.play()});J("Pause",D(),C,"pause",function(Ca,Ea){T.pause()});J("Done",D(),C,"done",function(Ca,Ea){ad.killScreen()});T.autoBuildInputMap()};var nd={makeScreen:function(C,J,D){if(!nd.auditionScreen)return C=new nd.AuditionScreen(C,J,D),nd.auditionScreen=C,C.setModal(!0),C.name="ImageAuditionScreen",
pa.pushScreen(C),C},killScreen:function(){pa.popScreen();nd.auditionScreen=null}},dc=function W(J,D,T){W.prototype.parentConstructor.call(this);J||(J={});T||(T=1);this.providedAssets=J;this.providedOpts=D;this.buildScreenUI(T);this.buildAssetList(J,D)};cb(dc,Da);nd.AuditionScreen=dc;dc.prototype.buildAssetList=function(J,D){function T(ja,qa){var ta="";if("string"===typeof ja)ta+=(ja||qa)+"\n(string)\n";else if("object"===typeof ja){var wa=ja.res;Array.isArray(wa)&&(wa=wa[0]);ta+=(qa||ja.name||wa||
"(unknown)")+"\n(object)\n"}ja.desc=ta;W.push(ja)}var W=[];if(J)if(Array.isArray(J))for(D=0;D<J.length;D++)T(J[D]);else if("object"===typeof J)for(var ka in J)T(J[ka],ka);this.assetList=W;this.assetCount=W.length;this.curIndex=0;this.updateCurText()};dc.prototype.updateCurText=function(){var J="#"+(this.curIndex+1)+"/"+this.assetCount+"\n",D=this.assetList[this.curIndex];D&&(J+=D.desc);this.curText.setTextValue(J)};dc.prototype.getCurImageRef=function(J){J=this.assetList[this.curIndex];return J?(J=
J.image||J.imageRef)?J:null:null};dc.prototype.updateSelf=function(J){var D=this.getCurImageRef();D&&D.update(J)};dc.prototype.drawSelfPost=function(J,D){if(this.assetList[this.curIndex]){J=this.getCurImageRef();var T=J.getSize(),W=T.w;T=T.h;var ka=.5*Ha,ja=.3*Ra;J.isCenteredX()||(ka-=W/2,ja-=T/2);J.draw(D,ka,ja,W,T)}};dc.prototype.keyDown=function(J){if(J.which===la.leftBracket)this.goToPrev();else if(J.which===la.rightBracket)this.goToNext();else if(J.which===la[" "])this.play();else return!1;return!0};
dc.prototype.goToFirst=function(){this.curIndex=0;this.updateCurText()};dc.prototype.goToPrev=function(){this.curIndex--;0>this.curIndex&&(this.curIndex=this.assetCount-1);this.updateCurText()};dc.prototype.goToNext=function(){this.curIndex++;this.curIndex>=this.assetCount&&(this.curIndex=0);this.updateCurText()};dc.prototype.play=function(){};dc.prototype.pause=function(){};dc.prototype.buildScreenUI=function(J){function D(Ca,Ea,va,Ma,ua){var Aa=ba.makeCoolButton(null,new O(150,150,200));Aa.setTextValue(Ca);
Aa.setSize(qa,ta);Aa.setPos(Ea,va);Aa.setCallback(ua,Ma);W.appendSubElement(Aa)}function T(){var Ca=30+wa+qa/2;wa+=1.1*qa|0;return Ca}var W=this;W.removeAllSubElements();W.setPos(0,0);W.setSize(Ha,Ra);var ka=new Ia(Ia.squareShape);ka.setPos(0,0);ka.setSize(Ha,Ra);ka.setColor(new O(0,0,0));W.appendSubElement(ka);ka=new ia("Image Auditioning");ka.setPos(0,0);ka.setSize(Ha,40*J);ka.setFont("Arial");ka.setFontSize(24*J);ka.setColor(O.yellow);ka.centerText();W.appendSubElement(ka);ka=new ia("[current]");
var ja=150*J;ka.setPos(50,Ra-ja-160);ka.setSize(Ha-100,ja);ka.setFont("Arial");ka.setFontSize(18*J);ka.setColor(O.white);ka.setFrame(4,O.darkGray);ka.setAlign("left");ka.setBaseline("top");W.appendSubElement(ka);W.curText=ka;var qa=100*J,ta=30*J,wa=0;J=Ra-90-ta;D("Prev",T(),J,"prev",function(Ca,Ea){W.goToPrev()});D("Next",T(),J,"next",function(Ca,Ea){W.goToNext()});D("Play",T(),J,"play",function(Ca,Ea){W.play()});D("Pause",T(),J,"pause",function(Ca,Ea){W.pause()});D("Refresh",T(),J,"refresh",function(Ca,
Ea){W.buildAssetList(W.providedAssets,W.providedOpts);W.goToFirst()});D("Done",T(),J,"done",function(Ca,Ea){nd.killScreen()});W.autoBuildInputMap()};var od={makeScreen:function(J,D,T,W){if(!od.auditionScreen)return J=new od.AuditionScreen(J,D,T),od.auditionScreen=J,J.setModal(!0),J.name="animSetAuditionScreen",W&&pa.pushScreen(J),J},killScreen:function(){pa.popScreen();od.auditionScreen=null}},Ib=function ka(D,T,W){ka.prototype.parentConstructor.call(this);D||(D=[]);W||(W=1);this.providedOpts=T;this.buildScreenUI(W);
this.buildAssetList(D,T)};cb(Ib,Da);od.AuditionScreen=Ib;Ib.prototype.buildAssetList=function(D,T){this.animSets=D;this.setCount=D.length;this.animCount=this.animIndex=this.setIndex=0;this.updateCurAnim();this.updateCurText()};Ib.prototype.updateCurAnim=function(){if(this.curAnimSet=this.animSets[this.setIndex]){this.animCount=this.curAnimSet.getAnimCount();this.animIndex=Math.min(this.animIndex,this.animCount);var D=this.curAnimSet.animFromIndex(this.animIndex);this.curAnimSet.setAnimDirectly(D)}else this.animIndex=
this.animCount=0};var bh=[{formatChar:"*",color:new O(250,200,250)},{formatChar:"^",color:O.yellow}];Ib.prototype.updateAnimText=function(){var D=this.getCurAnimation();if(D){var T=D.getFrame();D=D.getFrameCount();this.animText.setTextValue(""+(T+1)+" / "+D)}};Ib.prototype.updateCurText=function(){var D;this.curAnimSet&&this.curAnimSet&&(D=this.curAnimSet.name||this.curAnimSet.animSetDef.name);D=D||"";if(this.curAnimSet&&this.animCount){var T=this.curAnimSet.getCurAnimation();T=T.animDef.name}D="Set "+
(this.setIndex+1)+"/"+this.setCount+": *"+D+"*\n";D+="Anim #"+(this.animIndex+1)+"/"+this.animCount+": ^"+(T||"")+"^\n";D=ia.formatText(D,bh);this.curText.setTextValue(D)};Ib.prototype.getCurImageRef=function(D){return this.curAnimSet?this.curAnimSet.getCurAnimation():null};Ib.prototype.getCurAnimation=Ib.prototype.getCurImageRef;Ib.prototype.updateSelf=function(D){var T=this.getCurImageRef();T&&T.update(D);this.updateAnimText()};Ib.prototype.drawSelfPost=function(D,T){if(this.curAnimSet){D=this.curAnimSet.getCurAnimation();
var W=D.getSize(),ka=W.w;W=W.h;var ja=.5*Ha,qa=.3*Ra;if(D.isCenteredX()){var ta=ja;var wa=qa}else ta=ja-ka/2,wa=qa-W/2;D.draw(T,ta,wa,ka,W);T.strokeStyle="#000000";T.lineWidth=4;T.strokeRect(ja-ka/2,qa-W/2,ka,W)}};Ib.prototype.keyDown=function(D){if(D.which===la.leftBracket)this.changeAnim(-1);else if(D.which===la.rightBracket)this.changeAnim(1);else if(D.which===la[" "])this.play();else return!1;return!0};Ib.prototype.goToFirstAnimSet=function(){this.setIndex=0;this.updateCurAnim();this.updateCurText()};
Ib.prototype.changeAnimSet=function(D){this.setIndex=(this.setIndex+D+this.setCount)%this.setCount;this.updateCurAnim();this.updateCurText()};Ib.prototype.goToFirstAnim=function(){this.animIndex=0;this.updateCurAnim();this.updateCurText()};Ib.prototype.changeAnim=function(D){this.animIndex=(this.animIndex+D+this.animCount)%this.animCount;this.updateCurAnim();this.updateCurText()};Ib.prototype.play=function(){var D=this.getCurAnimation();D&&D.setAnimPaused(!1)};Ib.prototype.pause=function(){var D=
this.getCurAnimation();D&&D.setAnimPaused(!0)};Ib.prototype.changeFrame=function(D){var T=this.getCurAnimation();if(T){this.pause();var W=T.getFrame(),ka=T.getFrameCount();T.setFrame((W+D+ka)%ka);this.updateCurText()}};Ib.prototype.buildScreenUI=function(D){function T(va,Ma,ua){var Aa=30+Ca+ka/2;Ca+=1.1*ka|0;var Hb=Ea,Vb=ba.makeCoolButton(null,new O(150,150,200));Vb.setTextValue(va);Vb.setSize(ka,ja);Vb.setPos(Aa,Hb);Vb.setCallback(ua,Ma);W.appendSubElement(Vb)}var W=this,ka=100*D,ja=30*D;W.removeAllSubElements();
W.setPos(0,0);W.setSize(Ha,Ra);var qa=new Ia(Ia.squareShape);qa.setPos(0,0);qa.setSize(Ha,Ra);qa.setColor(new O(128,128,128));W.appendSubElement(qa);qa=new ia("AnimSet Auditioning");qa.setPos(0,0);qa.setSize(Ha,40*D);qa.setFont("Arial");qa.setFontSize(24*D);qa.setColor(O.yellow);qa.centerText();W.appendSubElement(qa);qa=new ia("[current]");var ta=100*D,wa=Ra-ta-3*ja-20;qa.setPos(50,wa);qa.setSize(Ha-100,ta);qa.setFont("Arial");qa.setFontSize(18*D);qa.setColor(O.white);qa.setFrame(4,O.darkGray);qa.setAlign("left");
qa.setBaseline("top");qa.enableDefaultSpecialFormatting();W.appendSubElement(qa);W.curText=qa;qa=new ia("[anim]");ta=18*D;qa.setPos(Ha/2-100,wa-ta);qa.setSize(200,ta);qa.setFont("Arial");qa.setFontSize(18*D);qa.setColor(O.white);qa.setAlign("right");qa.setBaseline("top");W.appendSubElement(qa);W.animText=qa;var Ca=0,Ea=Ra-3*ja;T("-Set","sprev",function(va,Ma){W.changeAnimSet(-1)});T("+Set","snext",function(va,Ma){W.changeAnimSet(1)});T("-Anim","aprev",function(va,Ma){W.changeAnim(-1)});T("+Anim",
"anext",function(va,Ma){W.changeAnim(1)});T("Refresh","refresh",function(va,Ma){W.buildAssetList(W.providedAssets,W.providedOpts);W.goToFirstAnim();W.goToFirstAnimSet()});T("Done","done",function(va,Ma){od.killScreen()});Ca=0;Ea+=ja+ja/2;T("Play","play",function(va,Ma){W.play()});T("Pause","pause",function(va,Ma){W.pause()});T("<","<",function(va,Ma){W.changeFrame(-1)});T(">",">",function(va,Ma){W.changeFrame(1)});W.autoBuildInputMap()};var Nb={testScreenOpts:{},makeScreen:function(D,T){if(void 0===
D||"object"!==typeof D)D={uiScale:D};Nb.testScreenOpts=D;D.uiScale||(D.uiScale=1);Nb.testScreen=new Da;Nb.testScreen.modal=!0;Nb.testScreen.fullOpaque=!0;Nb.testScreen.name="AudioTestScreen";Nb.rememberDefaultClick=ba.defaultClickSound;ba.defaultClickSound=null;Nb.buildTestScreenUI(Nb.testScreen,D);T&&pa.pushScreen(Nb.testScreen);return Nb.testScreen},killScreen:function(){ba.defaultClickSound=Nb.rememberDefaultClick;pa.popScreen();var D=Nb.testScreen;Nb.testScreen=null;if(Nb.testScreenOpts&&Nb.testScreenOpts.onKilled)Nb.testScreenOpts.onKilled(D)},
buildTestScreenUI:function(D,T){function W(){var ua=V.getSoundIDByIndex(D.curIndex),Aa=V.getSoundInfo(ua),Hb=Aa.source;Hb||(Hb="[Load was never triggered]");var Vb=Y.floor(100*Aa.volume)/100;D.curText.setTextValue("Current Sound\n\n#"+(D.curIndex+1)+"/"+D.soundCount+": "+ua+"\nsource: "+Hb+"\nduration: "+Aa.duration+"\nvolume: "+Vb+"\nloaded: "+V.isSoundLoaded(ua)+"\ncurrent time: "+Aa.currentPos+"\nready State: "+Aa.readyState+"\nerror: "+Aa.errorCode)}function ka(ua,Aa,Hb,Vb,Uc,md){var Gc=ba.makeCheapButton(null,
new O(150,150,200));Gc.setTextValue(ua);Gc.setSize(wa,Ca);Gc.setPos(Aa,Hb);Gc.setCallback(md,Uc);Gc.setFontSize(24*Vb);Gc.setTextInset(10,10);D.appendSubElement(Gc)}function ja(){var ua=30+Ea+wa/2;Ea+=1.1*wa|0;return ua}function qa(){Ea=0;Ma-=Ca+8*ta}var ta=T.uiScale;D.removeAllSubElements();D.setPos(0,0);D.setSize(Ha,Ra);T=new Ia(Ia.squareShape);T.setPos(0,0);T.setSize(Ha,Ra);T.setColor(new O(50,50,0));D.appendSubElement(T);T=new ia("Audio Test");T.setPos(0,0);T.setSize(Ha,40*ta);T.setFont("Arial");
T.setFontSize(24*ta);T.setColor(O.yellow);T.centerText();D.appendSubElement(T);T=new ia("[current]");T.setPos(50,30+10*ta);T.setSize(Ha-100,200*ta);T.setFont("Arial");T.setFontSize(18*ta);T.setColor(O.white);D.appendSubElement(T);D.curText=T;T=new ia("[groups]");T.setPos(Ha/2+100*ta,30+10*ta);T.setSize(Ha/2,200*ta);T.setBaseline("top");T.setFrame(2);T.setFont("Arial");T.setFontSize(18*ta);T.setColor(O.white);D.appendSubElement(T);D.groupText=T;D.curIndex=0;D.soundCount=V.getSoundCount();W();D.update=
function(ua){W();ua="Groups\n\n";for(var Aa in V.groups){var Hb=V.groups[Aa];ua+=Aa+": vol:"+(100*Hb.volume|0)/100+", enabled:"+Hb.enabled+"\n"}D.groupText.setTextValue(ua)};D.keyDown=function(ua){if(ua.which===la.leftBracket)D.prevSound();else if(ua.which===la.rightBracket)D.nextSound();else if(ua.which===la[" "])D.playSound();else return!1;return!0};D.prevSound=function(){D.curIndex--;0>D.curIndex&&(D.curIndex=D.soundCount-1);W()};D.nextSound=function(){D.curIndex++;D.curIndex>=D.soundCount&&(D.curIndex=
0);W()};D.playSound=function(){var ua=V.getSoundIDByIndex(D.curIndex);V.playSound(ua)};D.getCurGroup=function(){var ua=V.getSoundIDByIndex(D.curIndex);return V.getSoundGroup(ua)};var wa=100*ta,Ca=60*ta,Ea=0,va,Ma=Ra-30-Ca;ka("Prev",ja(),Ma,ta,"prev",function(ua,Aa){D.prevSound()});ka("Next",ja(),Ma,ta,"next",function(ua,Aa){D.nextSound()});ka("Play",ja(),Ma,ta,"play",function(ua,Aa){D.playSound()});ka("Pause",ja(),Ma,ta,"pause",function(ua,Aa){ua=V.getSoundIDByIndex(D.curIndex);V.pauseSound(ua)});
ka("Stop",ja(),Ma,ta,"stop",function(ua,Aa){va=V.getSoundIDByIndex(D.curIndex);V.pauseSound(va);V.resetSound(va)});ka("Done",ja(),Ma,ta,"done",function(ua,Aa){Nb.killScreen()});qa();ka("|<",ja(),Ma,ta,"tostart",function(ua,Aa){va=V.getSoundIDByIndex(D.curIndex);V.pauseSound(va);V.seekSound(va,0);V.playSound(va)});ka("1/4",ja(),Ma,ta,"toonefourth",function(ua,Aa){va=V.getSoundIDByIndex(D.curIndex);V.pauseSound(va);V.seekSound(va,.25,!0);V.playSound(va)});ka("2/4",ja(),Ma,ta,"tohalf",function(ua,Aa){va=
V.getSoundIDByIndex(D.curIndex);V.pauseSound(va);V.seekSound(va,.5,!0);V.playSound(va)});ka("3/4",ja(),Ma,ta,"tothreefourths",function(ua,Aa){va=V.getSoundIDByIndex(D.curIndex);V.pauseSound(va);V.seekSound(va,.75,!0);V.playSound(va)});ka(">|",ja(),Ma,ta,"toend",function(ua,Aa){va=V.getSoundIDByIndex(D.curIndex);V.seekSound(va,1,!0)});ka("loop",ja(),Ma,ta,"loop",function(ua,Aa){va=V.getSoundIDByIndex(D.curIndex);V.setSoundLooping(va,!V.getSoundLooping(va))});qa();ka("< vol",ja(),Ma,ta,"voldown",function(ua,
Aa){va=V.getSoundIDByIndex(D.curIndex);ua=V.getSoundVolume(va);ua-=.1;0>ua&&(ua=0);V.setSoundVolume(va,ua)});ka("vol >",ja(),Ma,ta,"volup",function(ua,Aa){va=V.getSoundIDByIndex(D.curIndex);ua=V.getSoundVolume(va);ua+=.1;1<ua&&(ua=1);V.setSoundVolume(va,ua)});ka("fade down",ja(),Ma,ta,"fadedown",function(ua,Aa){va=V.getSoundIDByIndex(D.curIndex);V.fadeSoundTo(va,.05,.8)});ka("fade up",ja(),Ma,ta,"fadeup",function(ua,Aa){va=V.getSoundIDByIndex(D.curIndex);V.unFadeSound(va,.8)});qa();ka("fade grp",
ja(),Ma,ta,"gfadedown",function(ua,Aa){ua=D.getCurGroup();V.fadeGroupTo(ua,.05,.8)});ka("fade grp up",ja(),Ma,ta,"gfadeup",function(ua,Aa){ua=D.getCurGroup();V.fadeGroupTo(ua,1,.8)});ka("mute grp",ja(),Ma,ta,"gmute",function(ua,Aa){ua=D.getCurGroup();V.muteGroup(ua)});ka("unmute grp",ja(),Ma,ta,"gmutedown",function(ua,Aa){ua=D.getCurGroup();V.muteGroup(ua,!1)});D.autoBuildInputMap()}},ch={keyAnimAudition:ad,imageAudition:nd,animSetAudition:od,audioAudition:Nb},zg,Xe,Ye,dh=function(){Oa.isCacheLoaded()&&
(z.log("rat preload done."),clearInterval(Ye),Ye=null,"undefined"!==typeof Xe&&Xe())},eh=ra.setDraw,fh=ra.setPostUIDraw,gh=ra.setUpdate;Fb.add(X,"input");Fb.add(U,"particle");Fb.add(Ad,"ui");Fb.add(pa,"screenManager");Fb.add(V,"audio");Na.Matrix=Qb;Na.addEventListener=re;Na.addOSEventListener=Cb;Na.ads=Ya;Na.assert=Wg;Na.audio=V;Na.auditions=ch;Na.bezier=ug;Na.bezierEase=Bb;Na.commandManager=Zc;Na.console=z;Na.data=Yg;Na.debug=Vg;Na.eventEmitter=fd;Na.eventMap=cc;Na.events=Ga;Na.fileAccess={save:function(D,
T,W){if("undefined"===typeof Blob)z.log("Unable to save.   Not supported");else if("string"!==typeof D&&(D=JSON.stringify(D)),D=new Blob([D],{type:"text/plain"}),sa.IEBrowser&&10<=sa.IEVersion&&window.navigator.msSaveBlob)window.navigator.msSaveBlob(D,T||"file");else{var ka=document.createElement("a");ka.href=window.URL.createObjectURL(D);ka.download=T;ka.click()}W&&W()},openFile:function(D,T){var W=document.createElement("input");W.type="file";document.body.appendChild(W);W.onchange=function(){W.parentNode.removeChild(W);
var ka=W.files;W=void 0;var ja=new FileReader,qa="";ja.onload=function(){qa+=ja.result};for(var ta=0;ta<ka.length;++ta)ja.readAsText(ka[ta]);ja.onloadend=function(){ja.onload=void 0;ja.onloadend=void 0;ja.error?(alert("error: "+ja.error.message),T&&T(ja.error)):D&&D(qa)}};W.click()},selectFile:function(D,T,W){var ka=document.createElement("input");ka.type="file";void 0!==W&&(ka.multiple=W);document.body.appendChild(ka);ka.onchange=function(){ka.parentNode.removeChild(ka);var ja=ka.files;ka=void 0;
D&&D(ja)};ka.click()}};Na.graphics=cg;Na.howlerAudio={enable:function(){var D=V;D.implementation="howler";var T=tb(D,!1),W=D.RatSound;W.prototype.isPlaying=function(){return this.a.playing()};W.prototype.isPaused=function(){return!this.a.playing()};W.prototype.getCurrentTime=function(){if("loaded"!==this.a.state())return 0;var ja=this.a.seek();return"object"===typeof ja?0:ja};W.prototype.setCurrentTime=function(ja){return this.a.seek(ja)};W.prototype.getDuration=function(){return this.a.duration()};
W.prototype.play=function(){this.a.play()};W.prototype.stop=function(){this.a.stop()};W.prototype.pause=function(){this.a.pause()};W.prototype.unload=function(){this.a.unload()};W.prototype.isLooping=function(){return this.a.loop()};W.prototype.setLooping=function(ja){this.a.loop(ja)};W.prototype.getVolume=function(){return this.a.volume()};W.prototype.setVolume=function(ja){this.a.volume(ja)};var ka=function(){if(!window.Howl)return z.logError("You need to add howler.js to your project somewhere"),
null;window.Howler.autoSuspend=!1};D.init=function(ja){ka();T.init(ja)};D.makeSound=function(ja,qa){if(!window.Howl)return z.logError("You need to add howler.js to your project somewhere"),null;var ta=new Howl({src:[ja]}),wa=new D.RatSound(ta);wa.src=ja;D._setSoundGroup(wa,qa.group);var Ca=D._setSoundInitialVolume(wa,qa.volume)*D.globalVolume;D.log("set volume for "+ja+" to "+Ca);ta.volume(Ca);qa.loop&&ta.loop(!0);return wa};D.getSoundInfo=function(ja){var qa=D.sounds[ja];if(qa&&qa[0])return qa=qa[0],
{id:ja,duration:qa.a.duration(),source:qa.src,volume:qa.a.volume(),currentPos:qa.a.seek(),readyState:qa.a.state(),errorCode:"none"};D.log("Requested info for nonexistent sound"+ja,0,ja);return null};D.isSoundLoaded=function(ja){var qa=D.sounds[ja];return qa&&qa[0]?"loaded"===qa[0].a.state():(D.log("Tried to check if nonexistent audio ("+ja+") is loaded",0),null)};ka()}};Na.init=function(D,T){T=T||{};zg||(z.log("Initializing Rat..."),ra.init(T),da.init(),Yf(D,T.gfxInit),z.attachGraphics(ca,cg,jb),
Fb.processAll("init"),ra.initAnimationCycle(),X.autoHandleEvents(),zg=!0)};Na.input=X;Na.license=vb;Na.live=ah;Na.math=Y;Na.particle=U;Na.preLoadImages=function(D,T){Xe=T;Oa.preLoadImages(D);Ye=setInterval(dh,1E3/60)};Na.ratParts=Fb;Na.removeEventListener=function(D,T,W){if(!T)return!1;var ka=Ga.registered[D];if(!ka)return!1;D=Ga.firing[D];for(var ja,qa=0;qa!==ka.length;++qa)if(ja=ka[qa],ja.func===T&&ja.ctx===W)return D&&(D.index<=qa&&--D.index,--D.stopAt),ka.splice(qa,1),!0;return!1};Na.removeOSEventListener=
function(D,T,W,ka){D.removeEventListener?D.removeEventListener(T,W,!!ka):D.detachEvent?D.detachEvent(T,W):"undefined"!==typeof window&&window.removeEventListener&&window.removeEventListener(T,W,!!ka)};Na.screenManager=pa;Na.setDraw=eh;Na.setUIDraw=fh;Na.setUpdate=gh;Na.spaces=Tg;Na.storage=Qa;Na.system=ra;Na.ui=Ad;Na.unitTest=yd;Na.user=bb;Na.utils=Qg;Object.defineProperty(Na,"__esModule",{value:!0})})
